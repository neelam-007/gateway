$Id$
Layer 7 Technologies, inc.

SSG deployment steps for a clean redhat linux box

Preconditions

Redhat linux is installed including postgresql server

know the root password ....

PREPARING THE SERVER
=========================================

Networking
----------
As root user

Set hostname. /etc/sysconfig/network sets it permanently

Hostname command with the above name to set it on a running system

Create user gateway, set the password for this user from the install kit.

adduser gateway
passwd gateway (note fla: jay, i dont think we need a passwd for that user)

Check /etc/hosts. make sure first line reads 127.0.0.1 localhost localhost.localdomain

Set IP addresses, using netconfig eth0/eth1

If dns does not resolve, adding a line in /etc/hosts makes configuration cleaner.
        i.p.addy      hostname hostname.domain.com
        is the standard pattern.

eth0 is assumed to be external address.

user postgres should already exist, its only accessible by "su - postgres", do not set
a password. The account should not be able to be logged into.


Server Software
---------------

As user gateway.

Install the toolkit into /ssg
This includes the tomcat, the jdk, the gateway WAR and the config
The kit build SHOULD have included the above configured hostname and root ca name.
if not,
Consult the reconfig documents for a post install

Database:

as Postgres:
    initdb --pgdata=/var/lib/pgsql/data

    change /var/lib/pgsql/data/postgresql.conf

    Allow network access (required for jdbc access)

    look for tcpip_socket = false, set to true

    Allow scalability of database:

    uncomment and set max_connections to 100
    uncomment and set shared_buffers to 256

    Set tcp to only listen on localhost

    look for virtual_host. Uncomment it, set to '127.0.0.1'


As root:

Restart psql server

    service postgresql restart

make sure it starts at boot

    chkconfig postgresql on

as Postgres:

	createdb ssg
	psql ssg -f /ssg/etc/db/postgres/ssg.sql
    psql ssg;
	CREATE USER gateway WITH PASSWORD 'same_as_linux_passwd';
	GRANT ALL ON
	    hibernate_unique_key, identity_provider, internal_group, internal_user,
	    internal_user_group, published_service, client_cert
	TO gateway;
	Edit Auth file /var/lib/pgsql/data/pg_hba.conf
    Add this line:
            host  ssg  gateway  127.0.0.1  255.255.255.255  password

DB is now in place

As Gateway:
 copy etc/catalina.policy in $TOMCAT_HOME/conf

As root
 cp /ssg/dist/etc/ssgruntimedefs.sh /etc/profile.d

Sets JAVA_HOME TOMCAT_HOME

 echo "su - gateway -c /ssg/tomcat/bin/startup.sh -security" >> /etc/rc.d/rc.local

Starts the gateway on machine boot.

As gateway

 startssg
