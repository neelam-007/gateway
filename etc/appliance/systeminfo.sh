#!/bin/bash -u
#
# Copyright (C) 2007 Layer 7 Technologies Inc.
#
# File: systeminfo.sh
# Purpose: This script is run by SSG Ping service to collect additional system
#          information. Text produced is appended as preformatted text to the
#          response HTML.
. /opt/SecureSpan/Appliance/libexec/envclean

echo "********************************************************************************"
echo "****************************** Kernel Information ******************************"
echo "********************************************************************************"
uname -an
echo
echo

echo "********************************************************************************"
echo "******************** Kernel Boot Parameters (/proc/cmdline) ********************"
echo "********************************************************************************"
cat /proc/cmdline
echo
echo

echo "********************************************************************************"
echo "********************************* Drive Space **********************************"
echo "********************************************************************************"
df -h
echo
echo

echo "********************************************************************************"
echo "********************************** Free Space **********************************"
echo "********************************************************************************"
free
echo
echo

echo "********************************************************************************"
echo "********************** Memory Information (/proc/meminfo) **********************"
echo "********************************************************************************"
cat /proc/meminfo
echo
echo

echo "********************************************************************************"
echo "********************************* Process List *********************************"
echo "********************************************************************************"
ps aufxwwww
echo
echo

echo "********************************************************************************"
echo "************************** Kernel and SSG RPM Packages *************************"
echo "********************************************************************************"
rpm -qa | egrep '^(kernel|ssg)-' | sort
echo
echo

echo "********************************************************************************"
echo "***************************** Tarari (cpp_manager) *****************************"
echo "********************************************************************************"
if [ -e /usr/local/Tarari/bin/cpp_manager ]; then
   /usr/local/Tarari/bin/cpp_manager -s
else
   echo cpp_manager not found
fi
echo
echo

echo "********************************************************************************"
echo "****************************** MySQL daemon status *****************************"
echo "********************************************************************************"
/sbin/service mysqld status
echo
echo

echo "********************************************************************************"
echo "********************************* MySQL status *********************************"
echo "********************************************************************************"
mysql ssg -u root -e "SHOW STATUS"
echo
echo

echo "********************************************************************************"
echo "****************************** MySQL slave status ******************************"
echo "********************************************************************************"
mysql ssg -u root -e "SHOW SLAVE STATUS\G"
echo
echo