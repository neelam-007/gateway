set -u
set -e

trap doLogout INT

SYSWIZARD="/ssg/sysconfigwizard/systemconfig.sh"
CONFWIZARD="/ssg/configwizard/ssgconfig.sh"
UPDATEWIZARD="/ssg/updatewizard/ssgupdatewizard.sh"
GETROOT="su -"

checkForUpdater() {
    if [ -e "/ssg/updatewizard/ssgupdatewizard.sh" ] ; then
        UPDATER_PRESENT="true"
    else
        UPDATER_PRESENT=""
    fi
}

doLogout() {
    exit
}

checkForUpdater
isValid="n"
while [ "$isValid" != "y" ]
do
    clear
    echo "Welcome to the SecureSpan Gateway"
    echo
    echo "This user account allows you to configure the appliance"
    echo "What would you like to do?"
        echo "1) Configure networking on this SecureSpan Gateway appliance"
        echo "2) Configure the SecureSpan Gateway application on this appliance"
        echo "3) Use a privileged shell (root)"
        echo "4) Logout (no reboot)"
        echo "5) Reboot the SSG appliance (apply the new configuration)"
        if [ "${UPDATER_PRESENT}" = "true" ] ; then
            echo "6) Upgrade the SecureSpan Appliance"
        fi
        echo -n "Please make a selection: "
        read choice

        case $choice in
                1) 	clear;
                    echo "1) Configure networking"
                    echo "2) Display current network configuration"
                    echo -n "Please make a selection: "
                    read choice
                    case $choice in
                        1) clear
                           (${SYSWIZARD});;
                        2) clear
                           (${SYSWIZARD} -printConfig);;
                        *) echo "That is not a valid selection"
                    esac
                    echo "Press enter to continue";
                    read;
                    clear;;
                2)  clear;
                    (${CONFWIZARD});
                    echo "Press enter to continue";
                    read;
                    clear;;
                3)  clear;
                    (${GETROOT});
                    clear;;
                4)  doLogout;;
                5)  echo -n "Are you sure you want to reboot the SecureSpan Gateway? [y/n]: "
                    read okToReboot
                    if [ "$okToReboot" == "y" ] || [ "$okToReboot" == "yes" ] ; then
                        sudo /sbin/reboot
                    fi
                    clear;;
                6)  if [ -n ${UPDATER_PRESENT} ] ; then
                        clear;
                        (${UPDATEWIZARD})
                        echo "Press enter to continue";
                        read;
                    else
                        echo "This option requires the SecureSpan Update Utility to be installed."
                        echo "Please select another option"
                        echo "Press enter to continue";
                        read;
                    fi
                    clear;;
                *)  isValid="n";
                    echo "That is not a valid selection";
                    echo "Press enter to continue";
                    read;;
        esac
done
