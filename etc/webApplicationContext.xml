<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC  "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
    <bean id="ssgBoot" class="com.l7tech.server.BootProcess">
         <property name="componentConfig">
            <ref bean="serverConfig"/>
        </property>
    </bean>

    <bean id="identityProviderConfigManager" class="com.l7tech.server.identity.IdProvConfManagerServer">
    </bean>

    <!--
    * singleton using the factory method. This is transitional, as it is referrencef from
    * too many places.
    -->
    <bean id="serverConfig" class="com.l7tech.server.ServerConfig" factory-method="getInstance" />
    <!-- ssl config for rmi/ssl -->
    <bean id="sslKeystore" class="com.l7tech.common.util.KeystoreUtils" factory-method="getInstance" />

    <bean id="sslKeystoreType" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetObject"><ref local='sslKeystore'/></property>
        <property name="targetMethod"><value>getKeyStoreType</value></property>
    </bean>

    <bean id="sslKeystorePassword" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetObject"><ref local='sslKeystore'/></property>
        <property name="targetMethod"><value>getSslKeystorePasswd</value></property>
    </bean>

    <bean id="sslKeystoreFile" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetObject"><ref local='sslKeystore'/></property>
        <property name="targetMethod"><value>getSslKeystorePath</value></property>
    </bean>

    <bean id="rmiServerSocketFactory" class="com.l7tech.remote.rmi.ssl.SslRMIServerSocketFactory">
        <property name="keyStoreType"><ref local='sslKeystoreType'/></property>
        <property name="keyStoreFile"><ref local='sslKeystoreFile'/></property>
        <property name="keyStorePassword"><ref local='sslKeystorePassword'/></property>
    </bean>

    <bean id="rmiClientSocketFactory" class="com.l7tech.remote.rmi.ssl.SslRMIClientSocketFactory"/>


    <bean id="adminSessionInvocationFactory" class="com.l7tech.remote.rmi.AdminSessionInvocationFactory"/>

    <!--    shared export properties, inherited with parent= -->
    <bean id="sharedExportProperties">
        <property name="registryPort"><value>2124</value></property>
        <property name="servicePort"><value>2124</value></property>
        <property name="clientSocketFactory"><ref bean="rmiClientSocketFactory"/></property>
        <property name="serverSocketFactory"><ref bean="rmiServerSocketFactory"/></property>
        <property name="registryClientSocketFactory"><ref bean="rmiClientSocketFactory"/></property>
        <property name="registryServerSocketFactory"><ref bean="rmiServerSocketFactory"/></property>
        <property name="stubRemoteInvocationFactory"><ref bean="adminSessionInvocationFactory"/></property>
    </bean>

    <!--    admin login exporter -->
    <bean class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
	    <property name="serviceName"><value>AdminLogin</value></property>
        <property name="service"><ref bean="adminLogin"/></property>
	    <property name="serviceInterface"><value>com.l7tech.admin.AdminLogin</value></property>
    </bean>
    <!--    admin login servant -->
    <bean id="adminLogin" class="com.l7tech.admin.rmi.AdminLoginImpl">
        <property name="identityProviderConfigManager"><ref bean="identityProviderConfigManager"/></property>
    </bean>

    <!--    admin context exporter -->
    <bean id="adminContextRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
        <property name="service"><ref bean="adminContext"/></property>
        <property name="serviceInterface"><value>com.l7tech.admin.AdminContext</value></property>
        <property name="singleton"><value>false</value></property>
    </bean>
    <!--    admin context servant -->
    <bean id="adminContext" class="com.l7tech.admin.rmi.AdminContextImpl">
        <constructor-arg><ref bean="identityAdminRemote"/></constructor-arg>
        <constructor-arg><ref bean="logAdminRemote"/></constructor-arg>
        <constructor-arg><ref bean="auditAdminRemote"/></constructor-arg>
        <constructor-arg><ref bean="serviceAdminRemote"/></constructor-arg>
        <constructor-arg><ref bean="jmsAdminRemote"/></constructor-arg>
        <constructor-arg><ref bean="trustedCertAdminRemote"/></constructor-arg>
        <constructor-arg><ref bean="customAssertionsRegistrarRemote"/></constructor-arg>
        <constructor-arg><ref bean="clusterStatusAdminRemote"/></constructor-arg>
<!--        <property name="identityProviderConfigManager"><ref bean="identityProviderConfigManager"/></property>-->
    </bean>

    <!--    log admin exporter -->
     <bean id="identityAdminRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
         <property name="service"><ref bean="identityAdmin"/></property>
         <property name="serviceInterface"><value>com.l7tech.identity.IdentityAdmin</value></property>
     </bean>
     <!--    identity admin servant -->
    <bean id="identityAdmin" class="com.l7tech.server.identity.IdentityAdminImpl">
        <property name="identityProviderConfigManager"><ref bean="identityProviderConfigManager"/></property>
    </bean>

    <!--    log admin exporter -->
    <bean id="logAdminRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
        <property name="service"><ref bean="logAdmin"/></property>
        <property name="serviceInterface"><value>com.l7tech.logging.LogAdmin</value></property>
    </bean>
    <!--    log admin servant -->
    <bean id="logAdmin" class="com.l7tech.logging.LogAdminImpl">
     </bean>


    <!--    audit admin exporter -->
    <bean id= "auditAdminRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
        <property name="service"><ref bean="auditAdmin"/></property>
        <property name="serviceInterface"><value>com.l7tech.common.audit.AuditAdmin</value></property>
    </bean>
    <!--    audit admin servant -->
    <bean id="auditAdmin" class="com.l7tech.server.audit.AuditAdminImpl">
    </bean>

    <!--    service admin exporter -->
    <bean id="serviceAdminRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
        <property name="service"><ref bean="serviceAdmin"/></property>
        <property name="serviceInterface"><value>com.l7tech.service.ServiceAdmin</value></property>
    </bean>
    <!--    service admin servant -->
    <bean id="serviceAdmin" class="com.l7tech.server.service.ServiceAdminImpl">
    </bean>

    <!--    jms admin exporter -->
    <bean id="jmsAdminRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
        <property name="service"><ref bean="jmsAdmin"/></property>
        <property name="serviceInterface"><value>com.l7tech.common.transport.jms.JmsAdmin</value></property>
    </bean>
    <!--    jms admin servant -->
    <bean id="jmsAdmin" class="com.l7tech.server.transport.jms.JmsAdminImpl">
    </bean>

    <!--    trusted cert admin exporter -->
     <bean id="trustedCertAdminRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
         <property name="service"><ref bean="trustedCertAdmin"/></property>
         <property name="serviceInterface"><value>com.l7tech.common.security.TrustedCertAdmin</value></property>
     </bean>
     <!--    trusted cert admin servant -->
     <bean id="trustedCertAdmin" class="com.l7tech.server.TrustedCertAdminImpl">
     </bean>

    <!--    trusted cert admin exporter -->
      <bean id="customAssertionsRegistrarRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
          <property name="service"><ref bean="customAssertionsRegistrar"/></property>
          <property name="serviceInterface"><value>com.l7tech.policy.assertion.ext.CustomAssertionsRegistrar</value></property>
      </bean>
      <!--    trusted cert admin servant -->
      <bean id="customAssertionsRegistrar" class="com.l7tech.policy.assertion.ext.rmi.CustomAssertionsRegistrarImpl">
      </bean>

    <!--    cluster status cert admin exporter -->
      <bean id="clusterStatusAdminRemote" class="com.l7tech.remote.rmi.RmiServiceExporterStubFactoryBean" parent="sharedExportProperties">
          <property name="service"><ref bean="clusterStatusAdmin"/></property>
          <property name="serviceInterface"><value>com.l7tech.cluster.ClusterStatusAdmin</value></property>
      </bean>
      <!--    trusted cert admin servant -->
      <bean id="clusterStatusAdmin" class="com.l7tech.cluster.ClusterStatusAdminImp">
      </bean>
</beans>
