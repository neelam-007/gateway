#!/bin/bash
#
# Utility for Secure Span Gateway Server system configuration
#
# chkconfig: 2345 09 91
# description: Layer7's Secure Span Gateway System Configuration Utility

if [ -z "$SSGHOME" ]; then
	SSGHOME="/ssg"
fi

ssgconfigutil="/usr/bin/perl ${SSGHOME}/sysconfigwizard/ssg_sys_config.pl"
migrationdeamon="${SSGHOME}/migration/ssgmigration.sh cfgdeamon"

MESSAGE="Applying Network (Re)Configuration"
USER=`/usr/bin/who am i | awk '{print $1}'`

# This script redirects STDOUT and STDERR to /dev/null as well as closing STDIN (<&-) so it can be detached from a
# terminal

start() {
	if [ "$USER" = "root" ]; then
		echo "${MESSAGE}: "
        (${ssgconfigutil})
        RETVAL=$?
        # plugin of migration utility copying system files at the right place
        (${migrationdeamon})
	else
		echo "Need to be root to run this script";
		exit
	fi

    echo
    return $RETVAL
}

# See how we were called. Run this on both start and stop since this is a run and terminate script
case "$1" in
  start)
	start
	;;
  stop)
    start
	;;
  config)
    start
	;;
  restart)
	;;
esac

exit $RETVAL
