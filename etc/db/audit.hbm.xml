<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 2.1//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">

<!-- $Id$ -->

<!--
  This is the Hibernate mapping file for audit records.
-->

<hibernate-mapping>
    <class name="com.l7tech.common.audit.AuditRecord" table="audit_main">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <!-- No version column required, since these never get modified -->
        <property name="nodeId" column="nodeid" type="string"/>
        <property name="millis" column="time" type="long"/>
        <property name="strLvl" column="audit_level" type="string"/>
        <property name="message" column="message" type="string"/>
        <property name="ipAddress" column="ip_address" type="string"/>
        <property name="name" column="name" type="string"/>

        <set name="details" lazy="false" inverse="true" cascade="all">
            <key column="audit_oid"/>
            <one-to-many class="com.l7tech.common.audit.AuditDetail"/>
        </set>

        <joined-subclass name="com.l7tech.common.audit.MessageSummaryAuditRecord" table="audit_message" >
            <key column="objectid"/>
            <property name="status" type="int"/>
            <property name="strRequestId" column="request_id" type="string"/>
            <property name="serviceOid" column="service_oid" type="long"/>
            <property name="identityProviderOid" column="provider_oid" type="long"/>
            <property name="userId" column="user_id" type="string"/>
            <property name="userName" column="user_name" type="string"/>
            <property name="authenticated" column="authenticated" type="boolean"/>
            <property name="requestXml" column="request_xml" type="text"/>
            <property name="requestContentLength" column="request_length" type="int"/>
            <property name="responseXml" column="response_xml" type="text"/>
            <property name="responseContentLength" column="response_length" type="int"/>
        </joined-subclass>

        <joined-subclass name="com.l7tech.common.audit.AdminAuditRecord" table="audit_admin">
            <key column="objectid"/>
            <property name="adminLogin" column="admin_login" type="string"/>
            <property name="entityClassname" column="entity_class" type="string"/>
            <property name="entityOid" column="entity_id" type="long"/>
            <property name="action" column="action" type="char"/>
        </joined-subclass>

        <joined-subclass name="com.l7tech.common.audit.SystemAuditRecord" table="audit_system">
            <key column="objectid"/>
            <property name="component" type="string"/>
            <property name="action" type="string"/>
        </joined-subclass>
    </class>

    <class name="com.l7tech.common.audit.AuditDetail" table="audit_detail">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <property name="time" type="long"/>
        <property name="componentOid" column="component_oid" type="long"/>
        <property name="messageOid" column="message_oid" type="long"/>
        <property name="ordinal" type="int"/>

        <many-to-one name="auditRecord" class="com.l7tech.common.audit.AuditRecord" column="audit_oid"/>
    </class>

    <class name="com.l7tech.common.audit.AuditDetailMessage" table="audit_detail_message">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="native"/>
        </id>

        <property name="className" column="class_name" type="string"/>
        <property name="methodName" column="method_name" type="string"/>
        <property name="level" type="string"/>
        <property name="message" type="string"/>
    </class>
</hibernate-mapping>