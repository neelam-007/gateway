<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 2.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">

<!-- $Id$ -->

<!--
  This is the unified (PostgreSQL & MySQL) version of the Hibernate mapping file.
-->

<hibernate-mapping>
    <class name="com.l7tech.identity.IdentityProviderConfig" table="identity_provider">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <!-- For subclasses -->
        <discriminator column="type"/>

        <version name="version" column="version" type="integer"/>

        <property name="description" type="string"/>
        <property name="name" type="string"/>

        <!-- insert="false" and update="false" because column is defined twice. discriminator is updated instead -->
        <property name="typeVal" type="int" column="type" insert="false" update="false"/>

        <property name="serializedProps" type="text" column="properties" />
    </class>

    <subclass name="com.l7tech.identity.ldap.LdapIdentityProviderConfig"
              extends="com.l7tech.identity.IdentityProviderConfig"
              discriminator-value="2"/>

    <class name="com.l7tech.identity.internal.InternalGroup" table="internal_group">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <version name="version" column="version" type="integer"/>

        <property name="description" type="string"/>
        <property name="name" type="string"/>

        <!--
        <set role="members" lazy="false" table="internal_user_group">
            <key column="internal_group"/>
            <many-to-many class="com.l7tech.identity.User" column="internal_user"/>
        </set>
        -->
    </class>

    <class name="com.l7tech.identity.internal.InternalUser" table="internal_user">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <version name="version" column="version" type="integer"/>

        <property name="name" type="string" column="name" />
        <property name="login" type="string" column="login" />
        <property name="password" type="string"/>
        <property name="firstName" column="first_name"  type="string"/>
        <property name="lastName" column="last_name" type="string"/>
        <property name="email" type="string"/>
        <property name="expiration" type="long"/>

        <!--
        <set role="groups" lazy="false" table="internal_user_group">
            <key column="internal_user"/>
            <many-to-many class="com.l7tech.identity.Group" column="internal_group"/>
        </set>
        -->
    </class>

    <class name="com.l7tech.identity.internal.GroupMembership" table="internal_user_group">
        <composite-id>
            <key-property name="userOid" column="internal_user" type="long"/>
            <key-property name="groupOid" column="internal_group" type="long"/>
        </composite-id>

        <!--
        <property name="userOid" type="long" column="internal_user"/>
        <property name="groupOid" type="long" column="internal_group"/>
        -->
    </class>


    <class name="com.l7tech.service.PublishedService" table="published_service">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <version name="version" column="version" type="integer"/>

        <property name="name" column="name" type="string"/>
        <property name="policyXml" column="policy_xml" type="text"/>
        <property name="wsdlUrl" column="wsdl_url" type="string"/>
        <property name="wsdlXml" column="wsdl_xml" type="text"/>
        <property name="disabled" column="disabled" type="boolean"/>
        <property name="soap" column="soap" type="boolean"/>
        <property name="routingUri" column="routing_uri" type="string"/>
    </class>

    <class name="com.l7tech.server.identity.cert.CertEntryRow" table="client_cert">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>
        <property name="provider" column="provider" type="long"/>
        <property name="userId" column="user_id" type="string"/>
        <property name="login" column="login" type="string"/>
        <property name="cert" column="cert" type="string"/>
        <property name="resetCounter" column="reset_counter" type="int"/>
    </class>

    <class name="com.l7tech.server.service.resolution.ResolutionParameters" table="service_resolution">
        <id name="oid" column="objectid" type="long">
            <generator class="hilo"/>
        </id>
        <property name="urn" column="urn" type="string"/>
        <property name="uri" column="uri" type="string"/>
        <property name="soapaction" column="soapaction" type="string"/>
        <property name="serviceid" column="serviceid" type="long"/>
    </class>

    <class name="com.l7tech.cluster.ClusterNodeInfo" table="cluster_info">
        <id name="mac" column="mac" type="string" unsaved-value="">
            <generator class="assigned"/>
        </id>
        <property name="name" column="name" type="string"/>
        <property name="address" column="address" type="string"/>
        <property name="multicastAddress" column="multicast_address" type="string"/>
        <property name="isMaster" column="ismaster" type="boolean"/>
        <property name="bootTime" column="uptime" type="long"/>
        <property name="avgLoad" column="avgload" type="double"/>
        <property name="lastUpdateTimeStamp" column="statustimestamp" type="long"/>
    </class>

    <class name="com.l7tech.cluster.ServiceUsage" table="service_usage">
        <composite-id>
            <key-property name="serviceid" column="serviceid" type="long"/>
            <key-property name="nodeid" column="nodeid" type="string"/>
        </composite-id>
        <property name="requests" column="requestnr" type="long"/>
        <property name="authorized" column="authorizedreqnr" type="long"/>
        <property name="completed" column="completedreqnr" type="long"/>
    </class>

    <class name="com.l7tech.logging.SSGLogRecord" table="ssg_logs">
        <id name="oid" column="objectid" type="long">
            <generator class="hilo"/>
        </id>
        <property name="nodeId" column="nodeid" type="string"/>
        <property name="message" column="message" type="text"/>
        <property name="strLvl" column="strlvl" type="string"/>
        <property name="loggerName" column="loggername" type="string"/>
        <property name="millis" column="millis" type="long"/>
        <property name="sourceClassName" column="sourceclassname" type="string"/>
        <property name="sourceMethodName" column="sourcemethodname" type="string"/>
        <property name="strRequestId" column="strrequestid" type="string"/>
    </class>

    <class name="com.l7tech.common.transport.jms.JmsConnection" table="jms_connection">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>
        <version name="version" column="version" type="integer"/>

        <property name="name" column="name" type="string"/>
        <property name="jndiUrl" column="jndi_url" type="string"/>
        <property name="initialContextFactoryClassname" column="factory_classname" type="string"/>
        <property name="destinationFactoryUrl" column="destination_factory_url" type="string"/>
        <property name="queueFactoryUrl" column="queue_factory_url" type="string"/>
        <property name="topicFactoryUrl" column="topic_factory_url" type="string"/>
        <property name="username" column="username" type="string"/>
        <property name="password" column="password" type="string"/>

        <!--
        <set name="endpoints" cascade="all" inverse="true">
            <key column="connection_oid"/>
            <one-to-many class="com.l7tech.common.transport.jms.JmsEndpoint"/>
        </set>
        -->
    </class>

    <class name="com.l7tech.common.transport.jms.JmsEndpoint" table="jms_endpoint">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>
        <version name="version" column="version" type="integer"/>

        <property name="connectionOid" column="connection_oid"/>
        <!--
        <many-to-one name="connection" class="com.l7tech.common.transport.jms.JmsConnection" column="connection_oid"/>
        -->

        <property name="name" column="name" type="string"/>
        <property name="destinationName" column="destination_name" type="string"/>
        <property name="replyType" column="reply_type" type="com.l7tech.common.transport.jms.JmsReplyType"/>
        <property name="username"/>
        <property name="password"/>
        <property name="maxConcurrentRequests" column="max_concurrent_requests"/>
        <property name="messageSource" column="is_message_source"/>
    </class>

    <class name="com.l7tech.common.security.TrustedCert" table="trusted_cert">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>
        <version name="version" column="version" type="integer"/>

        <property name="name" type="string"/>
        <property name="subjectDn" column="subject_dn" type="string" unique="true"/>
        <property name="certBase64" column="cert_base64" type="text"/>
        <property name="trustedForSsl" column="trusted_for_ssl" type="boolean"/>
        <property name="trustedForSigningClientCerts" column="trusted_for_client" type="boolean"/>
        <property name="trustedForSigningServerCerts" column="trusted_for_server" type="boolean"/>
        <property name="trustedForSigningSamlTokens" column="trusted_for_saml" type="boolean"/>
    </class>
    
    <subclass name="com.l7tech.identity.fed.FederatedIdentityProviderConfig"
              extends="com.l7tech.identity.IdentityProviderConfig"
              discriminator-value="3"/>

    <class name="com.l7tech.identity.fed.FederatedUser" table="fed_user">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <version name="version" column="version" type="integer"/>

        <property name="providerId" type="long" column="provider_oid"/>
        
        <property name="name" type="string" column="name" />
        <property name="login" type="string" column="login" />
        <property name="email" type="string"/>
        <property name="subjectDn" column="subject_dn" type="string"/>

        <property name="firstName" column="first_name"  type="string"/>
        <property name="lastName" column="last_name" type="string"/>
    </class>

    <class name="com.l7tech.identity.fed.FederatedGroup" table="fed_group">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <version name="version" column="version" type="integer"/>

        <property name="providerId" type="long" column="provider_oid"/>

        <property name="description" type="string"/>
        <property name="name" type="string"/>
    </class>

    <class name="com.l7tech.identity.fed.FederatedGroupMembership" table="fed_user_group">
        <composite-id>
            <key-property name="providerOid" column="provider_oid" type="long"/>
            <key-property name="userOid" column="fed_user_oid" type="long"/>
            <key-property name="groupOid" column="fed_group_oid" type="long"/>
        </composite-id>
    </class>

    <class name="com.l7tech.identity.fed.VirtualGroup" table="fed_group_virtual">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="hilo"/>
        </id>

        <version name="version" column="version" type="integer"/>

        <property name="description" type="string"/>
        <property name="providerId" column="provider_oid" type="long"/>
        <property name="name" type="string"/>

        <property name="samlEmailPattern" column="saml_email_pattern" type="string"/>
        <property name="x509SubjectDnPattern" column="x509_subject_dn_pattern" type="string"/>
        <property name="xmlProperties" column="properties" type="text"/>
    </class>


</hibernate-mapping>
