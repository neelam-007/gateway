<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping
        PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<!--
  This is the vestigial Hibernate mapping file for the remaining non-annotation-driven persistent entities.
-->
<hibernate-mapping>
    <typedef class="com.l7tech.server.util.GenericEnumUserType" name="policy_type">
        <param name="enumClass">com.l7tech.policy.PolicyType</param>
    </typedef>

    <typedef class="com.l7tech.server.util.GenericEnumUserType" name="service_state_type">
        <param name="enumClass">com.l7tech.gateway.common.service.ServiceState</param>
    </typedef>

    <typedef class="com.l7tech.server.util.GenericEnumSetUserType" name="http_methods_type">
        <param name="enumClass">com.l7tech.common.http.HttpMethod</param>
    </typedef>

    <typedef class="com.l7tech.server.util.GenericEnumUserType" name="soap_version_type">
        <param name="enumClass">com.l7tech.xml.soap.SoapVersion</param>
    </typedef>

    <class name="com.l7tech.gateway.common.service.PublishedService" table="published_service" lazy="false">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>

        <version name="version" column="version" type="integer"/>

        <property name="name" column="name" type="string"/>
        <property name="wsdlUrl" column="wsdl_url" type="string"/>
        <property name="wsdlXml" column="wsdl_xml" type="text"/>
        <property name="disabled" column="disabled" type="boolean"/>
        <property name="soap" column="soap" type="boolean"/>
        <property name="internal" column="internal" type="boolean"/>
        <property name="routingUri" column="routing_uri" type="string"/>
        <property name="defaultRoutingUrl" column="default_routing_url" type="string"/>
        <property name="httpMethods" column="http_methods" type="http_methods_type"/>
        <property name="laxResolution" column="lax_resolution" type="boolean"/>
        <property name="wssProcessingEnabled" column="wss_processing" type="boolean"/>
        <property name="tracingEnabled" column="tracing" type="boolean"/>
        <property name="soapVersion" column="soap_version" type="soap_version_type"/>

        <many-to-one class="com.l7tech.policy.Policy"
                     name="policy" lazy="false" column="policy_oid" unique="true" cascade="persist,merge,save-update,delete"/>

        <many-to-one name="folder" column="folder_oid"/>
    </class>

    <class name="com.l7tech.gateway.common.service.PublishedServiceAlias" table="published_service_alias" lazy="false">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>
        <version name="version" type="int"/>

        <property name="entityOid" column="published_service_oid" type="long"/>

        <many-to-one name="folder" column="folder_oid"/>
    </class>

    <class name="com.l7tech.policy.Policy" table="policy" lazy="false">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>
        <version name="version" type="int"/>
        <property name="guid" column="guid" type="string"/>
        <property name="name" column="name" type="string"/>
        <property name="type" column="policy_type" type="policy_type"/>
        <property name="xml" column="`xml`" type="text"/>
        <property name="soap" column="soap" type="boolean"/>
        <property name="internalTag" column="internal_tag" type="string" length="64"/>

        <many-to-one name="folder" column="folder_oid"/>
        <many-to-one name="securityZone" column="security_zone_oid"/>
    </class>

    <class name="com.l7tech.policy.PolicyVersion" table="policy_version" lazy="false">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>
        <version name="version" type="int"/>
        <property name="name" column="name" type="string"/>
        <property name="policyOid" column="policy_oid" type="long"/>
        <property name="ordinal" column="ordinal" type="long"/>
        <property name="time" column="time" type="long"/>
        <property name="userProviderOid" column="user_provider_oid" type="long"/>
        <property name="userLogin" column="user_login" type="string"/>
        <property name="xml" column="`xml`" type="text" lazy="true"/>
        <property name="active" column="active" type="boolean"/>
    </class>

    <class name="com.l7tech.policy.PolicyAlias" table="policy_alias" lazy="false">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>

        <version name="version" type="int"/>

        <property name="entityOid" column="policy_oid" type="long"/>

        <many-to-one name="folder" column="folder_oid"/>
    </class>

    <class name="com.l7tech.objectmodel.folder.Folder" table="folder" lazy="false">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>

        <version name="version" column="version" type="int"/>

        <property name="name" column="name" type="string"/>

        <many-to-one class="com.l7tech.objectmodel.folder.Folder" name="folder" lazy="false" column="parent_folder_oid"/>
    </class>
  
    <class name="com.l7tech.gateway.common.cluster.ServiceUsage" table="service_usage" lazy="false">
        <composite-id>
            <key-property name="serviceid" column="serviceid" type="long"/>
            <key-property name="nodeid" column="nodeid" type="string"/>
        </composite-id>
        <property name="requests" column="requestnr" type="long"/>
        <property name="authorized" column="authorizedreqnr" type="long"/>
        <property name="completed" column="completedreqnr" type="long"/>
    </class>

    <class name="com.l7tech.gateway.common.service.SampleMessage" table="sample_messages" lazy="false">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>

        <property name="name" type="string"/>
        <property name="operationName" column="operation_name" type="string"/>
        <property name="serviceOid" column="published_service_oid" type="long"/>
        <property name="xml" column="`xml`" type="text"/>
    </class>

    <class name="com.l7tech.gateway.common.service.MetricsBin" table="service_metrics">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>

        <property name="clusterNodeId" column="nodeid" type="string"/>
        <property name="serviceOid" column="published_service_oid" type="long"/>
        <property name="resolution" column="resolution" type="int"/>
        <property name="periodStart" column="period_start" type="long"/>

        <property name="startTime" column="start_time" type="long"/>
        <property name="endTime" column="end_time" type="long"/>

        <property name="numAttemptedRequest" column="attempted" type="int"/>
        <property name="numAuthorizedRequest" column="authorized" type="int"/>
        <property name="numCompletedRequest" column="completed" type="int"/>

        <property name="minBackendResponseTime" column="back_min" type="int"/>
        <property name="sumBackendResponseTime" column="back_sum" type="long"/>
        <property name="maxBackendResponseTime" column="back_max" type="int"/>

        <property name="minFrontendResponseTime" column="front_min" type="int"/>
        <property name="sumFrontendResponseTime" column="front_sum" type="long"/>
        <property name="maxFrontendResponseTime" column="front_max" type="int"/>

        <property name="interval" column="interval_size" type="int"/>

        <property name="serviceState" column="service_state" type="service_state_type" length="16"/>
    </class>

    <class name="com.l7tech.gateway.common.service.MetricsBinDetail" table="service_metrics_details">
        <composite-id>
            <key-property name="metricsBinOid" column="service_metrics_oid" type="long"/>
            <key-property name="mappingValuesOid" column="mapping_values_oid" type="long"/>
        </composite-id>        

        <property name="numAttemptedRequest" column="attempted" type="int"/>
        <property name="numAuthorizedRequest" column="authorized" type="int"/>
        <property name="numCompletedRequest" column="completed" type="int"/>

        <property name="minBackendResponseTime" column="back_min" type="int"/>
        <property name="sumBackendResponseTime" column="back_sum" type="long"/>
        <property name="maxBackendResponseTime" column="back_max" type="int"/>

        <property name="minFrontendResponseTime" column="front_min" type="int"/>
        <property name="sumFrontendResponseTime" column="front_sum" type="long"/>
        <property name="maxFrontendResponseTime" column="front_max" type="int"/>
    </class>

    <class name="com.l7tech.gateway.common.service.ServiceDocument" table="service_documents">
        <id name="oid" column="objectid" type="long" unsaved-value="-1">
            <generator class="layer7-generator"/>
        </id>

        <version name="version" column="version" type="integer"/>

        <property name="serviceId" column="service_oid" type="long"/>
        <property name="uri" column="uri" type="string"/>
        <property name="type" column="type" type="string"/>
        <property name="contentType" column="content_type" type="string"/>
        <property name="contents" column="content" type="string"/>
    </class>

</hibernate-mapping>
