<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:AuditAssertion>
            <L7p:Level stringValue="INFO"/>
            <L7p:SaveRequest booleanValue="true"/>
        </L7p:AuditAssertion>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:SslAssertion>
                    <L7p:RequireClientAuthentication booleanValue="true"/>
                </L7p:SslAssertion>
                <L7p:AuditDetailAssertion>
                    <L7p:Detail stringValue="username: ${request.username}"/>
                </L7p:AuditDetailAssertion>
                <L7p:Authentication>
                    <L7p:IdentityProviderOid longValue="-2"/>
                </L7p:Authentication>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SslAssertion/>
                <L7p:HttpBasic/>
                <L7p:AuditDetailAssertion>
                    <L7p:Detail stringValue="username: ${request.username}"/>
                </L7p:AuditDetailAssertion>
                <L7p:Authentication>
                    <L7p:IdentityProviderOid longValue="-2"/>
                </L7p:Authentication>
            </wsp:All>
        </wsp:OneOrMore>
        <L7p:AuditDetailAssertion>
            <L7p:Detail stringValue="auth_user: ${request.authenticateduser}"/>
        </L7p:AuditDetailAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="API Portal Authentication &amp; Management Policy v2.5 as of 2013-05-06 1500 //RR"/>
        </L7p:CommentAssertion>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="Mi41"/>
            <L7p:VariableToSet stringValue="VERSION"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="// successful errorCode"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue="MA=="/>
            <L7p:VariableToSet stringValue="errorCode"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue=""/>
            <L7p:VariableToSet stringValue="errorMsg"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue=""/>
            <L7p:VariableToSet stringValue="namespace"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="Backup original request"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="//this makes sure we always have the original request"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
            <L7p:DataType variableDataType="message"/>
            <L7p:VariableToSet stringValue="requestOriginal"/>
        </L7p:SetVariable>
        <wsp:All wsp:Usage="Required">
            <L7p:SetVariable>
                <L7p:AssertionComment assertionComment="included">
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="getResOperation()"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:AssertionComment>
                <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAubWV0aG9kfQ=="/>
                <L7p:VariableToSet stringValue="pman.operation"/>
            </L7p:SetVariable>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAudXJpfQ=="/>
                    <L7p:VariableToSet stringValue="sourceUri"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue=""/>
                    <L7p:VariableToSet stringValue="newSourceUri"/>
                </L7p:SetVariable>
                <L7p:Split>
                    <L7p:InputVariable stringValue="sourceUri"/>
                    <L7p:OutputVariable stringValue="splitUri"/>
                    <L7p:SplitPattern stringValue="/"/>
                </L7p:Split>
                <L7p:ForEachLoop L7p:Usage="Required"
                                 loopVariable="splitUri" variablePrefix="uri">
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:Expression1 stringValue="${splitUri[1]}"/>
                                <L7p:Expression2 stringValue="${uri.current}"/>
                                <L7p:Negate booleanValue="true"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                        <L7p:Negated booleanValue="true"/>
                                        <L7p:RightValue stringValue="${uri.current}"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:ComparisonAssertion>
                                <L7p:Expression1 stringValue="${uri.current}"/>
                                <L7p:Expression2 stringValue=""/>
                                <L7p:Negate booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                        <L7p:Negated booleanValue="true"/>
                                        <L7p:Operator operator="EMPTY"/>
                                        <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtuZXdTb3VyY2VVcml9LyR7dXJpLmN1cnJlbnR9"/>
                                <L7p:VariableToSet stringValue="newSourceUri"/>
                            </L7p:SetVariable>
                        </wsp:All>
                        <L7p:TrueAssertion/>
                    </wsp:OneOrMore>
                </L7p:ForEachLoop>
                <L7p:Split>
                    <L7p:InputVariable stringValue="newSourceUri"/>
                    <L7p:OutputVariable stringValue="splitUri"/>
                    <L7p:SplitPattern stringValue="/"/>
                </L7p:Split>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${splitUri[2]}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="apis"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="LyR7c3BsaXRVcmlbMV19LyR7c3BsaXRVcmlbMl19"/>
                            <L7p:VariableToSet stringValue="pman.resUri"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtzcGxpdFVyaVszXX0="/>
                            <L7p:VariableToSet stringValue="pman.resId"/>
                        </L7p:SetVariable>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="/1/apis/&lt;api-id>"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${splitUri[2]}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="api"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${splitUri[3]}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="plans"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="LyR7c3BsaXRVcmlbMV19LyR7c3BsaXRVcmlbMl19LyR7c3BsaXRVcmlbM119"/>
                            <L7p:VariableToSet stringValue="pman.resUri"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtzcGxpdFVyaVs0XX0="/>
                            <L7p:VariableToSet stringValue="pman.resId"/>
                        </L7p:SetVariable>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="/1/api/plans/&lt;plan-id>"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${splitUri[2]}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="api"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${splitUri[3]}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="keys"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="LyR7c3BsaXRVcmlbMV19LyR7c3BsaXRVcmlbMl19LyR7c3BsaXRVcmlbM119"/>
                            <L7p:VariableToSet stringValue="pman.resUri"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtzcGxpdFVyaVs0XX0="/>
                            <L7p:VariableToSet stringValue="pman.resId"/>
                        </L7p:SetVariable>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="/1/api/keys/&lt;plan-id>"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${splitUri[2]}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="gateway"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="LyR7c3BsaXRVcmlbMV19LyR7c3BsaXRVcmlbMl19"/>
                            <L7p:VariableToSet stringValue="pman.resUri"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtzcGxpdFVyaVszXX0="/>
                            <L7p:VariableToSet stringValue="pman.resId"/>
                        </L7p:SetVariable>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="/1/gateway"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${splitUri[2]}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="account"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${splitUri[3]}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="plans"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="LyR7c3BsaXRVcmlbMV19LyR7c3BsaXRVcmlbMl19LyR7c3BsaXRVcmlbM119"/>
                            <L7p:VariableToSet stringValue="pman.resUri"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtzcGxpdFVyaVs0XX0="/>
                            <L7p:VariableToSet stringValue="pman.resId"/>
                        </L7p:SetVariable>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="/1/account/plans/&lt;plan-id>"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtzb3VyY2VVcml9"/>
                        <L7p:VariableToSet stringValue="pman.resUri"/>
                    </L7p:SetVariable>
                </wsp:OneOrMore>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="getResUri() and getResId()"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnVybC5xdWVyeX0="/>
                    <L7p:VariableToSet stringValue="pman.options"/>
                </L7p:SetVariable>
                <L7p:Regex>
                    <L7p:AutoTarget booleanValue="false"/>
                    <L7p:OtherTargetMessageVariable stringValue="pman.options"/>
                    <L7p:Regex stringValue="\?"/>
                    <L7p:Replace booleanValue="true"/>
                    <L7p:Replacement stringValue=""/>
                    <L7p:Target target="OTHER"/>
                </L7p:Regex>
                <L7p:EncodeDecode>
                    <L7p:SourceVariableName stringValue="pman.options"/>
                    <L7p:TargetDataType variableDataType="string"/>
                    <L7p:TargetVariableName stringValue="pman.options"/>
                    <L7p:TransformType transformType="URL_DECODE"/>
                </L7p:EncodeDecode>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="getOptions()"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:OneOrMore wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
                    <L7p:VariableToSet stringValue="pman.resource"/>
                </L7p:SetVariable>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="getResource()"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:OneOrMore>
            <wsp:OneOrMore wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${pman.resUri}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="/1/apis"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${pman.resUri}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="/1/api/plans"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${pman.resUri}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="/1/api/keys"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${pman.resUri}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="/1/gateway"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${pman.resUri}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="/1/account/plans"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <wsp:All wsp:Usage="Required">
                    <L7p:SetVariable>
                        <L7p:AssertionComment assertionComment="included">
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// successful errorCode"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:AssertionComment>
                        <L7p:Base64Expression stringValue="NTAw"/>
                        <L7p:VariableToSet stringValue="errorCode"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="VW5zdXBwb3J0IFJlc291cmNlICgke3BtYW4ucmVzVXJpfSk="/>
                        <L7p:VariableToSet stringValue="errorMsg"/>
                    </L7p:SetVariable>
                </wsp:All>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// validate resource supported"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:OneOrMore>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="// parse and validate request arguments"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="parsing()"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </wsp:All>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${errorCode}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="0"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${pman.resUri}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/1/apis"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:VariableToSet stringValue="wsmanResp"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:VariableToSet stringValue="pman.resp.detail"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:VariableToSet stringValue="pman.resp.status"/>
                        </L7p:SetVariable>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//this section is only for Create API &amp; Update API"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="PUT"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="SW52YWxpZCBYTUwgUmVxdWVzdA=="/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//required"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="make sure it is a valid xml request"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//skip if there is already an error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${errorCode}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:Negated booleanValue="true"/>
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//bypass if not create"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:Expression1 stringValue="${pman.resId}"/>
                                                <L7p:Expression2 stringValue=""/>
                                                <L7p:Negate booleanValue="true"/>
                                                <L7p:Operator operator="EMPTY"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item binary="included">
                                                        <L7p:Negated booleanValue="true"/>
                                                        <L7p:Operator operator="EMPTY"/>
                                                        <L7p:RightValue stringValue=""/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServiceName/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZVhwYXRoLmVsZW1lbnR9"/>
                                                    <L7p:VariableToSet stringValue="serviceName"/>
                                                </L7p:SetVariable>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${serviceName}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item stringLength="included">
                                                            <L7p:Max intValue="-1"/>
                                                            <L7p:Min intValue="1"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="U2VydmljZU5hbWUgaXMgcmVxdWlyZWQ="/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//required"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="serviceName"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//skip if there is already an error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${errorCode}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:Negated booleanValue="true"/>
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//bypass if not create"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:Expression1 stringValue="${pman.resId}"/>
                                                <L7p:Expression2 stringValue=""/>
                                                <L7p:Negate booleanValue="true"/>
                                                <L7p:Operator operator="EMPTY"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item binary="included">
                                                        <L7p:Negated booleanValue="true"/>
                                                        <L7p:Operator operator="EMPTY"/>
                                                        <L7p:RightValue stringValue=""/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServiceDetails/l7:UrlPattern/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZVhwYXRoLmVsZW1lbnR9"/>
                                                    <L7p:VariableToSet stringValue="urlPattern"/>
                                                </L7p:SetVariable>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${urlPattern}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item stringLength="included">
                                                            <L7p:Max intValue="-1"/>
                                                            <L7p:Min intValue="1"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="VXJsUGF0dGVybiBpcyByZXF1aXJlZA=="/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="urlPattern"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//required"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${pman.resId}"/>
                                                    <L7p:Expression2 stringValue=""/>
                                                    <L7p:Negate booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:Operator operator="EMPTY"/>

                                                            <L7p:RightValue stringValue=""/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//bypass if not create"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="//skip if there is already an error"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:RightValue stringValue="0"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:RoutingUrl/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZVhwYXRoLmVsZW1lbnR9"/>
                                                    <L7p:VariableToSet stringValue="routingUrl"/>
                                                </L7p:SetVariable>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${routingUrl}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item stringLength="included">
                                                            <L7p:Max intValue="-1"/>
                                                            <L7p:Min intValue="1"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="Um91dGluZ1VybCBpcyByZXF1aXJlZA=="/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="routingUrl"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//required"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${errorCode}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//skip processing if there is already an error, since the next set of checks are all optional"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ApiGroup/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZVhwYXRoLmVsZW1lbnR9"/>
                                                    <L7p:VariableToSet stringValue="apiGroup"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="apiGroup"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServiceEnabled/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="serviceEnabled"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="serviceEnabled"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:SetAsPortalManaged/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="false"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="false"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="ZmFsc2U="/>
                                                    <L7p:VariableToSet stringValue="portalManaged"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="ZmFsc2U="/>
                                                    <L7p:VariableToSet stringValue="requireAPIKey"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="requireAPIKey"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:RequireSSL/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="requireSSL"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="requireSSL"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:RequireOAuth/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <wsp:OneOrMore wsp:Usage="Required">
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:ComparisonAssertion>

                                                            <L7p:Expression1 stringValue="${responseXpath.element}"/>

                                                            <L7p:Expression2 stringValue="1"/>

                                                            <L7p:Predicates predicates="included">

                                                                <L7p:item binary="included">

                                                                    <L7p:RightValue stringValue="1"/>
                                                                </L7p:item>
                                                            </L7p:Predicates>
                                                        </L7p:ComparisonAssertion>
                                                        <L7p:SetVariable>

                                                            <L7p:Base64Expression stringValue="dHJ1ZQ=="/>

                                                            <L7p:VariableToSet stringValue="requireOAuth1"/>
                                                        </L7p:SetVariable>
                                                    </wsp:All>
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:ComparisonAssertion>

                                                            <L7p:Expression1 stringValue="${responseXpath.element}"/>

                                                            <L7p:Expression2 stringValue="2"/>

                                                            <L7p:Predicates predicates="included">

                                                                <L7p:item binary="included">

                                                                    <L7p:RightValue stringValue="2"/>
                                                                </L7p:item>
                                                            </L7p:Predicates>
                                                        </L7p:ComparisonAssertion>
                                                        <L7p:SetVariable>

                                                            <L7p:Base64Expression stringValue="dHJ1ZQ=="/>

                                                            <L7p:VariableToSet stringValue="requireOAuth2"/>
                                                        </L7p:SetVariable>
                                                    </wsp:All>
                                                </wsp:OneOrMore>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="requireOAuthX"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:CodeInjectionProtection/l7:HtmlJavascript/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="crossSiteInjectionProtection"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="crossSiteInjectionProtection"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:CodeInjectionProtection/l7:PhpEval/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="phpEvalInjectionProtection"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="phpEvalInjectionProtection"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:CodeInjectionProtection/l7:Shell/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="shellInjectionProtection"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="shellInjectionProtection"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:CodeInjectionProtection/l7:LdapDn/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="ldapDNInjectionProtection"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="ldapDNInjectionProtection"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:CodeInjectionProtection/l7:LdapSearch/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="ldapSearchInjectionProtection"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="ldapSearchInjectionProtection"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:CodeInjectionProtection/l7:Xpath/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="xpathInjectionProtection"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="xpathInjectionProtection"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:SqlInjectionProtection/l7:MsSql/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="sqlServerExploits"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="sqlServerExploits"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:SqlInjectionProtection/l7:OraSql/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="oracleExploits"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="oracleExploits"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:SqlInjectionProtection/l7:StandardSql/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="standardSQLInjection"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="standardSQLInjection"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XmlMsgSrc stringValue="request"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Api/l7:ServicePolicyConfig/l7:SqlInjectionProtection/l7:InvasiveSql/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${responseXpath.element}"/>
                                                    <L7p:Expression2 stringValue="true"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="true"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                                    <L7p:VariableToSet stringValue="invasiveSQLInjection"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="invasiveSQLInjection"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//skip if there is already an error"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${errorCode}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="ZXJyb3IgcHJvY2Vzc2luZyAvYXBpcyByZXF1ZXN0"/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//process xml request and fill-up variables required by our stylesheet"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="Process xml request"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:FalseAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//continue to real operation"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                </L7p:FalseAssertion>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//process xml request for parameters"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="GET"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="R0VU"/>
                                    <L7p:VariableToSet stringValue="pman.operation"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//required by API Portal Integration Assertion"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Base64Expression stringValue="LzEvYXBpcw=="/>
                                    <L7p:VariableToSet stringValue="pman.resUri"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5zaG93UG9saWN5fQ=="/>
                                    <L7p:VariableToSet stringValue="showPolicy"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5zaG93RGV0YWlsc30="/>
                                    <L7p:VariableToSet stringValue="showDetails"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5lbmFibGVkfQ=="/>
                                    <L7p:VariableToSet stringValue="enabled"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5ncm91cH0="/>
                                    <L7p:VariableToSet stringValue="pman.options.apiGroup"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:Expression1 stringValue="${pman.resId}"/>
                                            <L7p:Expression2 stringValue=""/>
                                            <L7p:Negate booleanValue="true"/>
                                            <L7p:Operator operator="EMPTY"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="LzEvYXBpcy8ke3BtYW4ucmVzSWR9"/>
                                            <L7p:VariableToSet stringValue="pman.resUri"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:TrueAssertion/>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//search by apiId"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:ManagePortalResource/>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                            <L7p:Expression2 stringValue="200"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="200"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="pmanResponse"/>
                                            </L7p:SetVariable>
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue="serviceOIDs"/>
                                                <L7p:XmlMsgSrc stringValue="pmanResponse"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="//l7:Api/l7:ServiceOID/text()"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                            <L7p:SetVariable>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="// this is not required if the error checking is done for empty"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:Base64Expression stringValue="QGlkPWR1bW15"/>
                                                <L7p:VariableToSet stringValue="vcmanFilter"/>
                                            </L7p:SetVariable>
                                            <L7p:ForEachLoop
                                                    L7p:Usage="Required"
                                                    loopVariable="serviceOIDs.results" variablePrefix="oneSvc">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHt2Y21hbkZpbHRlcn0gb3IgQGlkPSR7b25lU3ZjLmN1cnJlbnR9"/>
                                                    <L7p:VariableToSet stringValue="vcmanFilter"/>
                                                </L7p:SetVariable>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//build wsman filter"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </L7p:ForEachLoop>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="PGVudjpFbnZlbG9wZSB4bWxuczplbnY9Imh0dHA6Ly93d3cudzMub3JnLzIwMDMvMDUvc29hcC1lbnZlbG9wZSINCiAgICB4bWxuczp3c2E9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZyINCiAgICB4bWxuczp3c2U9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvZXZlbnRpbmciDQogICAgeG1sbnM6d3Nlbj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS9lbnVtZXJhdGlvbiINCiAgICB4bWxuczp3c21hbj0iaHR0cDovL3NjaGVtYXMuZG10Zi5vcmcvd2JlbS93c21hbi8xL3dzbWFuLnhzZCINCiAgICB4bWxuczp3eGY9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDkvdHJhbnNmZXIiDQogICAgeG1sbnM6bDc9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTAvMDQvZ2F0ZXdheS1tYW5hZ2VtZW50IiB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiPg0KICAgIDxlbnY6SGVhZGVyPg0KICAgICAgICA8d3NhOkFjdGlvbiBlbnY6bXVzdFVuZGVyc3RhbmQ9InRydWUiPmh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDkvZW51bWVyYXRpb24vRW51bWVyYXRlPC93c2E6QWN0aW9uPg0KICAgICAgICA8d3NhOlJlcGx5VG8+DQogICAgICAgICAgICA8d3NhOkFkZHJlc3MgZW52Om11c3RVbmRlcnN0YW5kPSJ0cnVlIj5odHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA0LzA4L2FkZHJlc3Npbmcvcm9sZS9hbm9ueW1vdXM8L3dzYTpBZGRyZXNzPg0KICAgICAgICA8L3dzYTpSZXBseVRvPg0KICAgICAgICA8d3NhOk1lc3NhZ2VJRCBlbnY6bXVzdFVuZGVyc3RhbmQ9InRydWUiPndzbS1nZXQtaWQtJHtyZXF1ZXN0SWR9PC93c2E6TWVzc2FnZUlEPg0KICAgICAgICA8d3NhOlRvIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0My93c21hbjwvd3NhOlRvPg0KICAgICAgICA8d3NtYW46UmVzb3VyY2VVUkk+aHR0cDovL25zLmw3dGVjaC5jb20vMjAxMC8wNC9nYXRld2F5LW1hbmFnZW1lbnQvc2VydmljZXM8L3dzbWFuOlJlc291cmNlVVJJPg0KICAgICAgICA8d3NtYW46UmVxdWVzdFRvdGFsSXRlbXNDb3VudEVzdGltYXRlLz4NCiAgICA8L2VudjpIZWFkZXI+DQogICAgPGVudjpCb2R5Pg0KICAgICAgICA8d3NlbjpFbnVtZXJhdGU+DQogICAgICAgICAgICA8d3NtYW46T3B0aW1pemVFbnVtZXJhdGlvbi8+DQogICAgICAgICAgICA8d3NtYW46TWF4RWxlbWVudHM+MTAwMDAwPC93c21hbjpNYXhFbGVtZW50cz4NCiAgICAgICAgICAgIDx3c21hbjpGaWx0ZXI+Ly9sNzpTZXJ2aWNlWyR7dmNtYW5GaWx0ZXJ9XTwvd3NtYW46RmlsdGVyPg0KICAgICAgICA8L3dzZW46RW51bWVyYXRlPg0KICAgIDwvZW52OkJvZHk+DQo8L2VudjpFbnZlbG9wZT4="/>
                                                <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="request"/>
                                            </L7p:SetVariable>
                                            <L7p:GatewayManagement>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//look for specific serviceId(s) only"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:VariablePrefix stringValue="wsman"/>
                                            </L7p:GatewayManagement>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// using wsman"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="getPublishedServiceDetails()"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                        <wsp:All wsp:Usage="Required">
                                            <wsp:OneOrMore wsp:Usage="Required">
                                                <wsp:All wsp:Usage="Required">
                                                    <L7p:ComparisonAssertion>

                                                        <L7p:CaseSensitive booleanValue="false"/>
                                                        <L7p:Expression1 stringValue="${showPolicy}"/>
                                                        <L7p:Operator operatorNull="null"/>
                                                        <L7p:Predicates predicates="included">
                                                            <L7p:item dataType="included">

                                                                <L7p:Type variableDataType="string"/>
                                                            </L7p:item>
                                                            <L7p:item binary="included">

                                                                <L7p:RightValue stringValue="true"/>
                                                            </L7p:item>
                                                        </L7p:Predicates>
                                                    </L7p:ComparisonAssertion>
                                                    <L7p:ResponseXpathAssertion>

                                                        <L7p:VariablePrefix stringValue="wsmanSvcDetails"/>

                                                        <L7p:XpathExpression xpathExpressionValue="included">

                                                            <L7p:Expression stringValue="//l7:Service"/>

                                                            <L7p:Namespaces mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsa"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mdo"/>

                                                                    <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="s"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="l7"/>

                                                                    <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wxf"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="xs"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="env"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsen"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsman"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mex"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wse"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsmeta"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                </L7p:entry>
                                                            </L7p:Namespaces>
                                                        </L7p:XpathExpression>
                                                    </L7p:ResponseXpathAssertion>
                                                </wsp:All>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="wsmanSvcDetails"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="//l7:Service/l7:ServiceDetail"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:OneOrMore>
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue="pmanApis"/>
                                                <L7p:XmlMsgSrc stringValue="pmanResponse"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="//l7:Api"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="wsa"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="mdo"/>
                                                            <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="PGw3OkFwaXMgeG1sbnM6bDc9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMDQvYXBpLW1hbmFnZW1lbnQiPg0KICAgIDxsNzpNZXRob2Q+JHtwbWFuLm9wZXJhdGlvbn08L2w3Ok1ldGhvZD4NCiAgICA8bDc6UmVzb3VyY2U+JHtwbWFuLnJlc1VyaX08L2w3OlJlc291cmNlPg0KICAgIDxsNzpSZXNvdXJjZUlkPiR7cG1hbi5yZXNJZH08L2w3OlJlc291cmNlSWQ+DQogICAgPGw3OlRpbWVzdGFtcD4ke2dhdGV3YXkudGltZX08L2w3OlRpbWVzdGFtcD4NCiAgICA8bDc6U3RhdHVzPjIwMDwvbDc6U3RhdHVzPg0KICAgIDxsNzpEZXRhaWxzPnN1Y2Nlc3M8L2w3OkRldGFpbHM+DQoke3BtYW5BcGlzLmVsZW1lbnRzfQ0KJHt3c21hblN2Y0RldGFpbHMuZWxlbWVudHN9DQo8L2w3OkFwaXM+"/>
                                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="finalApisResponse"/>
                                            </L7p:SetVariable>
                                            <L7p:XslTransformation>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="// merge the pman and wsman responses together"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:Direction intValue="-1"/>

                                                <L7p:OtherTargetMessageVariable stringValue="finalApisResponse"/>
                                                <L7p:ResourceInfo staticResourceInfo="included">
                                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet extension-element-prefixes="l7" version="1.0" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:param name="showDetails"/>
<xsl:param name="showPolicy"/>
    
<xsl:template match="/l7:Apis">
    <xsl:copy>
        <xsl:copy-of select="l7:Method"/>
        <xsl:copy-of select="l7:Resource"/>
        <xsl:copy-of select="l7:ResourceId"/>
        <xsl:copy-of select="l7:Timestamp"/>
        <xsl:copy-of select="l7:Status"/>
        <xsl:copy-of select="l7:Details"/>
        <xsl:apply-templates select="l7:Api"/>
    </xsl:copy>
</xsl:template>

<xsl:template match="l7:Api">
    <xsl:variable name="serviceOID" select="./l7:ServiceOID/text()"/>
    <xsl:copy>
        <xsl:choose>
            <xsl:when test="$showPolicy = 'true'">
                <xsl:call-template name="buildApiElement">
                    <xsl:with-param name="apiEl" select="."/>
                    <xsl:with-param name="svcDetailEl" select="/l7:Apis/l7:Service[@id=$serviceOID]/l7:ServiceDetail"/>
                    <xsl:with-param name="svcPolicyEl" select="/l7:Apis/l7:Service[@id=$serviceOID]//l7:Resource[@type = 'policy']"/>
                </xsl:call-template>
            </xsl:when>
            <xsl:otherwise>
                <xsl:call-template name="buildApiElement">
                    <xsl:with-param name="apiEl" select="."/>
                    <xsl:with-param name="svcDetailEl" select="/l7:Apis/l7:ServiceDetail[@id=$serviceOID]"/>
                </xsl:call-template>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:copy>
</xsl:template>

<xsl:template name="buildApiElement">
    <xsl:param name="apiEl"/>
    <xsl:param name="svcDetailEl"/>
    <xsl:param name="svcPolicyEl"/>
    
    <xsl:copy-of select="$apiEl/l7:ApiId"/>
    <xsl:copy-of select="$apiEl/l7:ApiGroup"/>
    <xsl:copy-of select="$apiEl/l7:ServiceOID"/>
    <xsl:element name="l7:ServiceVersion" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcDetailEl/@version"/></xsl:element>
    <xsl:element name="l7:ServiceName" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcDetailEl/l7:Name/text()"/></xsl:element>
    <xsl:element name="l7:ServiceEnabled" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcDetailEl/l7:Enabled/text()"/></xsl:element>
    <!-- Build l7:ServiceDetails only when flag is set -->
    <xsl:if test="$showDetails = 'true'">
        <xsl:element name="l7:ServiceDetails" namespace="http://ns.l7tech.com/2012/04/api-management">
            <xsl:element name="l7:UrlPattern" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcDetailEl//l7:UrlPattern/text()"/></xsl:element>
            <xsl:element name="l7:HttpVerb" namespace="http://ns.l7tech.com/2012/04/api-management">
                <xsl:call-template name="getHttpVerbs"><xsl:with-param name="verbs" select="$svcDetailEl//l7:Verbs"/></xsl:call-template>
            </xsl:element>
            <xsl:element name="l7:FolderId" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcDetailEl/@folderId"/></xsl:element>
            <xsl:element name="l7:Soap" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcDetailEl//l7:Property[@key='soap']/l7:BooleanValue/text()"/></xsl:element>
            <xsl:element name="l7:Internal" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcDetailEl//l7:Property[@key='internal']/l7:BooleanValue/text()"/></xsl:element>
            <xsl:element name="l7:WssProcessingEnabled" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcDetailEl//l7:Property[@key='wssProcessingEnabled']/l7:BooleanValue/text()"/></xsl:element>
        </xsl:element>
    </xsl:if>
    <!-- Build l7:Policy only when flag is set -->
    <xsl:if test="$showPolicy = 'true'">
        <xsl:element name="l7:ServicePolicy" namespace="http://ns.l7tech.com/2012/04/api-management"><xsl:value-of select="$svcPolicyEl/text()" disable-output-escaping="no"/></xsl:element>
    </xsl:if>
</xsl:template>

<xsl:template name="getHttpVerbs">
    <xsl:param name="verbs"/>
    
    <xsl:variable name="count" select="count($verbs/l7:Verb)"/>
    
    <xsl:for-each select="$verbs//l7:Verb">
        <xsl:value-of select="."/><xsl:if test="position() &lt; $count"><xsl:text>,</xsl:text></xsl:if>
    </xsl:for-each>
</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                </L7p:ResourceInfo>
                                                <L7p:Target target="OTHER"/>
                                                <L7p:TransformName stringValue=""/>
                                            </L7p:XslTransformation>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtmaW5hbEFwaXNSZXNwb25zZS5tYWlucGFydH0="/>
                                                <L7p:VariableToSet stringValue="wsmanResp"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// build response"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="buildAPIsResponse"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                    </wsp:All>
                                    <L7p:TrueAssertion/>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//GET, Query APIs"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="PUT"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${pman.resId}"/>
                                    <L7p:Expression2 stringValue=""/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item binary="included">
                                            <L7p:Operator operator="EMPTY"/>
                                            <L7p:RightValue stringValue=""/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="pman.resp.status"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="RXJyb3IgcHVibGlzaGluZyBzZXJ2aWNl"/>
                                            <L7p:VariableToSet stringValue="pman.resp.detail"/>
                                        </L7p:SetVariable>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//skip if there is already an error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${errorCode}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="PGVudjpFbnZlbG9wZSB4bWxuczplbnY9Imh0dHA6Ly93d3cudzMub3JnLzIwMDMvMDUvc29hcC1lbnZlbG9wZSINCnhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDEwLzA0L2dhdGV3YXktbWFuYWdlbWVudCINCiAgICB4bWxuczp3c2E9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZyINCiAgICB4bWxuczp3c2U9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvZXZlbnRpbmciDQogICAgeG1sbnM6d3Nlbj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS9lbnVtZXJhdGlvbiINCiAgICB4bWxuczp3c21hbj0iaHR0cDovL3NjaGVtYXMuZG10Zi5vcmcvd2JlbS93c21hbi8xL3dzbWFuLnhzZCINCiAgICB4bWxuczp3eGY9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDkvdHJhbnNmZXIiIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSI+DQogICAgPGVudjpIZWFkZXI+DQogICAgICAgIDx3c2E6QWN0aW9uIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS9lbnVtZXJhdGlvbi9FbnVtZXJhdGU8L3dzYTpBY3Rpb24+DQogICAgICAgIDx3c2E6UmVwbHlUbz4NCiAgICAgICAgICAgIDx3c2E6QWRkcmVzcyBlbnY6bXVzdFVuZGVyc3RhbmQ9InRydWUiPmh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZy9yb2xlL2Fub255bW91czwvd3NhOkFkZHJlc3M+DQogICAgICAgIDwvd3NhOlJlcGx5VG8+DQogICAgICAgIDx3c2E6TWVzc2FnZUlEIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+JHtyZXF1ZXN0SWR9PC93c2E6TWVzc2FnZUlEPg0KICAgICAgICA8d3NhOlRvIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX06ODQ0My93c21hbjwvd3NhOlRvPg0KICAgICAgICA8d3NtYW46UmVzb3VyY2VVUkk+aHR0cDovL25zLmw3dGVjaC5jb20vMjAxMC8wNC9nYXRld2F5LW1hbmFnZW1lbnQvc2VydmljZXM8L3dzbWFuOlJlc291cmNlVVJJPg0KICAgICAgICA8d3NtYW46UmVxdWVzdFRvdGFsSXRlbXNDb3VudEVzdGltYXRlLz4NCiAgICA8L2VudjpIZWFkZXI+DQogICAgPGVudjpCb2R5Pg0KICAgICAgICA8d3NlbjpFbnVtZXJhdGU+DQogICAgICAgICAgICA8d3NtYW46T3B0aW1pemVFbnVtZXJhdGlvbi8+DQogICAgICAgICAgICA8d3NtYW46TWF4RWxlbWVudHM+MTwvd3NtYW46TWF4RWxlbWVudHM+DQogICAgICAgICAgICA8d3NtYW46RmlsdGVyPg0KL2w3OlNlcnZpY2UvbDc6U2VydmljZURldGFpbC9sNzpOYW1lW3RleHQoKT0nJHtzZXJ2aWNlTmFtZX0nXQ0KPC93c21hbjpGaWx0ZXI+DQogICAgICAgIDwvd3NlbjpFbnVtZXJhdGU+DQogICAgPC9lbnY6Qm9keT4NCjwvZW52OkVudmVsb3BlPg=="/>
                                                <L7p:ContentType stringValue="application/soap+xml;charset=UTF-8;action=&quot;http://schemas.xmlsoap.org/ws/2004/09/enumeration/Enumerate&quot;"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="request"/>
                                            </L7p:SetVariable>
                                            <L7p:GatewayManagement/>
                                            <wsp:OneOrMore wsp:Usage="Required">
                                                <wsp:All wsp:Usage="Required">
                                                    <L7p:ResponseXpathAssertion>

                                                        <L7p:VariablePrefix stringValue=""/>

                                                        <L7p:XpathExpression xpathExpressionValue="included">

                                                            <L7p:Expression stringValue="/env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/wsman:XmlFragment/l7:Name"/>

                                                            <L7p:Namespaces mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsa"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mdo"/>

                                                                    <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="s"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="l7"/>

                                                                    <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wxf"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="xs"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="env"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsen"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsman"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mex"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wse"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsmeta"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                </L7p:entry>
                                                            </L7p:Namespaces>
                                                        </L7p:XpathExpression>
                                                    </L7p:ResponseXpathAssertion>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="NTAw"/>

                                                        <L7p:VariableToSet stringValue="errorCode"/>
                                                    </L7p:SetVariable>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="U2VydmljZU5hbWUgJyR7c2VydmljZU5hbWV9JyBhbHJlYWR5IGV4aXN0"/>

                                                        <L7p:VariableToSet stringValue="errorMsg"/>
                                                    </L7p:SetVariable>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// If service exists set error"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:All>
                                                <L7p:TrueAssertion/>
                                            </wsp:OneOrMore>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// validate serviceName if already exist"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//skip if there is already an error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${errorCode}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="PGVudjpFbnZlbG9wZSB4bWxuczplbnY9Imh0dHA6Ly93d3cudzMub3JnLzIwMDMvMDUvc29hcC1lbnZlbG9wZSINCnhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDEwLzA0L2dhdGV3YXktbWFuYWdlbWVudCINCiAgICB4bWxuczp3c2E9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZyINCiAgICB4bWxuczp3c2U9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvZXZlbnRpbmciDQogICAgeG1sbnM6d3Nlbj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS9lbnVtZXJhdGlvbiINCiAgICB4bWxuczp3c21hbj0iaHR0cDovL3NjaGVtYXMuZG10Zi5vcmcvd2JlbS93c21hbi8xL3dzbWFuLnhzZCINCiAgICB4bWxuczp3eGY9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDkvdHJhbnNmZXIiIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSI+DQogICAgPGVudjpIZWFkZXI+DQogICAgICAgIDx3c2E6QWN0aW9uIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS9lbnVtZXJhdGlvbi9FbnVtZXJhdGU8L3dzYTpBY3Rpb24+DQogICAgICAgIDx3c2E6UmVwbHlUbz4NCiAgICAgICAgICAgIDx3c2E6QWRkcmVzcyBlbnY6bXVzdFVuZGVyc3RhbmQ9InRydWUiPmh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZy9yb2xlL2Fub255bW91czwvd3NhOkFkZHJlc3M+DQogICAgICAgIDwvd3NhOlJlcGx5VG8+DQogICAgICAgIDx3c2E6TWVzc2FnZUlEIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+JHtyZXF1ZXN0SWR9PC93c2E6TWVzc2FnZUlEPg0KICAgICAgICA8d3NhOlRvIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX06ODQ0My93c21hbjwvd3NhOlRvPg0KICAgICAgICA8d3NtYW46UmVzb3VyY2VVUkk+aHR0cDovL25zLmw3dGVjaC5jb20vMjAxMC8wNC9nYXRld2F5LW1hbmFnZW1lbnQvc2VydmljZXM8L3dzbWFuOlJlc291cmNlVVJJPg0KICAgICAgICA8d3NtYW46UmVxdWVzdFRvdGFsSXRlbXNDb3VudEVzdGltYXRlLz4NCiAgICA8L2VudjpIZWFkZXI+DQogICAgPGVudjpCb2R5Pg0KICAgICAgICA8d3NlbjpFbnVtZXJhdGU+DQogICAgICAgICAgICA8d3NtYW46T3B0aW1pemVFbnVtZXJhdGlvbi8+DQogICAgICAgICAgICA8d3NtYW46TWF4RWxlbWVudHM+MTwvd3NtYW46TWF4RWxlbWVudHM+DQogICAgICAgICAgICA8d3NtYW46RmlsdGVyPg0KL2w3OlNlcnZpY2UvbDc6U2VydmljZURldGFpbC9sNzpTZXJ2aWNlTWFwcGluZ3MvbDc6SHR0cE1hcHBpbmcvbDc6VXJsUGF0dGVyblt0ZXh0KCk9Jy8ke3VybFBhdHRlcm59Kicgb3IgdGV4dCgpPScke3VybFBhdHRlcm59KiddDQo8L3dzbWFuOkZpbHRlcj4NCiAgICAgICAgPC93c2VuOkVudW1lcmF0ZT4NCiAgICA8L2VudjpCb2R5Pg0KPC9lbnY6RW52ZWxvcGU+"/>
                                                <L7p:ContentType stringValue="application/soap+xml;charset=UTF-8;action=&quot;http://schemas.xmlsoap.org/ws/2004/09/enumeration/Enumerate&quot;"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="request"/>
                                            </L7p:SetVariable>
                                            <L7p:GatewayManagement/>
                                            <wsp:OneOrMore wsp:Usage="Required">
                                                <wsp:All wsp:Usage="Required">
                                                    <L7p:ResponseXpathAssertion>

                                                        <L7p:VariablePrefix stringValue=""/>

                                                        <L7p:XpathExpression xpathExpressionValue="included">

                                                            <L7p:Expression stringValue="/env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/wsman:XmlFragment/l7:UrlPattern"/>

                                                            <L7p:Namespaces mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsa"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mdo"/>

                                                                    <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="s"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="l7"/>

                                                                    <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="xs"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wxf"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsen"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="env"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsman"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsmeta"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wse"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mex"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                </L7p:entry>
                                                            </L7p:Namespaces>
                                                        </L7p:XpathExpression>
                                                    </L7p:ResponseXpathAssertion>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="NTAw"/>

                                                        <L7p:VariableToSet stringValue="errorCode"/>
                                                    </L7p:SetVariable>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="VXJsUGF0dGVybiAnJHt1cmxQYXR0ZXJufScgYWxyZWFkeSBleGlzdA=="/>

                                                        <L7p:VariableToSet stringValue="errorMsg"/>
                                                    </L7p:SetVariable>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// If service exists set error"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:All>
                                                <L7p:TrueAssertion/>
                                            </wsp:OneOrMore>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// validate urlPattern if already exist"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//skip if there is already an error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${errorCode}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="PHhtbC8+"/>
                                                <L7p:ContentType stringValue="application/soap+xml;charset=UTF-8;action=&quot;http://schemas.xmlsoap.org/ws/2004/09/transfer/Create&quot;"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="request"/>
                                            </L7p:SetVariable>
                                            <L7p:UUIDGenerator>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                                            <L7p:value stringValue="apiId"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:MaximumQuantity intValue="36"/>
                                                <L7p:TargetVariable stringValue="apiId"/>
                                            </L7p:UUIDGenerator>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHthcGlJZH0="/>
                                                <L7p:VariableToSet stringValue="pman.resId"/>
                                            </L7p:SetVariable>
                                            <L7p:XslTransformation>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//create API"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:ResourceInfo staticResourceInfo="included">
                                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
<xsl:param name="requireSSL" select="'false'"/>
<xsl:param name="portalManaged" select="'true'"/>
<xsl:param name="requireAPIKey" select="'true'"/>
<xsl:param name="requireOAuth1" select="'false'"/>
<xsl:param name="requireOAuth2" select="'false'"/>
<xsl:param name="pman.resId" select="''"/>
<xsl:param name="apiGroup" select="''"/>
<xsl:param name="gateway.portal.api.plans.fragment.guid" select="'03a8e771-bc14-4172-8f22-40164020210d'"/>
<xsl:param name="gateway.portal.account.plans.fragment.guid" select="'4448d875-f74b-4eed-8c49-ec0ff95c1b0f'"/>
<xsl:param name="gateway.portal.oauth1.fragment.guid" select="'f243464d-964b-487b-bbaa-2e6f853efb79'"/>
<xsl:param name="gateway.portal.oauth2.fragment.guid" select="'0e112050-5ba5-4c08-a6ee-22c39f0762c1'"/>
<xsl:param name="sqlServerExploits" select="'false'"/>
<xsl:param name="oracleExploits" select="'false'"/>
<xsl:param name="standardSQLInjection" select="'false'"/>
<xsl:param name="invasiveSQLInjection" select="'false'"/>
<xsl:param name="requestProtectionUrl" select="'true'"/>
<xsl:param name="requestProtectionBody" select="'true'"/>
<xsl:param name="crossSiteInjectionProtection" select="'false'"/>
<xsl:param name="phpEvalInjectionProtection" select="'false'"/>
<xsl:param name="shellInjectionProtection" select="'false'"/>
<xsl:param name="ldapDNInjectionProtection" select="'false'"/>
<xsl:param name="ldapSearchInjectionProtection" select="'false'"/>
<xsl:param name="xpathInjectionProtection" select="'false'"/>
<xsl:param name="requestId" select="'now'"/>
<xsl:param name="gateway.cluster.hostname" select="'localhost'"/>
<xsl:param name="serviceName" select="''"/>
<xsl:param name="urlPattern" select="''"/>
<xsl:param name="routingUrl" select="''"/>
<xsl:param name="gateway.time" select="'now'"/>
<xsl:output encoding="UTF-8" indent="yes" method="xml" omit-xml-declaration="yes" version="1.0"/>
<xsl:template match="/">
<env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope" xmlns:wsa="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:wse="http://schemas.xmlsoap.org/ws/2004/08/eventing" xmlns:wsen="http://schemas.xmlsoap.org/ws/2004/09/enumeration" xmlns:wsman="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd" xmlns:wxf="http://schemas.xmlsoap.org/ws/2004/09/transfer" xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <env:Header>
        <wsa:Action env:mustUnderstand="true">http://schemas.xmlsoap.org/ws/2004/09/transfer/Create</wsa:Action>
        <wsa:ReplyTo>
            <wsa:Address env:mustUnderstand="true">http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous</wsa:Address>
        </wsa:ReplyTo>
        <wsa:MessageID env:mustUnderstand="true"><xsl:value-of select="$requestId"/></wsa:MessageID>
        <wsa:To env:mustUnderstand="true">https://<xsl:value-of select="$gateway.cluster.hostname"/>:8443/wsman</wsa:To>
        <wsman:ResourceURI>http://ns.l7tech.com/2010/04/gateway-management/services</wsman:ResourceURI>
        <wsman:OperationTimeout>P0Y0M0DT0H5M0.000S</wsman:OperationTimeout>
    </env:Header>
    <env:Body>
<Service xmlns="http://ns.l7tech.com/2010/04/gateway-management">
    <ServiceDetail>
        <Name><xsl:value-of select="$serviceName"/></Name>
        <Enabled>true</Enabled>
        <ServiceMappings>
            <HttpMapping>
                <UrlPattern>/<xsl:value-of select="$urlPattern"/>*</UrlPattern>
                <Verbs>
                    <Verb>GET</Verb>
                    <Verb>POST</Verb>
                    <Verb>PUT</Verb>
                    <Verb>DELETE</Verb>
                </Verbs>
            </HttpMapping>
        </ServiceMappings>
        <Properties>
            <Property key="wssProcessingEnabled">
                <BooleanValue>false</BooleanValue>
            </Property>
            <Property key="soap">
                <BooleanValue>false</BooleanValue>
            </Property>
            <Property key="internal">
                <BooleanValue>false</BooleanValue>
            </Property>
        </Properties>
    </ServiceDetail>
    <Resources>
        <ResourceSet tag="policy">
            <Resource type="policy">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
&lt;wsp:All wsp:Usage="Required"&gt;		    
    &lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="============================="/&gt;
    &lt;/L7p:CommentAssertion&gt;
    &lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="======= Published thru API Portal ======="/&gt;
    &lt;/L7p:CommentAssertion&gt;
    &lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="======= Don't modify block starts ======="/&gt;
    &lt;/L7p:CommentAssertion&gt;
    &lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="============================="/&gt;
    &lt;/L7p:CommentAssertion&gt;
    
	&lt;L7p:ApiPortalIntegration&gt;
			<xsl:if test="$portalManaged = 'false'">
			&lt;L7p:Enabled booleanValue="false"/&gt;
			</xsl:if>
			&lt;L7p:ApiGroup stringValue="<xsl:value-of select="$apiGroup"/>"/&gt;
			&lt;L7p:ApiId stringValue="<xsl:value-of select="$pman.resId"/>"/&gt;
            &lt;L7p:PortalManagedApiFlag stringValue="L7p:ApiPortalManagedServiceAssertion"/&gt;
        &lt;/L7p:ApiPortalIntegration&gt;

	&lt;wsp:All wsp:Usage="Required"&gt;
		
		&lt;!-- requireSSL --&gt;		
		&lt;L7p:SslAssertion&gt;            
			&lt;L7p:Enabled booleanValue="<xsl:choose><xsl:when test="$requireSSL = 'true'">True</xsl:when><xsl:otherwise>False</xsl:otherwise></xsl:choose>"/&gt;
        &lt;/L7p:SslAssertion&gt;
		&lt;!-- requireSSL --&gt;

		<xsl:if test="$gateway.portal.oauth1.fragment.guid != 'not installed'">
		&lt;!-- requireOAuth1x --&gt;
		&lt;L7p:Include&gt;
            &lt;L7p:Enabled booleanValue="<xsl:value-of select="$requireOAuth1"/>"/&gt;
			&lt;L7p:PolicyGuid stringValue="<xsl:value-of select="$gateway.portal.oauth1.fragment.guid"/>"/&gt;
        &lt;/L7p:Include&gt;
		&lt;!-- requireOAuth1x --&gt;
		</xsl:if>

		<xsl:if test="$gateway.portal.oauth2.fragment.guid != 'not installed'">
		&lt;!-- requireOAuth20 --&gt;
		&lt;L7p:Include&gt;
            &lt;L7p:Enabled booleanValue="<xsl:choose><xsl:when test="$requireOAuth1 = 'true'">False</xsl:when><xsl:otherwise><xsl:value-of select="$requireOAuth2"/></xsl:otherwise></xsl:choose>"/&gt;
			&lt;L7p:PolicyGuid stringValue="<xsl:value-of select="$gateway.portal.oauth2.fragment.guid"/>"/&gt;
        &lt;/L7p:Include&gt;
		&lt;!-- requireOAuth20 --&gt;
		</xsl:if>
        
		&lt;!-- start of wsl:All for API Portal Integration section --&gt;
		&lt;wsp:All L7p:Enabled="<xsl:value-of select="$requireAPIKey"/>" wsp:Usage="Required"&gt;
            &lt;L7p:SetVariable&gt;
                &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// capture the API resource requested"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="getRequestedApiResource()"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:AssertionComment&gt;
                &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAudXJpfQ=="/&gt;
                &lt;L7p:VariableToSet stringValue="apiResource"/&gt;
            &lt;/L7p:SetVariable&gt;
            &lt;L7p:SetVariable&gt;
                &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// parse API key from request"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="getRequestApiKey()"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:AssertionComment&gt;
                &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX0="/&gt;
                &lt;L7p:VariableToSet stringValue="lookupApiKey"/&gt;
            &lt;/L7p:SetVariable&gt;
			        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;L7p:ComparisonAssertion&gt;
                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                &lt;L7p:Expression1 stringValue="&#36;{lookupApiKey}"/&gt;
                &lt;L7p:Operator operatorNull="null"/&gt;
                &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item stringLength="included"&gt;
                        &lt;L7p:Max intValue="-1"/&gt;
                        &lt;L7p:Min intValue="1"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Predicates&gt;
            &lt;/L7p:ComparisonAssertion&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="&#36;{session.client_id}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item stringLength="included"&gt;
                            &lt;L7p:Max intValue="-1"/&gt;
                            &lt;L7p:Min intValue="1"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="// parse API key from request"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="getRequestApiKey()"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzZXNzaW9uLmNsaWVudF9pZH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupApiKey"/&gt;
                &lt;/L7p:SetVariable&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="&#36;{oauth_consumer_key}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item stringLength="included"&gt;
                            &lt;L7p:Max intValue="-1"/&gt;
                            &lt;L7p:Min intValue="1"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="// parse API key from request"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="getRequestApiKey()"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue="JHtvYXV0aF9jb25zdW1lcl9rZXl9"/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupApiKey"/&gt;
                &lt;/L7p:SetVariable&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:TrueAssertion/&gt;
        &lt;/wsp:OneOrMore&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:LookupApiKey&gt;
                    &lt;L7p:ApiKey stringValue="&#36;{lookupApiKey}"/&gt;
                    &lt;L7p:ServiceId stringValue="&#36;{portal.managed.service.apiId}"/&gt;
                &lt;/L7p:LookupApiKey&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="&#36;{apiKeyRecord.found}"/&gt;
                            &lt;L7p:Operator operatorNull="null"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item dataType="included"&gt;
                                    &lt;L7p:Type variableDataType="string"/&gt;
                                &lt;/L7p:item&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="true"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                            &lt;L7p:ComparisonAssertion&gt;
                                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                &lt;L7p:Expression1 stringValue="&#36;{apiKeyRecord.service}"/&gt;
                                &lt;L7p:Operator operatorNull="null"/&gt;
                                &lt;L7p:Predicates predicates="included"&gt;
                                    &lt;L7p:item dataType="included"&gt;
                                    &lt;L7p:Type variableDataType="string"/&gt;
                                    &lt;/L7p:item&gt;
                                    &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="&#36;{portal.managed.service.apiId}"/&gt;
                                    &lt;/L7p:item&gt;
                                &lt;/L7p:Predicates&gt;
                            &lt;/L7p:ComparisonAssertion&gt;
                            &lt;L7p:ComparisonAssertion&gt;
                                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                &lt;L7p:Expression1 stringValue="&#36;{apiKeyRecord.service}"/&gt;
                                &lt;L7p:Operator operatorNull="null"/&gt;
                                &lt;L7p:Predicates predicates="included"&gt;
                                    &lt;L7p:item dataType="included"&gt;
                                    &lt;L7p:Type variableDataType="string"/&gt;
                                    &lt;/L7p:item&gt;
                                    &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="&#36;{service.oid}"/&gt;
                                    &lt;/L7p:item&gt;
                                &lt;/L7p:Predicates&gt;
                            &lt;/L7p:ComparisonAssertion&gt;
                        &lt;/wsp:OneOrMore&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="&#36;{apiKeyRecord.status}"/&gt;
                            &lt;L7p:Operator operatorNull="null"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item dataType="included"&gt;
                                    &lt;L7p:Type variableDataType="string"/&gt;
                                &lt;/L7p:item&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="active"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="// success - API key found"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:CustomizeErrorResponse&gt;
                            &lt;L7p:Content stringValue="Invalid API Key"/&gt;
                            &lt;L7p:HttpStatus stringValue="400"/&gt;
                        &lt;/L7p:CustomizeErrorResponse&gt;
                        &lt;L7p:FalseAssertion/&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="// error - API key not found"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Lookup API Key"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Step 1 --"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthcGlLZXlSZWNvcmQua2V5fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="apiKey"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthcGlLZXlSZWNvcmQucGxhbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="apiPlan"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:MessageContextAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="// capture API key and requested method (used by analytics)"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Mappings mappingInfoArray="included"&gt;
                        &lt;L7p:item mappingInfo="included"&gt;
                            &lt;L7p:Key stringValue="AUTH_USER"/&gt;
                            &lt;L7p:MappingType mappingType="AUTH_USER"/&gt;
                            &lt;L7p:Value stringValue="(SYSTEM DEFINED)"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item mappingInfo="included"&gt;
                            &lt;L7p:Key stringValue="API_KEY"/&gt;
                            &lt;L7p:MappingType mappingType="CUSTOM_MAPPING"/&gt;
                            &lt;L7p:Value stringValue="&#36;{apikey}"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item mappingInfo="included"&gt;
                            &lt;L7p:Key stringValue="API_METHOD"/&gt;
                            &lt;L7p:MappingType mappingType="CUSTOM_MAPPING"/&gt;
                            &lt;L7p:Value stringValue="&#36;{apiResource}"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Mappings&gt;
                &lt;/L7p:MessageContextAssertion&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// Capture API key and API method for metrics"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Step 2 --"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
			<!-- Account Plans -->
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:Include&gt;
					&lt;!-- Account Plans Policy Fragment --&gt;
					&lt;L7p:PolicyGuid stringValue="<xsl:value-of select="$gateway.portal.account.plans.fragment.guid"/>"/&gt;
                &lt;/L7p:Include&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                        &lt;L7p:CaseSensitive booleanValue="false"/&gt;

                        &lt;L7p:Expression1 stringValue="&#36;{apiAuthz}"/&gt;
                        &lt;L7p:Operator operatorNull="null"/&gt;
                        &lt;L7p:Predicates predicates="included"&gt;
                            &lt;L7p:item dataType="included"&gt;
                                &lt;L7p:Type variableDataType="string"/&gt;
                            &lt;/L7p:item&gt;
                            &lt;L7p:item binary="included"&gt;
                                &lt;L7p:RightValue stringValue="true"/&gt;
                            &lt;/L7p:item&gt;
                        &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[Account plan limit exceeded

Reason: &#36;{apiAuthzDetails}]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:FalseAssertion/&gt;
    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// Enforce Account Plan restriction"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Step 3 --"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
			<!-- Account Plans -->
			<!-- API Plans -->
			&lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:Include&gt;
					&lt;!-- API Plans Policy Fragment --&gt;
					&lt;L7p:PolicyGuid stringValue="<xsl:value-of select="$gateway.portal.api.plans.fragment.guid"/>"/&gt;
                &lt;/L7p:Include&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                        &lt;L7p:CaseSensitive booleanValue="false"/&gt;

                        &lt;L7p:Expression1 stringValue="&#36;{apiAuthz}"/&gt;
                        &lt;L7p:Operator operatorNull="null"/&gt;
                        &lt;L7p:Predicates predicates="included"&gt;
                            &lt;L7p:item dataType="included"&gt;
                                &lt;L7p:Type variableDataType="string"/&gt;
                            &lt;/L7p:item&gt;
                            &lt;L7p:item binary="included"&gt;
                                &lt;L7p:RightValue stringValue="true"/&gt;
                            &lt;/L7p:item&gt;
                        &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[API plan limit exceeded

Reason: &#36;{apiAuthzDetails}]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:FalseAssertion/&gt;
    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// Enforce API Plan restriction"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Step 4 --"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
			<!-- API Plans -->
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="// API Portal Integration section"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:All&gt;
		&lt;!-- end of wsl:All for APi Portal Integration section --&gt;

		&lt;!-- SQL Protection --&gt;
		&lt;L7p:SqlAttackProtection&gt;
			<xsl:if test="$sqlServerExploits != 'true' and $oracleExploits != 'true' and $standardSQLInjection != 'true' and $invasiveSQLInjection != 'true'">
            &lt;L7p:Enabled booleanValue="false"/&gt;            
			</xsl:if>
			&lt;L7p:Protections stringSetValue="included"&gt;
				<xsl:if test="$sqlServerExploits = 'true'">
				&lt;L7p:item stringValue="MsSql"/&gt;
				</xsl:if>
				<xsl:if test="$oracleExploits = 'true'">
                &lt;L7p:item stringValue="OraSql"/&gt;
				</xsl:if>
				<xsl:if test="$standardSQLInjection = 'true'">
                &lt;L7p:item stringValue="SqlMetaText"/&gt;
				</xsl:if>
				<xsl:if test="$invasiveSQLInjection = 'true'">
                &lt;L7p:item stringValue="SqlMeta"/&gt;
				</xsl:if>
			&lt;/L7p:Protections&gt;
        &lt;/L7p:SqlAttackProtection&gt;
		&lt;!-- SQL Protection --&gt;

		&lt;!-- Code Injection Protection --&gt;
		&lt;L7p:CodeInjectionProtectionAssertion&gt;
			<xsl:if test="$requestProtectionUrl != 'true' and $requestProtectionBody != 'true'">
				&lt;L7p:Enabled booleanValue="false"/&gt;
			</xsl:if>
			<xsl:if test="$crossSiteInjectionProtection != 'true' and $phpEvalInjectionProtection != 'true' and $shellInjectionProtection != 'true' and $ldapDNInjectionProtection != 'true' and $ldapSearchInjectionProtection != 'true' and $xpathInjectionProtection != 'true'">
				&lt;L7p:Enabled booleanValue="false"/&gt;
			</xsl:if>
			<xsl:if test="$requestProtectionBody = 'true'">
			&lt;L7p:IncludeRequestBody booleanValue="true"/&gt;
			</xsl:if>
			<xsl:if test="$requestProtectionUrl = 'true'">
			&lt;L7p:IncludeRequestUrl booleanValue="true"/&gt;
			</xsl:if>
			&lt;L7p:Protections codeInjectionProtectionTypeArray="included"&gt;
				<xsl:if test="$crossSiteInjectionProtection = 'true'">
				&lt;L7p:item protectionType="htmlJavaScriptInjection"/&gt;
				</xsl:if>
				<xsl:if test="$phpEvalInjectionProtection = 'true'">
				&lt;L7p:item protectionType="phpEvalInjection"/&gt;
				</xsl:if>
				<xsl:if test="$shellInjectionProtection = 'true'">
				&lt;L7p:item protectionType="shellInjection"/&gt;
				</xsl:if>
				<xsl:if test="$ldapDNInjectionProtection = 'true'">
				&lt;L7p:item protectionType="ldapDnInjection"/&gt;
				</xsl:if>
				<xsl:if test="$ldapSearchInjectionProtection = 'true'">
				&lt;L7p:item protectionType="ldapSearchInjection"/&gt;
				</xsl:if>
				<xsl:if test="$xpathInjectionProtection = 'true'">
				&lt;L7p:item protectionType="xpathInjection"/&gt;
				</xsl:if>
			&lt;/L7p:Protections&gt;
		&lt;/L7p:CodeInjectionProtectionAssertion&gt;
		&lt;!-- Code Injection Protection --&gt;

		&lt;L7p:assertionComment&gt;
          &lt;L7p:Properties mapValue="included"&gt;
            &lt;L7p:entry&gt;
              &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
              &lt;L7p:value stringValue="//auto generated policy"/&gt;
            &lt;/L7p:entry&gt;
          &lt;/L7p:Properties&gt;
        &lt;/L7p:assertionComment&gt;
    &lt;/wsp:All&gt;

        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="======= Don't modify block ends ======="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================="/&gt;
        &lt;/L7p:CommentAssertion&gt;

	&lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAudXJpfQ=="/&gt;
            &lt;L7p:VariableToSet stringValue="param.uri"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:Regex&gt;
            &lt;L7p:AutoTarget booleanValue="false"/&gt;
            &lt;L7p:OtherTargetMessageVariable stringValue="param.uri"/&gt;
            &lt;L7p:Regex stringValue="/<xsl:value-of select="$urlPattern"/>"/&gt;
            &lt;L7p:RegexName stringValue="process uri"/&gt;
            &lt;L7p:Replace booleanValue="true"/&gt;
            &lt;L7p:Replacement stringValue=""/&gt;
            &lt;L7p:Target target="OTHER"/&gt;
        &lt;/L7p:Regex&gt;

	&lt;L7p:HttpRoutingAssertion&gt;
		&lt;L7p:AssertionComment assertionComment="included"&gt;
			&lt;L7p:Properties mapValue="included"&gt;
				&lt;L7p:entry&gt;
					&lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
					&lt;L7p:value stringValue="Your API URL"/&gt;
				&lt;/L7p:entry&gt;
			&lt;/L7p:Properties&gt;
		&lt;/L7p:AssertionComment&gt;		
		&lt;L7p:ProtectedServiceUrl stringValue="<xsl:value-of select="$routingUrl"/>&#36;{param.uri}&#36;{request.url.query}"/&gt;
	&lt;/L7p:HttpRoutingAssertion&gt;	
	&lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="Created on <xsl:value-of select="$gateway.time"/>"/&gt;
    &lt;/L7p:CommentAssertion&gt;
&lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;</Resource>
        </ResourceSet>
    </Resources>
</Service>
    </env:Body>
</env:Envelope>

</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                </L7p:ResourceInfo>
                                                <L7p:TransformName stringValue=""/>
                                            </L7p:XslTransformation>
                                            <L7p:GatewayManagement>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//create the API"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:VariablePrefix stringValue="wsman"/>
                                            </L7p:GatewayManagement>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="RESP_createOp"/>
                                            </L7p:SetVariable>
                                            <wsp:OneOrMore wsp:Usage="Required">
                                                <wsp:All wsp:Usage="Required">
                                                    <L7p:ResponseXpathAssertion>

                                                        <L7p:VariablePrefix stringValue="serviceId"/>
                                                        <L7p:XmlMsgSrc stringValue="RESP_createOp"/>

                                                        <L7p:XpathExpression xpathExpressionValue="included">

                                                            <L7p:Expression stringValue="/env:Envelope/env:Body/wxf:ResourceCreated/wsa:ReferenceParameters/wsman:SelectorSet/wsman:Selector"/>

                                                            <L7p:Namespaces mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsa"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mdo"/>

                                                                    <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="s"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="l7"/>

                                                                    <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wxf"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="xs"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="env"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsen"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsman"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mex"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wse"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsmeta"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                </L7p:entry>
                                                            </L7p:Namespaces>
                                                        </L7p:XpathExpression>
                                                    </L7p:ResponseXpathAssertion>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// success"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:All>
                                                <wsp:All wsp:Usage="Required">
                                                    <L7p:ResponseXpathAssertion>

                                                        <L7p:VariablePrefix stringValue="fault"/>
                                                        <L7p:XmlMsgSrc stringValue="RESP_createOp"/>

                                                        <L7p:XpathExpression xpathExpressionValue="included">

                                                            <L7p:Expression stringValue="/env:Envelope/env:Body/env:Fault"/>

                                                            <L7p:Namespaces mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsa"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mdo"/>

                                                                    <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="s"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="l7"/>

                                                                    <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wxf"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="xs"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="env"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsen"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsman"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mex"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wse"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsmeta"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                </L7p:entry>
                                                            </L7p:Namespaces>
                                                        </L7p:XpathExpression>
                                                    </L7p:ResponseXpathAssertion>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="JHtmYXVsdC5lbGVtZW50fQ=="/>
                                                        <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                        <L7p:DataType variableDataType="message"/>

                                                        <L7p:VariableToSet stringValue="RESP_fault"/>
                                                    </L7p:SetVariable>
                                                    <wsp:OneOrMore wsp:Usage="Required">
                                                        <wsp:All wsp:Usage="Required">
                                                            <L7p:ResponseXpathAssertion>

                                                                <L7p:VariablePrefix stringValue="reason"/>

                                                                <L7p:XmlMsgSrc stringValue="RESP_fault"/>

                                                                <L7p:XpathExpression xpathExpressionValue="included">

                                                                    <L7p:Expression stringValue="//s:Reason/s:Text/text()"/>

                                                                    <L7p:Namespaces mapValue="included">
                                                                        <L7p:entry>

                                                                            <L7p:key stringValue="s"/>

                                                                            <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                        </L7p:entry>
                                                                        <L7p:entry>

                                                                            <L7p:key stringValue="l7"/>

                                                                            <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                        </L7p:entry>
                                                                    </L7p:Namespaces>
                                                                </L7p:XpathExpression>
                                                            </L7p:ResponseXpathAssertion>
                                                            <L7p:ResponseXpathAssertion>

                                                                <L7p:VariablePrefix stringValue="detail"/>

                                                                <L7p:XmlMsgSrc stringValue="RESP_fault"/>

                                                                <L7p:XpathExpression xpathExpressionValue="included">

                                                                    <L7p:Expression stringValue="//s:Detail/s:Text/text()"/>

                                                                    <L7p:Namespaces mapValue="included">
                                                                        <L7p:entry>

                                                                            <L7p:key stringValue="s"/>

                                                                            <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                        </L7p:entry>
                                                                        <L7p:entry>

                                                                            <L7p:key stringValue="l7"/>

                                                                            <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                        </L7p:entry>
                                                                    </L7p:Namespaces>
                                                                </L7p:XpathExpression>
                                                            </L7p:ResponseXpathAssertion>
                                                        </wsp:All>
                                                        <L7p:TrueAssertion/>
                                                    </wsp:OneOrMore>
                                                    <L7p:AuditDetailAssertion>
                                                        <L7p:Detail stringValue="Fault Reason: ${reason.result}Fault Detail: ${detail.result}"/>
                                                        <L7p:LoggingOnly booleanValue="true"/>
                                                    </L7p:AuditDetailAssertion>
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:SetVariable>

                                                            <L7p:Base64Expression stringValue="NTAw"/>

                                                            <L7p:VariableToSet stringValue="errorCode"/>
                                                        </L7p:SetVariable>
                                                        <L7p:SetVariable>

                                                            <L7p:Base64Expression stringValue="RXJyb3IgcHVibGlzaGluZyBzZXJ2aWNlLSR7c2VydmljZU5hbWV9DQoke3JlYXNvbi5yZXN1bHR9DQoke2RldGFpbC5yZXN1bHR9"/>

                                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                                        </L7p:SetVariable>
                                                    </wsp:All>
                                                    <L7p:FalseAssertion/>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// error check"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:All>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//perform checks"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:OneOrMore>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="MjAw"/>
                                                <L7p:VariableToSet stringValue="pman.resp.status"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="c3VjY2Vzcw=="/>
                                                <L7p:VariableToSet stringValue="pman.resp.detail"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//publish service"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//publish service"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <L7p:TrueAssertion/>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//PUT, Create API"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="PUT"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${pman.resId}"/>
                                    <L7p:Expression2 stringValue=""/>
                                    <L7p:Negate booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item binary="included">
                                            <L7p:Negated booleanValue="true"/>
                                            <L7p:Operator operator="EMPTY"/>
                                            <L7p:RightValue stringValue=""/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="LzEvYXBpcy8ke3BtYW4ucmVzSWR9"/>
                                        <L7p:VariableToSet stringValue="pman.resUri"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="R0VU"/>
                                        <L7p:VariableToSet stringValue="pman.operation"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="MA=="/>
                                        <L7p:VariableToSet stringValue="api.result.count"/>
                                    </L7p:SetVariable>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//skip if there is already an error"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${errorCode}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ManagePortalResource/>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                                    <L7p:Expression2 stringValue="200"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item binary="included">

                                                            <L7p:RightValue stringValue="200"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="//to used for xsl transform parameter and building wsmanFilter"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>

                                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="pmanResponse"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="serviceOID"/>
                                                    <L7p:XmlMsgSrc stringValue="pmanResponse"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:Apis/l7:Api/l7:ServiceOID/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="QGlkPSR7c2VydmljZU9JRC5lbGVtZW50fQ=="/>
                                                    <L7p:VariableToSet stringValue="wsmanFilter"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="PGVudjpFbnZlbG9wZSB4bWxuczplbnY9Imh0dHA6Ly93d3cudzMub3JnLzIwMDMvMDUvc29hcC1lbnZlbG9wZSINCiAgICB4bWxuczp3c2E9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZyINCiAgICB4bWxuczp3c2U9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvZXZlbnRpbmciDQogICAgeG1sbnM6d3Nlbj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS9lbnVtZXJhdGlvbiINCiAgICB4bWxuczp3c21hbj0iaHR0cDovL3NjaGVtYXMuZG10Zi5vcmcvd2JlbS93c21hbi8xL3dzbWFuLnhzZCINCiAgICB4bWxuczp3eGY9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDkvdHJhbnNmZXIiDQogICAgeG1sbnM6bDc9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTAvMDQvZ2F0ZXdheS1tYW5hZ2VtZW50IiB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiPg0KICAgIDxlbnY6SGVhZGVyPg0KICAgICAgICA8d3NhOkFjdGlvbiBlbnY6bXVzdFVuZGVyc3RhbmQ9InRydWUiPmh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDkvZW51bWVyYXRpb24vRW51bWVyYXRlPC93c2E6QWN0aW9uPg0KICAgICAgICA8d3NhOlJlcGx5VG8+DQogICAgICAgICAgICA8d3NhOkFkZHJlc3MgZW52Om11c3RVbmRlcnN0YW5kPSJ0cnVlIj5odHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA0LzA4L2FkZHJlc3Npbmcvcm9sZS9hbm9ueW1vdXM8L3dzYTpBZGRyZXNzPg0KICAgICAgICA8L3dzYTpSZXBseVRvPg0KICAgICAgICA8d3NhOk1lc3NhZ2VJRCBlbnY6bXVzdFVuZGVyc3RhbmQ9InRydWUiPndzbS1nZXQtaWQtJHtyZXF1ZXN0SWR9PC93c2E6TWVzc2FnZUlEPg0KICAgICAgICA8d3NhOlRvIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0My93c21hbjwvd3NhOlRvPg0KICAgICAgICA8d3NtYW46UmVzb3VyY2VVUkk+aHR0cDovL25zLmw3dGVjaC5jb20vMjAxMC8wNC9nYXRld2F5LW1hbmFnZW1lbnQvc2VydmljZXM8L3dzbWFuOlJlc291cmNlVVJJPg0KICAgICAgICA8d3NtYW46UmVxdWVzdFRvdGFsSXRlbXNDb3VudEVzdGltYXRlLz4NCiAgICA8L2VudjpIZWFkZXI+DQogICAgPGVudjpCb2R5Pg0KICAgICAgICA8d3NlbjpFbnVtZXJhdGU+DQogICAgICAgICAgICA8d3NtYW46T3B0aW1pemVFbnVtZXJhdGlvbi8+DQogICAgICAgICAgICA8d3NtYW46TWF4RWxlbWVudHM+MTAwMDAwPC93c21hbjpNYXhFbGVtZW50cz4NCiAgICAgICAgICAgIDx3c21hbjpGaWx0ZXI+Ly9sNzpTZXJ2aWNlWyR7d3NtYW5GaWx0ZXJ9XTwvd3NtYW46RmlsdGVyPg0KICAgICAgICA8L3dzZW46RW51bWVyYXRlPg0KICAgIDwvZW52OkJvZHk+DQo8L2VudjpFbnZlbG9wZT4="/>
                                                    <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="request"/>
                                                </L7p:SetVariable>
                                                <L7p:GatewayManagement>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="//look for specific serviceId(s) only"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>
                                                    <L7p:VariablePrefix stringValue="wsman"/>
                                                </L7p:GatewayManagement>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                                    <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="wsman.request"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="service.policy"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:Resources/l7:ResourceSet/l7:Resource/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="service.urlPattern"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:ServiceMappings/l7:HttpMapping/l7:UrlPattern/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtzZXJ2aWNlLnVybFBhdHRlcm4uZWxlbWVudH0="/>
                                                    <L7p:VariableToSet stringValue="param.uri.regex.element"/>
                                                </L7p:SetVariable>
                                                <L7p:Regex>
                                                    <L7p:AutoTarget booleanValue="false"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="param.uri.regex.element"/>
                                                    <L7p:Regex stringValue="/\*"/>
                                                    <L7p:RegexName stringValue="remove trailing /* if any"/>
                                                    <L7p:Replace booleanValue="true"/>
                                                    <L7p:Replacement stringValue=""/>
                                                    <L7p:Target target="OTHER"/>
                                                </L7p:Regex>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtzZXJ2aWNlLnBvbGljeS5lbGVtZW50fQ=="/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="service.policy"/>
                                                </L7p:SetVariable>
                                                <wsp:OneOrMore wsp:Usage="Required">
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:ResponseXpathAssertion>

                                                            <L7p:VariablePrefix stringValue="httpRouting"/>

                                                            <L7p:XmlMsgSrc stringValue="service.policy"/>

                                                            <L7p:XpathExpression xpathExpressionValue="included">

                                                                <L7p:Expression stringValue="/wsp:Policy/wsp:All/L7p:HttpRoutingAssertion/L7p:ProtectedServiceUrl/@stringValue"/>

                                                                <L7p:Namespaces mapValue="included">
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsp"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2002/12/policy"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="s"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="L7p"/>

                                                                        <L7p:value stringValue="http://www.layer7tech.com/ws/policy"/>
                                                                    </L7p:entry>
                                                                </L7p:Namespaces>
                                                            </L7p:XpathExpression>
                                                        </L7p:ResponseXpathAssertion>
                                                    </wsp:All>
                                                    <L7p:TrueAssertion/>
                                                </wsp:OneOrMore>
                                                <L7p:XslTransformation>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="//update API"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>
                                                    <L7p:Direction intValue="-1"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="wsman.request"/>
                                                    <L7p:ResourceInfo staticResourceInfo="included">
                                                        <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:L7p="http://www.layer7tech.com/ws/policy"
xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"
xmlns:env="http://www.w3.org/2003/05/soap-envelope"
xmlns:wsen="http://schemas.xmlsoap.org/ws/2004/09/enumeration"
xmlns:wsman="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"
xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management"
exclude-result-prefixes="l7 L7p wsman env wsen"
>
<xsl:param name="requireSSL" select="'false'"/>
<xsl:param name="portalManaged" select="'true'"/>
<xsl:param name="requireAPIKey" select="'true'"/>
<xsl:param name="requireOAuth1" select="'false'"/>
<xsl:param name="requireOAuth2" select="'false'"/>
<xsl:param name="apiGroup" select="''"/>
<xsl:param name="gateway.portal.api.plans.fragment.guid" select="'ce8159a9-d70d-4a5c-a8a9-d2f4d643c5ab'"/>
<xsl:param name="gateway.portal.account.plans.fragment.guid" select="'4448d875-f74b-4eed-8c49-ec0ff95c1b0f'"/>
<xsl:param name="gateway.portal.oauth1.fragment.guid" select="'f243464d-964b-487b-bbaa-2e6f853efb79'"/>
<xsl:param name="gateway.portal.oauth2.fragment.guid" select="'0e112050-5ba5-4c08-a6ee-22c39f0762c1'"/>
<xsl:param name="sqlServerExploits" select="'false'"/>
<xsl:param name="oracleExploits" select="'false'"/>
<xsl:param name="standardSQLInjection" select="'false'"/>
<xsl:param name="invasiveSQLInjection" select="'false'"/>
<xsl:param name="requestProtectionUrl" select="'true'"/>
<xsl:param name="requestProtectionBody" select="'true'"/>
<xsl:param name="crossSiteInjectionProtection" select="'false'"/>
<xsl:param name="phpEvalInjectionProtection" select="'false'"/>
<xsl:param name="shellInjectionProtection" select="'false'"/>
<xsl:param name="ldapDNInjectionProtection" select="'false'"/>
<xsl:param name="ldapSearchInjectionProtection" select="'false'"/>
<xsl:param name="xpathInjectionProtection" select="'false'"/>
<xsl:param name="requestId" select="'now'"/>
<xsl:param name="gateway.cluster.hostname" select="'localhost'"/>
<xsl:param name="serviceName" select="'ServiceName'"/>
<xsl:param name="serviceEnabled" select="'true'"/>
<xsl:param name="urlPattern" select="'serviceListener'"/>
<xsl:param name="routingUrl" select="'http://localhost:8080'"/>
<xsl:param name="gateway.time" select="'now'"/>
<xsl:param name="pman.resId" select="'default-id'"/>
<xsl:param name="param.uri.regex.element" select="''"/>
<xsl:param name="httpRouting.element" select="''"/>
<xsl:output encoding="UTF-8" indent="yes" method="xml" omit-xml-declaration="yes" version="1.0"/>
<xsl:template match="/">
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:wsa="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:wsman="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd" xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management">
   <s:Header>
      <wsa:Action s:mustUnderstand="true">http://schemas.xmlsoap.org/ws/2004/09/transfer/Put</wsa:Action>
      <wsa:To s:mustUnderstand="true">https://<xsl:value-of select="$gateway.cluster.hostname"/>:8443/wsman</wsa:To>
      <wsman:ResourceURI s:mustUnderstand="true">http://ns.l7tech.com/2010/04/gateway-management/services</wsman:ResourceURI>
      <wsa:MessageID s:mustUnderstand="true">requestId:<xsl:value-of select="$requestId"/></wsa:MessageID>
      <wsa:ReplyTo>
         <wsa:Address>http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous</wsa:Address>
      </wsa:ReplyTo>
      <wsman:SelectorSet>
         <wsman:Selector Name="id"><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/@id"/></wsman:Selector>
      </wsman:SelectorSet>
   </s:Header>
   <s:Body>   
   <xsl:variable name="folderId" select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/@folderId" />	
   <xsl:variable name="version" select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/@version" />	
   <xsl:variable name="policy_version" select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:Resources/l7:ResourceSet/l7:Resource/@version" />	
   <xsl:variable name="new_version" select="$version" />
   <xsl:variable name="new_policy_version" select="$policy_version" />
   <xsl:variable name="original_policy" select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:Resources/l7:ResourceSet/l7:Resource"/>
   <xsl:element name="l7:Service">   			
		 <xsl:attribute name="id"><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/@id"/></xsl:attribute>
		 <xsl:attribute name="version"><xsl:value-of select="$new_version"/></xsl:attribute>
		 <xsl:element name="l7:ServiceDetail">
         	<xsl:attribute name="folderId"><xsl:value-of select="$folderId"/></xsl:attribute>
		 	<xsl:attribute name="id"><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/@id"/></xsl:attribute>
			<xsl:attribute name="version"><xsl:value-of select="$new_version"/></xsl:attribute>
         <l7:Name><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:Name"/></l7:Name>
         <l7:Enabled><xsl:value-of select="$serviceEnabled"/></l7:Enabled>
		 <l7:ServiceMappings>
		 <l7:HttpMapping>
	          <l7:UrlPattern><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:ServiceMappings/l7:HttpMapping/l7:UrlPattern"/></l7:UrlPattern>
			  <l7:Verbs>
			  <xsl:for-each select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:ServiceMappings/l7:HttpMapping/l7:Verbs/l7:Verb/text()"><l7:Verb><xsl:value-of select="."/></l7:Verb></xsl:for-each>
			  </l7:Verbs>
		   </l7:HttpMapping>
		 </l7:ServiceMappings>
		 <l7:Properties>
               <l7:Property key="policyRevision">
                  <l7:LongValue><xsl:value-of select="$new_policy_version"/></l7:LongValue>
               </l7:Property>
               <l7:Property key="wssProcessingEnabled">
                  <l7:BooleanValue><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:Properties/l7:Property[@key='soap']/l7:BooleanValue"/></l7:BooleanValue>
               </l7:Property>
               <l7:Property key="soap">
                  <l7:BooleanValue><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:Properties/l7:Property[@key='internal']/l7:BooleanValue"/></l7:BooleanValue>
               </l7:Property>
               <l7:Property key="internal">
                  <l7:BooleanValue><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:Properties/l7:Property[@key='wssProcessingEnabled']/l7:BooleanValue"/></l7:BooleanValue>
               </l7:Property>
            </l7:Properties>
		 </xsl:element>
         <l7:Resources>
            <l7:ResourceSet tag="policy">
			   <xsl:element name="l7:Resource">
			   <xsl:attribute name="type">policy</xsl:attribute>
			   <xsl:attribute name="version"><xsl:value-of select="$new_policy_version"/></xsl:attribute>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
&lt;wsp:All wsp:Usage="Required"&gt;		    
    &lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="============================="/&gt;
    &lt;/L7p:CommentAssertion&gt;
    &lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="======= Published thru API Portal ======="/&gt;
    &lt;/L7p:CommentAssertion&gt;
    &lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="======= Don't modify block starts ======="/&gt;
    &lt;/L7p:CommentAssertion&gt;
    &lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="============================="/&gt;
    &lt;/L7p:CommentAssertion&gt;

	&lt;L7p:ApiPortalIntegration&gt;
			<xsl:if test="$portalManaged = 'false'">
			&lt;L7p:Enabled booleanValue="false"/&gt;
			</xsl:if>
			&lt;L7p:ApiGroup stringValue="<xsl:value-of select="$apiGroup"/>"/&gt;
			&lt;L7p:ApiId stringValue="<xsl:value-of select="$pman.resId"/>"/&gt;
            &lt;L7p:PortalManagedApiFlag stringValue="L7p:ApiPortalManagedServiceAssertion"/&gt;
        &lt;/L7p:ApiPortalIntegration&gt;
    
	&lt;wsp:All wsp:Usage="Required"&gt;
		
		&lt;!-- requireSSL --&gt;		
		&lt;L7p:SslAssertion&gt;            
			&lt;L7p:Enabled booleanValue="<xsl:choose><xsl:when test="$requireSSL = 'true'">True</xsl:when><xsl:otherwise>False</xsl:otherwise></xsl:choose>"/&gt;
        &lt;/L7p:SslAssertion&gt;
		&lt;!-- requireSSL --&gt;

		<xsl:if test="$gateway.portal.oauth1.fragment.guid != 'not installed'">
		&lt;!-- requireOAuth1x --&gt;
		&lt;L7p:Include&gt;
            &lt;L7p:Enabled booleanValue="<xsl:value-of select="$requireOAuth1"/>"/&gt;
			&lt;L7p:PolicyGuid stringValue="<xsl:value-of select="$gateway.portal.oauth1.fragment.guid"/>"/&gt;
        &lt;/L7p:Include&gt;
		&lt;!-- requireOAuth1x --&gt;
		</xsl:if>

		<xsl:if test="$gateway.portal.oauth2.fragment.guid != 'not installed'">
		&lt;!-- requireOAuth20 --&gt;
		&lt;L7p:Include&gt;
            &lt;L7p:Enabled booleanValue="<xsl:choose><xsl:when test="$requireOAuth1 = 'true'">False</xsl:when><xsl:otherwise><xsl:value-of select="$requireOAuth2"/></xsl:otherwise></xsl:choose>"/&gt;
			&lt;L7p:PolicyGuid stringValue="<xsl:value-of select="$gateway.portal.oauth2.fragment.guid"/>"/&gt;
        &lt;/L7p:Include&gt;
		&lt;!-- requireOAuth20 --&gt;
		</xsl:if>        

		&lt;!-- start of wsl:All for API Portal Integration section --&gt;
		&lt;wsp:All L7p:Enabled="<xsl:value-of select="$requireAPIKey"/>" wsp:Usage="Required"&gt;
            &lt;L7p:SetVariable&gt;
                &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// capture the API resource requested"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="getRequestedApiResource()"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:AssertionComment&gt;
                &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAudXJpfQ=="/&gt;
                &lt;L7p:VariableToSet stringValue="apiResource"/&gt;
            &lt;/L7p:SetVariable&gt;
            &lt;L7p:SetVariable&gt;
                &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// parse API key from request"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="getRequestApiKey()"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:AssertionComment&gt;
                &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX0="/&gt;
                &lt;L7p:VariableToSet stringValue="lookupApiKey"/&gt;
            &lt;/L7p:SetVariable&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;L7p:ComparisonAssertion&gt;
                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                &lt;L7p:Expression1 stringValue="&#36;{lookupApiKey}"/&gt;
                &lt;L7p:Operator operatorNull="null"/&gt;
                &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item stringLength="included"&gt;
                        &lt;L7p:Max intValue="-1"/&gt;
                        &lt;L7p:Min intValue="1"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Predicates&gt;
            &lt;/L7p:ComparisonAssertion&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="&#36;{session.client_id}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item stringLength="included"&gt;
                            &lt;L7p:Max intValue="-1"/&gt;
                            &lt;L7p:Min intValue="1"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="// parse API key from request"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="getRequestApiKey()"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzZXNzaW9uLmNsaWVudF9pZH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupApiKey"/&gt;
                &lt;/L7p:SetVariable&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="&#36;{oauth_consumer_key}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item stringLength="included"&gt;
                            &lt;L7p:Max intValue="-1"/&gt;
                            &lt;L7p:Min intValue="1"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="// parse API key from request"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="getRequestApiKey()"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue="JHtvYXV0aF9jb25zdW1lcl9rZXl9"/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupApiKey"/&gt;
                &lt;/L7p:SetVariable&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:TrueAssertion/&gt;
        &lt;/wsp:OneOrMore&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:LookupApiKey&gt;
                    &lt;L7p:ApiKey stringValue="&#36;{lookupApiKey}"/&gt;
                    &lt;L7p:ServiceId stringValue="&#36;{portal.managed.service.apiId}"/&gt;
                &lt;/L7p:LookupApiKey&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="&#36;{apiKeyRecord.found}"/&gt;
                            &lt;L7p:Operator operatorNull="null"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item dataType="included"&gt;
                                    &lt;L7p:Type variableDataType="string"/&gt;
                                &lt;/L7p:item&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="true"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                            &lt;L7p:ComparisonAssertion&gt;
                                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                &lt;L7p:Expression1 stringValue="&#36;{apiKeyRecord.service}"/&gt;
                                &lt;L7p:Operator operatorNull="null"/&gt;
                                &lt;L7p:Predicates predicates="included"&gt;
                                    &lt;L7p:item dataType="included"&gt;
                                    &lt;L7p:Type variableDataType="string"/&gt;
                                    &lt;/L7p:item&gt;
                                    &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="&#36;{portal.managed.service.apiId}"/&gt;
                                    &lt;/L7p:item&gt;
                                &lt;/L7p:Predicates&gt;
                            &lt;/L7p:ComparisonAssertion&gt;
                            &lt;L7p:ComparisonAssertion&gt;
                                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                &lt;L7p:Expression1 stringValue="&#36;{apiKeyRecord.service}"/&gt;
                                &lt;L7p:Operator operatorNull="null"/&gt;
                                &lt;L7p:Predicates predicates="included"&gt;
                                    &lt;L7p:item dataType="included"&gt;
                                    &lt;L7p:Type variableDataType="string"/&gt;
                                    &lt;/L7p:item&gt;
                                    &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="&#36;{service.oid}"/&gt;
                                    &lt;/L7p:item&gt;
                                &lt;/L7p:Predicates&gt;
                            &lt;/L7p:ComparisonAssertion&gt;
                        &lt;/wsp:OneOrMore&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="&#36;{apiKeyRecord.status}"/&gt;
                            &lt;L7p:Operator operatorNull="null"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item dataType="included"&gt;
                                    &lt;L7p:Type variableDataType="string"/&gt;
                                &lt;/L7p:item&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="active"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="// success - API key found"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:CustomizeErrorResponse&gt;
                            &lt;L7p:Content stringValue="Invalid API Key"/&gt;
                            &lt;L7p:HttpStatus stringValue="400"/&gt;
                        &lt;/L7p:CustomizeErrorResponse&gt;
                        &lt;L7p:FalseAssertion/&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="// error - API key not found"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Lookup API Key"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Step 1 --"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthcGlLZXlSZWNvcmQua2V5fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="apiKey"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthcGlLZXlSZWNvcmQucGxhbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="apiPlan"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:MessageContextAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="// capture API key and requested method (used by analytics)"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Mappings mappingInfoArray="included"&gt;
                        &lt;L7p:item mappingInfo="included"&gt;
                            &lt;L7p:Key stringValue="AUTH_USER"/&gt;
                            &lt;L7p:MappingType mappingType="AUTH_USER"/&gt;
                            &lt;L7p:Value stringValue="(SYSTEM DEFINED)"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item mappingInfo="included"&gt;
                            &lt;L7p:Key stringValue="API_KEY"/&gt;
                            &lt;L7p:MappingType mappingType="CUSTOM_MAPPING"/&gt;
                            &lt;L7p:Value stringValue="&#36;{apikey}"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item mappingInfo="included"&gt;
                            &lt;L7p:Key stringValue="API_METHOD"/&gt;
                            &lt;L7p:MappingType mappingType="CUSTOM_MAPPING"/&gt;
                            &lt;L7p:Value stringValue="&#36;{apiResource}"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Mappings&gt;
                &lt;/L7p:MessageContextAssertion&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// Capture API key and API method for metrics"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Step 2 --"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            <!-- Account Plans -->
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:Include&gt;
					&lt;!-- Account Plans Policy Fragment --&gt;
					&lt;L7p:PolicyGuid stringValue="<xsl:value-of select="$gateway.portal.account.plans.fragment.guid"/>"/&gt;
                &lt;/L7p:Include&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                        &lt;L7p:CaseSensitive booleanValue="false"/&gt;

                        &lt;L7p:Expression1 stringValue="&#36;{apiAuthz}"/&gt;
                        &lt;L7p:Operator operatorNull="null"/&gt;
                        &lt;L7p:Predicates predicates="included"&gt;
                            &lt;L7p:item dataType="included"&gt;
                                &lt;L7p:Type variableDataType="string"/&gt;
                            &lt;/L7p:item&gt;
                            &lt;L7p:item binary="included"&gt;
                                &lt;L7p:RightValue stringValue="true"/&gt;
                            &lt;/L7p:item&gt;
                        &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[Account plan limit exceeded

Reason: &#36;{apiAuthzDetails}]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:FalseAssertion/&gt;
    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// Enforce Account Plan restriction"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Step 3 --"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
			<!-- Account Plans -->
			<!-- API Plans -->
			&lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:Include&gt;
					&lt;!-- API Plans Policy Fragment --&gt;
					&lt;L7p:PolicyGuid stringValue="<xsl:value-of select="$gateway.portal.api.plans.fragment.guid"/>"/&gt;
                &lt;/L7p:Include&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                        &lt;L7p:CaseSensitive booleanValue="false"/&gt;

                        &lt;L7p:Expression1 stringValue="&#36;{apiAuthz}"/&gt;
                        &lt;L7p:Operator operatorNull="null"/&gt;
                        &lt;L7p:Predicates predicates="included"&gt;
                            &lt;L7p:item dataType="included"&gt;
                                &lt;L7p:Type variableDataType="string"/&gt;
                            &lt;/L7p:item&gt;
                            &lt;L7p:item binary="included"&gt;
                                &lt;L7p:RightValue stringValue="true"/&gt;
                            &lt;/L7p:item&gt;
                        &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[API plan limit exceeded

Reason: &#36;{apiAuthzDetails}]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:FalseAssertion/&gt;
    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="// Enforce API Plan restriction"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Step 4 --"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
			<!-- API Plans -->
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="// API Portal Integration section"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:All&gt;
		&lt;!-- end of wsl:All for APi Portal Integration section --&gt;

		&lt;!-- SQL Protection --&gt;
		&lt;L7p:SqlAttackProtection&gt;
			<xsl:if test="$sqlServerExploits != 'true' and $oracleExploits != 'true' and $standardSQLInjection != 'true' and $invasiveSQLInjection != 'true'">
            &lt;L7p:Enabled booleanValue="false"/&gt;            
			</xsl:if>
			&lt;L7p:Protections stringSetValue="included"&gt;
				<xsl:if test="$sqlServerExploits = 'true'">
				&lt;L7p:item stringValue="MsSql"/&gt;
				</xsl:if>
				<xsl:if test="$oracleExploits = 'true'">
                &lt;L7p:item stringValue="OraSql"/&gt;
				</xsl:if>
				<xsl:if test="$standardSQLInjection = 'true'">
                &lt;L7p:item stringValue="SqlMetaText"/&gt;
				</xsl:if>
				<xsl:if test="$invasiveSQLInjection = 'true'">
                &lt;L7p:item stringValue="SqlMeta"/&gt;
				</xsl:if>
			&lt;/L7p:Protections&gt;
        &lt;/L7p:SqlAttackProtection&gt;
		&lt;!-- SQL Protection --&gt;

		&lt;!-- Code Injection Protection --&gt;
		&lt;L7p:CodeInjectionProtectionAssertion&gt;
			<xsl:if test="$requestProtectionUrl != 'true' and $requestProtectionBody != 'true'">
				&lt;L7p:Enabled booleanValue="false"/&gt;
			</xsl:if>
			<xsl:if test="$crossSiteInjectionProtection != 'true' and $phpEvalInjectionProtection != 'true' and $shellInjectionProtection != 'true' and $ldapDNInjectionProtection != 'true' and $ldapSearchInjectionProtection != 'true' and $xpathInjectionProtection != 'true'">
				&lt;L7p:Enabled booleanValue="false"/&gt;
			</xsl:if>
			<xsl:if test="$requestProtectionBody = 'true'">
			&lt;L7p:IncludeRequestBody booleanValue="true"/&gt;
			</xsl:if>
			<xsl:if test="$requestProtectionUrl = 'true'">
			&lt;L7p:IncludeRequestUrl booleanValue="true"/&gt;
			</xsl:if>
			&lt;L7p:Protections codeInjectionProtectionTypeArray="included"&gt;
				<xsl:if test="$crossSiteInjectionProtection = 'true'">
				&lt;L7p:item protectionType="htmlJavaScriptInjection"/&gt;
				</xsl:if>
				<xsl:if test="$phpEvalInjectionProtection = 'true'">
				&lt;L7p:item protectionType="phpEvalInjection"/&gt;
				</xsl:if>
				<xsl:if test="$shellInjectionProtection = 'true'">
				&lt;L7p:item protectionType="shellInjection"/&gt;
				</xsl:if>
				<xsl:if test="$ldapDNInjectionProtection = 'true'">
				&lt;L7p:item protectionType="ldapDnInjection"/&gt;
				</xsl:if>
				<xsl:if test="$ldapSearchInjectionProtection = 'true'">
				&lt;L7p:item protectionType="ldapSearchInjection"/&gt;
				</xsl:if>
				<xsl:if test="$xpathInjectionProtection = 'true'">
				&lt;L7p:item protectionType="xpathInjection"/&gt;
				</xsl:if>
			&lt;/L7p:Protections&gt;
		&lt;/L7p:CodeInjectionProtectionAssertion&gt;
		&lt;!-- Code Injection Protection --&gt;

		&lt;L7p:assertionComment&gt;
          &lt;L7p:Properties mapValue="included"&gt;
            &lt;L7p:entry&gt;
              &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
              &lt;L7p:value stringValue="//auto generated policy"/&gt;
            &lt;/L7p:entry&gt;
          &lt;/L7p:Properties&gt;
        &lt;/L7p:assertionComment&gt;
    &lt;/wsp:All&gt;

        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="======= Don't modify block ends ======="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================="/&gt;
        &lt;/L7p:CommentAssertion&gt;

		&lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAudXJpfQ=="/&gt;
            &lt;L7p:VariableToSet stringValue="param.uri"/&gt;
        &lt;/L7p:SetVariable&gt;
		&lt;L7p:Regex&gt;
            &lt;L7p:AutoTarget booleanValue="false"/&gt;
            &lt;L7p:OtherTargetMessageVariable stringValue="param.uri"/&gt;
            &lt;L7p:Regex stringValue="<xsl:value-of select="$param.uri.regex.element"/>"/&gt;
            &lt;L7p:RegexName stringValue="process uri"/&gt;
            &lt;L7p:Replace booleanValue="true"/&gt;
            &lt;L7p:Replacement stringValue=""/&gt;
            &lt;L7p:Target target="OTHER"/&gt;
        &lt;/L7p:Regex&gt;

	&lt;L7p:HttpRoutingAssertion&gt;
		&lt;L7p:AssertionComment assertionComment="included"&gt;
			&lt;L7p:Properties mapValue="included"&gt;
				&lt;L7p:entry&gt;
					&lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
					&lt;L7p:value stringValue="Your API URL"/&gt;
				&lt;/L7p:entry&gt;
			&lt;/L7p:Properties&gt;
		&lt;/L7p:AssertionComment&gt;
		&lt;L7p:ProtectedServiceUrl stringValue="<xsl:value-of select="$httpRouting.element"/>"/&gt;
	&lt;/L7p:HttpRoutingAssertion&gt;	
	&lt;L7p:CommentAssertion&gt;
        &lt;L7p:Comment stringValue="Updated on <xsl:value-of select="$gateway.time"/>"/&gt;
    &lt;/L7p:CommentAssertion&gt;
&lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;</xsl:element>
			</l7:ResourceSet>
   		 </l7:Resources>
  </xsl:element>
    </s:Body>
</s:Envelope>
</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                    </L7p:ResourceInfo>
                                                    <L7p:Target target="OTHER"/>
                                                    <L7p:TransformName stringValue=""/>
                                                </L7p:XslTransformation>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHt3c21hbi5yZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
                                                    <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="request"/>
                                                </L7p:SetVariable>
                                                <L7p:GatewayManagement>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="//update service"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>
                                                    <L7p:VariablePrefix stringValue="wsman"/>
                                                </L7p:GatewayManagement>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="RESP_createOp"/>
                                                </L7p:SetVariable>
                                                <wsp:OneOrMore wsp:Usage="Required">
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:ResponseXpathAssertion>

                                                            <L7p:VariablePrefix stringValue="serviceId"/>

                                                            <L7p:XmlMsgSrc stringValue="RESP_createOp"/>

                                                            <L7p:XpathExpression xpathExpressionValue="included">

                                                                <L7p:Expression stringValue="/env:Envelope/env:Body/l7:Service"/>

                                                                <L7p:Namespaces mapValue="included">
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsa"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="mdo"/>

                                                                        <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="s"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="l7"/>

                                                                        <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wxf"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="xs"/>

                                                                        <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="env"/>

                                                                        <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsen"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsman"/>

                                                                        <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="mex"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wse"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsmeta"/>

                                                                        <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                    </L7p:entry>
                                                                </L7p:Namespaces>
                                                            </L7p:XpathExpression>
                                                        </L7p:ResponseXpathAssertion>
                                                        <L7p:assertionComment>

                                                            <L7p:Properties mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                    <L7p:value stringValue="// success"/>
                                                                </L7p:entry>
                                                            </L7p:Properties>
                                                        </L7p:assertionComment>
                                                    </wsp:All>
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:ResponseXpathAssertion>

                                                            <L7p:VariablePrefix stringValue="fault"/>

                                                            <L7p:XmlMsgSrc stringValue="RESP_createOp"/>

                                                            <L7p:XpathExpression xpathExpressionValue="included">

                                                                <L7p:Expression stringValue="/env:Envelope/env:Body/env:Fault"/>

                                                                <L7p:Namespaces mapValue="included">
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsa"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="mdo"/>

                                                                        <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="s"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="l7"/>

                                                                        <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wxf"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="xs"/>

                                                                        <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="env"/>

                                                                        <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsen"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsman"/>

                                                                        <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="mex"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wse"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsmeta"/>

                                                                        <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                    </L7p:entry>
                                                                </L7p:Namespaces>
                                                            </L7p:XpathExpression>
                                                        </L7p:ResponseXpathAssertion>
                                                        <L7p:SetVariable>

                                                            <L7p:Base64Expression stringValue="JHtmYXVsdC5lbGVtZW50fQ=="/>

                                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>

                                                            <L7p:DataType variableDataType="message"/>

                                                            <L7p:VariableToSet stringValue="RESP_fault"/>
                                                        </L7p:SetVariable>
                                                        <wsp:OneOrMore wsp:Usage="Required">
                                                            <wsp:All wsp:Usage="Required">
                                                                <L7p:ResponseXpathAssertion>

                                                                    <L7p:VariablePrefix stringValue="reason"/>

                                                                    <L7p:XmlMsgSrc stringValue="RESP_fault"/>

                                                                    <L7p:XpathExpression xpathExpressionValue="included">

                                                                        <L7p:Expression stringValue="//s:Reason/s:Text/text()"/>

                                                                        <L7p:Namespaces mapValue="included">
                                                                            <L7p:entry>

                                                                                <L7p:key stringValue="s"/>

                                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                            </L7p:entry>
                                                                            <L7p:entry>

                                                                                <L7p:key stringValue="l7"/>

                                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                            </L7p:entry>
                                                                        </L7p:Namespaces>
                                                                    </L7p:XpathExpression>
                                                                </L7p:ResponseXpathAssertion>
                                                                <L7p:ResponseXpathAssertion>

                                                                    <L7p:VariablePrefix stringValue="detail"/>

                                                                    <L7p:XmlMsgSrc stringValue="RESP_fault"/>

                                                                    <L7p:XpathExpression xpathExpressionValue="included">

                                                                        <L7p:Expression stringValue="//s:Detail/s:Text/text()"/>

                                                                        <L7p:Namespaces mapValue="included">
                                                                            <L7p:entry>

                                                                                <L7p:key stringValue="s"/>

                                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                            </L7p:entry>
                                                                            <L7p:entry>

                                                                                <L7p:key stringValue="l7"/>

                                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                            </L7p:entry>
                                                                        </L7p:Namespaces>
                                                                    </L7p:XpathExpression>
                                                                </L7p:ResponseXpathAssertion>
                                                            </wsp:All>
                                                            <L7p:TrueAssertion/>
                                                        </wsp:OneOrMore>
                                                        <L7p:AuditDetailAssertion>
                                                            <L7p:Detail stringValue="Fault Reason: ${reason.result}Fault Detail: ${detail.result}"/>

                                                            <L7p:LoggingOnly booleanValue="true"/>
                                                        </L7p:AuditDetailAssertion>
                                                        <wsp:All wsp:Usage="Required">
                                                            <L7p:SetVariable>

                                                                <L7p:Base64Expression stringValue="NTAw"/>

                                                                <L7p:VariableToSet stringValue="errorCode"/>
                                                            </L7p:SetVariable>
                                                            <L7p:SetVariable>

                                                                <L7p:Base64Expression stringValue="RXJyb3IgdXBkYXRlIGFwaS0ke3BtYW4ucmVzSWR9DQoke3JlYXNvbi5yZXN1bHR9DQoke2RldGFpbC5yZXN1bHR9"/>

                                                                <L7p:VariableToSet stringValue="errorMsg"/>
                                                            </L7p:SetVariable>
                                                        </wsp:All>
                                                        <L7p:FalseAssertion/>
                                                        <L7p:assertionComment>

                                                            <L7p:Properties mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                    <L7p:value stringValue="// error check"/>
                                                                </L7p:entry>
                                                            </L7p:Properties>
                                                        </L7p:assertionComment>
                                                    </wsp:All>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="//perform checks"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:OneOrMore>
                                            </wsp:All>
                                            <L7p:TrueAssertion/>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//only proceed if its 200"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                    </wsp:All>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//restore original operation as it was overwritten"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Base64Expression stringValue="UFVU"/>
                                    <L7p:VariableToSet stringValue="pman.operation"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//PUT, Update API (single res &amp; existing)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="DELETE"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${pman.resId}"/>
                                    <L7p:Expression2 stringValue=""/>
                                    <L7p:Negate booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item binary="included">
                                            <L7p:Negated booleanValue="true"/>
                                            <L7p:Operator operator="EMPTY"/>
                                            <L7p:RightValue stringValue=""/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="LzEvYXBpcy8ke3BtYW4ucmVzSWR9"/>
                                        <L7p:VariableToSet stringValue="pman.resUri"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="R0VU"/>
                                        <L7p:VariableToSet stringValue="pman.operation"/>
                                    </L7p:SetVariable>
                                    <L7p:ManagePortalResource/>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                                <L7p:Expression2 stringValue="200"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="200"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:SetVariable>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//to used for xsl transform parameter and building wsmanFilter"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="pmanResponse"/>
                                            </L7p:SetVariable>
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue="serviceOID"/>
                                                <L7p:XmlMsgSrc stringValue="pmanResponse"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="/l7:Apis/l7:Api/l7:ServiceOID/text()"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="QGlkPSR7c2VydmljZU9JRC5lbGVtZW50fQ=="/>
                                                <L7p:VariableToSet stringValue="wsmanFilter"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="PGVudjpFbnZlbG9wZSB4bWxuczplbnY9Imh0dHA6Ly93d3cudzMub3JnLzIwMDMvMDUvc29hcC1lbnZlbG9wZSINCiAgICB4bWxuczp3c2E9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZyINCiAgICB4bWxuczp3c2U9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvZXZlbnRpbmciDQogICAgeG1sbnM6d3Nlbj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS9lbnVtZXJhdGlvbiINCiAgICB4bWxuczp3c21hbj0iaHR0cDovL3NjaGVtYXMuZG10Zi5vcmcvd2JlbS93c21hbi8xL3dzbWFuLnhzZCINCiAgICB4bWxuczp3eGY9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDkvdHJhbnNmZXIiDQogICAgeG1sbnM6bDc9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTAvMDQvZ2F0ZXdheS1tYW5hZ2VtZW50IiB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiPg0KICAgIDxlbnY6SGVhZGVyPg0KICAgICAgICA8d3NhOkFjdGlvbiBlbnY6bXVzdFVuZGVyc3RhbmQ9InRydWUiPmh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDkvZW51bWVyYXRpb24vRW51bWVyYXRlPC93c2E6QWN0aW9uPg0KICAgICAgICA8d3NhOlJlcGx5VG8+DQogICAgICAgICAgICA8d3NhOkFkZHJlc3MgZW52Om11c3RVbmRlcnN0YW5kPSJ0cnVlIj5odHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA0LzA4L2FkZHJlc3Npbmcvcm9sZS9hbm9ueW1vdXM8L3dzYTpBZGRyZXNzPg0KICAgICAgICA8L3dzYTpSZXBseVRvPg0KICAgICAgICA8d3NhOk1lc3NhZ2VJRCBlbnY6bXVzdFVuZGVyc3RhbmQ9InRydWUiPndzbS1nZXQtaWQtJHtyZXF1ZXN0SWR9PC93c2E6TWVzc2FnZUlEPg0KICAgICAgICA8d3NhOlRvIGVudjptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0My93c21hbjwvd3NhOlRvPg0KICAgICAgICA8d3NtYW46UmVzb3VyY2VVUkk+aHR0cDovL25zLmw3dGVjaC5jb20vMjAxMC8wNC9nYXRld2F5LW1hbmFnZW1lbnQvc2VydmljZXM8L3dzbWFuOlJlc291cmNlVVJJPg0KICAgICAgICA8d3NtYW46UmVxdWVzdFRvdGFsSXRlbXNDb3VudEVzdGltYXRlLz4NCiAgICA8L2VudjpIZWFkZXI+DQogICAgPGVudjpCb2R5Pg0KICAgICAgICA8d3NlbjpFbnVtZXJhdGU+DQogICAgICAgICAgICA8d3NtYW46T3B0aW1pemVFbnVtZXJhdGlvbi8+DQogICAgICAgICAgICA8d3NtYW46TWF4RWxlbWVudHM+MTAwMDAwPC93c21hbjpNYXhFbGVtZW50cz4NCiAgICAgICAgICAgIDx3c21hbjpGaWx0ZXI+Ly9sNzpTZXJ2aWNlWyR7d3NtYW5GaWx0ZXJ9XTwvd3NtYW46RmlsdGVyPg0KICAgICAgICA8L3dzZW46RW51bWVyYXRlPg0KICAgIDwvZW52OkJvZHk+DQo8L2VudjpFbnZlbG9wZT4="/>
                                                <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="request"/>
                                            </L7p:SetVariable>
                                            <L7p:GatewayManagement>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//look for specific serviceId(s) only"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:VariablePrefix stringValue="wsman"/>
                                            </L7p:GatewayManagement>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                                <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="wsman.request"/>
                                            </L7p:SetVariable>
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue="service.policy"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="/env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:Resources/l7:ResourceSet/l7:Resource/text()"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="wsa"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="mdo"/>
                                                            <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="xs"/>
                                                            <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="wxf"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="wsen"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="env"/>
                                                            <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="wsman"/>
                                                            <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="wsmeta"/>
                                                            <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="wse"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="mex"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                            <L7p:Regex>
                                                <L7p:AutoTarget booleanValue="false"/>

                                                <L7p:OtherTargetMessageVariable stringValue="service.policy.element"/>
                                                <L7p:Regex stringValue="&lt;L7p:ApiPortalIntegration>"/>
                                                <L7p:Replace booleanValue="true"/>
                                                <L7p:Replacement stringValue="&lt;L7p:ApiPortalIntegration>&lt;L7p:Enabled booleanValue=&quot;false&quot;/>"/>
                                                <L7p:Target target="OTHER"/>
                                            </L7p:Regex>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtzZXJ2aWNlLnBvbGljeS5lbGVtZW50fQ=="/>
                                                <L7p:VariableToSet stringValue="disabled.policy"/>
                                            </L7p:SetVariable>
                                            <L7p:XslTransformation>
                                                <L7p:Direction intValue="-1"/>

                                                <L7p:OtherTargetMessageVariable stringValue="wsman.request"/>
                                                <L7p:ResourceInfo staticResourceInfo="included">
                                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet exclude-result-prefixes="l7 L7p wsman env wsen" version="1.0" xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:env="http://www.w3.org/2003/05/soap-envelope" xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" xmlns:wsen="http://schemas.xmlsoap.org/ws/2004/09/enumeration" xmlns:wsman="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:param name="gateway.cluster.hostname" select="'localhost'"/>
<xsl:param name="gateway.time" select="'now'"/>
<xsl:param name="requestId" select="'now'"/>
<xsl:param name="gateway.portal.deleted.apis.folderId" select="'18841601'"/>
<xsl:param name="disabled.policy" select="'>xml&lt;>/xml&lt;'"/>
<xsl:output encoding="UTF-8" indent="yes" method="xml" omit-xml-declaration="yes" version="1.0"/>
<xsl:template match="/">
<s:Envelope xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:wsa="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:wsman="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd">
   <s:Header>
      <wsa:Action s:mustUnderstand="true">http://schemas.xmlsoap.org/ws/2004/09/transfer/Put</wsa:Action>
      <wsa:To s:mustUnderstand="true">https://<xsl:value-of select="$gateway.cluster.hostname"/>:8443/wsman</wsa:To>
      <wsman:ResourceURI s:mustUnderstand="true">http://ns.l7tech.com/2010/04/gateway-management/services</wsman:ResourceURI>
      <wsa:MessageID s:mustUnderstand="true">requestId:<xsl:value-of select="$requestId"/></wsa:MessageID>
      <wsa:ReplyTo>
         <wsa:Address>http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous</wsa:Address>
      </wsa:ReplyTo>
      <wsman:SelectorSet>
         <wsman:Selector Name="id"><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/@id"/></wsman:Selector>
      </wsman:SelectorSet>
   </s:Header>
   <s:Body>   
   <xsl:variable name="version" select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/@version"/>	
   <xsl:variable name="policy_version" select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:Resources/l7:ResourceSet/l7:Resource/@version"/>	
   <xsl:variable name="new_version" select="$version"/>
   <xsl:variable name="new_policy_version" select="$policy_version"/>
   <xsl:variable name="original_policy" select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:Resources/l7:ResourceSet/l7:Resource"/>
   <xsl:variable name="policy_data" select="$disabled.policy"/>
   <xsl:element name="l7:Service">   			
		 <xsl:attribute name="id"><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/@id"/></xsl:attribute>
		 <xsl:attribute name="version"><xsl:value-of select="$new_version"/></xsl:attribute>
		 <xsl:element name="l7:ServiceDetail">
         	<xsl:attribute name="folderId"><xsl:value-of select="$gateway.portal.deleted.apis.folderId"/></xsl:attribute>
		 	<xsl:attribute name="id"><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/@id"/></xsl:attribute>
			<xsl:attribute name="version"><xsl:value-of select="$new_version"/></xsl:attribute>
         <l7:Name><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:Name"/>-deleted</l7:Name>
         <l7:Enabled>false</l7:Enabled>
		 <l7:ServiceMappings>
		 <l7:HttpMapping>
	          <l7:UrlPattern><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:ServiceMappings/l7:HttpMapping/l7:UrlPattern"/>-deleted</l7:UrlPattern>
			  <l7:Verbs>
			  <xsl:for-each select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:ServiceMappings/l7:HttpMapping/l7:Verbs/l7:Verb/text()"><l7:Verb><xsl:value-of select="."/></l7:Verb></xsl:for-each>
			  </l7:Verbs>
		   </l7:HttpMapping>
		 </l7:ServiceMappings>
		 <l7:Properties>
               <l7:Property key="policyRevision">
                  <l7:LongValue><xsl:value-of select="$new_policy_version"/></l7:LongValue>
               </l7:Property>
               <l7:Property key="wssProcessingEnabled">
                  <l7:BooleanValue><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:Properties/l7:Property[@key='soap']/l7:BooleanValue"/></l7:BooleanValue>
               </l7:Property>
               <l7:Property key="soap">
                  <l7:BooleanValue><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:Properties/l7:Property[@key='internal']/l7:BooleanValue"/></l7:BooleanValue>
               </l7:Property>
               <l7:Property key="internal">
                  <l7:BooleanValue><xsl:value-of select="env:Envelope/env:Body/wsen:EnumerateResponse/wsman:Items/l7:Service/l7:ServiceDetail/l7:Properties/l7:Property[@key='wssProcessingEnabled']/l7:BooleanValue"/></l7:BooleanValue>
               </l7:Property>
            </l7:Properties>
		 </xsl:element>
         <l7:Resources>
            <l7:ResourceSet tag="policy">
			   <xsl:element name="l7:Resource">
			   <xsl:attribute name="type">policy</xsl:attribute>
			   <xsl:attribute name="version"><xsl:value-of select="$new_policy_version"/></xsl:attribute><xsl:value-of select="$policy_data"/></xsl:element>
			</l7:ResourceSet>
   		 </l7:Resources>
  </xsl:element>
    </s:Body>
</s:Envelope>
</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                </L7p:ResourceInfo>
                                                <L7p:Target target="OTHER"/>
                                                <L7p:TransformName stringValue=""/>
                                            </L7p:XslTransformation>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHt3c21hbi5yZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
                                                <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="request"/>
                                            </L7p:SetVariable>
                                            <L7p:GatewayManagement>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//update service"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:VariablePrefix stringValue="wsman"/>
                                            </L7p:GatewayManagement>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                <L7p:DataType variableDataType="message"/>
                                                <L7p:VariableToSet stringValue="RESP_createOp"/>
                                            </L7p:SetVariable>
                                            <wsp:OneOrMore wsp:Usage="Required">
                                                <wsp:All wsp:Usage="Required">
                                                    <L7p:ResponseXpathAssertion>

                                                        <L7p:VariablePrefix stringValue="serviceId"/>
                                                        <L7p:XmlMsgSrc stringValue="RESP_createOp"/>

                                                        <L7p:XpathExpression xpathExpressionValue="included">

                                                            <L7p:Expression stringValue="/env:Envelope/env:Body/l7:Service"/>

                                                            <L7p:Namespaces mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsa"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mdo"/>

                                                                    <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="s"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="l7"/>

                                                                    <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wxf"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="xs"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="env"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsen"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsman"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mex"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wse"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsmeta"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                </L7p:entry>
                                                            </L7p:Namespaces>
                                                        </L7p:XpathExpression>
                                                    </L7p:ResponseXpathAssertion>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// success"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:All>
                                                <wsp:All wsp:Usage="Required">
                                                    <L7p:ResponseXpathAssertion>

                                                        <L7p:VariablePrefix stringValue="fault"/>
                                                        <L7p:XmlMsgSrc stringValue="RESP_createOp"/>

                                                        <L7p:XpathExpression xpathExpressionValue="included">

                                                            <L7p:Expression stringValue="/env:Envelope/env:Body/env:Fault"/>

                                                            <L7p:Namespaces mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsa"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mdo"/>

                                                                    <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="s"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="l7"/>

                                                                    <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wxf"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="xs"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="env"/>

                                                                    <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsen"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsman"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="mex"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wse"/>

                                                                    <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="wsmeta"/>

                                                                    <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                </L7p:entry>
                                                            </L7p:Namespaces>
                                                        </L7p:XpathExpression>
                                                    </L7p:ResponseXpathAssertion>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="JHtmYXVsdC5lbGVtZW50fQ=="/>
                                                        <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                        <L7p:DataType variableDataType="message"/>

                                                        <L7p:VariableToSet stringValue="RESP_fault"/>
                                                    </L7p:SetVariable>
                                                    <wsp:OneOrMore wsp:Usage="Required">
                                                        <wsp:All wsp:Usage="Required">
                                                            <L7p:ResponseXpathAssertion>

                                                                <L7p:VariablePrefix stringValue="reason"/>

                                                                <L7p:XmlMsgSrc stringValue="RESP_fault"/>

                                                                <L7p:XpathExpression xpathExpressionValue="included">

                                                                    <L7p:Expression stringValue="//s:Reason/s:Text/text()"/>

                                                                    <L7p:Namespaces mapValue="included">
                                                                        <L7p:entry>

                                                                            <L7p:key stringValue="s"/>

                                                                            <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                        </L7p:entry>
                                                                        <L7p:entry>

                                                                            <L7p:key stringValue="l7"/>

                                                                            <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                        </L7p:entry>
                                                                    </L7p:Namespaces>
                                                                </L7p:XpathExpression>
                                                            </L7p:ResponseXpathAssertion>
                                                            <L7p:ResponseXpathAssertion>

                                                                <L7p:VariablePrefix stringValue="detail"/>

                                                                <L7p:XmlMsgSrc stringValue="RESP_fault"/>

                                                                <L7p:XpathExpression xpathExpressionValue="included">

                                                                    <L7p:Expression stringValue="//s:Detail/s:Text/text()"/>

                                                                    <L7p:Namespaces mapValue="included">
                                                                        <L7p:entry>

                                                                            <L7p:key stringValue="s"/>

                                                                            <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                        </L7p:entry>
                                                                        <L7p:entry>

                                                                            <L7p:key stringValue="l7"/>

                                                                            <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                        </L7p:entry>
                                                                    </L7p:Namespaces>
                                                                </L7p:XpathExpression>
                                                            </L7p:ResponseXpathAssertion>
                                                        </wsp:All>
                                                        <L7p:TrueAssertion/>
                                                    </wsp:OneOrMore>
                                                    <L7p:AuditDetailAssertion>
                                                        <L7p:Detail stringValue="Fault Reason: ${reason.result}Fault Detail: ${detail.result}"/>
                                                        <L7p:LoggingOnly booleanValue="true"/>
                                                    </L7p:AuditDetailAssertion>
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:SetVariable>

                                                            <L7p:Base64Expression stringValue="NTAw"/>

                                                            <L7p:VariableToSet stringValue="errorCode"/>
                                                        </L7p:SetVariable>
                                                        <L7p:SetVariable>

                                                            <L7p:Base64Expression stringValue="RXJyb3IgdXBkYXRlIGFwaS0ke3BtYW4ucmVzSWR9DQoke3JlYXNvbi5yZXN1bHR9DQoke2RldGFpbC5yZXN1bHR9"/>

                                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                                        </L7p:SetVariable>
                                                    </wsp:All>
                                                    <L7p:FalseAssertion/>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// error check"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:All>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//perform checks"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:OneOrMore>
                                        </wsp:All>
                                        <L7p:TrueAssertion/>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//only proceed if its 200"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//restore original operation as it was overwritten"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Base64Expression stringValue="REVMRVRF"/>
                                    <L7p:VariableToSet stringValue="pman.operation"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//DELETE, Delete API (single res &amp; existing)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="NTAw"/>
                                    <L7p:VariableToSet stringValue="errorCode"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="SW52YWxpZCBPcGVyYXRpb24="/>
                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//OTHERS"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//perform API functions"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="API functions"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${wsmanResp}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item stringLength="included">
                                            <L7p:Max intValue="-1"/>
                                            <L7p:Min intValue="1"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHt3c21hblJlc3B9"/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="fragmentResponse"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGw3OkFwaXMgeG1sbnM6bDc9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMDQvYXBpLW1hbmFnZW1lbnQiPg0KICAgIDxsNzpNZXRob2Q+JHtwbWFuLm9wZXJhdGlvbn08L2w3Ok1ldGhvZD4NCiAgICA8bDc6UmVzb3VyY2U+JHtwbWFuLnJlc1VyaX08L2w3OlJlc291cmNlPg0KICAgIDxsNzpSZXNvdXJjZUlkPiR7cG1hbi5yZXNJZH08L2w3OlJlc291cmNlSWQ+DQogICAgPGw3OlRpbWVzdGFtcD4ke2dhdGV3YXkudGltZX08L2w3OlRpbWVzdGFtcD4NCiAgICA8bDc6U3RhdHVzPiR7cG1hbi5yZXNwLnN0YXR1c308L2w3OlN0YXR1cz4NCiAgICA8bDc6RGV0YWlscz4ke3BtYW4ucmVzcC5kZXRhaWx9PC9sNzpEZXRhaWxzPg0KPC9sNzpBcGlzPg=="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="fragmentResponse"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//prepare api response"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// branch for APIs"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="handleApis()"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${pman.resUri}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/1/api/plans"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//flag if we need to perform a wsman update fragment policy"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:Base64Expression stringValue="ZmFsc2U="/>
                            <L7p:VariableToSet stringValue="refreshFlag"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="// do not change"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="Constant: "/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:Base64Expression stringValue="QVBJIFBsYW5zIEZyYWdtZW50"/>
                            <L7p:VariableToSet stringValue="FRAGMENT_NAME"/>
                        </L7p:SetVariable>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5yZW1vdmVPbWl0dGVkfQ=="/>
                                    <L7p:VariableToSet stringValue="pman.options.removeOmitted"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${pman.resId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item stringLength="included">
                                                    <L7p:Max intValue="-1"/>
                                                    <L7p:Min intValue="1"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="DELETE"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="GET"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="LzEvYXBpL3BsYW5zLyR7cG1hbi5yZXNJZH0="/>
                                            <L7p:VariableToSet stringValue="pman.resUri"/>
                                        </L7p:SetVariable>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//with Plan ID parameter"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${pman.resId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item stringLength="included">
                                                    <L7p:Max intValue="-1"/>
                                                    <L7p:Min intValue="1"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="DELETE"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="GET"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="SW52YWxpZCBSZXF1ZXN0"/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//with Plan ID parameter"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:FalseAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//continue to real operation"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                </L7p:FalseAssertion>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//pre-processing and validation"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="GET"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//GET"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="PUT"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                    <L7p:VariableToSet stringValue="refreshFlag"/>
                                </L7p:SetVariable>
                                <wsp:All wsp:Usage="Required">
                                    <wsp:OneOrMore wsp:Usage="Required">
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue=""/>
                                                <L7p:XmlMsgSrc stringValue="request"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="/l7:ApiPlans"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                        </wsp:All>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="NTAw"/>
                                                <L7p:VariableToSet stringValue="errorCode"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="SW52YWxpZCBYTUwgUmVxdWVzdA=="/>
                                                <L7p:VariableToSet stringValue="errorMsg"/>
                                            </L7p:SetVariable>
                                            <L7p:FalseAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//stop now - this wil short circuit the rest of the PUT section"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                            </L7p:FalseAssertion>
                                        </wsp:All>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//required"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="make sure it is a valid xml request"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="API Plans reload part 1 of 2 (checking and validation)"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                </L7p:AuditDetailAssertion>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${pman.operation}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="PUT"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//there should be a body"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.mainpart}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item stringLength="included">
                                                    <L7p:Max intValue="-1"/>
                                                    <L7p:Min intValue="1"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="apiPlans"/>
                                        </L7p:SetVariable>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:XslTransformation>
                                                    <L7p:Direction intValue="-1"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="apiPlans"/>
                                                    <L7p:ResourceInfo staticResourceInfo="included">
                                                        <L7p:Document stringValueReference="inline"><![CDATA[<?xml version='1.0' ?>
<xsl:stylesheet version="1.0" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
	<xsl:output encoding="UTF-8" indent="no" method="xml" omit-xml-declaration="yes" version="1.0"/>
	<xsl:strip-space elements="*"/>
	<xsl:template match="l7:ApiPlans">		
		<L7p:PlanPolicies xmlns:L7p="http://www.layer7tech.com/ws/policy">
		<xsl:apply-templates select="l7:ApiPlan"/>
		</L7p:PlanPolicies>
	</xsl:template>	
	<xsl:template match="l7:ApiPlan">
		<xsl:apply-templates select="l7:PlanPolicy"/>
	</xsl:template>
	<xsl:template match="l7:PlanId"/>
	<xsl:template match="l7:PlanName"/>
	<xsl:template match="l7:DefaultPlan"/>
	<xsl:template match="l7:LastUpdate"/>		
	<xsl:template match="l7:PlanPolicy">
		<xsl:value-of select="." disable-output-escaping="yes"/>
	</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                    </L7p:ResourceInfo>
                                                    <L7p:Target target="OTHER"/>
                                                    <L7p:TransformName stringValue=""/>
                                                </L7p:XslTransformation>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="SW52YWxpZCBYTUwgcmVxdWVzdA=="/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//make sure we can transform it to the format we want"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${errorCode}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//on error, skip the rest"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${errorCode}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:Negated booleanValue="true"/>
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="PHM6RW52ZWxvcGUgeG1sbnM6cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMy8wNS9zb2FwLWVudmVsb3BlIiB4bWxuczphPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA0LzA4L2FkZHJlc3NpbmciIHhtbG5zOnc9Imh0dHA6Ly9zY2hlbWFzLmRtdGYub3JnL3diZW0vd3NtYW4vMS93c21hbi54c2QiPg0KICAgPHM6SGVhZGVyPg0KICAgICAgPGE6TWVzc2FnZUlEPndzbS1nZXQtaWQtJHtyZXF1ZXN0SWR9PC9hOk1lc3NhZ2VJRD4NCiAgICAgIDxhOlRvPmh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC93c21hbjwvYTpUbz4NCiAgICAgIDxhOlJlcGx5VG8+DQogICAgICAgICA8YTpBZGRyZXNzIHM6bXVzdFVuZGVyc3RhbmQ9InRydWUiPmh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZy9yb2xlL2Fub255bW91czwvYTpBZGRyZXNzPg0KICAgICAgPC9hOlJlcGx5VG8+DQogICAgICA8YTpBY3Rpb24gczptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS90cmFuc2Zlci9HZXQ8L2E6QWN0aW9uPg0KICAgICAgPHc6UmVzb3VyY2VVUkkgczptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cDovL25zLmw3dGVjaC5jb20vMjAxMC8wNC9nYXRld2F5LW1hbmFnZW1lbnQvcG9saWNpZXM8L3c6UmVzb3VyY2VVUkk+DQogICAgICA8dzpTZWxlY3RvclNldD4NCiAgICAgICAgIDx3OlNlbGVjdG9yIE5hbWU9Im5hbWUiPiR7RlJBR01FTlRfTkFNRX08L3c6U2VsZWN0b3I+DQogICAgICA8L3c6U2VsZWN0b3JTZXQ+DQogICAgICA8dzpPcGVyYXRpb25UaW1lb3V0PlBUNjAuMDAwUzwvdzpPcGVyYXRpb25UaW1lb3V0Pg0KICAgPC9zOkhlYWRlcj4NCiAgIDxzOkJvZHkvPg0KPC9zOkVudmVsb3BlPg=="/>
                                                    <L7p:VariableToSet stringValue="wsmRequestMessage"/>
                                                </L7p:SetVariable>
                                                <L7p:CommentAssertion>
                                                    <L7p:Comment stringValue="// This fragment performs the WS-Mgmt operation call (note that the request/response messages are both overwritten)"/>
                                                </L7p:CommentAssertion>
                                                <L7p:CommentAssertion>
                                                    <L7p:Comment stringValue="// Requires: authenticatedUser with &quot;admin&quot; privileges"/>
                                                </L7p:CommentAssertion>
                                                <L7p:CommentAssertion>
                                                    <L7p:Comment stringValue="// Requires: var wsmRequestMessage set with complete SOAP request"/>
                                                </L7p:CommentAssertion>
                                                <L7p:CommentAssertion>
                                                    <L7p:Comment stringValue="// Requires: var wsmRequestMessage must be of type &quot;String&quot;"/>
                                                </L7p:CommentAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// Must contain complete WS-Management SOAP request"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>

                                                    <L7p:Base64Expression stringValue="JHt3c21SZXF1ZXN0TWVzc2FnZX0="/>
                                                    <L7p:VariableToSet stringValue="wsmRequestMessage"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHt3c21SZXF1ZXN0TWVzc2FnZX0="/>
                                                    <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="request"/>
                                                </L7p:SetVariable>
                                                <L7p:GatewayManagement>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// execute WS-Mgmt call"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="LEFT.COMMENT"/>

                                                                <L7p:value stringValue="performWsmCall()"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>
                                                </L7p:GatewayManagement>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="wsmResponseMessage"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// clear request message"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="LEFT.COMMENT"/>

                                                                <L7p:value stringValue="set request = (empty)"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>

                                                    <L7p:Base64Expression stringValue=""/>
                                                    <L7p:ContentType stringValue="text/plain; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="request"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// clear response message"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="LEFT.COMMENT"/>

                                                                <L7p:value stringValue="set response = (empty)"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>

                                                    <L7p:Base64Expression stringValue=""/>
                                                    <L7p:ContentType stringValue="text/plain; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="response"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="wsmPolicy"/>
                                                    <L7p:XmlMsgSrc stringValue="wsmResponseMessage"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="//l7:Policy"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsp"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2002/12/policy"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="policyXpath"/>
                                                    <L7p:XmlMsgSrc stringValue="wsmResponseMessage"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="//l7:Resource[@type='policy']/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//get policy fragment"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="RXJyb3IgcmVhZGluZyBmcmFnbWVudDogJHtGUkFHTUVOVF9OQU1FfQ=="/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="/error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// Get API Plans policy fragment"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="getPolicyFragment()"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//on error, skip the rest"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${errorCode}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:Negated booleanValue="true"/>
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:XslTransformation>
                                                    <L7p:Direction intValue="-1"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="apiPlans"/>
                                                    <L7p:ResourceInfo staticResourceInfo="included">
                                                        <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output encoding="UTF-8" indent="no" method="xml" omit-xml-declaration="yes" version="1.0" />
    <xsl:template match="/L7p:PlanPolicies">
        <!-- create the at-least-one branch for all non-default plans -->
        <xsl:element name="wsp:OneOrMore" namespace="http://schemas.xmlsoap.org/ws/2002/12/policy">
            <xsl:attribute name="wsp:Usage" namespace="http://schemas.xmlsoap.org/ws/2002/12/policy">
                <xsl:value-of select="'Required'" />
            </xsl:attribute>
            <xsl:element name="L7p:assertionComment" namespace="http://www.layer7tech.com/ws/policy">
                <xsl:element name="L7p:Properties" namespace="http://www.layer7tech.com/ws/policy">
                    <xsl:element name="L7p:entry" namespace="http://www.layer7tech.com/ws/policy">
                        <xsl:element name="L7p:key" namespace="http://www.layer7tech.com/ws/policy">
                            <xsl:value-of select="'RIGHT.COMMENT'" />
                        </xsl:element>
                        <xsl:element name="L7p:value" namespace="http://www.layer7tech.com/ws/policy">
                            <xsl:value-of select="'// api plans'" />
                        </xsl:element>
                    </xsl:element>
                </xsl:element>
            </xsl:element>
            <!-- copy over the policy assertions pushed by the portal -->
            <xsl:apply-templates select="wsp:Policy/wsp:All" />
        </xsl:element>
    </xsl:template>
    <xsl:template match="wsp:Policy/wsp:All">
        <xsl:copy-of select="wsp:All" />
    </xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                    </L7p:ResourceInfo>
                                                    <L7p:Target target="OTHER"/>
                                                    <L7p:TransformName stringValue=""/>
                                                </L7p:XslTransformation>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwb2xpY3lYcGF0aC5lbGVtZW50fQ=="/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="policyFragment"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHthcGlQbGFucy5tYWlucGFydH0="/>
                                                    <L7p:VariableToSet stringValue="updatePolicySection"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="replacePolicySection"/>
                                                    <L7p:XmlMsgSrc stringValue="policyFragment"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/wsp:Policy/wsp:All/wsp:OneOrMore[1]"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsp"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2002/12/policy"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="L7p"/>

                                                                <L7p:value stringValue="http://www.layer7tech.com/ws/policy"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:RemoveElement>

                                                    <L7p:ElementFromVariable stringValue="replacePolicySection.elements"/>

                                                    <L7p:ElementToInsertVariable stringValue="updatePolicySection"/>

                                                    <L7p:InsertedElementLocation insertedElementLocation="PREVIOUS_SIBLING"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="policyFragment"/>
                                                    <L7p:Target target="OTHER"/>
                                                </L7p:RemoveElement>
                                                <L7p:RemoveElement>

                                                    <L7p:ElementFromVariable stringValue="replacePolicySection.elements"/>

                                                    <L7p:ElementToInsertVariable stringValue="updatePolicySection"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="policyFragment"/>
                                                    <L7p:Target target="OTHER"/>
                                                </L7p:RemoveElement>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="// create updated policy fragment"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="RXJyb3IgY3JlYXRpbmcgdXBkYXRlIGZyYWdtZW50"/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// Generate new API Plans policy fragment"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="createUpdateFragment()"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
                                            <L7p:VariableToSet stringValue="pman.resource"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:TrueAssertion/>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//perform API Plans Fragment reload - part 1 of 2"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0T3JpZ2luYWwubWFpbnBhcnR9"/>
                                    <L7p:VariableToSet stringValue="pman.resource"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//PUT - Updates"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="DELETE"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                    <L7p:VariableToSet stringValue="refreshFlag"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//DELETE - single plan"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="NTAw"/>
                                    <L7p:VariableToSet stringValue="errorCode"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="SW52YWxpZCBPcGVyYXRpb24="/>
                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//OTHERS"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5yZW1vdmVPbWl0dGVkfQ=="/>
                                <L7p:VariableToSet stringValue="pman.options.removeOmitted"/>
                            </L7p:SetVariable>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="API Plans functions"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:AuditDetailAssertion>
                            <L7p:Detail stringValue="Process response... ${errorCode}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${errorCode}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                        <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                        <L7p:Negated booleanValue="true"/>
                                        <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="reason.fault"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ManagePortalResource/>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="response"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:ApiPlans/l7:ApiPlan"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="response"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:ApiPlan"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="PGw3OkFwaVBsYW5zIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDEyLzA0L2FwaS1tYW5hZ2VtZW50Ij4NCjwvbDc6QXBpUGxhbnM+"/>
                                                    <L7p:VariableToSet stringValue="pman.resp.resource"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//pman.resp.resource must be a valid xml"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="response"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3Auc3RhdHVzfQ=="/>
                                            <L7p:VariableToSet stringValue="responseStatus"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AuZGV0YWlsfQ=="/>
                                            <L7p:VariableToSet stringValue="responseDetail"/>
                                        </L7p:SetVariable>
                                        <L7p:XslTransformation>
                                            <L7p:Direction intValue="2"/>
                                            <L7p:ResourceInfo staticResourceInfo="included">
                                                <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:param name="pman.operation" select="'GET'"/>
<xsl:param name="pman.resUri" select="'/v1/apis'"/>
<xsl:param name="pman.resId" select="''"/>
<xsl:param name="gateway.time" select="'2012-05-16T21:16:53.133Z'"/>
<xsl:param name="responseStatus" select="'500'"/>
<xsl:param name="responseDetail" select="'internal service failure'"/>
<xsl:output indent="yes" method="xml" omit-xml-declaration="yes"/>
<xsl:strip-space elements="*"/>		
        <xsl:template match="/">
		<l7:ApiPlans>
		   <!-- Common response elements -->		   
		   <l7:Method><xsl:value-of select="$pman.operation"/></l7:Method>
		   <l7:Resource><xsl:value-of select="$pman.resUri"/></l7:Resource>
		   <l7:ResourceId><xsl:value-of select="$pman.resId"/></l7:ResourceId>
		   <l7:Timestamp><xsl:value-of select="$gateway.time"/></l7:Timestamp>
		   <l7:Status><xsl:value-of select="$responseStatus"/></l7:Status>
		   <l7:Details><xsl:value-of select="$responseDetail"/></l7:Details>
		   <!-- Resource payload -->
			<xsl:apply-templates/>
		</l7:ApiPlans>	  
	 	</xsl:template>
		<xsl:template match="l7:ApiPlan" name="plans">					  									
			<l7:ApiPlan>
		        <l7:PlanId><xsl:value-of select="l7:PlanId"/></l7:PlanId>
		        <l7:PlanName><xsl:value-of select="l7:PlanName"/></l7:PlanName>
		        <l7:DefaultPlan><xsl:choose>
			<xsl:when test="l7:DefaultPlan"><xsl:value-of select="l7:DefaultPlan"/></xsl:when>
			<xsl:otherwise>false</xsl:otherwise>
			</xsl:choose></l7:DefaultPlan>
		        <l7:LastUpdate><xsl:value-of select="l7:LastUpdate"/></l7:LastUpdate>
		        <l7:PlanPolicy><xsl:value-of select="l7:PlanPolicy"/></l7:PlanPolicy>
	    	</l7:ApiPlan>
		</xsl:template>		
</xsl:stylesheet>]]></L7p:Document>
                                            </L7p:ResourceInfo>
                                            <L7p:Target target="RESPONSE"/>
                                            <L7p:TransformName stringValue="format api plans response"/>
                                        </L7p:XslTransformation>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="fragmentResponse"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//skip if there is already an error"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${errorCode}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="RXJyb3IgcGVyZm9ybWluZyBvcGVyYXRpb24="/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//perform &amp; process Manage Portal Assertion response"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${errorCode}"/>
                                        <L7p:Operator operatorNull="null"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item dataType="included">
                                                <L7p:Type variableDataType="string"/>
                                            </L7p:item>
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:RightValue stringValue="0"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:ComparisonAssertion>
                                        <L7p:Expression1 stringValue="${refreshFlag}"/>
                                        <L7p:Expression2 stringValue="true"/>
                                        <L7p:Negate booleanValue="true"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:RightValue stringValue="true"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:AuditDetailAssertion>
                                            <L7p:Detail stringValue="API Plans reload part 2 of 2 (full reload/updating)"/>
                                            <L7p:LoggingOnly booleanValue="true"/>
                                        </L7p:AuditDetailAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="DELETE"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="PUT"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//we only need to update if the last operation was a DELETE or PUT (updates)"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//last operation should have been successful as well before we proceed"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                            <L7p:Expression2 stringValue="200"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="200"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc1VyaX0="/>
                                            <L7p:VariableToSet stringValue="pman.resUri.orig"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLm9wZXJhdGlvbn0="/>
                                            <L7p:VariableToSet stringValue="pman.operation.orig"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//query all API Plans for processing"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:Base64Expression stringValue="LzEvYXBpL3BsYW5z"/>
                                            <L7p:VariableToSet stringValue="pman.resUri"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="R0VU"/>
                                            <L7p:VariableToSet stringValue="pman.operation"/>
                                        </L7p:SetVariable>
                                        <L7p:ManagePortalResource/>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="apiPlans"/>
                                        </L7p:SetVariable>
                                        <L7p:XslTransformation>
                                            <L7p:Direction intValue="-1"/>

                                            <L7p:OtherTargetMessageVariable stringValue="apiPlans"/>
                                            <L7p:ResourceInfo staticResourceInfo="included">
                                                <L7p:Document stringValueReference="inline"><![CDATA[<?xml version='1.0' ?>
<xsl:stylesheet version="1.0" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
	<xsl:output encoding="UTF-8" indent="no" method="xml" omit-xml-declaration="yes" version="1.0"/>
	<xsl:strip-space elements="*"/>
	<xsl:template match="l7:ApiPlans">		
		<L7p:PlanPolicies xmlns:L7p="http://www.layer7tech.com/ws/policy">
		<xsl:apply-templates select="l7:ApiPlan"/>
		</L7p:PlanPolicies>
	</xsl:template>	
	<xsl:template match="l7:ApiPlan">
		<xsl:apply-templates select="l7:PlanPolicy"/>
	</xsl:template>
	<xsl:template match="l7:PlanId"/>
	<xsl:template match="l7:PlanName"/>
	<xsl:template match="l7:DefaultPlan"/>
	<xsl:template match="l7:LastUpdate"/>		
	<xsl:template match="l7:PlanPolicy">
		<xsl:value-of select="." disable-output-escaping="yes"/>
	</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                            </L7p:ResourceInfo>
                                            <L7p:Target target="OTHER"/>
                                            <L7p:TransformName stringValue=""/>
                                        </L7p:XslTransformation>
                                        <L7p:SetVariable>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// successful errorCode"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:Base64Expression stringValue="MA=="/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="PHM6RW52ZWxvcGUgeG1sbnM6cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMy8wNS9zb2FwLWVudmVsb3BlIiB4bWxuczphPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA0LzA4L2FkZHJlc3NpbmciIHhtbG5zOnc9Imh0dHA6Ly9zY2hlbWFzLmRtdGYub3JnL3diZW0vd3NtYW4vMS93c21hbi54c2QiPg0KICAgPHM6SGVhZGVyPg0KICAgICAgPGE6TWVzc2FnZUlEPndzbS1nZXQtaWQtJHtyZXF1ZXN0SWR9PC9hOk1lc3NhZ2VJRD4NCiAgICAgIDxhOlRvPmh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC93c21hbjwvYTpUbz4NCiAgICAgIDxhOlJlcGx5VG8+DQogICAgICAgICA8YTpBZGRyZXNzIHM6bXVzdFVuZGVyc3RhbmQ9InRydWUiPmh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZy9yb2xlL2Fub255bW91czwvYTpBZGRyZXNzPg0KICAgICAgPC9hOlJlcGx5VG8+DQogICAgICA8YTpBY3Rpb24gczptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOS90cmFuc2Zlci9HZXQ8L2E6QWN0aW9uPg0KICAgICAgPHc6UmVzb3VyY2VVUkkgczptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cDovL25zLmw3dGVjaC5jb20vMjAxMC8wNC9nYXRld2F5LW1hbmFnZW1lbnQvcG9saWNpZXM8L3c6UmVzb3VyY2VVUkk+DQogICAgICA8dzpTZWxlY3RvclNldD4NCiAgICAgICAgIDx3OlNlbGVjdG9yIE5hbWU9Im5hbWUiPiR7RlJBR01FTlRfTkFNRX08L3c6U2VsZWN0b3I+DQogICAgICA8L3c6U2VsZWN0b3JTZXQ+DQogICAgICA8dzpPcGVyYXRpb25UaW1lb3V0PlBUNjAuMDAwUzwvdzpPcGVyYXRpb25UaW1lb3V0Pg0KICAgPC9zOkhlYWRlcj4NCiAgIDxzOkJvZHkvPg0KPC9zOkVudmVsb3BlPg=="/>
                                                    <L7p:VariableToSet stringValue="wsmRequestMessage"/>
                                                </L7p:SetVariable>
                                                <L7p:CommentAssertion>
                                                    <L7p:Comment stringValue="// This fragment performs the WS-Mgmt operation call (note that the request/response messages are both overwritten)"/>
                                                </L7p:CommentAssertion>
                                                <L7p:CommentAssertion>
                                                    <L7p:Comment stringValue="// Requires: authenticatedUser with &quot;admin&quot; privileges"/>
                                                </L7p:CommentAssertion>
                                                <L7p:CommentAssertion>
                                                    <L7p:Comment stringValue="// Requires: var wsmRequestMessage set with complete SOAP request"/>
                                                </L7p:CommentAssertion>
                                                <L7p:CommentAssertion>
                                                    <L7p:Comment stringValue="// Requires: var wsmRequestMessage must be of type &quot;String&quot;"/>
                                                </L7p:CommentAssertion>
                                                <L7p:SetVariable>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// Must contain complete WS-Management SOAP request"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>

                                                    <L7p:Base64Expression stringValue="JHt3c21SZXF1ZXN0TWVzc2FnZX0="/>
                                                    <L7p:VariableToSet stringValue="wsmRequestMessage"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHt3c21SZXF1ZXN0TWVzc2FnZX0="/>
                                                    <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="request"/>
                                                </L7p:SetVariable>
                                                <L7p:GatewayManagement>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// execute WS-Mgmt call"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="LEFT.COMMENT"/>

                                                                <L7p:value stringValue="performWsmCall()"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>
                                                </L7p:GatewayManagement>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="wsmResponseMessage"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// clear request message"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="LEFT.COMMENT"/>

                                                                <L7p:value stringValue="set request = (empty)"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>

                                                    <L7p:Base64Expression stringValue=""/>
                                                    <L7p:ContentType stringValue="text/plain; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="request"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:AssertionComment assertionComment="included">
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// clear response message"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="LEFT.COMMENT"/>

                                                                <L7p:value stringValue="set response = (empty)"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:AssertionComment>

                                                    <L7p:Base64Expression stringValue=""/>
                                                    <L7p:ContentType stringValue="text/plain; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="response"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="wsmPolicy"/>
                                                    <L7p:XmlMsgSrc stringValue="wsmResponseMessage"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="//l7:Policy"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsp"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2002/12/policy"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="policyXpath"/>
                                                    <L7p:XmlMsgSrc stringValue="wsmResponseMessage"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="//l7:Resource[@type='policy']/text()"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="RXJyb3IgcmVhZGluZyBmcmFnbWVudDogJHtGUkFHTUVOVF9OQU1FfQ=="/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// Get API Plans policy fragment"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="getPolicyFragment()"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:RightValue stringValue="0"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:TrueAssertion/>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="// on error, skip step"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:XslTransformation>
                                                    <L7p:Direction intValue="-1"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="apiPlans"/>
                                                    <L7p:ResourceInfo staticResourceInfo="included">
                                                        <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output encoding="UTF-8" indent="no" method="xml" omit-xml-declaration="yes" version="1.0" />
    <xsl:template match="/L7p:PlanPolicies">
        <!-- create the at-least-one branch for all non-default plans -->
        <xsl:element name="wsp:OneOrMore" namespace="http://schemas.xmlsoap.org/ws/2002/12/policy">
            <xsl:attribute name="wsp:Usage" namespace="http://schemas.xmlsoap.org/ws/2002/12/policy">
                <xsl:value-of select="'Required'" />
            </xsl:attribute>
            <xsl:element name="L7p:assertionComment" namespace="http://www.layer7tech.com/ws/policy">
                <xsl:element name="L7p:Properties" namespace="http://www.layer7tech.com/ws/policy">
                    <xsl:element name="L7p:entry" namespace="http://www.layer7tech.com/ws/policy">
                        <xsl:element name="L7p:key" namespace="http://www.layer7tech.com/ws/policy">
                            <xsl:value-of select="'RIGHT.COMMENT'" />
                        </xsl:element>
                        <xsl:element name="L7p:value" namespace="http://www.layer7tech.com/ws/policy">
                            <xsl:value-of select="'// api plans'" />
                        </xsl:element>
                    </xsl:element>
                </xsl:element>
            </xsl:element>
            <!-- copy over the policy assertions pushed by the portal -->
            <xsl:apply-templates select="wsp:Policy/wsp:All" />
        </xsl:element>
    </xsl:template>
    <xsl:template match="wsp:Policy/wsp:All">
        <xsl:copy-of select="wsp:All" />
    </xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                    </L7p:ResourceInfo>
                                                    <L7p:Target target="OTHER"/>
                                                    <L7p:TransformName stringValue=""/>
                                                </L7p:XslTransformation>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwb2xpY3lYcGF0aC5lbGVtZW50fQ=="/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="policyFragment"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHthcGlQbGFucy5tYWlucGFydH0="/>
                                                    <L7p:VariableToSet stringValue="updatePolicySection"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="replacePolicySection"/>
                                                    <L7p:XmlMsgSrc stringValue="policyFragment"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/wsp:Policy/wsp:All/wsp:OneOrMore[1]"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsp"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2002/12/policy"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="xs"/>

                                                                <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="env"/>

                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsen"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mex"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsa"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="mdo"/>

                                                                <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="L7p"/>

                                                                <L7p:value stringValue="http://www.layer7tech.com/ws/policy"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wxf"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsman"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wse"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="wsmeta"/>

                                                                <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:RemoveElement>

                                                    <L7p:ElementFromVariable stringValue="replacePolicySection.elements"/>

                                                    <L7p:ElementToInsertVariable stringValue="updatePolicySection"/>

                                                    <L7p:InsertedElementLocation insertedElementLocation="PREVIOUS_SIBLING"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="policyFragment"/>
                                                    <L7p:Target target="OTHER"/>
                                                </L7p:RemoveElement>
                                                <L7p:RemoveElement>

                                                    <L7p:ElementFromVariable stringValue="replacePolicySection.elements"/>

                                                    <L7p:ElementToInsertVariable stringValue="updatePolicySection"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="policyFragment"/>
                                                    <L7p:Target target="OTHER"/>
                                                </L7p:RemoveElement>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="// create updated policy fragment"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="RXJyb3IgY3JlYXRpbmcgdXBkYXRlIGZyYWdtZW50"/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//error"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// Generate new API Plans policy fragment"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="createUpdateFragment()"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:RightValue stringValue="0"/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:TrueAssertion/>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="// on error, skip step"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwb2xpY3lGcmFnbWVudC5tYWlucGFydH0="/>
                                                    <L7p:VariableToSet stringValue="newFragmentValue"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHt3c21Qb2xpY3kuZWxlbWVudH0="/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="updatedPolicy"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtuZXdGcmFnbWVudFZhbHVlfQ=="/>
                                                    <L7p:VariableToSet stringValue="newFragmentValue"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHt1cGRhdGVkUG9saWN5Lm1haW5wYXJ0fQ=="/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="updatedPolicy"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue="previousVersion"/>
                                                    <L7p:XmlMsgSrc stringValue="updatedPolicy"/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="//l7:Policy/@version"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                                <L7p:XslTransformation>
                                                    <L7p:Direction intValue="-1"/>

                                                    <L7p:OtherTargetMessageVariable stringValue="updatedPolicy"/>
                                                    <L7p:ResourceInfo staticResourceInfo="included">
                                                        <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output encoding="UTF-8" indent="no" method="xml" omit-xml-declaration="yes" version="1.0" />
    <xsl:param name="newFragmentValue" />
    <xsl:template match="/">
        <xsl:copy>
            <xsl:apply-templates select="*|@*|text()|processing-instruction()|comment()" />
        </xsl:copy>
    </xsl:template>
    <xsl:template match="l7:Resource">
        <xsl:choose>
            <xsl:when test="@type='policy'">
                <xsl:copy>
                    <xsl:apply-templates select="@*" />
                    <xsl:value-of disable-output-escaping="no" select="$newFragmentValue" />
                </xsl:copy>
            </xsl:when>
            <xsl:otherwise>
                <xsl:copy>
                    <xsl:apply-templates select="*|@*|text()|processing-instruction()|comment()" />
                </xsl:copy>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>
    <!-- Identity transform -->
    <xsl:template match="@*|*|processing-instruction()|comment()">
        <xsl:copy>
            <xsl:apply-templates select="*|@*|text()|processing-instruction()|comment()" />
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                    </L7p:ResourceInfo>
                                                    <L7p:Target target="OTHER"/>
                                                    <L7p:TransformName stringValue=""/>
                                                </L7p:XslTransformation>
                                                <wsp:All wsp:Usage="Required">
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="PHM6RW52ZWxvcGUgeG1sbnM6cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMy8wNS9zb2FwLWVudmVsb3BlIiB4bWxuczp3c2E9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDQvMDgvYWRkcmVzc2luZyIgeG1sbnM6d3NtYW49Imh0dHA6Ly9zY2hlbWFzLmRtdGYub3JnL3diZW0vd3NtYW4vMS93c21hbi54c2QiIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDEwLzA0L2dhdGV3YXktbWFuYWdlbWVudCI+DQogICA8czpIZWFkZXI+DQogICAgICA8d3NhOkFjdGlvbiBzOm11c3RVbmRlcnN0YW5kPSJ0cnVlIj5odHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA0LzA5L3RyYW5zZmVyL1B1dDwvd3NhOkFjdGlvbj4NCiAgICAgIDx3c2E6VG8gczptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cDovL2xvY2FsaG9zdDo4MDgwL3dzbWFuPC93c2E6VG8+DQogICAgICA8d3NtYW46UmVzb3VyY2VVUkkgczptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+aHR0cDovL25zLmw3dGVjaC5jb20vMjAxMC8wNC9nYXRld2F5LW1hbmFnZW1lbnQvcG9saWNpZXM8L3dzbWFuOlJlc291cmNlVVJJPg0KICAgICAgPHdzYTpNZXNzYWdlSUQgczptdXN0VW5kZXJzdGFuZD0idHJ1ZSI+d3NtLXB1dC1pZC0ke3JlcXVlc3RJZH08L3dzYTpNZXNzYWdlSUQ+DQogICAgICA8d3NhOlJlcGx5VG8+DQogICAgICAgICA8d3NhOkFkZHJlc3M+aHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNC8wOC9hZGRyZXNzaW5nL3JvbGUvYW5vbnltb3VzPC93c2E6QWRkcmVzcz4NCiAgICAgIDwvd3NhOlJlcGx5VG8+DQogICAgICA8d3NtYW46U2VsZWN0b3JTZXQ+DQogICAgICAgICA8d3NtYW46U2VsZWN0b3IgTmFtZT0ibmFtZSI+JHtGUkFHTUVOVF9OQU1FfTwvd3NtYW46U2VsZWN0b3I+DQogICAgICA8L3dzbWFuOlNlbGVjdG9yU2V0Pg0KICAgPC9zOkhlYWRlcj4NCiAgIDxzOkJvZHk+DQoke3VwZGF0ZWRQb2xpY3kubWFpbnBhcnR9DQogICA8L3M6Qm9keT4NCjwvczpFbnZlbG9wZT4="/>

                                                        <L7p:VariableToSet stringValue="wsmRequestMessage"/>
                                                    </L7p:SetVariable>
                                                    <L7p:CommentAssertion>
                                                        <L7p:Comment stringValue="// This fragment performs the WS-Mgmt operation call (note that the request/response messages are both overwritten)"/>
                                                    </L7p:CommentAssertion>
                                                    <L7p:CommentAssertion>
                                                        <L7p:Comment stringValue="// Requires: authenticatedUser with &quot;admin&quot; privileges"/>
                                                    </L7p:CommentAssertion>
                                                    <L7p:CommentAssertion>
                                                        <L7p:Comment stringValue="// Requires: var wsmRequestMessage set with complete SOAP request"/>
                                                    </L7p:CommentAssertion>
                                                    <L7p:CommentAssertion>
                                                        <L7p:Comment stringValue="// Requires: var wsmRequestMessage must be of type &quot;String&quot;"/>
                                                    </L7p:CommentAssertion>
                                                    <L7p:SetVariable>

                                                        <L7p:AssertionComment assertionComment="included">

                                                            <L7p:Properties mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                    <L7p:value stringValue="// Must contain complete WS-Management SOAP request"/>
                                                                </L7p:entry>
                                                            </L7p:Properties>
                                                        </L7p:AssertionComment>

                                                        <L7p:Base64Expression stringValue="JHt3c21SZXF1ZXN0TWVzc2FnZX0="/>

                                                        <L7p:VariableToSet stringValue="wsmRequestMessage"/>
                                                    </L7p:SetVariable>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="JHt3c21SZXF1ZXN0TWVzc2FnZX0="/>
                                                        <L7p:ContentType stringValue="application/soap+xml; charset=utf-8"/>
                                                        <L7p:DataType variableDataType="message"/>

                                                        <L7p:VariableToSet stringValue="request"/>
                                                    </L7p:SetVariable>
                                                    <L7p:GatewayManagement>

                                                        <L7p:AssertionComment assertionComment="included">

                                                            <L7p:Properties mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                    <L7p:value stringValue="// execute WS-Mgmt call"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="LEFT.COMMENT"/>

                                                                    <L7p:value stringValue="performWsmCall()"/>
                                                                </L7p:entry>
                                                            </L7p:Properties>
                                                        </L7p:AssertionComment>
                                                    </L7p:GatewayManagement>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                                        <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                        <L7p:DataType variableDataType="message"/>

                                                        <L7p:VariableToSet stringValue="wsmResponseMessage"/>
                                                    </L7p:SetVariable>
                                                    <L7p:SetVariable>

                                                        <L7p:AssertionComment assertionComment="included">

                                                            <L7p:Properties mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                    <L7p:value stringValue="// clear request message"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="LEFT.COMMENT"/>

                                                                    <L7p:value stringValue="set request = (empty)"/>
                                                                </L7p:entry>
                                                            </L7p:Properties>
                                                        </L7p:AssertionComment>

                                                        <L7p:Base64Expression stringValue=""/>
                                                        <L7p:ContentType stringValue="text/plain; charset=utf-8"/>
                                                        <L7p:DataType variableDataType="message"/>

                                                        <L7p:VariableToSet stringValue="request"/>
                                                    </L7p:SetVariable>
                                                    <L7p:SetVariable>

                                                        <L7p:AssertionComment assertionComment="included">

                                                            <L7p:Properties mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                    <L7p:value stringValue="// clear response message"/>
                                                                </L7p:entry>
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="LEFT.COMMENT"/>

                                                                    <L7p:value stringValue="set response = (empty)"/>
                                                                </L7p:entry>
                                                            </L7p:Properties>
                                                        </L7p:AssertionComment>

                                                        <L7p:Base64Expression stringValue=""/>
                                                        <L7p:ContentType stringValue="text/plain; charset=utf-8"/>
                                                        <L7p:DataType variableDataType="message"/>

                                                        <L7p:VariableToSet stringValue="response"/>
                                                    </L7p:SetVariable>
                                                    <L7p:SetVariable>

                                                        <L7p:Base64Expression stringValue="JHt3c21SZXNwb25zZU1lc3NhZ2UubWFpbnBhcnR9"/>
                                                        <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                        <L7p:DataType variableDataType="message"/>

                                                        <L7p:VariableToSet stringValue="RESP_putOp"/>
                                                    </L7p:SetVariable>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="// perform policy push"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:All>
                                                <wsp:OneOrMore wsp:Usage="Required">
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:ResponseXpathAssertion>

                                                            <L7p:VariablePrefix stringValue="newVersion"/>

                                                            <L7p:XmlMsgSrc stringValue="RESP_putOp"/>

                                                            <L7p:XpathExpression xpathExpressionValue="included">

                                                                <L7p:Expression stringValue="//l7:Policy/@version"/>

                                                                <L7p:Namespaces mapValue="included">
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="s"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="l7"/>

                                                                        <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                    </L7p:entry>
                                                                </L7p:Namespaces>
                                                            </L7p:XpathExpression>
                                                        </L7p:ResponseXpathAssertion>
                                                        <L7p:ResponseXpathAssertion>

                                                            <L7p:VariablePrefix stringValue="newPolicy"/>

                                                            <L7p:XmlMsgSrc stringValue="RESP_putOp"/>

                                                            <L7p:XpathExpression xpathExpressionValue="included">

                                                                <L7p:Expression stringValue="//l7:Policy"/>

                                                                <L7p:Namespaces mapValue="included">
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="s"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="l7"/>

                                                                        <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                    </L7p:entry>
                                                                </L7p:Namespaces>
                                                            </L7p:XpathExpression>
                                                        </L7p:ResponseXpathAssertion>
                                                        <L7p:assertionComment>

                                                            <L7p:Properties mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                    <L7p:value stringValue="// success"/>
                                                                </L7p:entry>
                                                            </L7p:Properties>
                                                        </L7p:assertionComment>
                                                    </wsp:All>
                                                    <wsp:All wsp:Usage="Required">
                                                        <L7p:ResponseXpathAssertion>

                                                            <L7p:VariablePrefix stringValue="fault"/>

                                                            <L7p:XmlMsgSrc stringValue="RESP_putOp"/>

                                                            <L7p:XpathExpression xpathExpressionValue="included">

                                                                <L7p:Expression stringValue="/env:Envelope/env:Body/env:Fault"/>

                                                                <L7p:Namespaces mapValue="included">
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsa"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/addressing"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="mdo"/>

                                                                        <L7p:value stringValue="http://schemas.wiseman.dev.java.net/metadata/messagetypes"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="s"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="l7"/>

                                                                        <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="xs"/>

                                                                        <L7p:value stringValue="http://www.w3.org/2001/XMLSchema"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wxf"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/transfer"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsen"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/enumeration"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="env"/>

                                                                        <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsman"/>

                                                                        <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wsmeta"/>

                                                                        <L7p:value stringValue="http://schemas.dmtf.org/wbem/wsman/1/wsman/version1.0.0.a/default-addressing-model.xsd"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="wse"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/08/eventing"/>
                                                                    </L7p:entry>
                                                                    <L7p:entry>

                                                                        <L7p:key stringValue="mex"/>

                                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2004/09/mex"/>
                                                                    </L7p:entry>
                                                                </L7p:Namespaces>
                                                            </L7p:XpathExpression>
                                                        </L7p:ResponseXpathAssertion>
                                                        <L7p:SetVariable>

                                                            <L7p:Base64Expression stringValue="JHtmYXVsdC5lbGVtZW50fQ=="/>

                                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>

                                                            <L7p:DataType variableDataType="message"/>

                                                            <L7p:VariableToSet stringValue="RESP_fault"/>
                                                        </L7p:SetVariable>
                                                        <wsp:OneOrMore wsp:Usage="Required">
                                                            <wsp:All wsp:Usage="Required">
                                                                <L7p:ResponseXpathAssertion>

                                                                    <L7p:VariablePrefix stringValue="reason"/>

                                                                    <L7p:XmlMsgSrc stringValue="RESP_fault"/>

                                                                    <L7p:XpathExpression xpathExpressionValue="included">

                                                                        <L7p:Expression stringValue="//s:Reason/s:Text/text()"/>

                                                                        <L7p:Namespaces mapValue="included">
                                                                            <L7p:entry>

                                                                                <L7p:key stringValue="s"/>

                                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                            </L7p:entry>
                                                                            <L7p:entry>

                                                                                <L7p:key stringValue="l7"/>

                                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                            </L7p:entry>
                                                                        </L7p:Namespaces>
                                                                    </L7p:XpathExpression>
                                                                </L7p:ResponseXpathAssertion>
                                                                <L7p:ResponseXpathAssertion>

                                                                    <L7p:VariablePrefix stringValue="detail"/>

                                                                    <L7p:XmlMsgSrc stringValue="RESP_fault"/>

                                                                    <L7p:XpathExpression xpathExpressionValue="included">

                                                                        <L7p:Expression stringValue="//s:Detail/s:Text/text()"/>

                                                                        <L7p:Namespaces mapValue="included">
                                                                            <L7p:entry>

                                                                                <L7p:key stringValue="s"/>

                                                                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                                                                            </L7p:entry>
                                                                            <L7p:entry>

                                                                                <L7p:key stringValue="l7"/>

                                                                                <L7p:value stringValue="http://ns.l7tech.com/2010/04/gateway-management"/>
                                                                            </L7p:entry>
                                                                        </L7p:Namespaces>
                                                                    </L7p:XpathExpression>
                                                                </L7p:ResponseXpathAssertion>
                                                            </wsp:All>
                                                            <L7p:TrueAssertion/>
                                                        </wsp:OneOrMore>
                                                        <L7p:AuditDetailAssertion>
                                                            <L7p:Detail stringValue="Fault Reason: ${reason.result}Fault Detail: ${detail.result}"/>

                                                            <L7p:LoggingOnly booleanValue="true"/>
                                                        </L7p:AuditDetailAssertion>
                                                        <L7p:FalseAssertion/>
                                                        <L7p:assertionComment>

                                                            <L7p:Properties mapValue="included">
                                                                <L7p:entry>

                                                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                    <L7p:value stringValue="// error check"/>
                                                                </L7p:entry>
                                                            </L7p:Properties>
                                                        </L7p:assertionComment>
                                                    </wsp:All>
                                                    <L7p:assertionComment>
                                                        <L7p:Properties mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="RIGHT.COMMENT"/>

                                                                <L7p:value stringValue="//perform checks"/>
                                                            </L7p:entry>
                                                        </L7p:Properties>
                                                    </L7p:assertionComment>
                                                </wsp:OneOrMore>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//perform push"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="NTAw"/>
                                                    <L7p:VariableToSet stringValue="errorCode"/>
                                                </L7p:SetVariable>
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="RXJyb3IgdXBkYXRpbmcgZnJhZ21lbnQ6ICR7RlJBR01FTlRfTkFNRX0="/>
                                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                                </L7p:SetVariable>
                                                <L7p:assertionComment>
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//error "/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:assertionComment>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// Update API Plans policy fragment"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="updatePolicyFragment()"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//we must reload all the api plans and rebuild the API Plans Fragment"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//skip if there is already an error"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${errorCode}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                            <L7p:Expression2 stringValue="404"/>
                                            <L7p:Negate booleanValue="true"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:RightValue stringValue="404"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="RXJyb3IgdXBkYXRpbmcgZnJhZ21lbnQ6ICR7RlJBR01FTlRfTkFNRX0="/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//perform API Plans Fragment reload - part 2 of 2"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                        <L7p:Expression1 stringValue="${errorCode}"/>
                                        <L7p:Expression2 stringValue="0"/>
                                        <L7p:Negate booleanValue="true"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:RightValue stringValue="0"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:ComparisonAssertion>
                                        <L7p:Expression1 stringValue="${refreshFlag}"/>
                                        <L7p:Expression2 stringValue="true"/>
                                        <L7p:Negate booleanValue="true"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:RightValue stringValue="true"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${reason.fault}"/>
                                        <L7p:Operator operatorNull="null"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item stringLength="included">
                                                <L7p:Max intValue="-1"/>
                                                <L7p:Min intValue="1"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtlcnJvck1zZ30NCkZhdWx0IFJlYXNvbjoke3JlYXNvbi5yZXN1bHR9DQpGYXVsdCBEZXRhaWw6JHtkZXRhaWwucmVzdWx0fQ=="/>
                                        <L7p:VariableToSet stringValue="errorMsg"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtlcnJvckNvZGV9"/>
                                        <L7p:VariableToSet stringValue="responseStatus"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtlcnJvck1zZ30="/>
                                        <L7p:VariableToSet stringValue="responseDetail"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtwbWFuLnJlc1VyaS5vcmlnfQ=="/>
                                        <L7p:VariableToSet stringValue="pman.resUri"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtwbWFuLm9wZXJhdGlvbi5vcmlnfQ=="/>
                                        <L7p:VariableToSet stringValue="pman.operation"/>
                                    </L7p:SetVariable>
                                    <L7p:XslTransformation>
                                        <L7p:AssertionComment assertionComment="included">
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//with the errorCode &amp; errorMessage in place"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:AssertionComment>
                                        <L7p:Direction intValue="2"/>
                                        <L7p:ResourceInfo staticResourceInfo="included">
                                            <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:param name="pman.operation" select="'GET'"/>
<xsl:param name="pman.resUri" select="'/v1/apis'"/>
<xsl:param name="pman.resId" select="''"/>
<xsl:param name="gateway.time" select="'2012-05-16T21:16:53.133Z'"/>
<xsl:param name="responseStatus" select="'500'"/>
<xsl:param name="responseDetail" select="'internal service failure'"/>
<xsl:output indent="yes" method="xml" omit-xml-declaration="yes"/>
<xsl:strip-space elements="*"/>		
        <xsl:template match="/">
		<l7:ApiPlans>
		   <!-- Common response elements -->		   
		   <l7:Method><xsl:value-of select="$pman.operation"/></l7:Method>
		   <l7:Resource><xsl:value-of select="$pman.resUri"/></l7:Resource>
		   <l7:ResourceId><xsl:value-of select="$pman.resId"/></l7:ResourceId>
		   <l7:Timestamp><xsl:value-of select="$gateway.time"/></l7:Timestamp>
		   <l7:Status><xsl:value-of select="$responseStatus"/></l7:Status>
		   <l7:Details><xsl:value-of select="$responseDetail"/></l7:Details>
		   <!-- Resource payload -->
			<xsl:apply-templates/>
		</l7:ApiPlans>	  
	 	</xsl:template>
		<xsl:template match="l7:ApiPlan" name="plans">					  												
		</xsl:template>		
</xsl:stylesheet>]]></L7p:Document>
                                        </L7p:ResourceInfo>
                                        <L7p:Target target="RESPONSE"/>
                                        <L7p:TransformName stringValue="format api plans response"/>
                                    </L7p:XslTransformation>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                        <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                        <L7p:DataType variableDataType="message"/>
                                        <L7p:VariableToSet stringValue="fragmentResponse"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//error handling for cases that there was an error updating the fragment"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="processResponse()"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//Result &amp; post-processing"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// branch for API Plans"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="handleApiPlans()"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${pman.resUri}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/1/api/keys"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5yZW1vdmVPbWl0dGVkfQ=="/>
                                    <L7p:VariableToSet stringValue="pman.options.removeOmitted"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${pman.resId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item stringLength="included">
                                                    <L7p:Max intValue="-1"/>
                                                    <L7p:Min intValue="1"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="DELETE"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="GET"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="LzEvYXBpL2tleXMvJHtwbWFuLnJlc0lkfQ=="/>
                                            <L7p:VariableToSet stringValue="pman.resUri"/>
                                        </L7p:SetVariable>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//with ApiKey ID parameter"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${pman.resId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item stringLength="included">
                                                    <L7p:Max intValue="-1"/>
                                                    <L7p:Min intValue="1"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="DELETE"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="GET"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="SW52YWxpZCBSZXF1ZXN0"/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//with ApiKey ID parameter"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:FalseAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//continue to real operation"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                </L7p:FalseAssertion>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//pre-processing and validation"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="GET"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5zdGF0dXN9"/>
                                    <L7p:VariableToSet stringValue="pman.options.status"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//GET"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="PUT"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
                                    <L7p:VariableToSet stringValue="pman.resource"/>
                                </L7p:SetVariable>
                                <wsp:All wsp:Usage="Required">
                                    <wsp:OneOrMore wsp:Usage="Required">
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue=""/>
                                                <L7p:XmlMsgSrc stringValue="request"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="/l7:ApiKeys"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                        </wsp:All>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="NTAw"/>
                                                <L7p:VariableToSet stringValue="errorCode"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="SW52YWxpZCBYTUwgUmVxdWVzdA=="/>
                                                <L7p:VariableToSet stringValue="errorMsg"/>
                                            </L7p:SetVariable>
                                            <L7p:FalseAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//stop now - this wil short circuit the rest of the PUT section"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                            </L7p:FalseAssertion>
                                        </wsp:All>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//required"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="make sure it is a valid xml request"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//PUT, Updates"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="DELETE"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${pman.resId}"/>
                                    <L7p:Expression2 stringValue=""/>
                                    <L7p:Negate booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item binary="included">
                                            <L7p:Negated booleanValue="true"/>
                                            <L7p:Operator operator="EMPTY"/>
                                            <L7p:RightValue stringValue=""/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//DELETE, Delete API (single res &amp; existing)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="NTAw"/>
                                    <L7p:VariableToSet stringValue="errorCode"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="SW52YWxpZCBPcGVyYXRpb24="/>
                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//OTHERS"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//perform ApiKey Functions"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="ApiKey Functions"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:AuditDetailAssertion>
                            <L7p:Detail stringValue="Process response... ${errorCode}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${errorCode}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                        <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                        <L7p:Negated booleanValue="true"/>
                                        <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="reason.fault"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ManagePortalResource/>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="response"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:ApiKeys/l7:ApiKey"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="response"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:ApiKey"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="PGw3OkFwaUtleXMgeG1sbnM6bDc9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMDQvYXBpLW1hbmFnZW1lbnQiPg0KPC9sNzpBcGlLZXlzPg=="/>
                                                    <L7p:VariableToSet stringValue="pman.resp.resource"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//pman.resp.resource must be a valid xml"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="response"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3Auc3RhdHVzfQ=="/>
                                            <L7p:VariableToSet stringValue="responseStatus"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AuZGV0YWlsfQ=="/>
                                            <L7p:VariableToSet stringValue="responseDetail"/>
                                        </L7p:SetVariable>
                                        <L7p:XslTransformation>
                                            <L7p:Direction intValue="2"/>
                                            <L7p:ResourceInfo staticResourceInfo="included">
                                                <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:param name="pman.operation" select="'GET'"/>
<xsl:param name="pman.resUri" select="'/v1/apis'"/>
<xsl:param name="pman.resId" select="''"/>
<xsl:param name="gateway.time" select="'2012-05-16T21:16:53.133Z'"/>
<xsl:param name="pman.resp.status" select="'500'"/>
<xsl:param name="pman.resp.detail" select="'internal service failure'"/>
<xsl:output indent="yes" method="xml" omit-xml-declaration="yes"/>
<xsl:strip-space elements="*"/>		
        <xsl:template match="/">
		<l7:ApiKeys>
		   <!-- Common response elements -->		   
		   <l7:Method><xsl:value-of select="$pman.operation"/></l7:Method>
		   <l7:Resource><xsl:value-of select="$pman.resUri"/></l7:Resource>
		   <l7:ResourceId><xsl:value-of select="$pman.resId"/></l7:ResourceId>
		   <l7:Timestamp><xsl:value-of select="$gateway.time"/></l7:Timestamp>
		   <l7:Status><xsl:value-of select="$pman.resp.status"/></l7:Status>
		   <l7:Details><xsl:value-of select="$pman.resp.detail"/></l7:Details>
		   <!-- Resource payload -->
			<xsl:apply-templates/>
		</l7:ApiKeys>	  
	 	</xsl:template>
		<xsl:template match="l7:ApiKey">	
			<xsl:element name="l7:ApiKey">				  									
			        <xsl:copy-of select="l7:Key"/>
			        <xsl:copy-of select="l7:Status"/>
			        <xsl:copy-of select="l7:Apis"/>
			        <xsl:copy-of select="l7:Secret"/>
			        <xsl:copy-of select="l7:AccountPlanMappingId"/>
			        <xsl:copy-of select="l7:CustomMetaData"/>
			        <xsl:copy-of select="l7:Label"/>
			        <xsl:copy-of select="l7:Details"/>
			        <xsl:copy-of select="l7:Platform"/>
			        <xsl:copy-of select="l7:Security"/>
			</xsl:element>
		</xsl:template>			
</xsl:stylesheet>]]></L7p:Document>
                                            </L7p:ResourceInfo>
                                            <L7p:Target target="RESPONSE"/>
                                            <L7p:TransformName stringValue="format api keys"/>
                                        </L7p:XslTransformation>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="fragmentResponse"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//skip if there is already an error"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${errorCode}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="RXJyb3IgcGVyZm9ybWluZyBvcGVyYXRpb24="/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//perform &amp; process Manage Portal Assertion response"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="processResponse()"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//Result &amp; post-processing"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// branch for API Keys"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="handleApiKeys()"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${pman.resUri}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/1/gateway"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="GET"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ManagePortalResource/>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="response"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3Auc3RhdHVzfQ=="/>
                                    <L7p:VariableToSet stringValue="responseStatus"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AuZGV0YWlsfQ=="/>
                                    <L7p:VariableToSet stringValue="responseDetail"/>
                                </L7p:SetVariable>
                                <L7p:XslTransformation>
                                    <L7p:Direction intValue="2"/>
                                    <L7p:ResourceInfo staticResourceInfo="included">
                                        <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:param name="pman.operation" select="'GET'"/>
<xsl:param name="pman.resUri" select="'/1/gateway'"/>
<xsl:param name="pman.resId" select="''"/>
<xsl:param name="gateway.time" select="'2012-05-16T21:16:53.133Z'"/>
<xsl:param name="pman.resp.status" select="'500'"/>
<xsl:param name="pman.resp.detail" select="'internal service failure'"/>
<xsl:param name="ssgnode.id" select="''"/>
<xsl:param name="ssgnode.name" select="''"/>
<xsl:param name="ssgnode.build.detail" select="''"/>
<xsl:param name="ssgnode.build.label" select="''"/>
<xsl:param name="ssgnode.build.number" select="''"/>
<xsl:param name="ssgnode.build.version" select="''"/>
<xsl:param name="ssgnode.build.version.major" select="''"/>
<xsl:param name="ssgnode.build.version.minor" select="''"/>
<xsl:param name="ssgnode.build.version.subminor" select="''"/>
<xsl:output indent="yes" method="xml" omit-xml-declaration="yes"/>
<xsl:strip-space elements="*"/>		
        <xsl:template match="/">
		<l7:Gateway>
		   <!-- Common response elements -->		   
		   <l7:Method><xsl:value-of select="$pman.operation"/></l7:Method>
		   <l7:Resource><xsl:value-of select="$pman.resUri"/></l7:Resource>
		   <l7:ResourceId><xsl:value-of select="$pman.resId"/></l7:ResourceId>
		   <l7:Timestamp><xsl:value-of select="$gateway.time"/></l7:Timestamp>
		   <l7:Status><xsl:value-of select="$pman.resp.status"/></l7:Status>
		   <l7:Details><xsl:value-of select="$pman.resp.detail"/></l7:Details> 
		   <l7:Node><xsl:value-of select="$ssgnode.build.detail"/></l7:Node>
		   <!-- Resource payload -->
			<xsl:apply-templates/> 
		</l7:Gateway>	  
	 	</xsl:template>
		<xsl:template match="l7:Api">	
			<xsl:element name="l7:Api">				  									
			        <xsl:copy-of select="l7:Count"/>
			        <xsl:copy-of select="l7:CacheItems"/>			        
			</xsl:element>
		</xsl:template>
		<xsl:template match="l7:ApiPlan">	
			<xsl:element name="l7:ApiPlan">				  									
			        <xsl:copy-of select="l7:Count"/>
			        <xsl:copy-of select="l7:CacheItems"/>			        
			</xsl:element>
		</xsl:template>
		<xsl:template match="l7:ApiKey">	
			<xsl:element name="l7:ApiKey">				  									
			        <xsl:copy-of select="l7:Count"/>
			        <xsl:copy-of select="l7:CacheItems"/>			        
			</xsl:element>
		</xsl:template>
		<xsl:template match="l7:ApiLegacyKey">	
			<xsl:element name="l7:ApiLegacyKey">				  									
			        <xsl:copy-of select="l7:Count"/>
			        <xsl:copy-of select="l7:CacheItems"/>			        
			</xsl:element>
		</xsl:template>
		<xsl:template match="l7:AccountPlans">	
			<xsl:element name="l7:AccountPlans">				  									
			        <xsl:copy-of select="l7:Count"/>
			        <xsl:copy-of select="l7:CacheItems"/>			        
			</xsl:element>
		</xsl:template>			
</xsl:stylesheet>]]></L7p:Document>
                                    </L7p:ResourceInfo>
                                    <L7p:Target target="RESPONSE"/>
                                    <L7p:TransformName stringValue="format gateway stat"/>
                                </L7p:XslTransformation>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="fragmentResponse"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//GET"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="NTAw"/>
                                    <L7p:VariableToSet stringValue="errorCode"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="SW52YWxpZCBPcGVyYXRpb24="/>
                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//OTHERS"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//perform GatewayStat Functions"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="GatewayStat Functions"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:AuditDetailAssertion>
                            <L7p:Detail stringValue="Process response... ${errorCode}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// branch for GatewayStat"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="handleGatewayStat()"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${pman.resUri}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="/1/account/plans"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//flag if we need to perform a wsman update fragment policy"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:Base64Expression stringValue="ZmFsc2U="/>
                            <L7p:VariableToSet stringValue="refreshFlag"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="// do not change"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="Constant: "/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:Base64Expression stringValue="QWNjb3VudCBQbGFucyBGcmFnbWVudA=="/>
                            <L7p:VariableToSet stringValue="FRAGMENT_NAME"/>
                        </L7p:SetVariable>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5yZW1vdmVPbWl0dGVkfQ=="/>
                                    <L7p:VariableToSet stringValue="pman.options.removeOmitted"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${pman.resId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item stringLength="included">
                                                    <L7p:Max intValue="-1"/>
                                                    <L7p:Min intValue="1"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="DELETE"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="GET"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="LzEvYWNjb3VudC9wbGFucy8ke3BtYW4ucmVzSWR9"/>
                                            <L7p:VariableToSet stringValue="pman.resUri"/>
                                        </L7p:SetVariable>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//with PlanId ID parameter"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${pman.resId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item stringLength="included">
                                                    <L7p:Max intValue="-1"/>
                                                    <L7p:Min intValue="1"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="DELETE"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="GET"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="SW52YWxpZCBSZXF1ZXN0"/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//with PlanId ID parameter"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:FalseAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//continue to real operation"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                </L7p:FalseAssertion>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//pre-processing and validation"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="GET"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5zdGF0dXN9"/>
                                    <L7p:VariableToSet stringValue="pman.options.status"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${pman.resId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item stringLength="included">
                                                    <L7p:Max intValue="-1"/>
                                                    <L7p:Min intValue="1"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="LzEvYWNjb3VudC9wbGFucy8ke3BtYW4ucmVzSWR9"/>
                                            <L7p:VariableToSet stringValue="pman.resUri"/>
                                        </L7p:SetVariable>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//with PlanId ID parameter"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <L7p:TrueAssertion/>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//GET"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="PUT"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
                                    <L7p:VariableToSet stringValue="pman.resource"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                    <L7p:VariableToSet stringValue="refreshFlag"/>
                                </L7p:SetVariable>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lm1haW5wYXJ0fQ=="/>
                                        <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                        <L7p:DataType variableDataType="message"/>
                                        <L7p:VariableToSet stringValue="accountPlans"/>
                                    </L7p:SetVariable>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue=""/>
                                                <L7p:XmlMsgSrc stringValue="request"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="/l7:AccountPlans"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                        </wsp:All>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="NTAw"/>
                                                <L7p:VariableToSet stringValue="errorCode"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="SW52YWxpZCBYTUwgUmVxdWVzdA=="/>
                                                <L7p:VariableToSet stringValue="errorMsg"/>
                                            </L7p:SetVariable>
                                            <L7p:FalseAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//stop now - this wil short circuit the rest of the PUT section"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                            </L7p:FalseAssertion>
                                        </wsp:All>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//required"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//make sure it is a valid xml request"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${gateway.portal.accountplans.disableXSLTValidate}"/>
                                        <L7p:Expression2 stringValue="true"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item binary="included">
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:RightValue stringValue="true"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:AuditDetailAssertion>
                                            <L7p:Detail stringValue="Account Plans reload part 1 of 2 (validation) "/>
                                            <L7p:LoggingOnly booleanValue="true"/>
                                        </L7p:AuditDetailAssertion>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:XslTransformation>
                                                <L7p:Direction intValue="-1"/>

                                                <L7p:OtherTargetMessageVariable stringValue="accountPlans"/>
                                                <L7p:ResourceInfo staticResourceInfo="included">
                                                    <L7p:Document stringValueReference="inline"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:param name="gateway.time" select="'now'"/>
<xsl:param name="gateway.portal.useHalfAsync" select="'true'"/>
<xsl:output indent="yes" method="xml" omit-xml-declaration="yes"/>
<xsl:strip-space elements="*"/>		
<xsl:template match="/">
	<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
	    <wsp:All wsp:Usage="Required">
	        <L7p:AuditDetailAssertion>
	            <L7p:Detail stringValue="Policy Fragment: Account Plans Fragment"/>
	        </L7p:AuditDetailAssertion>
	        <L7p:CommentAssertion>
	            <L7p:Comment stringValue="// This fragment is auto generated by the gateway. DO NOT MODIFY"/>
	        </L7p:CommentAssertion>
	        <L7p:SetVariable>
	            <L7p:Base64Expression stringValue="JHthcGlLZXl9"/>
	            <L7p:VariableToSet stringValue="apiKey"/>
	        </L7p:SetVariable>
	        <L7p:SetVariable>
	            <L7p:Base64Expression stringValue="JHthY2NvdW50UGxhbk1hcHBpbmdJZH0="/>
	            <L7p:VariableToSet stringValue="accountPlanMappingId"/>
	        </L7p:SetVariable>
	        <L7p:SetVariable>
	            <L7p:Base64Expression stringValue="ZmFsc2U="/>
	            <L7p:VariableToSet stringValue="apiAuthz"/>
	        </L7p:SetVariable>
	        <L7p:SetVariable>
	            <L7p:Base64Expression stringValue="Tm90IFNldA=="/>
	            <L7p:VariableToSet stringValue="apiAuthzDetails"/>
	        </L7p:SetVariable>
	        <wsp:OneOrMore wsp:Usage="Required">
	            <xsl:apply-templates select="l7:AccountPlans/l7:AccountPlan[l7:DefaultPlan = 'false']"/>
	            <xsl:apply-templates select="l7:AccountPlans/l7:AccountPlan[l7:DefaultPlan = 'true']"/>
	            <!-- accountPlanMappingId not found [start] -->
		        <wsp:All wsp:Usage="Required">
		            <L7p:ComparisonAssertion>
		                <L7p:CaseSensitive booleanValue="false"/>			                
						<xsl:element name="L7p:Expression1">                            
						<xsl:attribute name="stringValue">&#36;{apiAuthzDetails}</xsl:attribute>
						</xsl:element>
		                <L7p:Operator operatorNull="null"/>
			            <L7p:Predicates predicates="included">
			                <L7p:item dataType="included">
			                    <L7p:Type variableDataType="string"/>
			                </L7p:item>
			                <L7p:item binary="included">
			                    <L7p:RightValue stringValue="Not Set"/>
			                </L7p:item>
			            </L7p:Predicates>
		            </L7p:ComparisonAssertion>
					<L7p:SetVariable>
			            <L7p:Base64Expression stringValue="ZmFsc2U="/>
			            <L7p:VariableToSet stringValue="apiAuthz"/>
			        </L7p:SetVariable>
			        <L7p:SetVariable>
            			<L7p:Base64Expression stringValue="JHthcGlLZXl9fCR7YWNjb3VudFBsYW5NYXBwaW5nSWR9IEFjY291bnRQbGFuTWFwcGluZ0lkIG5vdCBmb3VuZA=="/>
           				<L7p:VariableToSet stringValue="apiAuthzDetails"/>
       				</L7p:SetVariable>
				    <L7p:assertionComment>
		                <L7p:Properties mapValue="included">
		                    <L7p:entry>
		                        <L7p:key stringValue="RIGHT.COMMENT"/>
		                        <L7p:value stringValue="//accountPlanMappingId not found"/>
		                    </L7p:entry>
		                </L7p:Properties>
		            </L7p:assertionComment>
		        </wsp:All>
				<!-- accountPlanMappingId not found [end] -->         
	        </wsp:OneOrMore>
			<L7p:CommentAssertion>
				<xsl:element name="L7p:Comment">                            
					<xsl:attribute name="stringValue">Updated on <xsl:value-of select="$gateway.time"/></xsl:attribute>
				</xsl:element>
        	</L7p:CommentAssertion>
	        <L7p:ExportVariables>
	            <L7p:ExportedVars stringArrayValue="included">
	                <L7p:item stringValue="apiAuthz"/>
	                <L7p:item stringValue="apiAuthzDetails"/>
	            </L7p:ExportedVars>
	        </L7p:ExportVariables>
	    </wsp:All>
	</wsp:Policy>
</xsl:template>

<xsl:template match="l7:AccountPlan">
	<wsp:All wsp:Usage="Required">
	    <L7p:ComparisonAssertion>
	        <L7p:CaseSensitive booleanValue="false"/>
	        <xsl:element name="L7p:Expression1">                            
				<xsl:attribute name="stringValue">&#36;{accountPlanMappingId}</xsl:attribute>
			</xsl:element>
			<L7p:Operator operatorNull="null"/>
			<L7p:Predicates predicates="included">
                <L7p:item dataType="included">
                    <L7p:Type variableDataType="string"/>
                </L7p:item>
                <L7p:item binary="included">
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Negated booleanValue="true"/>
                    <L7p:Operator operator="EMPTY"/>
                    <L7p:RightValue stringValue=""/>
                </L7p:item>
            </L7p:Predicates>	      
	    </L7p:ComparisonAssertion>				
	    <L7p:ComparisonAssertion>
	        <L7p:CaseSensitive booleanValue="false"/>		            
			<xsl:element name="L7p:Expression1">                            
				<xsl:attribute name="stringValue">&#36;{apiAuthzDetails}</xsl:attribute>
			</xsl:element>
	         <L7p:Operator operatorNull="null"/>
            <L7p:Predicates predicates="included">
                <L7p:item dataType="included">
                    <L7p:Type variableDataType="string"/>
                </L7p:item>
                <L7p:item binary="included">
                    <L7p:RightValue stringValue="Not Set"/>
                </L7p:item>
            </L7p:Predicates>
	    </L7p:ComparisonAssertion>
	    <wsp:OneOrMore wsp:Usage="Required">
			<xsl:choose>
			    <xsl:when test="l7:DefaultPlan/text() = 'true'"><L7p:TrueAssertion/></xsl:when>
				<xsl:when test="not(l7:PlanMapping/l7:Id)"><L7p:FalseAssertion/></xsl:when>
				<xsl:otherwise><xsl:apply-templates/></xsl:otherwise>
			</xsl:choose>								
	    </wsp:OneOrMore>
	    <wsp:OneOrMore wsp:Usage="Required">
	        <wsp:All wsp:Usage="Required">
	             <L7p:SetVariable>
            		<L7p:Base64Expression stringValue="JHthcGlBdXRoekRldGFpbHN9fCR7YXBpS2V5fXwke2FjY291bnRQbGFuTWFwcGluZ0lkfXxxdW90YT8="/>
           			<L7p:VariableToSet stringValue="apiAuthzDetails"/>
       			 </L7p:SetVariable>
				 <L7p:SetVariable>                
				<xsl:element name="L7p:Expression">                            
					<xsl:attribute name="stringValue">
						<xsl:choose>
							<xsl:when test="l7:PlanDetails/l7:ThroughputQuota/l7:Quota=''">100000</xsl:when>
							<xsl:otherwise><xsl:value-of select="l7:PlanDetails/l7:ThroughputQuota/l7:Quota"/></xsl:otherwise>
						</xsl:choose>
					</xsl:attribute>
					</xsl:element> 
                <L7p:VariableToSet stringValue="quota"/>
                </L7p:SetVariable>
				<xsl:variable name="param.throughputQuotaName">
				<xsl:choose>
				 <xsl:when test="$gateway.portal.useHalfAsync='true'">
					<xsl:value-of select="'L7p:HalfAsyncThroughputQuota'"/>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="'L7p:ThroughputQuota'"/>
				</xsl:otherwise>
				</xsl:choose>
				</xsl:variable>
			    <xsl:element name="{$param.throughputQuotaName}">
					<xsl:element name="L7p:CounterName">                            
					<xsl:attribute name="stringValue">&#36;{accountPlanMappingId}</xsl:attribute>
					</xsl:element>
					<xsl:if test="l7:PlanDetails/l7:ThroughputQuota/@l7:enabled='false'">
					<L7p:Enabled booleanValue="false"/>
					</xsl:if>
	                <L7p:Global booleanValue="true"/>                            
					<xsl:element name="L7p:Quota">                            
					<xsl:attribute name="stringValue">&#36;{quota}</xsl:attribute>
					</xsl:element>
					<xsl:element name="L7p:TimeUnit">                            
					<xsl:attribute name="intValue">
						<xsl:choose>
							<xsl:when test="l7:PlanDetails/l7:ThroughputQuota/l7:TimeUnit=''">4</xsl:when>
							<xsl:otherwise><xsl:value-of select="l7:PlanDetails/l7:ThroughputQuota/l7:TimeUnit"/></xsl:otherwise>
						</xsl:choose>
					</xsl:attribute>
					</xsl:element> 
					<xsl:element name="L7p:CounterStrategy">                            
					<xsl:attribute name="intValue"><xsl:value-of select="l7:PlanDetails/l7:ThroughputQuota/l7:CounterStrategy"/></xsl:attribute>
					</xsl:element>                             
	            </xsl:element> 
	            <L7p:SetVariable>
	                <L7p:Base64Expression stringValue="JHthcGlBdXRoekRldGFpbHN9b2t8cmF0ZT8="/>
	                <L7p:VariableToSet stringValue="apiAuthzDetails"/>
	            </L7p:SetVariable>
	            <L7p:SetVariable>
	                <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
	                <L7p:VariableToSet stringValue="apiAuthz"/>
	            </L7p:SetVariable>
	        </wsp:All>
	        <wsp:All wsp:Usage="Required">
	            <L7p:SetVariable>
	                <L7p:Base64Expression stringValue="JHthcGlBdXRoekRldGFpbHN9ZmFpbGVk"/>
	                <L7p:VariableToSet stringValue="apiAuthzDetails"/>
	            </L7p:SetVariable>
	        </wsp:All>
	    </wsp:OneOrMore>
	    <L7p:assertionComment>
	        <L7p:Properties mapValue="included">
	            <L7p:entry>
	                <L7p:key stringValue="RIGHT.COMMENT"/>                            
					<xsl:element name="L7p:value">                            
					<xsl:attribute name="stringValue"><xsl:value-of select="l7:PlanName"/>:<xsl:value-of select="l7:PlanId"/><xsl:if test="l7:DefaultPlan='true'">(Default)</xsl:if></xsl:attribute>
					</xsl:element>
	            </L7p:entry>
	        </L7p:Properties>
	    </L7p:assertionComment>
	</wsp:All>
</xsl:template>

<xsl:template match="l7:PlanId">
</xsl:template>
<xsl:template match="l7:PlanName">
</xsl:template>
<xsl:template match="l7:DefaultPlan">
</xsl:template>
<xsl:template match="l7:PlanDetails">
</xsl:template>

<xsl:template match="l7:PlanMapping">    
        <wsp:All wsp:Usage="Required">
            <L7p:SetVariable>
				<!--
                <L7p:Expression stringValue="10,20,30"/>
				-->
				<xsl:element name="L7p:Expression">                            
				<xsl:attribute name="stringValue">
				<xsl:apply-templates/>
				</xsl:attribute>
				</xsl:element>
                <L7p:VariableToSet stringValue="orgIds"/>
            </L7p:SetVariable>
            <L7p:Split>
			    <L7p:IgnoreEmptyValues booleanValue="true"/>
                <L7p:InputVariable stringValue="orgIds"/>
                <L7p:OutputVariable stringValue="orgIdsSplit"/>
            </L7p:Split>
            <L7p:IndexLookupByItem>
                <L7p:MultivaluedVariableName stringValue="orgIdsSplit"/>
                <L7p:OutputVariableName stringValue="matchIndex"/>
                <L7p:ValueToSearchForVariableName stringValue="accountPlanMappingId"/>
            </L7p:IndexLookupByItem>
        </wsp:All>    	
</xsl:template>

<xsl:template match="l7:Id"><xsl:value-of select="text()"/>,</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                                </L7p:ResourceInfo>
                                                <L7p:Target target="OTHER"/>
                                                <L7p:TransformName stringValue=""/>
                                            </L7p:XslTransformation>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//validate through XSL transform"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLnJlc291cmNlfQ=="/>
                                                <L7p:VariableToSet stringValue="pman.resource.orig"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLm9wZXJhdGlvbn0="/>
                                                <L7p:VariableToSet stringValue="pman.operation.orig"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLnJlc1VyaX0="/>
                                                <L7p:VariableToSet stringValue="pman.resUri.orig"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHthY2NvdW50UGxhbnMubWFpbnBhcnR9"/>
                                                <L7p:VariableToSet stringValue="pman.resource"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBvcnRhbC5hY2NvdW50LnBsYW5zLmZyYWdtZW50Lmd1aWR9"/>
                                                <L7p:VariableToSet stringValue="pman.options.policyGUID"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="LzEvcG9saWN5L3ZhbGlkYXRl"/>
                                                <L7p:VariableToSet stringValue="pman.resUri"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="UFVU"/>
                                                <L7p:VariableToSet stringValue="pman.operation"/>
                                            </L7p:SetVariable>
                                            <L7p:ManagePortalResource/>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLnJlc291cmNlLm9yaWd9"/>
                                                <L7p:VariableToSet stringValue="pman.resource"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLm9wZXJhdGlvbi5vcmlnfQ=="/>
                                                <L7p:VariableToSet stringValue="pman.operation"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLnJlc1VyaS5vcmlnfQ=="/>
                                                <L7p:VariableToSet stringValue="pman.resUri"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//validate policy through assertion"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="RmFpbGVkIEZyYWdtZW50IFZhbGlkYXRpb246ICR7cG1hbi5yZXNwLmRldGFpbH0="/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//validate updated plan through transform to policy"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//PUT, Updates"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${pman.operation}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="DELETE"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${pman.resId}"/>
                                    <L7p:Expression2 stringValue=""/>
                                    <L7p:Negate booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item binary="included">
                                            <L7p:Negated booleanValue="true"/>
                                            <L7p:Operator operator="EMPTY"/>
                                            <L7p:RightValue stringValue=""/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                    <L7p:VariableToSet stringValue="refreshFlag"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//DELETE, Delete Account Plan (single res &amp; existing)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//skip if there is already an error"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="NTAw"/>
                                    <L7p:VariableToSet stringValue="errorCode"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="SW52YWxpZCBPcGVyYXRpb24="/>
                                    <L7p:VariableToSet stringValue="errorMsg"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="//OTHERS"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//perform AccountPlans Functions"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="AccountPlans Functions"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:AuditDetailAssertion>
                            <L7p:Detail stringValue="Process response... ${errorCode}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${errorCode}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                        <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                        <L7p:Negated booleanValue="true"/>
                                        <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="reason.fault"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ManagePortalResource/>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="response"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:AccountPlans/l7:AccountPlan"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                                    <L7p:DataType variableDataType="message"/>
                                                    <L7p:VariableToSet stringValue="response"/>
                                                </L7p:SetVariable>
                                                <L7p:ResponseXpathAssertion>
                                                    <L7p:VariablePrefix stringValue=""/>
                                                    <L7p:XpathExpression xpathExpressionValue="included">
                                                        <L7p:Expression stringValue="/l7:AccountPlan"/>
                                                        <L7p:Namespaces mapValue="included">
                                                            <L7p:entry>
                                                                <L7p:key stringValue="s"/>

                                                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                            </L7p:entry>
                                                            <L7p:entry>
                                                                <L7p:key stringValue="l7"/>

                                                                <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                                            </L7p:entry>
                                                        </L7p:Namespaces>
                                                    </L7p:XpathExpression>
                                                </L7p:ResponseXpathAssertion>
                                            </wsp:All>
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:SetVariable>

                                                    <L7p:Base64Expression stringValue="PGw3OkFjY291bnRQbGFucyB4bWxuczpsNz0iaHR0cDovL25zLmw3dGVjaC5jb20vMjAxMi8wNC9hcGktbWFuYWdlbWVudCI+DQo8L2w3OkFjY291bnRQbGFucz4="/>
                                                    <L7p:VariableToSet stringValue="pman.resp.resource"/>
                                                </L7p:SetVariable>
                                            </wsp:All>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//pman.resp.resource must be a valid xml"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="response"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3Auc3RhdHVzfQ=="/>
                                            <L7p:VariableToSet stringValue="responseStatus"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AuZGV0YWlsfQ=="/>
                                            <L7p:VariableToSet stringValue="responseDetail"/>
                                        </L7p:SetVariable>
                                        <L7p:XslTransformation>
                                            <L7p:Direction intValue="2"/>
                                            <L7p:ResourceInfo staticResourceInfo="included">
                                                <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:param name="pman.operation" select="'GET'"/>
<xsl:param name="pman.resUri" select="'/v1/apis'"/>
<xsl:param name="pman.resId" select="''"/>
<xsl:param name="gateway.time" select="'2012-05-16T21:16:53.133Z'"/>
<xsl:param name="pman.resp.status" select="'500'"/>
<xsl:param name="pman.resp.detail" select="'internal service failure'"/>
<xsl:output indent="yes" method="xml" omit-xml-declaration="yes"/>
<xsl:strip-space elements="*"/>		
        <xsl:template match="/">
		<l7:AccountPlans>
		   <!-- Common response elements -->		   
		   <l7:Method><xsl:value-of select="$pman.operation"/></l7:Method>
		   <l7:Resource><xsl:value-of select="$pman.resUri"/></l7:Resource>
		   <l7:ResourceId><xsl:value-of select="$pman.resId"/></l7:ResourceId>
		   <l7:Timestamp><xsl:value-of select="$gateway.time"/></l7:Timestamp>
		   <l7:Status><xsl:value-of select="$pman.resp.status"/></l7:Status>
		   <l7:Details><xsl:value-of select="$pman.resp.detail"/></l7:Details>
		   <!-- Resource payload -->
			<xsl:apply-templates/>
		</l7:AccountPlans>	  
	 	</xsl:template>
		<xsl:template match="l7:AccountPlan">
			<xsl:element name="l7:AccountPlan">				  									
			        <xsl:copy-of select="l7:PlanId"/>
			        <xsl:copy-of select="l7:PlanName"/>
			        <xsl:copy-of select="l7:LastUpdated"/>
			        <xsl:copy-of select="l7:DefaultPlan"/>
			        <xsl:copy-of select="l7:PlanDetails"/>
			        <xsl:copy-of select="l7:PlanMapping"/>
			        <xsl:copy-of select="l7:PlanPolicy"/>
			</xsl:element>
		</xsl:template>			
</xsl:stylesheet>]]></L7p:Document>
                                            </L7p:ResourceInfo>
                                            <L7p:Target target="RESPONSE"/>
                                            <L7p:TransformName stringValue="format account plans"/>
                                        </L7p:XslTransformation>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="fragmentResponse"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//skip if there is already an error"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${errorCode}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="RXJyb3IgcGVyZm9ybWluZyBvcGVyYXRpb24="/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//perform &amp; process Manage Portal Assertion response"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                        <L7p:Expression2 stringValue="200"/>
                                        <L7p:Negate booleanValue="true"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item binary="included">
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:RightValue stringValue="200"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${errorCode}"/>
                                        <L7p:Operator operatorNull="null"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item dataType="included">
                                                <L7p:Type variableDataType="string"/>
                                            </L7p:item>
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:RightValue stringValue="0"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:ComparisonAssertion>
                                        <L7p:Expression1 stringValue="${refreshFlag}"/>
                                        <L7p:Expression2 stringValue="true"/>
                                        <L7p:Negate booleanValue="true"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:RightValue stringValue="true"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:AuditDetailAssertion>
                                            <L7p:Detail stringValue="Account Plans reload part 2 of 2 (full reload/updating) "/>
                                            <L7p:LoggingOnly booleanValue="true"/>
                                        </L7p:AuditDetailAssertion>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="DELETE"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${pman.operation}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="PUT"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//we only need to update if the last operation was a DELETE or PUT (updates)"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//last operation should have been successful as well before we proceed"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                            <L7p:Expression2 stringValue="200"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="200"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc1VyaX0="/>
                                            <L7p:VariableToSet stringValue="pman.resUri.orig"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLm9wZXJhdGlvbn0="/>
                                            <L7p:VariableToSet stringValue="pman.operation.orig"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//query all API Plans for processing"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:Base64Expression stringValue="LzEvYWNjb3VudC9wbGFucw=="/>
                                            <L7p:VariableToSet stringValue="pman.resUri"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="R0VU"/>
                                            <L7p:VariableToSet stringValue="pman.operation"/>
                                        </L7p:SetVariable>
                                        <L7p:ManagePortalResource/>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtwbWFuLnJlc3AucmVzb3VyY2V9"/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="accountPlans"/>
                                        </L7p:SetVariable>
                                        <L7p:XslTransformation>
                                            <L7p:Direction intValue="-1"/>

                                            <L7p:OtherTargetMessageVariable stringValue="accountPlans"/>
                                            <L7p:ResourceInfo staticResourceInfo="included">
                                                <L7p:Document stringValueReference="inline"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:l7="http://ns.l7tech.com/2012/04/api-management" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:param name="gateway.time" select="'now'"/>
<xsl:param name="gateway.portal.useHalfAsync" select="'true'"/>
<xsl:output indent="yes" method="xml" omit-xml-declaration="yes"/>
<xsl:strip-space elements="*"/>		
<xsl:template match="/">
	<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
	    <wsp:All wsp:Usage="Required">
	        <L7p:AuditDetailAssertion>
	            <L7p:Detail stringValue="Policy Fragment: Account Plans Fragment"/>
	        </L7p:AuditDetailAssertion>
	        <L7p:CommentAssertion>
	            <L7p:Comment stringValue="// This fragment is auto generated by the gateway. DO NOT MODIFY"/>
	        </L7p:CommentAssertion>
	        <L7p:SetVariable>
	            <L7p:Base64Expression stringValue="JHthcGlLZXl9"/>
	            <L7p:VariableToSet stringValue="apiKey"/>
	        </L7p:SetVariable>
	        <L7p:SetVariable>
	            <L7p:Base64Expression stringValue="JHthY2NvdW50UGxhbk1hcHBpbmdJZH0="/>
	            <L7p:VariableToSet stringValue="accountPlanMappingId"/>
	        </L7p:SetVariable>
	        <L7p:SetVariable>
	            <L7p:Base64Expression stringValue="ZmFsc2U="/>
	            <L7p:VariableToSet stringValue="apiAuthz"/>
	        </L7p:SetVariable>
	        <L7p:SetVariable>
	            <L7p:Base64Expression stringValue="Tm90IFNldA=="/>
	            <L7p:VariableToSet stringValue="apiAuthzDetails"/>
	        </L7p:SetVariable>
	        <wsp:OneOrMore wsp:Usage="Required">
	            <xsl:apply-templates select="l7:AccountPlans/l7:AccountPlan[l7:DefaultPlan = 'false']"/>
	            <xsl:apply-templates select="l7:AccountPlans/l7:AccountPlan[l7:DefaultPlan = 'true']"/>
	            <!-- accountPlanMappingId not found [start] -->
		        <wsp:All wsp:Usage="Required">
		            <L7p:ComparisonAssertion>
		                <L7p:CaseSensitive booleanValue="false"/>			                
						<xsl:element name="L7p:Expression1">                            
						<xsl:attribute name="stringValue">&#36;{apiAuthzDetails}</xsl:attribute>
						</xsl:element>
		                <L7p:Operator operatorNull="null"/>
			            <L7p:Predicates predicates="included">
			                <L7p:item dataType="included">
			                    <L7p:Type variableDataType="string"/>
			                </L7p:item>
			                <L7p:item binary="included">
			                    <L7p:RightValue stringValue="Not Set"/>
			                </L7p:item>
			            </L7p:Predicates>
		            </L7p:ComparisonAssertion>
					<L7p:SetVariable>
			            <L7p:Base64Expression stringValue="ZmFsc2U="/>
			            <L7p:VariableToSet stringValue="apiAuthz"/>
			        </L7p:SetVariable>
			        <L7p:SetVariable>
            			<L7p:Base64Expression stringValue="JHthcGlLZXl9fCR7YWNjb3VudFBsYW5NYXBwaW5nSWR9IEFjY291bnRQbGFuTWFwcGluZ0lkIG5vdCBmb3VuZA=="/>
           				<L7p:VariableToSet stringValue="apiAuthzDetails"/>
       				</L7p:SetVariable>
				    <L7p:assertionComment>
		                <L7p:Properties mapValue="included">
		                    <L7p:entry>
		                        <L7p:key stringValue="RIGHT.COMMENT"/>
		                        <L7p:value stringValue="//accountPlanMappingId not found"/>
		                    </L7p:entry>
		                </L7p:Properties>
		            </L7p:assertionComment>
		        </wsp:All>
				<!-- accountPlanMappingId not found [end] -->         
	        </wsp:OneOrMore>
			<L7p:CommentAssertion>
				<xsl:element name="L7p:Comment">                            
					<xsl:attribute name="stringValue">Updated on <xsl:value-of select="$gateway.time"/></xsl:attribute>
				</xsl:element>
        	</L7p:CommentAssertion>
	        <L7p:ExportVariables>
	            <L7p:ExportedVars stringArrayValue="included">
	                <L7p:item stringValue="apiAuthz"/>
	                <L7p:item stringValue="apiAuthzDetails"/>
	            </L7p:ExportedVars>
	        </L7p:ExportVariables>
	    </wsp:All>
	</wsp:Policy>
</xsl:template>

<xsl:template match="l7:AccountPlan">
	<wsp:All wsp:Usage="Required">
	    <L7p:ComparisonAssertion>
	        <L7p:CaseSensitive booleanValue="false"/>
	        <xsl:element name="L7p:Expression1">                            
				<xsl:attribute name="stringValue">&#36;{accountPlanMappingId}</xsl:attribute>
			</xsl:element>
			<L7p:Operator operatorNull="null"/>
			<L7p:Predicates predicates="included">
                <L7p:item dataType="included">
                    <L7p:Type variableDataType="string"/>
                </L7p:item>
                <L7p:item binary="included">
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Negated booleanValue="true"/>
                    <L7p:Operator operator="EMPTY"/>
                    <L7p:RightValue stringValue=""/>
                </L7p:item>
            </L7p:Predicates>	      
	    </L7p:ComparisonAssertion>				
	    <L7p:ComparisonAssertion>
	        <L7p:CaseSensitive booleanValue="false"/>		            
			<xsl:element name="L7p:Expression1">                            
				<xsl:attribute name="stringValue">&#36;{apiAuthzDetails}</xsl:attribute>
			</xsl:element>
	         <L7p:Operator operatorNull="null"/>
            <L7p:Predicates predicates="included">
                <L7p:item dataType="included">
                    <L7p:Type variableDataType="string"/>
                </L7p:item>
                <L7p:item binary="included">
                    <L7p:RightValue stringValue="Not Set"/>
                </L7p:item>
            </L7p:Predicates>
	    </L7p:ComparisonAssertion>
	    <wsp:OneOrMore wsp:Usage="Required">
			<xsl:choose>
			    <xsl:when test="l7:DefaultPlan/text() = 'true'"><L7p:TrueAssertion/></xsl:when>
				<xsl:when test="not(l7:PlanMapping/l7:Id)"><L7p:FalseAssertion/></xsl:when>
				<xsl:otherwise><xsl:apply-templates/></xsl:otherwise>
			</xsl:choose>								
	    </wsp:OneOrMore>
	    <wsp:OneOrMore wsp:Usage="Required">
	        <wsp:All wsp:Usage="Required">
	             <L7p:SetVariable>
            		<L7p:Base64Expression stringValue="JHthcGlBdXRoekRldGFpbHN9fCR7YXBpS2V5fXwke2FjY291bnRQbGFuTWFwcGluZ0lkfXxxdW90YT8="/>
           			<L7p:VariableToSet stringValue="apiAuthzDetails"/>
       			 </L7p:SetVariable>
				 <L7p:SetVariable>                
				<xsl:element name="L7p:Expression">                            
					<xsl:attribute name="stringValue">
						<xsl:choose>
							<xsl:when test="l7:PlanDetails/l7:ThroughputQuota/l7:Quota=''">100000</xsl:when>
							<xsl:otherwise><xsl:value-of select="l7:PlanDetails/l7:ThroughputQuota/l7:Quota"/></xsl:otherwise>
						</xsl:choose>
					</xsl:attribute>
					</xsl:element> 
                <L7p:VariableToSet stringValue="quota"/>
                </L7p:SetVariable>
				<xsl:variable name="param.throughputQuotaName">
				<xsl:choose>
				 <xsl:when test="$gateway.portal.useHalfAsync='true'">
					<xsl:value-of select="'L7p:HalfAsyncThroughputQuota'"/>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="'L7p:ThroughputQuota'"/>
				</xsl:otherwise>
				</xsl:choose>
				</xsl:variable>
			    <xsl:element name="{$param.throughputQuotaName}">
					<xsl:element name="L7p:CounterName">                            
					<xsl:attribute name="stringValue">&#36;{accountPlanMappingId}</xsl:attribute>
					</xsl:element>
					<xsl:if test="l7:PlanDetails/l7:ThroughputQuota/@l7:enabled='false'">
					<L7p:Enabled booleanValue="false"/>
					</xsl:if>
	                <L7p:Global booleanValue="true"/>                            
					<xsl:element name="L7p:Quota">                            
					<xsl:attribute name="stringValue">&#36;{quota}</xsl:attribute>
					</xsl:element>
					<xsl:element name="L7p:TimeUnit">                            
					<xsl:attribute name="intValue">
						<xsl:choose>
							<xsl:when test="l7:PlanDetails/l7:ThroughputQuota/l7:TimeUnit=''">4</xsl:when>
							<xsl:otherwise><xsl:value-of select="l7:PlanDetails/l7:ThroughputQuota/l7:TimeUnit"/></xsl:otherwise>
						</xsl:choose>
					</xsl:attribute>
					</xsl:element> 
					<xsl:element name="L7p:CounterStrategy">                            
					<xsl:attribute name="intValue"><xsl:value-of select="l7:PlanDetails/l7:ThroughputQuota/l7:CounterStrategy"/></xsl:attribute>
					</xsl:element>                             
	            </xsl:element> 
	            <L7p:SetVariable>
	                <L7p:Base64Expression stringValue="JHthcGlBdXRoekRldGFpbHN9b2t8cmF0ZT8="/>
	                <L7p:VariableToSet stringValue="apiAuthzDetails"/>
	            </L7p:SetVariable>
	            <L7p:SetVariable>
	                <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
	                <L7p:VariableToSet stringValue="apiAuthz"/>
	            </L7p:SetVariable>
	        </wsp:All>
	        <wsp:All wsp:Usage="Required">
	            <L7p:SetVariable>
	                <L7p:Base64Expression stringValue="JHthcGlBdXRoekRldGFpbHN9ZmFpbGVk"/>
	                <L7p:VariableToSet stringValue="apiAuthzDetails"/>
	            </L7p:SetVariable>
	        </wsp:All>
	    </wsp:OneOrMore>
	    <L7p:assertionComment>
	        <L7p:Properties mapValue="included">
	            <L7p:entry>
	                <L7p:key stringValue="RIGHT.COMMENT"/>                            
					<xsl:element name="L7p:value">                            
					<xsl:attribute name="stringValue"><xsl:value-of select="l7:PlanName"/>:<xsl:value-of select="l7:PlanId"/><xsl:if test="l7:DefaultPlan='true'">(Default)</xsl:if></xsl:attribute>
					</xsl:element>
	            </L7p:entry>
	        </L7p:Properties>
	    </L7p:assertionComment>
	</wsp:All>
</xsl:template>

<xsl:template match="l7:PlanId">
</xsl:template>
<xsl:template match="l7:PlanName">
</xsl:template>
<xsl:template match="l7:DefaultPlan">
</xsl:template>
<xsl:template match="l7:PlanDetails">
</xsl:template>

<xsl:template match="l7:PlanMapping">    
        <wsp:All wsp:Usage="Required">
            <L7p:SetVariable>
				<!--
                <L7p:Expression stringValue="10,20,30"/>
				-->
				<xsl:element name="L7p:Expression">                            
				<xsl:attribute name="stringValue">
				<xsl:apply-templates/>
				</xsl:attribute>
				</xsl:element>
                <L7p:VariableToSet stringValue="orgIds"/>
            </L7p:SetVariable>
            <L7p:Split>
			    <L7p:IgnoreEmptyValues booleanValue="true"/>
                <L7p:InputVariable stringValue="orgIds"/>
                <L7p:OutputVariable stringValue="orgIdsSplit"/>
            </L7p:Split>
            <L7p:IndexLookupByItem>
                <L7p:MultivaluedVariableName stringValue="orgIdsSplit"/>
                <L7p:OutputVariableName stringValue="matchIndex"/>
                <L7p:ValueToSearchForVariableName stringValue="accountPlanMappingId"/>
            </L7p:IndexLookupByItem>
        </wsp:All>    	
</xsl:template>

<xsl:template match="l7:Id"><xsl:value-of select="text()"/>,</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                            </L7p:ResourceInfo>
                                            <L7p:Target target="OTHER"/>
                                            <L7p:TransformName stringValue=""/>
                                        </L7p:XslTransformation>
                                        <L7p:SetVariable>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// successful errorCode"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:Base64Expression stringValue="MA=="/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ComparisonAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//last operation should have been successful as well before we proceed"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                                <L7p:Expression2 stringValue="200"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item binary="included">
                                                        <L7p:RightValue stringValue="200"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHthY2NvdW50UGxhbnMubWFpbnBhcnR9"/>
                                                <L7p:VariableToSet stringValue="pman.resource"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBvcnRhbC5hY2NvdW50LnBsYW5zLmZyYWdtZW50Lmd1aWR9"/>
                                                <L7p:VariableToSet stringValue="pman.options.policyGUID"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLnJlc1VyaX0="/>
                                                <L7p:VariableToSet stringValue="pman.resUri.orig"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtwbWFuLm9wZXJhdGlvbn0="/>
                                                <L7p:VariableToSet stringValue="pman.operation.orig"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="//query all API Plans for processing"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:Base64Expression stringValue="LzEvcG9saWN5L3VwZGF0ZQ=="/>
                                                <L7p:VariableToSet stringValue="pman.resUri"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="UFVU"/>
                                                <L7p:VariableToSet stringValue="pman.operation"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBvcnRhbC5hY2NvdW50cGxhbnMuZGlzYWJsZVhTTFRWYWxpZGF0ZX0="/>
                                                <L7p:VariableToSet stringValue="pman.options.disableValidate"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBvcnRhbC5hY2NvdW50cGxhbnMuZW5hYmxlQXN5bmNGb3JGcmFnbWVudFVwZGF0ZX0="/>
                                                <L7p:VariableToSet stringValue="pman.options.enableAsyncForFragmentUpdate"/>
                                            </L7p:SetVariable>
                                            <L7p:ManagePortalResource/>
                                            <L7p:SetVariable>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="// successful errorCode"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:Base64Expression stringValue="MA=="/>
                                                <L7p:VariableToSet stringValue="errorCode"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// Update API Plans policy fragment"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                                        <L7p:value stringValue="updatePolicyFragment()"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:All>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="//we must reload all the account plans and rebuild the Account Plans Fragment"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//skip if there is already an error"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${errorCode}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:Expression1 stringValue="${pman.resp.status}"/>
                                            <L7p:Expression2 stringValue="404"/>
                                            <L7p:Negate booleanValue="true"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:RightValue stringValue="404"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="RXJyb3IgdXBkYXRpbmcgZnJhZ21lbnQ6ICR7RlJBR01FTlRfTkFNRX0="/>
                                            <L7p:VariableToSet stringValue="errorMsg"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="//perform Account Plans Fragment reload"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="processResponse()"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="//Result &amp; post-processing"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// branch for Account Plans"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="handleAccountPlans()"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="// internal failure errorCode"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:Base64Expression stringValue="NTAw"/>
                            <L7p:VariableToSet stringValue="errorCode"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="VW5rbm93biBvcGVyYXRpb24gKCR7cG1hbi5yZXNVcml9KQ=="/>
                            <L7p:VariableToSet stringValue="errorMsg"/>
                        </L7p:SetVariable>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// error branch, should not get here"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="error()"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// handlers branch"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// this is where the work begins"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <L7p:TrueAssertion/>
        </wsp:OneOrMore>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="Restore original request"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="//this makes sure we always have the original request"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0T3JpZ2luYWwubWFpbnBhcnR9"/>
            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
            <L7p:DataType variableDataType="message"/>
            <L7p:VariableToSet stringValue="request"/>
        </L7p:SetVariable>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${errorCode}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="0"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:HardcodedResponse>
                    <L7p:Base64ResponseBody stringValue="JHtmcmFnbWVudFJlc3BvbnNlLm1haW5wYXJ0fQ=="/>
                </L7p:HardcodedResponse>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// Return response"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="if (success path)"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[<Error>
  <Code>${errorCode}</Code>
  <Detail>${errorMsg}</Detail>
</Error>]]></L7p:Content>
                    <L7p:ContentType stringValue="text/xml; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="${errorCode}"/>
                </L7p:CustomizeErrorResponse>
                <L7p:FalseAssertion/>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// Return error, falsify policy"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="Else (error)"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="displayResult()"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>
