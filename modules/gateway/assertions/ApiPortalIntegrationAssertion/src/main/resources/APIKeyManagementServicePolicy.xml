<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:SslAssertion>
                    <L7p:RequireClientAuthentication booleanValue="true"/>
                </L7p:SslAssertion>
                <L7p:AuditDetailAssertion>
                    <L7p:Detail stringValue="username: ${request.username}"/>
                </L7p:AuditDetailAssertion>
                <L7p:Authentication>
                    <L7p:IdentityProviderOid longValue="-2"/>
                </L7p:Authentication>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SslAssertion/>
                <L7p:HttpBasic/>
                <L7p:AuditDetailAssertion>
                    <L7p:Detail stringValue="username: ${request.username}"/>
                </L7p:AuditDetailAssertion>
                <L7p:Authentication>
                    <L7p:IdentityProviderOid longValue="-2"/>
                </L7p:Authentication>
            </wsp:All>
        </wsp:OneOrMore>
        <L7p:AuditAssertion>
            <L7p:Level stringValue="INFO"/>
            <L7p:SaveRequest booleanValue="true"/>
        </L7p:AuditAssertion>
        <L7p:AuditDetailAssertion>
            <L7p:Detail stringValue="auth_user: ${request.authenticateduser}"/>
        </L7p:AuditDetailAssertion>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="L2dlbmVyYXRl"/>
            <L7p:VariableToSet stringValue="uri.generate"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="L3JlZ2lzdGVy"/>
            <L7p:VariableToSet stringValue="uri.register"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="L3VwZGF0ZQ=="/>
            <L7p:VariableToSet stringValue="uri.update"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="L2RlbGV0ZQ=="/>
            <L7p:VariableToSet stringValue="uri.delete"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="// successful errorCode"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue="MA=="/>
            <L7p:VariableToSet stringValue="errorCode"/>
        </L7p:SetVariable>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="// Setup debugging portion (only when enabled)"/>
        </L7p:CommentAssertion>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${request.http.parameter.debug}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="true"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:AssertionComment assertionComment="included">
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="-- (v2)"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:AssertionComment>
                    <L7p:Base64Expression stringValue="PCEtLSBkZWJ1ZyBibG9jayAtLT4NCiAgIDxsNzpEZWJ1ZyB4bWxuczpsNz0iaHR0cDovL25zLmw3dGVjaC5jb20vMjAxMS8wOC9wb3J0YWwtYXBpLWtleXMiPg0KICAgICAgPGw3Ok1ldGhvZD4ke3JlcXVlc3QuaHR0cC5tZXRob2R9PC9sNzpNZXRob2Q+DQogICAgICA8bDc6VXJpPiR7cmVxdWVzdC5odHRwLnVyaX08L2w3OlVyaT4NCiAgICAgIDxsNzpIdHRwSGVhZGVycz5yZXF1ZXN0Lmh0dHAuYWxsaGVhZGVydmFsdWVzPC9sNzpIdHRwSGVhZGVycz4NCiAgICAgIDxsNzpIdHRwUGFybXM+DQogICAgICAgIDxsNzpQYXJtIG5hbWU9ImFwaWtleSI+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX08L2w3OlBhcm0+DQogICAgICAgIDxsNzpQYXJtIG5hbWU9ImFwaWtleVNlY3JldCI+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleVNlY3JldH08L2w3OlBhcm0+DQogICAgICAgIDxsNzpQYXJtIG5hbWU9ImFwaWtleVN0YXR1cyI+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleVN0YXR1c308L2w3OlBhcm0+DQogICAgICAgIDxsNzpQYXJtIG5hbWU9ImFzc2lnbkFwaXMiPiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5hc3NpZ25BcGlzfTwvbDc6UGFybT4NCiAgICAgICAgPGw3OlBhcm0gbmFtZT0iZm9ybWF0Ij4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuZm9ybWF0fTwvbDc6UGFybT4NCiAgICAgICAgPGw3OlBhcm0gbmFtZT0iZGVidWciPiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5kZWJ1Z308L2w3OlBhcm0+DQogICAgICA8L2w3Okh0dHBQYXJtcz4NCiAgIDwvbDc6RGVidWc+"/>
                    <L7p:VariableToSet stringValue="debugBlock"/>
                </L7p:SetVariable>
            </wsp:All>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue=""/>
                <L7p:VariableToSet stringValue="debugBlock"/>
            </L7p:SetVariable>
        </wsp:OneOrMore>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.uri}"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:Operator operator="CONTAINS"/>
                                <L7p:RightValue stringValue="${uri.register}"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.uri}"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:Operator operator="CONTAINS"/>
                                <L7p:RightValue stringValue="${uri.update}"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.uri}"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:Operator operator="CONTAINS"/>
                                <L7p:RightValue stringValue="${uri.delete}"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                </wsp:OneOrMore>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAudXJpfQ=="/>
                    <L7p:VariableToSet stringValue="serviceOp"/>
                </L7p:SetVariable>
                <L7p:Regex>
                    <L7p:AutoTarget booleanValue="false"/>
                    <L7p:OtherTargetMessageVariable stringValue="serviceOp"/>
                    <L7p:Regex stringValue="\/api\/keys\/"/>
                    <L7p:RegexName stringValue="- strip out uri prefix (v2)"/>
                    <L7p:Replace booleanValue="true"/>
                    <L7p:Replacement stringValue=""/>
                    <L7p:Target target="OTHER"/>
                </L7p:Regex>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBvcnRhbC5tYW5hZ2VkLnNlcnZpY2VzfQ=="/>
                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="validServices"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX0="/>
                    <L7p:VariableToSet stringValue="apikey"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${serviceOp}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="register"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:HtmlFormDataAssertion>
                            <L7p:AllowGet booleanValue="true"/>
                            <L7p:AllowPost booleanValue="true"/>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="- required(apikey, apikeySecret, assignApis); optional(apikeyStatus, issuer, debug, format)"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:DisallowOtherFields booleanValue="true"/>
                            <L7p:FieldSpecs htmlFormFieldSpecArray="included">
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="accountPlanMappingId"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:MinOccurs intValue="1"/>
                                    <L7p:Name stringValue="apikey"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:MinOccurs intValue="1"/>
                                    <L7p:Name stringValue="apikeySecret"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="apikeyStatus"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="assignApis"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="callbackUrl"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="debug"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="format"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="issuer"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="label"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="oauthScope"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="oauthType"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="plan"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="platform"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="service"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="customMetaData"/>
                                </L7p:item>
                            </L7p:FieldSpecs>
                        </L7p:HtmlFormDataAssertion>
                        <wsp:All wsp:Usage="Required">
                            <L7p:LookupApiKey>
                                <L7p:ApiKey stringValue="${apikey}"/>
                                <L7p:ServiceId stringValue=""/>
                            </L7p:LookupApiKey>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Register Key - lookup:found=${apiKeyRecord.found}key=${apiKeyRecord.key}secret=${apiKeyRecord.secret}"/>
                            </L7p:AuditDetailAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${apiKeyRecord.found}"/>
                                        <L7p:Operator operatorNull="null"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item dataType="included">
                                                <L7p:Type variableDataType="string"/>
                                            </L7p:item>
                                            <L7p:item binary="included">
                                                <L7p:RightValue stringValue="true"/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="NTAw"/>
                                        <L7p:VariableToSet stringValue="errorCode"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="SW52YWxpZCBBUEkgS2V5IC0gRHVwbGljYXRlIGtleSBlcnJvciB8"/>
                                        <L7p:VariableToSet stringValue="errorMessage"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                                <L7p:TrueAssertion/>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// Error - duplicate key"/>
                                        </L7p:entry>
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="if (apikey already exists)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.apikeySecret}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:Negated booleanValue="true"/>
                                            <L7p:Operator operator="EMPTY"/>
                                            <L7p:RightValue stringValue=""/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="NTAw"/>
                                        <L7p:VariableToSet stringValue="errorCode"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtlcnJvck1lc3NhZ2V9IEludmFsaWQvTWlzc2luZyBTZWNyZXQgfA=="/>
                                        <L7p:VariableToSet stringValue="errorMessage"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// Error - missing api key secret"/>
                                        </L7p:entry>
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="if (apikeySecret not set)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${request.http.parameter.assignApis}"/>
                                        <L7p:Operator operatorNull="null"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item dataType="included">
                                                <L7p:Type variableDataType="string"/>
                                            </L7p:item>
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:Operator operator="EMPTY"/>
                                                <L7p:RightValue stringValue=""/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="PGw3OlMgaWQ9IiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5hc3NpZ25BcGlzfSIgLz4="/>
                                            <L7p:VariableToSet stringValue="apiMapping"/>
                                        </L7p:SetVariable>
                                        <L7p:Regex>
                                            <L7p:AutoTarget booleanValue="false"/>

                                            <L7p:OtherTargetMessageVariable stringValue="apiMapping"/>
                                            <L7p:Regex stringValue="\+\+"/>
                                            <L7p:Replace booleanValue="true"/>
                                            <L7p:Replacement stringValue="\&quot; />&lt;l7:S id=\&quot;"/>
                                            <L7p:Target target="OTHER"/>
                                        </L7p:Regex>
                                        <L7p:Regex>
                                            <L7p:AutoTarget booleanValue="false"/>

                                            <L7p:OtherTargetMessageVariable stringValue="apiMapping"/>
                                            <L7p:Regex stringValue="\;"/>
                                            <L7p:Replace booleanValue="true"/>
                                            <L7p:Replacement stringValue="\&quot; plan=\&quot;"/>
                                            <L7p:Target target="OTHER"/>
                                        </L7p:Regex>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="PGw3OlNlcnZpY2VzIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDExLzA4L3BvcnRhbC1hcGkta2V5cyI+DQoke2FwaU1hcHBpbmd9DQo8L2w3OlNlcnZpY2VzPg=="/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="mapValidation"/>
                                        </L7p:SetVariable>
                                        <L7p:AuditDetailAssertion>
                                            <L7p:Detail stringValue="update api map: ${mapValidation.mainpart}"/>
                                        </L7p:AuditDetailAssertion>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="// build &lt;l7:Services> block"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ResponseXpathAssertion>
                                            <L7p:AssertionComment assertionComment="included">
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="// find valid service list"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:AssertionComment>
                                            <L7p:VariablePrefix stringValue="validMapEntries"/>
                                            <L7p:XmlMsgSrc stringValue="mapValidation"/>
                                            <L7p:XpathExpression xpathExpressionValue="included">
                                                <L7p:Expression stringValue="/l7:Services/l7:S[string-length(./@id) > 0 and string-length(./@plan) > 0]"/>
                                                <L7p:Namespaces mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="s"/>
                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="l7"/>
                                                        <L7p:value stringValue="http://ns.l7tech.com/2011/08/portal-api-keys"/>
                                                    </L7p:entry>
                                                </L7p:Namespaces>
                                            </L7p:XpathExpression>
                                        </L7p:ResponseXpathAssertion>
                                        <L7p:AuditDetailAssertion>
                                            <L7p:Detail stringValue="Map entries: found=${validMapEntries.found} ; count=${validMapEntries.count}"/>
                                        </L7p:AuditDetailAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${validMapEntries.found}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="boolean"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:RightValue stringValue="true"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${validMapEntries.count}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="int"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Operator operator="GT"/>
                                                    <L7p:RightValue stringValue="0"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ResponseXpathAssertion>
                                            <L7p:VariablePrefix stringValue="mapIds"/>
                                            <L7p:XmlMsgSrc stringValue="mapValidation"/>
                                            <L7p:XpathExpression xpathExpressionValue="included">
                                                <L7p:Expression stringValue="/l7:Services/l7:S[string-length(./@id) > 0]/@id"/>
                                                <L7p:Namespaces mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="s"/>
                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="l7"/>
                                                        <L7p:value stringValue="http://ns.l7tech.com/2011/08/portal-api-keys"/>
                                                    </L7p:entry>
                                                </L7p:Namespaces>
                                            </L7p:XpathExpression>
                                        </L7p:ResponseXpathAssertion>
                                        <L7p:AuditDetailAssertion>
                                            <L7p:Detail stringValue="API Ids: found=${mapIds.found} ; count=${mapIds.count}"/>
                                        </L7p:AuditDetailAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${mapIds.count}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:RightValue stringValue="${validMapEntries.count}"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ResponseXpathAssertion>
                                            <L7p:VariablePrefix stringValue="mapPlans"/>
                                            <L7p:XmlMsgSrc stringValue="mapValidation"/>
                                            <L7p:XpathExpression xpathExpressionValue="included">
                                                <L7p:Expression stringValue="/l7:Services/l7:S[string-length(./@plan) > 0]/@plan"/>
                                                <L7p:Namespaces mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="s"/>
                                                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                    </L7p:entry>
                                                    <L7p:entry>
                                                        <L7p:key stringValue="l7"/>
                                                        <L7p:value stringValue="http://ns.l7tech.com/2011/08/portal-api-keys"/>
                                                    </L7p:entry>
                                                </L7p:Namespaces>
                                            </L7p:XpathExpression>
                                        </L7p:ResponseXpathAssertion>
                                        <L7p:AuditDetailAssertion>
                                            <L7p:Detail stringValue="Plans: found=${mapPlans.found} ; count=${mapPlans.count}"/>
                                        </L7p:AuditDetailAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${mapPlans.count}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:RightValue stringValue="${validMapEntries.count}"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="// validate the mapping"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                        <L7p:Detail stringValue="Bad assignApis parameter:${request.http.parameter.assignApis}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="NTAw"/>
                                        <L7p:VariableToSet stringValue="errorCode"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="JHtlcnJvck1lc3NhZ2V9IEludmFsaWQgQXNzaWduZWQgQVBJcyB8"/>
                                        <L7p:VariableToSet stringValue="errorMessage"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// Error - missing api-plan mapping"/>
                                        </L7p:entry>
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="if (assignApis not set)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="// Input parameters"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="Validate"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.label}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:EncodeDecode>
                                            <L7p:SourceVariableName stringValue="request.http.parameter.label"/>
                                            <L7p:TargetDataType variableDataType="string"/>
                                            <L7p:TargetVariableName stringValue="encodedLabel"/>
                                            <L7p:TransformType transformType="URL_ENCODE"/>
                                        </L7p:EncodeDecode>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue=""/>
                                        <L7p:VariableToSet stringValue="encodedLabel"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// urlEncoded"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="getLabel()"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.callbackUrl}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:EncodeDecode>
                                            <L7p:SourceVariableName stringValue="request.http.parameter.callbackUrl"/>
                                            <L7p:TargetDataType variableDataType="string"/>
                                            <L7p:TargetVariableName stringValue="encodedCallbackUrl"/>
                                            <L7p:TransformType transformType="URL_ENCODE"/>
                                        </L7p:EncodeDecode>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue=""/>
                                        <L7p:VariableToSet stringValue="encodedCallbackUrl"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// urlEncoded"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="getCallbackUrl()"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.oauthScope}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:EncodeDecode>
                                            <L7p:SourceVariableName stringValue="request.http.parameter.oauthScope"/>
                                            <L7p:TargetDataType variableDataType="string"/>
                                            <L7p:TargetVariableName stringValue="encodedScope"/>
                                            <L7p:TransformType transformType="URL_ENCODE"/>
                                        </L7p:EncodeDecode>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue=""/>
                                        <L7p:VariableToSet stringValue="encodedScope"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// oauthScope"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="getOAuthScope()"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.oauthType}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:EncodeDecode>
                                            <L7p:SourceVariableName stringValue="request.http.parameter.oauthType"/>
                                            <L7p:TargetDataType variableDataType="string"/>
                                            <L7p:TargetVariableName stringValue="encodedType"/>
                                            <L7p:TransformType transformType="URL_ENCODE"/>
                                        </L7p:EncodeDecode>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue=""/>
                                        <L7p:VariableToSet stringValue="encodedType"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// oauthType"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="getOAuthType()"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.platform}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:EncodeDecode>
                                            <L7p:SourceVariableName stringValue="request.http.parameter.platform"/>
                                            <L7p:TargetDataType variableDataType="string"/>
                                            <L7p:TargetVariableName stringValue="encodedPlatform"/>
                                            <L7p:TransformType transformType="URL_ENCODE"/>
                                        </L7p:EncodeDecode>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue=""/>
                                        <L7p:VariableToSet stringValue="encodedPlatform"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// platform"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="getPlatform()"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.accountPlanMappingId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:EncodeDecode>
                                            <L7p:SourceVariableName stringValue="request.http.parameter.accountPlanMappingId"/>
                                            <L7p:TargetDataType variableDataType="string"/>
                                            <L7p:TargetVariableName stringValue="encodedAccountPlanMappingId"/>
                                            <L7p:TransformType transformType="URL_ENCODE"/>
                                        </L7p:EncodeDecode>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue=""/>
                                        <L7p:VariableToSet stringValue="encodedAccountPlanMappingId"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// accountPlanMappingId"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="getAccountPlanMappingId()"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.customMetaData}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:EncodeDecode>
                                            <L7p:Enabled booleanValue="false"/>
                                            <L7p:SourceVariableName stringValue="request.http.parameter.customMetaData"/>
                                            <L7p:TargetDataType variableDataType="string"/>
                                            <L7p:TargetVariableName stringValue="encodedCustomMetaData"/>
                                            <L7p:TransformType transformType="URL_ENCODE"/>
                                        </L7p:EncodeDecode>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmN1c3RvbU1ldGFEYXRhfQ=="/>
                                            <L7p:VariableToSet stringValue="encodedCustomMetaData"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue=""/>
                                        <L7p:VariableToSet stringValue="encodedCustomMetaData"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// customMetaData"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="getCustomMetaData()"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="PGw3OlMgaWQ9IiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5hc3NpZ25BcGlzfSIgLz4="/>
                                        <L7p:VariableToSet stringValue="apiMapping"/>
                                    </L7p:SetVariable>
                                    <L7p:Regex>
                                        <L7p:AutoTarget booleanValue="false"/>
                                        <L7p:OtherTargetMessageVariable stringValue="apiMapping"/>
                                        <L7p:Regex stringValue="\+\+"/>
                                        <L7p:Replace booleanValue="true"/>
                                        <L7p:Replacement stringValue="\&quot; />&lt;l7:S id=\&quot;"/>
                                        <L7p:Target target="OTHER"/>
                                    </L7p:Regex>
                                    <L7p:Regex>
                                        <L7p:AutoTarget booleanValue="false"/>
                                        <L7p:OtherTargetMessageVariable stringValue="apiMapping"/>
                                        <L7p:Regex stringValue="\;"/>
                                        <L7p:Replace booleanValue="true"/>
                                        <L7p:Replacement stringValue="\&quot; plan=\&quot;"/>
                                        <L7p:Target target="OTHER"/>
                                    </L7p:Regex>
                                    <L7p:CommentAssertion>
                                        <L7p:Comment stringValue="// missing validation logic - TBD"/>
                                    </L7p:CommentAssertion>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// build &lt;l7:Services> block"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGw3OkFwaUtleSB4bWxuczpsNz0iaHR0cDovL25zLmw3dGVjaC5jb20vMjAxMS8wOC9wb3J0YWwtYXBpLWtleXMiIHN0YXR1cz0iYWN0aXZlIj4NCiAgPGw3OlZhbHVlPiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5hcGlrZXl9PC9sNzpWYWx1ZT4NCiAgPGw3OlNlY3JldD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuYXBpa2V5U2VjcmV0fTwvbDc6U2VjcmV0Pg0KICA8bDc6QWNjb3VudFBsYW5NYXBwaW5nSWQ+JHtlbmNvZGVkQWNjb3VudFBsYW5NYXBwaW5nSWR9PC9sNzpBY2NvdW50UGxhbk1hcHBpbmdJZD4NCiAgPGw3OkN1c3RvbU1ldGFEYXRhPg0KPCFbQ0RBVEFbDQoke2VuY29kZWRDdXN0b21NZXRhRGF0YX0NCl1dPg0KICA8L2w3OkN1c3RvbU1ldGFEYXRhPg0KICA8bDc6U2VydmljZXM+DQoke2FwaU1hcHBpbmd9DQogIDwvbDc6U2VydmljZXM+DQogIDxsNzpPQXV0aCBjYWxsYmFja1VybD0iJHtlbmNvZGVkQ2FsbGJhY2tVcmx9IiBsYWJlbD0iJHtlbmNvZGVkTGFiZWx9IiBzY29wZT0iJHtlbmNvZGVkU2NvcGV9IiB0eXBlPSIke2VuY29kZWRUeXBlfSIgLz4NCiAgPGw3OlBsYXRmb3JtPiR7ZW5jb2RlZFBsYXRmb3JtfTwvbDc6UGxhdGZvcm0+DQo8L2w3OkFwaUtleT4="/>
                                    <L7p:VariableToSet stringValue="newApiKey"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ManageApiKey>
                                            <L7p:Action stringValue="Add"/>
                                            <L7p:ApiKey stringValue="${request.http.parameter.apikey}"/>
                                            <L7p:ApiKeyElement stringValue="${newApiKey}"/>
                                            <L7p:VariablePrefix stringValue="newKey"/>
                                        </L7p:ManageApiKey>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="PGw3OkFwaUtleVJlc3BvbnNlIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDExLzA4L3BvcnRhbC1hcGkta2V5cyI+DQogICA8bDc6T3BlcmF0aW9uPiR7c2VydmljZU9wfTwvbDc6T3BlcmF0aW9uPg0KICAgPGw3OlRpbWVzdGFtcD4ke3JlcXVlc3QudGltZS5sb2NhbC5NTWRkeXl5eS1ISDptbTpzcy5TU1N9PC9sNzpUaW1lc3RhbXA+DQogICA8bDc6U3RhdHVzPjIwMDwvbDc6U3RhdHVzPg0KICAgPGw3Ok1lc3NhZ2U+c3VjY2VzczwvbDc6TWVzc2FnZT4NCiAgIDxsNzpEZXRhaWw+e21lc3NhZ2UgZGV0YWlsc308L2w3OkRldGFpbD4NCiAgIDxsNzpBcGlLZXk+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX08L2w3OkFwaUtleT4NCiAgIDxsNzpQcm9wZXJ0aWVzPg0KICAgICA8IS0tIHplcm8gb3IgbW9yZSBQcm9wZXJ0eSBlbGVtZW50cywgZm9yIGUuZy4gLS0+DQogICAgIDxsNzpQcm9wZXJ0eSBrZXk9ImNvcnJlbElkIj4NCiAgICAgICA8bDc6U3RyaW5nVmFsdWU+JHtyZXF1ZXN0SWR9PC9sNzpTdHJpbmdWYWx1ZT4NCiAgICAgPC9sNzpQcm9wZXJ0eT4NCiAgIDwvbDc6UHJvcGVydGllcz4NCiR7ZGVidWdCbG9ja30NCjwvbDc6QXBpS2V5UmVzcG9uc2U+"/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="fragmentResponse"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtlcnJvck1lc3NhZ2V9IEVycm9yIGFkZGluZyBBUEkga2V5"/>
                                            <L7p:VariableToSet stringValue="errorMessage"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="Register new APIKey"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// error case"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                            </L7p:TrueAssertion>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="// Perform registration"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="if (serviceOp is &quot;register&quot;)"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${serviceOp}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="update"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:HtmlFormDataAssertion>
                            <L7p:AllowGet booleanValue="true"/>
                            <L7p:AllowPost booleanValue="true"/>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="- required(apikey); at least one(apikeyStatus, apikeySecret, assignApis); optional(debug, format)"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:DisallowOtherFields booleanValue="true"/>
                            <L7p:FieldSpecs htmlFormFieldSpecArray="included">
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="accountPlanMappingId"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:MinOccurs intValue="1"/>
                                    <L7p:Name stringValue="apikey"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="apikeySecret"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="apikeyStatus"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="assignApis"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="callbackUrl"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="debug"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="format"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="label"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="oauthScope"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="oauthType"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="platform"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:AllowEmpty boxedBooleanValue="true"/>
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="customMetaData"/>
                                </L7p:item>
                            </L7p:FieldSpecs>
                        </L7p:HtmlFormDataAssertion>
                        <wsp:All wsp:Usage="Required">
                            <L7p:LookupApiKey>
                                <L7p:ApiKey stringValue="${apikey}"/>
                                <L7p:ServiceId stringValue=""/>
                            </L7p:LookupApiKey>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Update Key - lookup:found=${apiKeyRecord.found}key=${apiKeyRecord.key}secret=${apiKeyRecord.secret}"/>
                            </L7p:AuditDetailAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${apiKeyRecord.found}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="true"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="NTAw"/>
                                        <L7p:VariableToSet stringValue="errorCode"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="SW52YWxpZCBBUEkgS2V5IHw="/>
                                        <L7p:VariableToSet stringValue="errorMessage"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// Error - invalid key"/>
                                        </L7p:entry>
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="if (apikey does not exist)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${request.http.parameter.assignApis}"/>
                                        <L7p:Operator operatorNull="null"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item dataType="included">
                                                <L7p:Type variableDataType="string"/>
                                            </L7p:item>
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:Operator operator="EMPTY"/>
                                                <L7p:RightValue stringValue=""/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="PGw3OlMgaWQ9IiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5hc3NpZ25BcGlzfSIgLz4="/>
                                            <L7p:VariableToSet stringValue="apiMapping"/>
                                        </L7p:SetVariable>
                                        <L7p:Regex>
                                            <L7p:AutoTarget booleanValue="false"/>

                                            <L7p:OtherTargetMessageVariable stringValue="apiMapping"/>
                                            <L7p:Regex stringValue="\+\+"/>
                                            <L7p:Replace booleanValue="true"/>
                                            <L7p:Replacement stringValue="\&quot; />&lt;l7:S id=\&quot;"/>
                                            <L7p:Target target="OTHER"/>
                                        </L7p:Regex>
                                        <L7p:Regex>
                                            <L7p:AutoTarget booleanValue="false"/>

                                            <L7p:OtherTargetMessageVariable stringValue="apiMapping"/>
                                            <L7p:Regex stringValue="\;"/>
                                            <L7p:Replace booleanValue="true"/>
                                            <L7p:Replacement stringValue="\&quot; plan=\&quot;"/>
                                            <L7p:Target target="OTHER"/>
                                        </L7p:Regex>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="PGw3OlNlcnZpY2VzIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDExLzA4L3BvcnRhbC1hcGkta2V5cyI+DQoke2FwaU1hcHBpbmd9DQo8L2w3OlNlcnZpY2VzPg=="/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="mapValidation"/>
                                        </L7p:SetVariable>
                                        <L7p:AuditDetailAssertion>
                                            <L7p:Detail stringValue="update api map: ${mapValidation.mainpart}"/>
                                        </L7p:AuditDetailAssertion>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="// build &lt;l7:Services> block"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:AssertionComment assertionComment="included">
                                                    <L7p:Properties mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                                            <L7p:value stringValue="// find valid service list"/>
                                                        </L7p:entry>
                                                    </L7p:Properties>
                                                </L7p:AssertionComment>
                                                <L7p:VariablePrefix stringValue="validMapEntries"/>
                                                <L7p:XmlMsgSrc stringValue="mapValidation"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="/l7:Services/l7:S[string-length(./@id) > 0 and string-length(./@plan) > 0]"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2011/08/portal-api-keys"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                            <L7p:AuditDetailAssertion>
                                                <L7p:Detail stringValue="Map entries: found=${validMapEntries.found} ; count=${validMapEntries.count}"/>
                                            </L7p:AuditDetailAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${validMapEntries.found}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="boolean"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">

                                                        <L7p:CaseSensitive booleanValue="false"/>
                                                        <L7p:RightValue stringValue="true"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${validMapEntries.count}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="int"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">

                                                        <L7p:CaseSensitive booleanValue="false"/>
                                                        <L7p:Operator operator="GT"/>
                                                        <L7p:RightValue stringValue="0"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue="mapIds"/>
                                                <L7p:XmlMsgSrc stringValue="mapValidation"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="/l7:Services/l7:S[string-length(./@id) > 0]/@id"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2011/08/portal-api-keys"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                            <L7p:AuditDetailAssertion>
                                                <L7p:Detail stringValue="API Ids: found=${mapIds.found} ; count=${mapIds.count}"/>
                                            </L7p:AuditDetailAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${mapIds.count}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">

                                                        <L7p:CaseSensitive booleanValue="false"/>
                                                        <L7p:RightValue stringValue="${validMapEntries.count}"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                            <L7p:ResponseXpathAssertion>
                                                <L7p:VariablePrefix stringValue="mapPlans"/>
                                                <L7p:XmlMsgSrc stringValue="mapValidation"/>
                                                <L7p:XpathExpression xpathExpressionValue="included">
                                                    <L7p:Expression stringValue="/l7:Services/l7:S[string-length(./@plan) > 0]/@plan"/>
                                                    <L7p:Namespaces mapValue="included">
                                                        <L7p:entry>
                                                            <L7p:key stringValue="s"/>
                                                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                                        </L7p:entry>
                                                        <L7p:entry>
                                                            <L7p:key stringValue="l7"/>
                                                            <L7p:value stringValue="http://ns.l7tech.com/2011/08/portal-api-keys"/>
                                                        </L7p:entry>
                                                    </L7p:Namespaces>
                                                </L7p:XpathExpression>
                                            </L7p:ResponseXpathAssertion>
                                            <L7p:AuditDetailAssertion>
                                                <L7p:Detail stringValue="Plans: found=${mapPlans.found} ; count=${mapPlans.count}"/>
                                            </L7p:AuditDetailAssertion>
                                            <L7p:ComparisonAssertion>
                                                <L7p:CaseSensitive booleanValue="false"/>
                                                <L7p:Expression1 stringValue="${mapPlans.count}"/>
                                                <L7p:Operator operatorNull="null"/>
                                                <L7p:Predicates predicates="included">
                                                    <L7p:item dataType="included">
                                                        <L7p:Type variableDataType="string"/>
                                                    </L7p:item>
                                                    <L7p:item binary="included">

                                                        <L7p:CaseSensitive booleanValue="false"/>
                                                        <L7p:RightValue stringValue="${validMapEntries.count}"/>
                                                    </L7p:item>
                                                </L7p:Predicates>
                                            </L7p:ComparisonAssertion>
                                        </wsp:All>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:AuditDetailAssertion>
                                                <L7p:Detail stringValue="Bad assignApis parameter:${request.http.parameter.assignApis}"/>
                                            </L7p:AuditDetailAssertion>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="NTAw"/>
                                                <L7p:VariableToSet stringValue="errorCode"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtlcnJvck1lc3NhZ2V9IEludmFsaWQgQXNzaWduZWQgQVBJcyB8"/>
                                                <L7p:VariableToSet stringValue="errorMessage"/>
                                            </L7p:SetVariable>
                                        </wsp:All>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="// validate service-plan mapping"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// Error - Invalid Assigned APIs"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="if (assignApis)"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                        <L7p:CaseSensitive booleanValue="false"/>
                                        <L7p:Expression1 stringValue="${request.http.parameter.apikeyStatus}"/>
                                        <L7p:Operator operatorNull="null"/>
                                        <L7p:Predicates predicates="included">
                                            <L7p:item dataType="included">
                                                <L7p:Type variableDataType="string"/>
                                            </L7p:item>
                                            <L7p:item binary="included">
                                                <L7p:Negated booleanValue="true"/>
                                                <L7p:Operator operator="EMPTY"/>
                                                <L7p:RightValue stringValue=""/>
                                            </L7p:item>
                                        </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.apikeyStatus}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="active"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.apikeyStatus}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="inactive"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.apikeyStatus}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:RightValue stringValue="suspend"/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <wsp:All wsp:Usage="Required">
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="NTAw"/>
                                                <L7p:VariableToSet stringValue="errorCode"/>
                                            </L7p:SetVariable>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue="JHtlcnJvck1lc3NhZ2V9IEludmFsaWQgU3RhdHVzIHw="/>
                                                <L7p:VariableToSet stringValue="errorMessage"/>
                                            </L7p:SetVariable>
                                        </wsp:All>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="// apikey status must be one of (active, inactive, suspend)"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                                <L7p:value stringValue="// Error - Invalid status"/>
                                            </L7p:entry>
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="else if (apikeyStatus does not exist)"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:OneOrMore wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.apikeySecret}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.label}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.callbackUrl}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.oauthScope}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.oauthType}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.platform}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.accountPlanMappingId}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                    </wsp:OneOrMore>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtlcnJvck1lc3NhZ2V9IE1pc3NpbmcgdXBkYXRlIGZpZWxkcw=="/>
                                            <L7p:VariableToSet stringValue="errorMessage"/>
                                        </L7p:SetVariable>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="// Error - Missing update argument"/>
                                                </L7p:entry>
                                                <L7p:entry>
                                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                                    <L7p:value stringValue="else"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                        <L7p:Properties mapValue="included">
                                            <L7p:entry>
                                                <L7p:key stringValue="LEFT.COMMENT"/>
                                                <L7p:value stringValue="else if (apikeySecret or label or callbackUrl specified)"/>
                                            </L7p:entry>
                                        </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// one of plan or apikeyStatus"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="// Input parameters"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="Validate"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHthcGlLZXlSZWNvcmQueG1sfQ=="/>
                                    <L7p:VariableToSet stringValue="newApiKey"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.assignApis}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFzc2lnbkFwaXN9"/>
                                            <L7p:VariableToSet stringValue="pman.options.assignApis"/>
                                        </L7p:SetVariable>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                                    <L7p:value stringValue="if (assignApis updated)"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.apikeyStatus}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleVN0YXR1c30="/>
                                            <L7p:VariableToSet stringValue="pman.options.apikeyStatus"/>
                                        </L7p:SetVariable>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                                    <L7p:value stringValue="if (status updated)"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ComparisonAssertion>
                                            <L7p:CaseSensitive booleanValue="false"/>
                                            <L7p:Expression1 stringValue="${request.http.parameter.apikeySecret}"/>
                                            <L7p:Operator operatorNull="null"/>
                                            <L7p:Predicates predicates="included">
                                                <L7p:item dataType="included">
                                                    <L7p:Type variableDataType="string"/>
                                                </L7p:item>
                                                <L7p:item binary="included">
                                                    <L7p:Negated booleanValue="true"/>
                                                    <L7p:Operator operator="EMPTY"/>
                                                    <L7p:RightValue stringValue=""/>
                                                </L7p:item>
                                            </L7p:Predicates>
                                        </L7p:ComparisonAssertion>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleVNlY3JldH0="/>
                                            <L7p:VariableToSet stringValue="pman.options.apikeySecret"/>
                                        </L7p:SetVariable>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                                    <L7p:value stringValue="if (secret updated)"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${request.http.parameter.label}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:Operator operator="EMPTY"/>

                                                            <L7p:RightValue stringValue=""/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:EncodeDecode>

                                                    <L7p:SourceVariableName stringValue="request.http.parameter.label"/>
                                                    <L7p:TargetDataType variableDataType="string"/>

                                                    <L7p:TargetVariableName stringValue="pman.options.label"/>
                                                    <L7p:TransformType transformType="URL_ENCODE"/>
                                                </L7p:EncodeDecode>
                                            </wsp:All>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue=""/>
                                                <L7p:VariableToSet stringValue="pman.options.label"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//label"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${request.http.parameter.callbackUrl}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:Operator operator="EMPTY"/>

                                                            <L7p:RightValue stringValue=""/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:EncodeDecode>

                                                    <L7p:SourceVariableName stringValue="request.http.parameter.callbackUrl"/>
                                                    <L7p:TargetDataType variableDataType="string"/>

                                                    <L7p:TargetVariableName stringValue="pman.options.callbackUrl"/>
                                                    <L7p:TransformType transformType="URL_ENCODE"/>
                                                </L7p:EncodeDecode>
                                            </wsp:All>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue=""/>
                                                <L7p:VariableToSet stringValue="pman.options.callbackUrl"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//callbackUrl"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${request.http.parameter.oauthScope}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:Operator operator="EMPTY"/>

                                                            <L7p:RightValue stringValue=""/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:EncodeDecode>

                                                    <L7p:SourceVariableName stringValue="request.http.parameter.oauthScope"/>
                                                    <L7p:TargetDataType variableDataType="string"/>

                                                    <L7p:TargetVariableName stringValue="pman.options.oauthScope"/>
                                                    <L7p:TransformType transformType="URL_ENCODE"/>
                                                </L7p:EncodeDecode>
                                            </wsp:All>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue=""/>
                                                <L7p:VariableToSet stringValue="pman.options.oauthScope"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//oauthScope"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${request.http.parameter.oauthType}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:Operator operator="EMPTY"/>

                                                            <L7p:RightValue stringValue=""/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:EncodeDecode>

                                                    <L7p:SourceVariableName stringValue="request.http.parameter.oauthType"/>
                                                    <L7p:TargetDataType variableDataType="string"/>

                                                    <L7p:TargetVariableName stringValue="pman.options.oauthType"/>
                                                    <L7p:TransformType transformType="URL_ENCODE"/>
                                                </L7p:EncodeDecode>
                                            </wsp:All>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue=""/>
                                                <L7p:VariableToSet stringValue="pman.options.oauthType"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//oauthType"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${request.http.parameter.platform}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:Operator operator="EMPTY"/>

                                                            <L7p:RightValue stringValue=""/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:EncodeDecode>

                                                    <L7p:SourceVariableName stringValue="request.http.parameter.platform"/>
                                                    <L7p:TargetDataType variableDataType="string"/>

                                                    <L7p:TargetVariableName stringValue="pman.options.platform"/>
                                                    <L7p:TransformType transformType="URL_ENCODE"/>
                                                </L7p:EncodeDecode>
                                            </wsp:All>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue=""/>
                                                <L7p:VariableToSet stringValue="pman.options.platform"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//platform"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${request.http.parameter.accountPlanMappingId}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:Operator operator="EMPTY"/>

                                                            <L7p:RightValue stringValue=""/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:EncodeDecode>

                                                    <L7p:SourceVariableName stringValue="request.http.parameter.accountPlanMappingId"/>
                                                    <L7p:TargetDataType variableDataType="string"/>

                                                    <L7p:TargetVariableName stringValue="pman.options.accountPlanMappingId"/>
                                                    <L7p:TransformType transformType="URL_ENCODE"/>
                                                </L7p:EncodeDecode>
                                            </wsp:All>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue=""/>
                                                <L7p:VariableToSet stringValue="pman.options.accountPlanMappingId"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//accountPlanMappingId"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <wsp:OneOrMore wsp:Usage="Required">
                                            <wsp:All wsp:Usage="Required">
                                                <L7p:ComparisonAssertion>
                                                    <L7p:CaseSensitive booleanValue="false"/>
                                                    <L7p:Expression1 stringValue="${request.http.parameter.customMetaData}"/>
                                                    <L7p:Operator operatorNull="null"/>
                                                    <L7p:Predicates predicates="included">
                                                        <L7p:item dataType="included">
                                                            <L7p:Type variableDataType="string"/>
                                                        </L7p:item>
                                                        <L7p:item binary="included">
                                                            <L7p:Negated booleanValue="true"/>

                                                            <L7p:Operator operator="EMPTY"/>

                                                            <L7p:RightValue stringValue=""/>
                                                        </L7p:item>
                                                    </L7p:Predicates>
                                                </L7p:ComparisonAssertion>
                                                <L7p:EncodeDecode>

                                                    <L7p:SourceVariableName stringValue="request.http.parameter.customMetaData"/>
                                                    <L7p:TargetDataType variableDataType="string"/>

                                                    <L7p:TargetVariableName stringValue="pman.options.customMetaData"/>
                                                    <L7p:TransformType transformType="URL_ENCODE"/>
                                                </L7p:EncodeDecode>
                                            </wsp:All>
                                            <L7p:SetVariable>
                                                <L7p:Base64Expression stringValue=""/>
                                                <L7p:VariableToSet stringValue="pman.options.customMetaData"/>
                                            </L7p:SetVariable>
                                            <L7p:assertionComment>
                                                <L7p:Properties mapValue="included">
                                                    <L7p:entry>
                                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                                        <L7p:value stringValue="//customMetaData"/>
                                                    </L7p:entry>
                                                </L7p:Properties>
                                            </L7p:assertionComment>
                                        </wsp:OneOrMore>
                                        <L7p:assertionComment>
                                            <L7p:Properties mapValue="included">
                                                <L7p:entry>
                                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                                    <L7p:value stringValue="if (other fields updated)"/>
                                                </L7p:entry>
                                                <L7p:entry>
                                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                                    <L7p:value stringValue="// handles label, callbackUrl, oauthScope, oauthType, and Platform"/>
                                                </L7p:entry>
                                            </L7p:Properties>
                                        </L7p:assertionComment>
                                    </wsp:All>
                                </wsp:OneOrMore>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ManageApiKey>
                                            <L7p:Action stringValue="Update"/>
                                            <L7p:ApiKey stringValue="${apikey}"/>
                                            <L7p:ApiKeyElement stringValue="${newApiKey}"/>
                                            <L7p:VariablePrefix stringValue="updatedKey"/>
                                        </L7p:ManageApiKey>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="PGw3OkFwaUtleVJlc3BvbnNlIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDExLzA4L3BvcnRhbC1hcGkta2V5cyI+DQogICA8bDc6T3BlcmF0aW9uPiR7c2VydmljZU9wfTwvbDc6T3BlcmF0aW9uPg0KICAgPGw3OlRpbWVzdGFtcD4ke3JlcXVlc3QudGltZS5sb2NhbC5NTWRkeXl5eS1ISDptbTpzcy5TU1N9PC9sNzpUaW1lc3RhbXA+DQogICA8bDc6U3RhdHVzPjIwMDwvbDc6U3RhdHVzPg0KICAgPGw3Ok1lc3NhZ2U+c3VjY2VzczwvbDc6TWVzc2FnZT4NCiAgIDxsNzpEZXRhaWw+e21lc3NhZ2UgZGV0YWlsc308L2w3OkRldGFpbD4NCiAgIDxsNzpBcGlLZXk+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX08L2w3OkFwaUtleT4NCiAgIDxsNzpQcm9wZXJ0aWVzPg0KICAgICA8bDc6UHJvcGVydHkga2V5PSJjb3JyZWxJZCI+DQogICAgICAgPGw3OlN0cmluZ1ZhbHVlPiR7cmVxdWVzdElkfTwvbDc6U3RyaW5nVmFsdWU+DQogICAgIDwvbDc6UHJvcGVydHk+DQogICA8L2w3OlByb3BlcnRpZXM+DQoke2RlYnVnQmxvY2t9DQo8L2w3OkFwaUtleVJlc3BvbnNlPg=="/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="fragmentResponse"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtlcnJvck1lc3NhZ2V9IEVycm9yIHVwZGF0aW5nIEFQSSBrZXk="/>
                                            <L7p:VariableToSet stringValue="errorMessage"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="Update APIKey"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// error case"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                            </L7p:TrueAssertion>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="// Perform update"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="if (serviceOp is &quot;update&quot;)"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${serviceOp}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="delete"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:HtmlFormDataAssertion>
                            <L7p:AllowGet booleanValue="true"/>
                            <L7p:AllowPost booleanValue="true"/>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="- required(apikey); optional(debug, format)"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:DisallowOtherFields booleanValue="true"/>
                            <L7p:FieldSpecs htmlFormFieldSpecArray="included">
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:MinOccurs intValue="1"/>
                                    <L7p:Name stringValue="apikey"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="debug"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="format"/>
                                </L7p:item>
                            </L7p:FieldSpecs>
                        </L7p:HtmlFormDataAssertion>
                        <wsp:All wsp:Usage="Required">
                            <L7p:LookupApiKey>
                                <L7p:ApiKey stringValue="${apikey}"/>
                                <L7p:ServiceId stringValue=""/>
                            </L7p:LookupApiKey>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Delete Key - lookup:found=${apiKeyRecord.found}key=${apiKeyRecord.key}secret=${apiKeyRecord.secret}"/>
                            </L7p:AuditDetailAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${apiKeyRecord.found}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="true"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="NTAw"/>
                                        <L7p:VariableToSet stringValue="errorCode"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                        <L7p:Base64Expression stringValue="SW52YWxpZCBBUEkgS2V5"/>
                                        <L7p:VariableToSet stringValue="errorMessage"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// Error - invalid key"/>
                                        </L7p:entry>
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="if (apikey does not exist)"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                        <L7p:key stringValue="RIGHT.COMMENT"/>
                                        <L7p:value stringValue="// Input parameters"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                        <L7p:key stringValue="LEFT.COMMENT"/>
                                        <L7p:value stringValue="Validate"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${errorCode}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                        <L7p:item dataType="included">
                                            <L7p:Type variableDataType="string"/>
                                        </L7p:item>
                                        <L7p:item binary="included">
                                            <L7p:RightValue stringValue="0"/>
                                        </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PEw3OkFwaUtleSB4bWxuczpMNz0iaHR0cDovL25zLmw3dGVjaC5jb20vMjAxMS8wOC9wb3J0YWwtYXBpLWtleXMiIGVuYWJsZWQ9InRydWUiIHN0YXR1cz0iYWN0aXZlIj4NCjxMNzpWYWx1ZT4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuYXBpa2V5fTwvTDc6VmFsdWU+DQo8TDc6U2VydmljZT4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuc2VydmljZX08L0w3OlNlcnZpY2U+DQo8TDc6UGxhbj4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucGxhbn08L0w3OlBsYW4+DQo8L0w3OkFwaUtleT4="/>
                                    <L7p:VariableToSet stringValue="newApiKey"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:ManageApiKey>
                                            <L7p:Action stringValue="Remove"/>
                                            <L7p:ApiKey stringValue="${apikey}"/>
                                            <L7p:VariablePrefix stringValue="removedKey"/>
                                        </L7p:ManageApiKey>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="PGw3OkFwaUtleVJlc3BvbnNlIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDExLzA4L3BvcnRhbC1hcGkta2V5cyI+DQogICA8bDc6T3BlcmF0aW9uPiR7c2VydmljZU9wfTwvbDc6T3BlcmF0aW9uPg0KICAgPGw3OlRpbWVzdGFtcD4ke3JlcXVlc3QudGltZS5sb2NhbC5NTWRkeXl5eS1ISDptbTpzcy5TU1N9PC9sNzpUaW1lc3RhbXA+DQogICA8bDc6U3RhdHVzPjIwMDwvbDc6U3RhdHVzPg0KICAgPGw3Ok1lc3NhZ2U+c3VjY2VzczwvbDc6TWVzc2FnZT4NCiAgIDxsNzpEZXRhaWw+e21lc3NhZ2UgZGV0YWlsc308L2w3OkRldGFpbD4NCiAgIDxsNzpBcGlLZXk+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX08L2w3OkFwaUtleT4NCiAgIDxsNzpQcm9wZXJ0aWVzPg0KICAgICA8bDc6UHJvcGVydHkga2V5PSJjb3JyZWxJZCI+DQogICAgICAgPGw3OlN0cmluZ1ZhbHVlPiR7cmVxdWVzdElkfTwvbDc6U3RyaW5nVmFsdWU+DQogICAgIDwvbDc6UHJvcGVydHk+DQogICA8L2w3OlByb3BlcnRpZXM+DQoke2RlYnVnQmxvY2t9DQo8L2w3OkFwaUtleVJlc3BvbnNlPg=="/>
                                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                            <L7p:DataType variableDataType="message"/>
                                            <L7p:VariableToSet stringValue="fragmentResponse"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="NTAw"/>
                                            <L7p:VariableToSet stringValue="errorCode"/>
                                        </L7p:SetVariable>
                                        <L7p:SetVariable>
                                            <L7p:Base64Expression stringValue="JHtlcnJvck1lc3NhZ2V9IEVycm9yIHJlbW92aW5nIEFQSSBrZXk="/>
                                            <L7p:VariableToSet stringValue="errorMessage"/>
                                        </L7p:SetVariable>
                                    </wsp:All>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="Update APIKey"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:TrueAssertion>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// error case"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                            </L7p:TrueAssertion>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="if (serviceOp is &quot;delete&quot;)"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="NTAw"/>
                            <L7p:VariableToSet stringValue="errorCode"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="SW52YWxpZCBSZXF1ZXN0"/>
                            <L7p:VariableToSet stringValue="errorMessage"/>
                        </L7p:SetVariable>
                    </wsp:All>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${errorCode}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:RightValue stringValue="0"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="PGw3OkFwaUtleVJlc3BvbnNlIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDExLzA4L3BvcnRhbC1hcGkta2V5cyI+DQogICA8bDc6T3BlcmF0aW9uPiR7c2VydmljZU9wfTwvbDc6T3BlcmF0aW9uPg0KICAgPGw3OlRpbWVzdGFtcD4ke3JlcXVlc3QudGltZS5sb2NhbC5NTWRkeXl5eS1ISDptbTpzcy5TU1N9PC9sNzpUaW1lc3RhbXA+DQogICA8bDc6U3RhdHVzPjUwMDwvbDc6U3RhdHVzPg0KICAgPGw3Ok1lc3NhZ2U+RXJyb3IgcHJvY2Vzc2luZyByZXF1ZXN0PC9sNzpNZXNzYWdlPg0KICAgPGw3OkRldGFpbD4ke2Vycm9yTWVzc2FnZX08L2w3OkRldGFpbD4NCiAgIDxsNzpBcGlLZXk+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX08L2w3OkFwaUtleT4NCiAgIDxsNzpQcm9wZXJ0aWVzPg0KICAgICA8bDc6UHJvcGVydHkga2V5PSJjb3JyZWxJZCI+DQogICAgICAgPGw3OlN0cmluZ1ZhbHVlPiR7cmVxdWVzdElkfTwvbDc6U3RyaW5nVmFsdWU+DQogICAgIDwvbDc6UHJvcGVydHk+DQogICAgIDxsNzpQcm9wZXJ0eSBrZXk9InVzYWdlIj4NCiAgICAgICA8bDc6U3RyaW5nVmFsdWU+PCFbQ0RBVEFbIE5vbmUgXV0+PC9sNzpTdHJpbmdWYWx1ZT4NCiAgICAgPC9sNzpQcm9wZXJ0eT4NCiAgIDwvbDc6UHJvcGVydGllcz4NCiR7ZGVidWdCbG9ja30NCjwvbDc6QXBpS2V5UmVzcG9uc2U+"/>
                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="fragmentResponse"/>
                        </L7p:SetVariable>
                    </wsp:All>
                    <L7p:TrueAssertion/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Build error message"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="if (errorCode not 0)"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// API Key management branch"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${request.http.uri}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:Operator operator="CONTAINS"/>
                            <L7p:RightValue stringValue="${uri.generate}"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAudXJpfQ=="/>
                    <L7p:VariableToSet stringValue="serviceOp"/>
                </L7p:SetVariable>
                <L7p:Regex>
                    <L7p:AutoTarget booleanValue="false"/>
                    <L7p:OtherTargetMessageVariable stringValue="serviceOp"/>
                    <L7p:Regex stringValue=".*/generate"/>
                    <L7p:RegexName stringValue="- strip out uri prefix (v2)"/>
                    <L7p:Replace booleanValue="true"/>
                    <L7p:Replacement stringValue="generate"/>
                    <L7p:Target target="OTHER"/>
                </L7p:Regex>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBvcnRhbC5tYW5hZ2VkLnNlcnZpY2VzfQ=="/>
                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="validServices"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${serviceOp}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="generate"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:HtmlFormDataAssertion>
                            <L7p:AllowGet booleanValue="true"/>
                            <L7p:AllowPost booleanValue="true"/>
                            <L7p:DisallowOtherFields booleanValue="true"/>
                            <L7p:FieldSpecs htmlFormFieldSpecArray="included">
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="debug"/>
                                </L7p:item>
                                <L7p:item htmlFormFieldSpec="included">
                                    <L7p:DataType fieldDataType="any"/>
                                    <L7p:MaxOccurs intValue="1"/>
                                    <L7p:Name stringValue="format"/>
                                </L7p:item>
                            </L7p:FieldSpecs>
                        </L7p:HtmlFormDataAssertion>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="// There are no required input arguments"/>
                        </L7p:CommentAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:UUIDGenerator>
                                    <L7p:Quantity stringValue="2"/>
                                    <L7p:TargetVariable stringValue="guids"/>
                                </L7p:UUIDGenerator>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtndWlkc1swXX0="/>
                                    <L7p:VariableToSet stringValue="keySecret"/>
                                </L7p:SetVariable>
                                <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>
                                    <L7p:OtherTargetMessageVariable stringValue="keySecret"/>
                                    <L7p:Regex stringValue="\-"/>
                                    <L7p:RegexName stringValue="Remove dash characters"/>
                                    <L7p:Replace booleanValue="true"/>
                                    <L7p:Replacement stringValue=""/>
                                    <L7p:Target target="OTHER"/>
                                </L7p:Regex>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtndWlkc1sxXX0="/>
                                    <L7p:VariableToSet stringValue="rawApiKey"/>
                                </L7p:SetVariable>
                                <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>
                                    <L7p:OtherTargetMessageVariable stringValue="rawApiKey"/>
                                    <L7p:Regex stringValue="\-"/>
                                    <L7p:RegexName stringValue="Remove dash characters"/>
                                    <L7p:Replace booleanValue="true"/>
                                    <L7p:Replacement stringValue=""/>
                                    <L7p:Target target="OTHER"/>
                                </L7p:Regex>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="bDd4eCR7cmF3QXBpS2V5fQ=="/>
                                    <L7p:VariableToSet stringValue="rawApiKey"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyYXdBcGlLZXl9"/>
                                    <L7p:VariableToSet stringValue="encodedApiKey"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGw3OkFwaUtleVJlc3BvbnNlIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDExLzA4L3BvcnRhbC1hcGkta2V5cyI+DQogICA8bDc6T3BlcmF0aW9uPmdlbmVyYXRlPC9sNzpPcGVyYXRpb24+DQogICA8bDc6VGltZXN0YW1wPiR7cmVxdWVzdC50aW1lLmxvY2FsLk1NZGR5eXl5LUhIOm1tOnNzLlNTU308L2w3OlRpbWVzdGFtcD4NCiAgIDxsNzpTdGF0dXM+MjAwPC9sNzpTdGF0dXM+DQogICA8bDc6TWVzc2FnZT5zdWNjZXNzPC9sNzpNZXNzYWdlPg0KICAgPGw3OkRldGFpbD57bWVzc2FnZSBkZXRhaWxzfTwvbDc6RGV0YWlsPg0KICAgPGw3OkFwaUtleT4ke2VuY29kZWRBcGlLZXl9PC9sNzpBcGlLZXk+DQogICA8bDc6UHJvcGVydGllcz4NCiAgICAgIDwhLS16ZXJvIG9yIG1vcmUgUHJvcGVydHkgZWxlbWVudHMsIGZvciBlLmcuLS0+DQogICAgICA8bDc6UHJvcGVydHkga2V5PSJpc3N1ZXIiPg0KICAgICAgICAgPGw3OlN0cmluZ1ZhbHVlPiR7Z2F0ZXdheS5jbHVzdGVyLmhvc3RuYW1lfTwvbDc6U3RyaW5nVmFsdWU+DQogICAgICA8L2w3OlByb3BlcnR5Pg0KICAgICAgPGw3OlByb3BlcnR5IGtleT0iY29ycmVsSWQiPg0KICAgICAgICAgPGw3OlN0cmluZ1ZhbHVlPiR7cmVxdWVzdElkfTwvbDc6U3RyaW5nVmFsdWU+DQogICAgICA8L2w3OlByb3BlcnR5Pg0KICAgICAgPGw3OlByb3BlcnR5IGtleT0ia2V5Ij4NCiAgICAgICAgIDxsNzpTdHJpbmdWYWx1ZT4ke3Jhd0FwaUtleX08L2w3OlN0cmluZ1ZhbHVlPg0KICAgICAgPC9sNzpQcm9wZXJ0eT4NCiAgICAgIDxsNzpQcm9wZXJ0eSBrZXk9ImtleVNlY3JldCI+DQogICAgICAgICA8bDc6U3RyaW5nVmFsdWU+JHtrZXlTZWNyZXR9PC9sNzpTdHJpbmdWYWx1ZT4NCiAgICAgIDwvbDc6UHJvcGVydHk+DQogICA8L2w3OlByb3BlcnRpZXM+DQoke2RlYnVnQmxvY2t9DQo8L2w3OkFwaUtleVJlc3BvbnNlPg=="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="fragmentResponse"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                        <L7p:entry>
                                            <L7p:key stringValue="RIGHT.COMMENT"/>
                                            <L7p:value stringValue="// new API key response"/>
                                        </L7p:entry>
                                        <L7p:entry>
                                            <L7p:key stringValue="LEFT.COMMENT"/>
                                            <L7p:value stringValue="Generate"/>
                                        </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="NTAw"/>
                                    <L7p:VariableToSet stringValue="errorCode"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="RXJyb3IgR2VuZXJhdGluZyBLZXk="/>
                                    <L7p:VariableToSet stringValue="errorMessage"/>
                                </L7p:SetVariable>
                            </wsp:All>
                        </wsp:OneOrMore>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="NTAw"/>
                            <L7p:VariableToSet stringValue="errorCode"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="SW52YWxpZCBSZXF1ZXN0"/>
                            <L7p:VariableToSet stringValue="errorMessage"/>
                        </L7p:SetVariable>
                    </wsp:All>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${errorCode}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:RightValue stringValue="0"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="PGw3OkFwaUtleVJlc3BvbnNlIHhtbG5zOmw3PSJodHRwOi8vbnMubDd0ZWNoLmNvbS8yMDExLzA4L3BvcnRhbC1hcGkta2V5cyI+DQogICA8bDc6T3BlcmF0aW9uPiR7c2VydmljZU9wfTwvbDc6T3BlcmF0aW9uPg0KICAgPGw3OlRpbWVzdGFtcD4ke3JlcXVlc3QudGltZS5sb2NhbC5NTWRkeXl5eS1ISDptbTpzcy5TU1N9PC9sNzpUaW1lc3RhbXA+DQogICA8bDc6U3RhdHVzPjUwMDwvbDc6U3RhdHVzPg0KICAgPGw3Ok1lc3NhZ2U+RXJyb3IgcHJvY2Vzc2luZyByZXF1ZXN0PC9sNzpNZXNzYWdlPg0KICAgPGw3OkRldGFpbD4ke2Vycm9yTWVzc2FnZX08L2w3OkRldGFpbD4NCiAgIDxsNzpBcGlLZXk+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwaWtleX08L2w3OkFwaUtleT4NCiAgIDxsNzpQcm9wZXJ0aWVzPg0KICAgICA8bDc6UHJvcGVydHkga2V5PSJjb3JyZWxJZCI+DQogICAgICAgPGw3OlN0cmluZ1ZhbHVlPiR7cmVxdWVzdElkfTwvbDc6U3RyaW5nVmFsdWU+DQogICAgIDwvbDc6UHJvcGVydHk+DQogICAgIDxsNzpQcm9wZXJ0eSBrZXk9InVzYWdlIj4NCiAgICAgICA8bDc6U3RyaW5nVmFsdWU+PCFbQ0RBVEFbIE5vbmUgXV0+PC9sNzpTdHJpbmdWYWx1ZT4NCiAgICAgPC9sNzpQcm9wZXJ0eT4NCiAgIDwvbDc6UHJvcGVydGllcz4NCiR7ZGVidWdCbG9ja30NCjwvbDc6QXBpS2V5UmVzcG9uc2U+"/>
                            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="fragmentResponse"/>
                        </L7p:SetVariable>
                    </wsp:All>
                    <L7p:TrueAssertion/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// Build error message"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="if (errorCode not 0)"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// API Key generator branch"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValue="Bad operation"/>
                </L7p:CustomizeErrorResponse>
                <L7p:FalseAssertion/>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// Invalid Operation catch block"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
        </wsp:OneOrMore>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${errorCode}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="0"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:HardcodedResponse>
                    <L7p:Base64ResponseBody stringValue="JHtmcmFnbWVudFJlc3BvbnNlLm1haW5wYXJ0fQ=="/>
                </L7p:HardcodedResponse>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// Return response"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="if (success path)"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValue="${fragmentResponse.mainpart}"/>
                    <L7p:ContentType stringValue="text/xml; charset=UTF-8"/>
                    <L7p:HttpStatus stringValue="${errorCode}"/>
                </L7p:CustomizeErrorResponse>
                <L7p:FalseAssertion/>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="// Return error, falsify policy"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="Else (error)"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>
