<?xml version="1.0" encoding="UTF-8"?>
<enumeration ObjectType="Service" ExportDate="20120821 1113" ExporterVersion="6.2 (4248)">
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="123797524" version="2">
        <l7:ServiceDetail folderId="123600914" id="123797524" version="2">
            <l7:Name>oauth/validation</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/validation/v2/authorize</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>4</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="3">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SslAssertion&gt;
                    &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
                    &lt;/L7p:SslAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="f0eb1f7b-392b-40a4-9f4f-46d00ffad3d3"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;error&gt;invalid request&lt;/error&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
                    &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
                    &lt;L7p:HttpStatus stringValue="401"/&gt;
                    &lt;/L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="callback"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="response_type"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="scope"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNsaWVudF9rZXl9"/&gt;
                    &lt;L7p:VariableToSet stringValue="client_key"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNhbGxiYWNrfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="redirect_uri"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNjb3BlfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlc3BvbnNlX3R5cGV9"/&gt;
                    &lt;L7p:VariableToSet stringValue="response_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.client_key}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Get client registration information =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_clientstore_server}/oauth/clientstore/getAll"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="clientKeyValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathType"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/clients/values/value/type/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathName"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/clients/values/value/name/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathCallback"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/keys/values/value/callback/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/keys/values/value/scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/keys/values/value/status/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/keys/values/value/expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Given client_id is invalid: ${client_key}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0Pgo8ZXJyb3I+SW52YWxpZCBjbGllbnRfaWQ8L2Vycm9yPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Get client info"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathStatus.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="ENABLED"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathExpiration.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="0"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="0"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${gateway.time.millis}"/&gt;
                    &lt;L7p:Expression2 stringValue="${xpathExpiration.result}"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:RightValue stringValue="${xpathExpiration.result}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check expiration date"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Given client_id is DISABLED or EXPIRED, statue: ${xpathStatus.result}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0Pgo8ZXJyb3I+R2l2ZW4gY2xpZW50X2lkIGlzIERJU0FCTEVEIG9yIEVYUElSRUQ8L2Vycm9yPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check status and expiration of key"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Add scope check here =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${scope}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNjb3BlLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="If scope parameter is missing in the request, return the default scope.
                    The default scope in from client registration"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Set scope parameter to return"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Public clients must have registered redirect_uri"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="public"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="public"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Confidential clients utilizing implicit grant_type must have registered
                    redirect_uri"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="confidential"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="confidential"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${response_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="token"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="confidential"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="confidential"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${response_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="token"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:RightValue stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Invalid redirect_uri: ${redirect_uri}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0Pgo8ZXJyb3I+SW52YWxpZCByZWRpcmVjdF91cmk8L2Vycm9yPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check registered redirect_uri"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="If redirect_uri parameter is passed in, then it must match redirect_uri
                    entered during client registration."/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aENhbGxiYWNrLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="callbacks"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:IncludeEntireExpressionCapture booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="callbacks"/&gt;
                    &lt;L7p:Regex stringValue="\s"/&gt;
                    &lt;L7p:RegexName stringValue="Remove white spaces"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:Split&gt;
                    &lt;L7p:InputVariable stringValue="callbacks"/&gt;
                    &lt;L7p:OutputVariable stringValue="callbacks"/&gt;
                    &lt;L7p:SplitPattern stringValue=",|;"/&gt;
                    &lt;/L7p:Split&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${callbacks}"/&gt;
                    &lt;L7p:Expression2 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:MultivaluedComparison multivaluedComparison="ANY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${redirect_uri}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="redirect_uri"/&gt;
                    &lt;L7p:Regex stringValue="^http"/&gt;
                    &lt;L7p:RegexName stringValue="Check that redirect_uri is an absolute URI"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check that redirect_uri does not include a fragment component"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue="#"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:RightValue stringValue="#"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="If redirect_uri parameter is not passed in, then use redirect_uri
                    entered during client registration."/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aENhbGxiYWNrLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="redirect_uri"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="redirect_uri"/&gt;
                    &lt;L7p:Regex stringValue="^http"/&gt;
                    &lt;L7p:RegexName stringValue="Check that redirect_uri is an absolute URI"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="redirect_uri"/&gt;
                    &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
                    &lt;L7p:Regex stringValue="[,;]http"/&gt;
                    &lt;L7p:RegexName stringValue="Check that redirect_uri is just one absolute URI"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check that redirect_uri does not include a fragment component"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue="#"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:RightValue stringValue="#"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item regex="included"&gt;
                    &lt;L7p:Pattern stringValue="|oob"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item regex="included"&gt;
                    &lt;L7p:Pattern stringValue="|oob"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="No redirect available"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="If redirect_uri parameter is passed and none was registered use the one
                    passed in"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item regex="included"&gt;
                    &lt;L7p:Pattern stringValue="|oob"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="redirect_uri"/&gt;
                    &lt;L7p:Regex stringValue="^http"/&gt;
                    &lt;L7p:RegexName stringValue="Check that redirect_uri is an absolute URI"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check that redirect_uri does not include a fragment component"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue="#"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:RightValue stringValue="#"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Mismatching redirect uri. Given: ${request.http.parameter.callback},
                    registered: ${xpathCallback.result}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0Pgo8ZXJyb3I+TWlzbWF0Y2hpbmcgcmVkaXJlY3QgdXJpLiBHaXZlbjogJyR7cmVkaXJlY3RfdXJpfSc8L2Vycm9yPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Validate redirect_uri parameter against registered redirect_uri"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KPGNsaWVudE5hbWU+PCFbQ0RBVEFbJHt4cGF0aE5hbWUucmVzdWx0fV1dPjwvY2xpZW50TmFtZT4KPHJlZGlyZWN0X3VyaT48IVtDREFUQVske3JlZGlyZWN0X3VyaX1dXT48L3JlZGlyZWN0X3VyaT4KPHNjb3BlPjwhW0NEQVRBWyR7c2NvcGV9XV0+PC9zY29wZT4KPHJlc3BvbnNlX3R5cGU+PCFbQ0RBVEFbJHtyZXNwb25zZV90eXBlfV1dPjwvcmVzcG9uc2VfdHlwZT4KPC92YWxpZGF0aW9uPg=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="123797523" version="2">
        <l7:ServiceDetail folderId="123600914" id="123797523" version="2">
            <l7:Name>oauth/validation</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/validation/validate/v2/token</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>4</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="3">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Validates OAuth 2.0 Access Tokens"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="For Bearer token, pass in Authorization header OR access_token"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="For MAC token, pass in Authorization header, http_method, url"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion&gt;
                    &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
                    &lt;/L7p:SslAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="f0eb1f7b-392b-40a4-9f4f-46d00ffad3d3"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
                    &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
                    &lt;L7p:HttpStatus stringValue="401"/&gt;
                    &lt;/L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="auth_scheme"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLmF1dGhvcml6YXRpb259"/&gt;
                    &lt;L7p:VariableToSet stringValue="authorizationHeader"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFjY2Vzc190b2tlbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="access_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${authorizationHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="auth_header"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="authorizationHeader"/&gt;
                    &lt;L7p:Regex stringValue="(\b.*\b)\s+.*"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthdXRoX2hlYWRlclsxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="auth_scheme"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Look for authentication scheme in the authorization header, if it
                    exists."/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizationHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${access_token}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description&amp;quot;: Missing access
                    token"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check access token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizationHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${access_token}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5hY2Nlc3NfdG9rZW58QEB9IyMke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXJzLmh0dHBfbWV0aG9kfEBAfSMjJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy51cmx8QEB9"/&gt;
                    &lt;L7p:VariableToSet stringValue="requestParams"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Presence of &amp;quot;@@&amp;quot; indicates duplicate parameters"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="requestParams"/&gt;
                    &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
                    &lt;L7p:Regex stringValue="@@"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizationHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${access_token}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5hY2Nlc3NfdG9rZW58QEB9IyMke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXJzLmh0dHBfbWV0aG9kfEBAfSMjJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy51cmx8QEB9"/&gt;
                    &lt;L7p:VariableToSet stringValue="requestParams"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Presence of &amp;quot;@@&amp;quot; indicates duplicate parameters"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="requestParams"/&gt;
                    &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
                    &lt;L7p:Regex stringValue="@@"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Duplicate parameters"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check for duplicate access tokens and parameters in the request"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${access_token}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="QmVhcmVy"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthY2Nlc3NfdG9rZW59"/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Bearer - access_token parameter"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${authorizationHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="auth_header"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="authorizationHeader"/&gt;
                    &lt;L7p:Regex stringValue="Bearer\s+(.*)"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${auth_header[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="QmVhcmVy"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthdXRoX2hlYWRlclsxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Bearer - Authorization Header"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${authorizationHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="auth_header"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="authorizationHeader"/&gt;
                    &lt;L7p:Regex stringValue="MAC\s+(.*)"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${auth_header[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="id"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="authorizationHeader"/&gt;
                    &lt;L7p:Regex stringValue="id\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${id[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="bWFj"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtpZFsxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="mac - Authorization Header"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Invalid request"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check token type (Bearer or mac)"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CacheLookup&gt;
                    &lt;L7p:CacheEntryKey stringValue="${token}"/&gt;
                    &lt;L7p:CacheId stringValue="acTokenInfoCache"/&gt;
                    &lt;L7p:ContentTypeOverride stringValue=""/&gt;
                    &lt;L7p:MaxEntryAgeMillis longValue="60000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="acTokenInfo"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheLookup&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="mac"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="mac"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathAcTokenInfo"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="acTokenInfo"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ac/token_secret/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aEFjVG9rZW5JbmZvLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_secret"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_secret is only set for MAC token type"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="Bearer"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="Bearer"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="token_secret"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathAcTokenInfo"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="acTokenInfo"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ac/token_expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aEFjVG9rZW5JbmZvLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_expiration"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathAcTokenInfo"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="acTokenInfo"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ac/scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aEFjVG9rZW5JbmZvLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathAcTokenInfo"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="acTokenInfo"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ac/resource_owner_id/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aEFjVG9rZW5JbmZvLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_resource_owner_id"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathAcTokenInfo"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="acTokenInfo"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ac/client_id/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aEFjVG9rZW5JbmZvLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_client_id"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathAcTokenInfo"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="acTokenInfo"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ac/status/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aEFjVG9rZW5JbmZvLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_status"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Look in cache"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHt0b2tlbn0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="getTokenValues"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_tokenstore_server}/oauth/tokenstore/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="getTokenValues"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathClientKey"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/client_key/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathSecret"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/secret"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathOwner"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/status/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNlY3JldC5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_secret"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aEV4cGlyYXRpb24ucmVzdWx0fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_expiration"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNjb3BlLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aE93bmVyLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_resource_owner_id"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aENsaWVudEtleS5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_client_id"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFN0YXR1cy5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_status"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGFjPg0KPHRva2VuX3NlY3JldD4ke3Rva2VuX3NlY3JldH08L3Rva2VuX3NlY3JldD4NCjx0b2tlbl9leHBpcmF0aW9uPiR7dG9rZW5fZXhwaXJhdGlvbn08L3Rva2VuX2V4cGlyYXRpb24+DQo8c2NvcGU+JHt0b2tlbl9zY29wZX08L3Njb3BlPg0KPHJlc291cmNlX293bmVyX2lkPiR7dG9rZW5fcmVzb3VyY2Vfb3duZXJfaWR9PC9yZXNvdXJjZV9vd25lcl9pZD4NCjxjbGllbnRfaWQ+JHt0b2tlbl9jbGllbnRfaWR9PC9jbGllbnRfaWQ+DQo8c3RhdHVzPiR7dG9rZW5fc3RhdHVzfTwvc3RhdHVzPg0KPC9hYz4="/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="acTokenInfo"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:CacheStorage&gt;
                    &lt;L7p:CacheEntryKey stringValue="${token}"/&gt;
                    &lt;L7p:CacheId stringValue="acTokenInfoCache"/&gt;
                    &lt;L7p:MaxEntries intValue="1000"/&gt;
                    &lt;L7p:MaxEntryAgeMillis longValue="60000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="acTokenInfo"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheStorage&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Look in tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Access token is invalid or
                    revoked"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="lookup token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="Bearer"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="Bearer"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Bearer - No additional checks"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="mac"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="mac"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="ts"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="request.http.header.authorization"/&gt;
                    &lt;L7p:Regex stringValue="ts\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${ts[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt0c1sxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="timestamp_sec"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="nonce"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="request.http.header.authorization"/&gt;
                    &lt;L7p:Regex stringValue="nonce\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${nonce[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtub25jZVsxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="nonce"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt0aW1lc3RhbXBfc2VjfSR7bm9uY2V9JHt0b2tlbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="replay_arg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:WssReplayProtection&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Set the right timeframe!"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:CustomExpiryTime intValue="300000"/&gt;
                    &lt;L7p:CustomIdentifierVariable stringValue="replay_arg"/&gt;
                    &lt;L7p:CustomProtection booleanValue="true"/&gt;
                    &lt;L7p:CustomScope stringValue="${service.oid}"/&gt;
                    &lt;/L7p:WssReplayProtection&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmh0dHBfbWV0aG9kfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="http_method"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${http_method}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnVybH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="url"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${url}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="ext"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="request.http.header.authorization"/&gt;
                    &lt;L7p:Regex stringValue="ext\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${ext[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtleHRbMV19"/&gt;
                    &lt;L7p:VariableToSet stringValue="ext"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="ext"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="ext is optional"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt0b2tlbl9zZWNyZXR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="mac_key"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${mac_key}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="aG1hYy1zaGEtMQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="mac_algorithm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="request_mac"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="request.http.header.authorization"/&gt;
                    &lt;L7p:Regex stringValue="mac\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request_mac[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0X21hY1sxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="request_mac"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Generate mac and compare to mac in the request message"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="1987200f-1887-4566-b0e7-1bff9558a361"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request_mac}"/&gt;
                    &lt;L7p:Expression2 stringValue="${mac}"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${mac}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="mac"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Invalid request"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="validate token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:DataType variableDataType="dateTime"/&gt;
                    &lt;L7p:DateOffsetExpression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="now"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${now.millis}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item dataType="included"&gt;
                    &lt;L7p:Type variableDataType="int"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:RightValue stringValue="${token_expiration}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${token_status}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item dataType="included"&gt;
                    &lt;L7p:Type variableDataType="string"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Access token expired or
                    disabled, status: ${token_status}, expiration: ${token_expiration}, time_now: ${now.millis}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check expiration and status of access token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KPGNsaWVudF9rZXk+PCFbQ0RBVEFbJHt0b2tlbl9jbGllbnRfaWR9XV0+PC9jbGllbnRfa2V5Pgo8cmVzb3VyY2Vfb3duZXI+PCFbQ0RBVEFbJHt0b2tlbl9yZXNvdXJjZV9vd25lcl9pZH1dXT48L3Jlc291cmNlX293bmVyPgo8c2NvcGU+PCFbQ0RBVEFbJHt0b2tlbl9zY29wZX1dXT48L3Njb3BlPgo8ZXhwaXJhdGlvbj48IVtDREFUQVske3Rva2VuX2V4cGlyYXRpb259XV0+PC9leHBpcmF0aW9uPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="123797525" version="2">
        <l7:ServiceDetail folderId="123600914" id="123797525" version="2">
            <l7:Name>oauth/validation</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/validation/validate/v2/granttype</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>3</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="2">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Validates grant types. Right now only 'auth_code' type"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion&gt;
                    &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
                    &lt;/L7p:SslAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="f0eb1f7b-392b-40a4-9f4f-46d00ffad3d3"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="callback"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
                    &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
                    &lt;L7p:HttpStatus stringValue="401"/&gt;
                    &lt;/L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_tokenstore_server}/oauth/tokenstore/getTemp"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathCallback"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/callback/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathClientKey"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/client_key/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathOwner"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathClientKey.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="${request.http.parameter.client_key}"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${request.http.parameter.client_key}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check that authorization code is not expired"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Expression1 stringValue="${xpathExpiration.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="${gateway.time.millis}"/&gt;
                    &lt;L7p:Operator operator="GE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="GE"/&gt;
                    &lt;L7p:RightValue stringValue="${gateway.time.millis}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNhbGxiYWNrfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="redirect_uri"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="redirect_uri parameter must match redirect_uri parameter used in
                    authorization request."/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${xpathCallback.result}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check redirect_uri"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KPHNjb3BlPjwhW0NEQVRBWyR7eHBhdGhTY29wZS5yZXN1bHR9XV0+PC9zY29wZT4KPHJlc291cmNlX293bmVyPjwhW0NEQVRBWyR7eHBhdGhPd25lci5yZXN1bHR9XV0+PC9yZXNvdXJjZV9vd25lcj4KPC92YWxpZGF0aW9uPg=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="123797528" version="2">
        <l7:ServiceDetail folderId="123600914" id="123797528" version="2">
            <l7:Name>oauth/validation</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/validation/validate/v2/tokenrequest</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>4</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="3">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Validates the given client_id and secret"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Gets called when clients request an access_token"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion&gt;
                    &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
                    &lt;/L7p:SslAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="f0eb1f7b-392b-40a4-9f4f-46d00ffad3d3"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
                    &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
                    &lt;L7p:HttpStatus stringValue="401"/&gt;
                    &lt;/L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="secret"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_clientstore_server}/oauth/clientstore/getAll"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="clientValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathSecret"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/keys/values/value/secret/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/keys/values/value/status/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/keys/values/value/expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathSecret.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="${request.http.parameter.secret}"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${request.http.parameter.secret}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathStatus.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="ENABLED"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathExpiration.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="0"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="0"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:DataType variableDataType="dateTime"/&gt;
                    &lt;L7p:DateOffsetExpression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="now"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${now.millis}"/&gt;
                    &lt;L7p:Expression2 stringValue="${xpathExpiration.result}"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:RightValue stringValue="${xpathExpiration.result}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check expiration date"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: given client_secret is wrong
                    or client_id has expired or it is disabled, given secret: ${request.http.parameter.secret}, status:
                    ${token_status}, expiration: ${token_expiration}, time_now: ${now.millis}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check status and expiration and secret of key"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathType"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/clients/values/value/type/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathName"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/clients/values/value/name/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/keys/values/value/scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KPHR5cGU+PCFbQ0RBVEFbJHt4cGF0aFR5cGUucmVzdWx0fV1dPjwvdHlwZT4KPGNsaWVudF9uYW1lPjwhW0NEQVRBWyR7eHBhdGhOYW1lLnJlc3VsdH1dXT48L2NsaWVudF9uYW1lPgo8c2NvcGU+PCFbQ0RBVEFbJHt4cGF0aFNjb3BlLnJlc3VsdH1dXT48L3Njb3BlPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="123797527" version="2">
        <l7:ServiceDetail folderId="123600914" id="123797527" version="2">
            <l7:Name>oauth/validation</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/validation/validate/v1/signature</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>4</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="3">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Validates oauth_signature for OAuth 1.0 requests"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Required request parameters: oauth_consumer_key, signatureBaseString"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Optional request parameters: oauth_token, oauth_verifier"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion&gt;
                    &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
                    &lt;/L7p:SslAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="f0eb1f7b-392b-40a4-9f4f-46d00ffad3d3"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
                    &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
                    &lt;L7p:HttpStatus stringValue="401"/&gt;
                    &lt;/L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLm9hdXRoX2NvbnN1bWVyX2tleX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupApiKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="request.http.parameter.oauth_signature"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth_signature"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:DataType variableDataType="dateTime"/&gt;
                    &lt;L7p:DateOffsetExpression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="now"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CacheLookup&gt;
                    &lt;L7p:CacheEntryKey stringValue="${lookupApiKey}"/&gt;
                    &lt;L7p:CacheId stringValue="consumerSecretCache"/&gt;
                    &lt;L7p:ContentTypeOverride stringValue=""/&gt;
                    &lt;L7p:MaxEntryAgeMillis longValue="30000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="consumerKeyValues"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheLookup&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${consumerKeyValues.mainpart}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Look in cache for client_key values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2xpZW50X2tleT0ke2xvb2t1cEFwaUtleX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="params"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_clientstore_server}/oauth/clientstore/getKey"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="params"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="consumerKeyValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjb25zdW1lcktleVZhbHVlcy5tYWlucGFydH0="/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="consumerKeyValues"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:CacheStorage&gt;
                    &lt;L7p:CacheEntryKey stringValue="${lookupApiKey}"/&gt;
                    &lt;L7p:CacheId stringValue="consumerSecretCache"/&gt;
                    &lt;L7p:MaxEntries intValue="1000"/&gt;
                    &lt;L7p:MaxEntryAgeMillis longValue="30000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="consumerKeyValues"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheStorage&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Look at client_store"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Get the client_key values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="clientSecret"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="consumerKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/secret/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="clientExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="consumerKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="clientStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="consumerKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/status/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="clientName"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="consumerKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/client_name/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${clientStatus.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="ENABLED"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${clientExpiration.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="0"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="0"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${now.millis}"/&gt;
                    &lt;L7p:Expression2 stringValue="${clientExpiration.result}"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:RightValue stringValue="${clientExpiration.result}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check expiration date"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Validate client_key values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0Pgo8ZXJyb3I+b2F1dGhfY29uc3VtZXJfa2V5IGludmFsaWQgb3IgZXhwaXJlZDwvZXJyb3I+CjwvdmFsaWRhdGlvbj4="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="invalid or expired"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjbGllbnRTZWNyZXQucmVzdWx0fSY="/&gt;
                    &lt;L7p:VariableToSet stringValue="secrets"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Find the consumer_key_secret and validate values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_consumer_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_signature"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="signatureBaseString"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CacheLookup&gt;
                    &lt;L7p:CacheEntryKey stringValue="${request.http.parameter.oauth_token}"/&gt;
                    &lt;L7p:CacheId stringValue="tokenValuesCache"/&gt;
                    &lt;L7p:ContentTypeOverride stringValue=""/&gt;
                    &lt;L7p:MaxEntryAgeMillis longValue="30000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="tokenValues"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheLookup&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${tokenValues.mainpart}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Look in cache for token values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLm9hdXRoX3Rva2VufQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="params"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_tokenstore_server}/oauth/tokenstore/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="params"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt0b2tlblZhbHVlcy5tYWlucGFydH0="/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="tokenValues"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:CacheStorage&gt;
                    &lt;L7p:CacheEntryKey stringValue="${request.http.parameter.oauth_token}"/&gt;
                    &lt;L7p:CacheId stringValue="tokenValuesCache"/&gt;
                    &lt;L7p:MaxEntries intValue="1000"/&gt;
                    &lt;L7p:MaxEntryAgeMillis longValue="30000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="tokenValues"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheStorage&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Look at token store"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Get the token values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="tokenSecret"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/secret/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="tokenExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="tokenStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/status/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${tokenStatus.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="ENABLED"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${now.millis}"/&gt;
                    &lt;L7p:Expression2 stringValue="${tokenExpiration.result}"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:RightValue stringValue="${tokenExpiration.result}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Validate token values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzZWNyZXRzfSR7dG9rZW5TZWNyZXQucmVzdWx0fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="secrets"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="validate 'access_token'"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_consumer_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_signature"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="signatureBaseString"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="validate 'request_token' request, no token secret exists"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_consumer_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_signature"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="oauth_verifier"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="signatureBaseString"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="dG9rZW49JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLm9hdXRoX3Rva2VufSZ2ZXJpZmllcj0ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIub2F1dGhfdmVyaWZpZXJ9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="params"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:HttpMethod httpMethod="POST"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_tokenstore_server}/oauth/tokenstore/getTemp"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="params"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="tempTokenSecret"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/secret/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="tempTokenExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${now.millis}"/&gt;
                    &lt;L7p:Expression2 stringValue="${tempTokenExpiration.result}"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:RightValue stringValue="${tempTokenExpiration.result}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzZWNyZXRzfSR7dGVtcFRva2VuU2VjcmV0LnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="secrets"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="invalid or expired"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0Pgo8ZXJyb3I+b2F1dGhfdG9rZW4gaXMgaW52YWxpZCBvciBleHBpcmVkPC9lcnJvcj4KPC92YWxpZGF0aW9uPg=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="invalid or expired"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="validate 'authorized request_token'"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="At least one token type must be present"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:GenerateSecurityHash&gt;
                    &lt;L7p:Base64Data stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNpZ25hdHVyZUJhc2VTdHJpbmd9"/&gt;
                    &lt;L7p:KeyText stringValue="${secrets}"/&gt;
                    &lt;L7p:LineBreak lineBreak="CR-LF"/&gt;
                    &lt;L7p:TargetOutputVariable stringValue="signature"/&gt;
                    &lt;/L7p:GenerateSecurityHash&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Comparison did not match: ${signature} is equal to
                    ${request.http.parameter.oauth_signature}, basestring:
                    ${request.http.parameter.signatureBaseString}"/&gt;
                    &lt;L7p:Enabled booleanValue="false"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${signature}"/&gt;
                    &lt;L7p:Expression2 stringValue="${request.http.parameter.oauth_signature}"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${request.http.parameter.oauth_signature}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KPGNsaWVudF9uYW1lPjwhW0NEQVRBWyR7Y2xpZW50TmFtZS5yZXN1bHR9XV0+PC9jbGllbnRfbmFtZT4KPC92YWxpZGF0aW9uPg=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="123797530" version="2">
        <l7:ServiceDetail folderId="123600914" id="123797530" version="2">
            <l7:Name>oauth/validation</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/validation/v1/authorize</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>3</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="2">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Validates the authorization request for OAuth 1.0"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Moves a request_token to an authorized_request_token"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion&gt;
                    &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
                    &lt;/L7p:SslAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="f0eb1f7b-392b-40a4-9f4f-46d00ffad3d3"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
                    &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
                    &lt;L7p:HttpStatus stringValue="401"/&gt;
                    &lt;/L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token, expiration, verifier"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="expiration"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="verifier"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_tokenstore_server}/oauth/tokenstore/getTemp"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathTokenValues"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${gateway.time.millis}"/&gt;
                    &lt;L7p:Expression2 stringValue="${xpathTokenValues.result}"/&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="LE"/&gt;
                    &lt;L7p:RightValue stringValue="${xpathTokenValues.result}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="validate expiration date"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathTokenValues"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathTokenValues.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="${request.http.parameter.resource_owner}"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue="${request.http.parameter.resource_owner}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check the authorizing resource_owner"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathCallback"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/callback/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="dG9rZW49JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRva2VufSZ2ZXJpZmllcj0ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIudmVyaWZpZXJ9JmV4cGlyYXRpb249JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmV4cGlyYXRpb259"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="messageBody"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_tokenstore_server}/oauth/tokenstore/update"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="messageBody"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KPGNhbGxiYWNrPjwhW0NEQVRBWyR7eHBhdGhDYWxsYmFjay5yZXN1bHR9XV0+PC9jYWxsYmFjaz4KPC92YWxpZGF0aW9uPg=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="123797531" version="2">
        <l7:ServiceDetail folderId="123600914" id="123797531" version="2">
            <l7:Name>oauth/validation</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/validation/validate/v2/refreshtoken</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>5</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="4">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Validates a OAuth 2.0 Refresh Token"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion&gt;
                    &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
                    &lt;/L7p:SslAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="f0eb1f7b-392b-40a4-9f4f-46d00ffad3d3"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="rtoken"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="scope"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
                    &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
                    &lt;L7p:HttpStatus stringValue="401"/&gt;
                    &lt;/L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNjb3BlfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${oauth_tokenstore_server}/oauth/tokenstore/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="rtoken"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/rexpiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathClientKey"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/client_key/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathOwner"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/values/value/status/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathClientKey.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="${request.http.parameter.client_key}"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${request.http.parameter.client_key}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:DataType variableDataType="dateTime"/&gt;
                    &lt;L7p:DateOffsetExpression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="now"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathExpiration.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="${now.millis}"/&gt;
                    &lt;L7p:Operator operator="GE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="GE"/&gt;
                    &lt;L7p:RightValue stringValue="${now.millis}"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathStatus.result}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item dataType="included"&gt;
                    &lt;L7p:Type variableDataType="string"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="refresh token was expired or disabled. expiration:
                    ${xpathExpiration.result}, time_now: ${now.millis}, status: ${xpathStatus.result}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check expiration and status of refresh token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${scope}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNjb3BlLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="If scope parameter is missing, use existing scope"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Set the scope to be used"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="PHZhbGlkYXRpb24+CjxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KPHNjb3BlPjwhW0NEQVRBWyR7c2NvcGV9XV0+PC9zY29wZT4KPHJlc291cmNlX293bmVyPjwhW0NEQVRBWyR7eHBhdGhPd25lci5yZXN1bHR9XV0+PC9yZXNvdXJjZV9vd25lcj4KPC92YWxpZGF0aW9uPg=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
</enumeration>
