<?xml version="1.0" encoding="UTF-8"?>
<enumeration>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a7812"
                version="2">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a75e1" id="57477c668279c3c8d34da687b89a7812" version="2">
            <l7:Name>resource owner password credentials</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/v2/client/ropc*</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>2</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This is a test client for an OAuth 2 implementation using the resource                     owner password credentials grant type"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion/&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="cm9wYw=="/&gt;
                    &lt;L7p:VariableToSet stringValue="client_page"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="6042809d-5ef7-4bb1-a9f3-af3584a06d5c"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="e503f8c2-0466-478d-937d-87c5a5f19bee"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CookieCredentialSource&gt;
                    &lt;L7p:CookieName stringValue="l7otk2ropc"/&gt;
                    &lt;/L7p:CookieCredentialSource&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cookie.l7otk2ropc}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjb29raWUubDdvdGsycm9wY30="/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="none"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;/L7p:TrueAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="get current token session id"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="4fb19dfb-0d61-4ec1-a843-b0493badf7da"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${clearSessionForm}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2ropc="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="refresh"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="refresh"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="rt"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="current_token"/&gt;
                    &lt;L7p:Regex stringValue="\&amp;quot;refresh_token\&amp;quot;\s*\:\s*\&amp;quot;([^&amp;quot;]*)\&amp;quot;"/&gt;
                    &lt;L7p:RegexName stringValue="isolate the refresh token"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtydFsxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="access_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Z3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuJnJlZnJlc2hfdG9rZW49JHtydFsxXX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="postMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CurrentSecurityHeaderHandling intValue="3"/&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="POST"/&gt;
                    &lt;L7p:Login stringValue="${oauth2_client_id}"/&gt;
                    &lt;L7p:Password stringValue="${oauth2_client_secret}"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth2_auth_server}${oauth2_token_path}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="application/xml"/&gt;
                    &lt;L7p:Name stringValue="accept"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="postMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="3MVG94DzwlYDSHS6GTCNPxF87RQ8HrxbojWk89by7fE_H4ch8TsfZcaIFz.jdne83WCVPiD_xA93_Y8j4iomk"/&gt;
                    &lt;L7p:Name stringValue="client_id"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="https://ssg61.l7tech.com:8443/salesforce/oauth/callback"/&gt;
                    &lt;L7p:Name stringValue="redirect_uri"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="4922422941220601472"/&gt;
                    &lt;L7p:Name stringValue="client_secret"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="authorization_code"/&gt;
                    &lt;L7p:Name stringValue="grant_type"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="${request.http.parameter.code}"/&gt;
                    &lt;L7p:Name stringValue="code"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmVmcmVzaGVkLg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Refresh"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="callapi"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="callapi"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjdXJyZW50X3Rva2VufQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRhcmdldH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="target_url"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="R0VU"/&gt;
                    &lt;L7p:VariableToSet stringValue="target_http_method"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="9481f86f-4c50-4500-b496-a5fa5a4a98b9"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="GET"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${request.http.parameter.target}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="${authorization_header}"/&gt;
                    &lt;L7p:Name stringValue="authorization"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Call API"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="handshake"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="handshake"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.login}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item stringLength="included"&gt;
                    &lt;L7p:Max intValue="-1"/&gt;
                    &lt;L7p:Min intValue="1"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.password}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item stringLength="included"&gt;
                    &lt;L7p:Max intValue="-1"/&gt;
                    &lt;L7p:Min intValue="1"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="request.http.parameter.login"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="login"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="request.http.parameter.password"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="password"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_scope"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="scope"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Z3JhbnRfdHlwZT1wYXNzd29yZCZ1c2VybmFtZT0ke2xvZ2lufSZzY29wZT0ke3Njb3BlfSZwYXNzd29yZD0ke3Bhc3N3b3JkfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="postMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CurrentSecurityHeaderHandling intValue="3"/&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="POST"/&gt;
                    &lt;L7p:Login stringValue="${oauth2_client_id}"/&gt;
                    &lt;L7p:Password stringValue="${oauth2_client_secret}"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth2_auth_server}${oauth2_token_path}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="postMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmV0cmlldmVkLg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:TargetVariable stringValue="tokenSessionId"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHt0b2tlblNlc3Npb25JZFswXX0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2ropc=${tokenSessionId[0]}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Handshake"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="clearSession"/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="clearSession"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cacheKey}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/delete"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Tm8gY3VycmVudCB0b2tlbi4="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2ropc="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Clear session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9Cgo8ZGl2IGlkPSJjb250ZW50Ij4KCQk8SUZSQU1FIGlkPW15aWZyYW1lIHNyYz0iIiBzdHlsZT0nZGlzcGxheTpub25lJyBmcmFtZWJvcmRlcj0iMCIgc2Nyb2xsaW5nPSJhdXRvIj4KCQk8L0lGUkFNRT4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImNvbnRlbnRfbGFuZGluZ19wYWdlIj4gICAgICAgICAgICAgIAoJCQk8ZGl2IGNsYXNzPSJ2aWV3IHZpZXctcHJvZHVjdHMzIHZpZXctaWQtcHJvZHVjdHMzIHZpZXctZGlzcGxheS1pZC1wYWdlXzEgdmlldy1kb20taWQtMSI+CQkKCQkJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CgkJCQk8ZGl2IGNsYXNzPSJ0aXRsZS1ib3giPgoJCQkJPGgxPk9BdXRoVjJDbGllbnQ8L2gxPgoJCQkJPGJyIC8+CgkJCQk8aDM+T0F1dGggdmVyc2lvbjogJHtvYXV0aDJfdmVyc2lvbn08L2gzPgoJCQkJPGJyIC8+CgkJCQk8aDM+R3JhbnQgdHlwZTogUmVzb3VyY2Ugb3duZXIgcGFzc3dvcmQgY3JlZGVudGlhbHM8L2gzPgoJCQkJPGJyIC8+CgkJCQk8aDM+Q3VycmVudCBBY2Nlc3MgVG9rZW46PC9oMz4KCQkJCTxiciAvPgoJCQkJJHtjbGVhclNlc3Npb25Gb3JtfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPjxwcmU+CiR7Y3VycmVudF90b2tlbn0KCQkJCTwvcHJlPgoJCQkJPC9wPgoJCQkJPC9kaXY+CgkJCQk8L2Rpdj4KCQkJICAgICAgICA8Y2FwdGlvbj48aDQ+PGI+PC9iPjwvaDQ+PGhyPjxwPjwvcD48L2NhcHRpb24+CgkJICAgIAk8L2Rpdj4KCiAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmlldyB2aWV3LXByb2R1Y3RzMyB2aWV3LWlkLXByb2R1Y3RzMyB2aWV3LWRpc3BsYXktaWQtcGFnZV8xIHZpZXctZG9tLWlkLTEiPgkJCgkJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIiPgoJCQkJPGJyIC8+CgoJCQkJCgkJCQk8aDM+SW5pdGlhdGUgbmV3IE9BdXRoIGhhbmRzaGFrZTwvaDM+CgkJCQk8YnIgLz4KCgkJCQk8Zm9ybSBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSIgbWV0aG9kPSJQT1NUIj4KICAgCQkJCQk8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJhY3Rpb24iCiAgICAgICAgICAgICAgICAgICAgCQkJCXZhbHVlPSJoYW5kc2hha2UiLz4KCQkJCQlMb2dpbjogJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7IDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJsb2dpbiIvPjxici8+PGJyLz4KCQkJCQlQYXNzd29yZDogPGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzd29yZCIvPgoJCQkJCTxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJJbml0aWF0ZSIvPgoJCQkJPC9mb3JtPgoKCQkJCTxiciAvPjxiciAvPjxiciAvPgoKCQkJCTxoMz5SZWZyZXNoIEN1cnJlbnQgQWNjZXNzIFRva2VuPC9oMz4KCQkJCTxiciAvPgoKCgkJCQk8Zm9ybSBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSI+CiAgIAkJCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIgogICAgICAgICAgICAgICAgICAgIAkJCQl2YWx1ZT0icmVmcmVzaCIvPgoJCQkJCTxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJSZWZyZXNoIi8+CgkJCQk8L2Zvcm0+CgoJCQkJPGJyIC8+PGJyIC8+PGJyIC8+CgkJCQkKCQkJCTxoMz5DYWxsIEFQSSBVc2luZyBDdXJyZW50IEFjY2VzcyBUb2tlbjwvaDM+CgkJCQk8YnIgLz4KCgkJCQk8Zm9ybSBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSI+CiAgIAkJCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIgogICAgICAgICAgICAgICAgICAgIAkJCQl2YWx1ZT0iY2FsbGFwaSIvPgoJCQkJCTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN0YXRlIgogICAgICAgICAgICAgICAgICAgIAkJCQl2YWx1ZT0ic3RhdGVfdGVzdCIvPgoJCQkJCVRhcmdldDogPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InRhcmdldCIgc2l6ZT04MCB2YWx1ZT0iJHthcGljYWxsdGFyZ2V0fSIvPgoJCQkJCTxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJDYWxsIEFQSSIvPgoJCQkJPC9mb3JtPgoJCQkJPGJyIC8+CgkJCQk8cD48cHJlPgoke2FwaW91dHB1dH0KCQkJCTwvcHJlPgoJCQkJPC9wPgoJCQkJCgkJCQk8L2Rpdj4KCQkJICAgICAgICA8Y2FwdGlvbj48aDQ+PGI+PC9iPjwvaDQ+PGhyPjxwPjwvcD48L2NhcHRpb24+CgkgICAgCTwvZGl2PgoKCgkJPC9kaXY+CjwvZGl2PgoKJHtodG1sVGVtcGxhdGVCb3R0b219"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a79cb"
                version="2">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a75e1" id="57477c668279c3c8d34da687b89a79cb" version="2">
            <l7:Name>SAML</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/v2/client/saml*</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>2</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This is a test client for an OAuth 2 implementation using the saml                     grant type"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion/&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="c2FtbA=="/&gt;
                    &lt;L7p:VariableToSet stringValue="client_page"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dXJuOmlldGY6cGFyYW1zOm9hdXRoOmdyYW50LXR5cGU6c2FtbDItYmVhcmVy"/&gt;
                    &lt;L7p:VariableToSet stringValue="saml_grant_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="6042809d-5ef7-4bb1-a9f3-af3584a06d5c"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="e503f8c2-0466-478d-937d-87c5a5f19bee"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CookieCredentialSource&gt;
                    &lt;L7p:CookieName stringValue="l7otk2saml"/&gt;
                    &lt;/L7p:CookieCredentialSource&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cookie.l7otk2saml}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjb29raWUubDdvdGsyc2FtbH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="none"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;/L7p:TrueAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="get current token session id"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="4fb19dfb-0d61-4ec1-a843-b0493badf7da"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${clearSessionForm}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2saml="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Find cached token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Tm8gY3VycmVudCBzYW1s"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_saml"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CookieCredentialSource&gt;
                    &lt;L7p:CookieName stringValue="l7otk2samlfromsts"/&gt;
                    &lt;/L7p:CookieCredentialSource&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cookie.l7otk2samlfromsts}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjb29raWUubDdvdGsyc2FtbGZyb21zdHN9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupSaml"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="lookupSaml"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSamlResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="samlValue"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="lookupSamlResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:found/ns:value/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="samlValue.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="samlDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzYW1sRGVjb2RlZH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_saml"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2samlfromsts="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="get current saml token session id"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Find cached saml token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.saml}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item dataType="included"&gt;
                    &lt;L7p:Type variableDataType="string"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item stringLength="included"&gt;
                    &lt;L7p:Max intValue="-1"/&gt;
                    &lt;L7p:Min intValue="1"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNhbWx9"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_saml"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjdXJyZW50X3NhbWx9"/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:TargetVariable stringValue="samlTokenSessionId"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtzYW1sVG9rZW5TZXNzaW9uSWRbMF19JnZhbHVlPSR7c2Vzc2lvblZhbHVlfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSaml"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSaml"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2samlfromsts=${samlTokenSessionId[0]}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="callapi"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="callapi"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjdXJyZW50X3Rva2VufQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRhcmdldH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="target_url"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="R0VU"/&gt;
                    &lt;L7p:VariableToSet stringValue="target_http_method"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="9481f86f-4c50-4500-b496-a5fa5a4a98b9"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="GET"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${request.http.parameter.target}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="${authorization_header}"/&gt;
                    &lt;L7p:Name stringValue="authorization"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Call API"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="handshake"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="handshake"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzYW1sX2dyYW50X3R5cGV9"/&gt;
                    &lt;L7p:VariableToSet stringValue="notencodedgranttype"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="notencodedgranttype"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="encodedgranttype"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="current_saml"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="encoded_saml"/&gt;
                    &lt;L7p:TransformType transformType="BASE64_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="encoded_saml"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="encoded_saml"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Z3JhbnRfdHlwZT0ke2VuY29kZWRncmFudHR5cGV9JmFzc2VydGlvbj0ke2VuY29kZWRfc2FtbH0mc2NvcGU9JHtvYXV0aDJfc2NvcGV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="postMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CurrentSecurityHeaderHandling intValue="3"/&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="POST"/&gt;
                    &lt;L7p:Login stringValue="${oauth2_client_id}"/&gt;
                    &lt;L7p:Password stringValue="${oauth2_client_secret}"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth2_auth_server}${oauth2_token_path}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="application/xml"/&gt;
                    &lt;L7p:Name stringValue="accept"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="postMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="3MVG94DzwlYDSHS6GTCNPxF87RQ8HrxbojWk89by7fE_H4ch8TsfZcaIFz.jdne83WCVPiD_xA93_Y8j4iomk"/&gt;
                    &lt;L7p:Name stringValue="client_id"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="https://ssg61.l7tech.com:8443/salesforce/oauth/callback"/&gt;
                    &lt;L7p:Name stringValue="redirect_uri"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="4922422941220601472"/&gt;
                    &lt;L7p:Name stringValue="client_secret"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="authorization_code"/&gt;
                    &lt;L7p:Name stringValue="grant_type"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="${request.http.parameter.code}"/&gt;
                    &lt;L7p:Name stringValue="code"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRjcC5yZW1vdGVJUH0hJHtvYXV0aDJfY2xpZW50X2lkfSFzYW1s"/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmV0cmlldmVkIHZpYSBoYW5kc2hha2Uu"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:TargetVariable stringValue="tokenSessionId"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHt0b2tlblNlc3Npb25JZFswXX0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2saml=${tokenSessionId[0]}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Handshake"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="clearSession"/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="clearSession"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:LookupDynamicContextVariables&gt;
                    &lt;L7p:SourceVariable stringValue="cookie.l7otk2saml"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;/L7p:LookupDynamicContextVariables&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjb29raWUubDdvdGsyc2FtbH0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteTokenMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/delete"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteTokenMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2saml="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear current token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:LookupDynamicContextVariables&gt;
                    &lt;L7p:SourceVariable stringValue="cookie.l7otk2samlfromsts"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;/L7p:LookupDynamicContextVariables&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjb29raWUubDdvdGsyc2FtbGZyb21zdHN9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteSamlMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/delete"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteSamlMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2samlfromsts="/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear current saml token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Tm8gY3VycmVudCB0b2tlbi4="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Tm8gY3VycmVudCBzYW1s"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_saml"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Clear session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${current_saml}"/&gt;
                    &lt;L7p:Expression2 stringValue="No current saml"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="No current saml"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjdXJyZW50X3NhbWx9"/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_saml_summary"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:XslTransformation&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create summary of SAML assertion information"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Direction intValue="-1"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="current_saml_summary"/&gt;
                    &lt;L7p:ResourceInfo staticResourceInfo="included"&gt;
                    &lt;L7p:Document stringValueReference="inline"&gt;&lt;![CDATA[&lt;xsl:stylesheet version="1.0"
                    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
                    &lt;xsl:output method="html"/&gt;

                    &lt;xsl:template match="/"&gt;
                    &lt;b&gt;SAML Assertion Summary&lt;/b&gt;&lt;br/&gt;
                    NameID: &lt;xsl:value-of select="//*[local-name()='NameID']"/&gt;&lt;br/&gt;
                    SubjectConfimation: &lt;xsl:value-of select="//*[local-name()='SubjectConfirmation']/@Method"/&gt;&lt;br/&gt;
                    NotBefore: &lt;xsl:value-of select="//*[local-name()='Conditions']/@NotBefore"/&gt;&lt;br/&gt;
                    NotOnOrAfter: &lt;xsl:value-of select="//*[local-name()='Conditions']/@NotOnOrAfter"/&gt;&lt;br/&gt;
                    AuthenticationContext: &lt;xsl:value-of select="//*[local-name()='AuthnContext']"/&gt;&lt;br/&gt;
                    &lt;/xsl:template&gt;
                    &lt;/xsl:stylesheet&gt;]]&gt;&lt;/L7p:Document&gt;
                    &lt;/L7p:ResourceInfo&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;L7p:TransformName stringValue=""/&gt;
                    &lt;/L7p:XslTransformation&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Escape &amp;amp;lt; character in SAML assertion for HTML display"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="current_saml"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;/"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="&amp;amp;lt;/"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Add line break and escape &amp;amp;lt; character in SAML assertion for                     HTML display"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="current_saml"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="&amp;lt;br&gt;&amp;amp;lt;"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjdXJyZW50X3NhbWxfc3VtbWFyeS5tYWlucGFydH0NCjxiciAvPg0KPGEgaHJlZj0iamF2YXNjcmlwdDp1bmhpZGUoJ3NhbWxfYXNzZXJ0aW9uJykiPlZpZXcgU0FNTCBBc3NlcnRpb248L2E+DQoJCQk8L3A+DQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogZnVuY3Rpb24gdW5oaWRlKGRpdklEKSB7DQogdmFyIGl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkaXZJRCk7DQogaWYgKGl0ZW0pIHsNCiBpdGVtLmNsYXNzTmFtZT0oaXRlbS5jbGFzc05hbWU9PSdoaWRkZW4nKT8ndW5oaWRkZW4nOidoaWRkZW4nOw0KIH0NCiB9DQogPC9zY3JpcHQ+DQoJCQk8cCBpZD0ic2FtbF9hc3NlcnRpb24iIGNsYXNzPSJoaWRkZW4iPg0KJHtjdXJyZW50X3NhbWx9"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_saml"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Build HTML template for SAML assertion display if exists"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="host_server"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtob3N0X3NlcnZlcn0vb2F1dGgvdjIvc2FtbFRva2VuU2VydmVy"/&gt;
                    &lt;L7p:VariableToSet stringValue="saml_token_server"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9Cgo8ZGl2IGlkPSJjb250ZW50Ij4KCTxJRlJBTUUgaWQ9bXlpZnJhbWUgc3JjPSIiIHN0eWxlPSdkaXNwbGF5Om5vbmUnIGZyYW1lYm9yZGVyPSIwIiBzY3JvbGxpbmc9ImF1dG8iPgoJPC9JRlJBTUU+Cgk8ZGl2IGlkPSJjb250ZW50X2xhbmRpbmdfcGFnZSI+ICAgICAgICAgICAgICAKCQk8ZGl2IGNsYXNzPSJ2aWV3IHZpZXctcHJvZHVjdHMzIHZpZXctaWQtcHJvZHVjdHMzIHZpZXctZGlzcGxheS1pZC1wYWdlXzEgdmlldy1kb20taWQtMSI+CQkKCQkJPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KCQkJPGRpdiBjbGFzcz0idGl0bGUtYm94Ij4KCQkJPGgxPk9BdXRoVjJDbGllbnQ8L2gxPgoJCQk8YnIgLz4KCQkJPGgzPk9BdXRoIHZlcnNpb246ICR7b2F1dGgyX3ZlcnNpb259PC9oMz4KCQkJPGJyIC8+CgkJCTxoMz5HcmFudCB0eXBlOiBTQU1MICgke3NhbWxfZ3JhbnRfdHlwZX0pPC9oMz4KCQkJPGJyIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICR7Y2xlYXJTZXNzaW9uRm9ybX0KCQkJPGgzPkN1cnJlbnQgQWNjZXNzIFRva2VuOjwvaDM+CgkJCTxiciAvPgoJCQk8cD48cHJlPgoke2N1cnJlbnRfdG9rZW59CgkJCTwvcHJlPgoJCQk8L3A+CgkJCTwvZGl2PgoJCQk8L2Rpdj4KCQkJCTxjYXB0aW9uPjxoND48Yj48L2I+PC9oND48aHI+PHA+PC9wPjwvY2FwdGlvbj4KCQkJPC9kaXY+CgoJCQk8ZGl2IGNsYXNzPSJ2aWV3IHZpZXctcHJvZHVjdHMzIHZpZXctaWQtcHJvZHVjdHMzIHZpZXctZGlzcGxheS1pZC1wYWdlXzEgdmlldy1kb20taWQtMSI+CQkKCQkJPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KCQkJPGJyIC8+CgkJCTxoMz5Jbml0aWF0ZSBuZXcgU0FNTCBoYW5kc2hha2U8L2gzPgoJCQk8YnIgLz4KCgkJCTxmb3JtIGFjdGlvbj0iJHtzYW1sX3Rva2VuX3NlcnZlcn0iPgoJCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icmVkaXJlY3RfdXJpIgoJCQkJCQkJICB2YWx1ZT0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9Ii8+CgkJCQk8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iSW5pdGlhdGUiLz4JCQkKCQkJPC9mb3JtPgoJCQk8YnIgLz4KCQkJPHA+CiR7Y3VycmVudF9zYW1sfQoKCQkJPC9wPgoKCQkJPGJyIC8+PGJyIC8+PGJyIC8+CgoJCQkKCQkJPGgzPkluaXRpYXRlIG5ldyBPQXV0aCBoYW5kc2hha2U8L2gzPgoJCQk8YnIgLz4KCgkJCTxmb3JtIGFjdGlvbj0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9Ij4KCQkJCTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImFjdGlvbiIKCQkJCQkJCSAgdmFsdWU9ImhhbmRzaGFrZSIvPgoJCQkJPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkluaXRpYXRlIi8+CgkJCTwvZm9ybT4KCgkJCTxiciAvPjxiciAvPjxiciAvPgoKCQkJPGgzPkNhbGwgQVBJIFVzaW5nIEN1cnJlbnQgQWNjZXNzIFRva2VuPC9oMz4KCQkJPGJyIC8+CgoJCQk8Zm9ybSBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSI+CgkJCQk8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJhY3Rpb24iCgkJCQkJCQkgIHZhbHVlPSJjYWxsYXBpIi8+CgkJCQk8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJzdGF0ZSIKCQkJCQkJCSAgdmFsdWU9InN0YXRlX3Rlc3QiLz4KCQkJCVRhcmdldDogPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InRhcmdldCIgc2l6ZT04MCB2YWx1ZT0iJHthcGljYWxsdGFyZ2V0fSIvPgoJCQkJPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkNhbGwgQVBJIi8+CgkJCTwvZm9ybT4KCQkJPGJyIC8+CgkJCTxwPjxwcmU+CiR7YXBpb3V0cHV0fQoJCQk8L3ByZT4KCQkJPC9wPgoJCQkKCQkJPC9kaXY+CgkJCQk8Y2FwdGlvbj48aDQ+PGI+PC9iPjwvaDQ+PGhyPjxwPjwvcD48L2NhcHRpb24+CgkJPC9kaXY+Cgk8L2Rpdj4KPC9kaXY+CiR7aHRtbFRlbXBsYXRlQm90dG9tfQ=="/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a78cf"
                version="2">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a7661" id="57477c668279c3c8d34da687b89a78cf" version="2">
            <l7:Name>oauth/v2</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/auth/oauth/v2/*</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>2</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Endpoint isused by websites to reload website content"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Set this to the uri prefix that points to the authorization template
                    resource files "/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAudXJpfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="uri"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="uris"/&gt;
                    &lt;L7p:IncludeEntireExpressionCapture booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="uri"/&gt;
                    &lt;L7p:Regex stringValue="(.*)/"/&gt;
                    &lt;L7p:RegexName stringValue="remove uri prefix"/&gt;
                    &lt;L7p:RegexVar stringValue="uri"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="/"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CurrentSecurityHeaderHandling intValue="3"/&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:ProtectedServiceUrl
                    stringValue="${host_oauth2_auth_template_server}${uri}${request.http.query}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a7851"
                version="10">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a76e1" id="57477c668279c3c8d34da687b89a7851"
                          version="10">
            <l7:Name>protected resource</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/v2/protectedapi*</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>16</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="15">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This is a protected resource server used by the test clients"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="e418c4cb-b910-49a7-b9f5-aa6ee18d21f9"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Add additional authorization rules here =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Based on grant type, scope, client id, and subscriber id
                    here =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="ewogICJjbGllbnRfaWQiOiIke3Nlc3Npb24uY2xpZW50X2lkfSIsCiAgInN1YnNjcmliZXJfaWQiOiIke3Nlc3Npb24uc3Vic2NyaWJlcl9pZH0iLAogICJzY29wZSI6IiR7c2Vzc2lvbi5zY29wZX0iLAogICJleHBpcmVzX2F0Ijoke3Nlc3Npb24uZXhwaXJlc19hdH0sCiAgImFjY2Vzc2VkX2F0Ijoke2dhdGV3YXkudGltZS5zZWNvbmRzfQp9"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a7794"
                version="2">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a75e1" id="57477c668279c3c8d34da687b89a7794" version="2">
            <l7:Name>implicit</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/v2/client/implicit*</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>2</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This is a test client for an OAuth 2 implementation using the implicit
                    grant type"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion/&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="aW1wbGljaXQ="/&gt;
                    &lt;L7p:VariableToSet stringValue="client_page"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="6042809d-5ef7-4bb1-a9f3-af3584a06d5c"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="e503f8c2-0466-478d-937d-87c5a5f19bee"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtob3N0X29hdXRoMl9hdXRoX3NlcnZlcn0ke29hdXRoMl9hdXRoX3BhdGh9"/&gt;
                    &lt;L7p:VariableToSet stringValue="authServer"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="authServer"/&gt;
                    &lt;L7p:Regex stringValue="//localhost:"/&gt;
                    &lt;L7p:RegexName stringValue="Replace localhost"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="//${request.url.host}:"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CookieCredentialSource&gt;
                    &lt;L7p:CookieName stringValue="l7otk2imp"/&gt;
                    &lt;/L7p:CookieCredentialSource&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cookie.l7otk2imp}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjb29raWUubDdvdGsyaW1wfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="none"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;/L7p:TrueAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="get current token session id"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="4fb19dfb-0d61-4ec1-a843-b0493badf7da"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${clearSessionForm}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2imp="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="callapi"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="callapi"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjdXJyZW50X3Rva2VufQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRhcmdldH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="target_url"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="R0VU"/&gt;
                    &lt;L7p:VariableToSet stringValue="target_http_method"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="9481f86f-4c50-4500-b496-a5fa5a4a98b9"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="GET"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${request.http.parameter.target}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="${authorization_header}"/&gt;
                    &lt;L7p:Name stringValue="authorization"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Call API"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.access_token}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnVybC5xdWVyeX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtzZXNzaW9uVmFsdWV9DQoNClRoZSBhY2Nlc3MgdG9rZW4gd2FzIGV4dHJhY3RlZCBmcm9tIHRoZSBmcmFnbWVudCBjb21wb25lbnQu"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:TargetVariable stringValue="tokenSessionId"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHt0b2tlblNlc3Npb25JZFswXX0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2imp=${tokenSessionId[0]}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Handshake callback"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="clearSession"/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="clearSession"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cacheKey}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/delete"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Tm8gY3VycmVudCB0b2tlbi4="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2imp="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Clear session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.error}"/&gt;
                    &lt;L7p:Expression2 stringValue="access_denied"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="access_denied"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="QWNjZXNzIHdhcyBkZW5pZWQu"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorMessage"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Denied"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.error}"/&gt;
                    &lt;L7p:Expression2 stringValue="invalid_request"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="invalid_request"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="VGhlIHJlcXVlc3Qgd2FzIGludmFsaWQuIFBsZWFzZSB0cnkgYWdhaW4u"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorMessage"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Invalid"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.error}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="QW4gZXJyb3IgaGFzIG9jY3VycmVkOiAke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuZXJyb3J9"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorMessage"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Unknown error"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnVybC5xdWVyeX0NCg0KJHtlcnJvck1lc3NhZ2V9"/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:TargetVariable stringValue="tokenSessionId"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHt0b2tlblNlc3Npb25JZH0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2imp=${tokenSessionId[0]}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Error"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="JHtodG1sVGVtcGxhdGVUb3B9CiAKPGRpdiBpZD0iY29udGVudCI+CgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPiAKCWlmICh3aW5kb3cubG9jYXRpb24uaGFzaC5sZW5ndGggIT0gMCkgewoJLy8gUGFyc2UgZnJnZW1lbnQgY29tcG9uZW50LgoJdmFyIHF1ZXJ5U3RyaW5nID0gbG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSk7CgkKCS8vIFNlbmQgdGhlIGZyYWdtZW50IHRvIHRoZSBzZXJ2ZXIuCgl3aW5kb3cubG9jYXRpb24gPSAiJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9PyIgKyBxdWVyeVN0cmluZwoJfQoJPC9zY3JpcHQ+CgoJPElGUkFNRSBpZD1teWlmcmFtZSBzcmM9IiIgc3R5bGU9J2Rpc3BsYXk6bm9uZScgZnJhbWVib3JkZXI9IjAiIHNjcm9sbGluZz0iYXV0byI+Cgk8L0lGUkFNRT4KCTxkaXYgaWQ9ImNvbnRlbnRfbGFuZGluZ19wYWdlIj4gICAgICAgICAgICAgIAoJPGRpdiBjbGFzcz0idmlldyB2aWV3LXByb2R1Y3RzMyB2aWV3LWlkLXByb2R1Y3RzMyB2aWV3LWRpc3BsYXktaWQtcGFnZV8xIHZpZXctZG9tLWlkLTEiPgkJCgkJPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KCQk8ZGl2IGNsYXNzPSJ0aXRsZS1ib3giPgoJCTxoMT5PQXV0aFYyQ2xpZW50PC9oMT4KCQk8YnIgLz4KCQk8aDM+T0F1dGggdmVyc2lvbjogJHtvYXV0aDJfdmVyc2lvbn08L2gzPgoJCTxiciAvPgoJCTxoMz5HcmFudCB0eXBlOiBJbXBsaWNpdDwvaDM+CgkJPGJyIC8+CgkJPGgzPkN1cnJlbnQgQWNjZXNzIFRva2VuOjwvaDM+CgkJPGJyIC8+CiAgICAgICAgICAgICAgICAke2NsZWFyU2Vzc2lvbkZvcm19CgkJPHA+PHByZT4KJHtjdXJyZW50X3Rva2VufQoJCTwvcHJlPgoJCTwvcD4KCQk8L2Rpdj4KCQk8L2Rpdj4KCQkJPGNhcHRpb24+PGg0PjxiPjwvYj48L2g0Pjxocj48cD48L3A+PC9jYXB0aW9uPgoJCTwvZGl2PgoKCQkgPGRpdiBjbGFzcz0idmlldyB2aWV3LXByb2R1Y3RzMyB2aWV3LWlkLXByb2R1Y3RzMyB2aWV3LWRpc3BsYXktaWQtcGFnZV8xIHZpZXctZG9tLWlkLTEiPgkJCgkJPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KCQk8YnIgLz4KCgkJCgkJPGgzPkluaXRpYXRlIG5ldyBPQXV0aCBoYW5kc2hha2U8L2gzPgoJCTxiciAvPgoKCQk8Zm9ybSBhY3Rpb249IiR7YXV0aFNlcnZlcn0iPgoJCQk8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJjbGllbnRfaWQiCgkJCQkJCQl2YWx1ZT0iJHtvYXV0aDJfY2xpZW50X2lkfSIvPgoJCQk8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJyZWRpcmVjdF91cmkiCgkJCQkJCQl2YWx1ZT0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9Ii8+CgkJCTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InJlc3BvbnNlX3R5cGUiCgkJCQkJCQl2YWx1ZT0idG9rZW4iLz4KCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2NvcGUiCgkJCQkJCQl2YWx1ZT0iJHtvYXV0aDJfc2NvcGV9Ii8+CgkJCTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN0YXRlIgoJCQkJCQkJdmFsdWU9InN0YXRlX3Rlc3QiLz4KCQkJCQkJCQoJCQk8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iSW5pdGlhdGUiLz4JCQkKCQk8L2Zvcm0+CgoJCTxiciAvPjxiciAvPjxiciAvPgoJCQoJCTxoMz5DYWxsIEFQSSBVc2luZyBDdXJyZW50IEFjY2VzcyBUb2tlbjwvaDM+CgkJPGJyIC8+CgoJCTxmb3JtIGFjdGlvbj0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9Ij4KCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIgoJCQkJCQkJdmFsdWU9ImNhbGxhcGkiLz4KCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic3RhdGUiCgkJCQkJCQl2YWx1ZT0ic3RhdGVfdGVzdCIvPgoJCQlUYXJnZXQ6IDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJ0YXJnZXQiIHNpemU9ODAgdmFsdWU9IiR7YXBpY2FsbHRhcmdldH0iLz4KCQkJPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkNhbGwgQVBJIi8+CgkJPC9mb3JtPgoJCTxiciAvPgoJCTxwPjxwcmU+CiR7YXBpb3V0cHV0fQoJCTwvcHJlPgoJCTwvcD4KCQkKCQk8L2Rpdj4KCQkJPGNhcHRpb24+PGg0PjxiPjwvYj48L2g0Pjxocj48cD48L3A+PC9jYXB0aW9uPgoJPC9kaXY+CjwvZGl2Pgo8L2Rpdj4KCiR7aHRtbFRlbXBsYXRlQm90dG9tfQ=="/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a7890"
                version="6">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a75e1" id="57477c668279c3c8d34da687b89a7890" version="6">
            <l7:Name>authorization code</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/v2/client/authcode*</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>2</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="3">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This is a test client for an OAuth 2 implementation using the                     authorization code grant type"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion/&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="YXV0aGNvZGU="/&gt;
                    &lt;L7p:VariableToSet stringValue="client_page"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="6042809d-5ef7-4bb1-a9f3-af3584a06d5c"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="e503f8c2-0466-478d-937d-87c5a5f19bee"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtob3N0X29hdXRoMl9hdXRoX3NlcnZlcn0ke29hdXRoMl9hdXRoX3BhdGh9"/&gt;
                    &lt;L7p:VariableToSet stringValue="authServer"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="authServer"/&gt;
                    &lt;L7p:Regex stringValue="//localhost:"/&gt;
                    &lt;L7p:RegexName stringValue="Replace localhost"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="//${request.url.host}:"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9"/&gt;
                    &lt;L7p:VariableToSet stringValue="redirectUri"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CookieCredentialSource&gt;
                    &lt;L7p:CookieName stringValue="l7otk2ac"/&gt;
                    &lt;/L7p:CookieCredentialSource&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cookie.l7otk2ac}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjb29raWUubDdvdGsyYWN9"/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="none"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;/L7p:TrueAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="get current token session id"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="4fb19dfb-0d61-4ec1-a843-b0493badf7da"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${clearSessionForm}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2ac="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="refresh"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="refresh"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="rt"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="current_token"/&gt;
                    &lt;L7p:Regex stringValue="\&amp;quot;refresh_token\&amp;quot;\s*\:\s*\&amp;quot;([^&amp;quot;]*)\&amp;quot;"/&gt;
                    &lt;L7p:RegexName stringValue="isolate the refresh token"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtydFsxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="refresh_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Z3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuJnJlZnJlc2hfdG9rZW49JHtyZWZyZXNoX3Rva2VufSZzY29wZT0ke29hdXRoMl9zY29wZX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="postMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CurrentSecurityHeaderHandling intValue="3"/&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="POST"/&gt;
                    &lt;L7p:Login stringValue="${oauth2_client_id}"/&gt;
                    &lt;L7p:Password stringValue="${oauth2_client_secret}"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth2_auth_server}${oauth2_token_path}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="application/xml"/&gt;
                    &lt;L7p:Name stringValue="accept"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="postMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="3MVG94DzwlYDSHS6GTCNPxF87RQ8HrxbojWk89by7fE_H4ch8TsfZcaIFz.jdne83WCVPiD_xA93_Y8j4iomk"/&gt;
                    &lt;L7p:Name stringValue="client_id"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="https://ssg61.l7tech.com:8443/salesforce/oauth/callback"/&gt;
                    &lt;L7p:Name stringValue="redirect_uri"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="4922422941220601472"/&gt;
                    &lt;L7p:Name stringValue="client_secret"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="authorization_code"/&gt;
                    &lt;L7p:Name stringValue="grant_type"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="${request.http.parameter.code}"/&gt;
                    &lt;L7p:Name stringValue="code"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmVmcmVzaGVkLg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Refresh"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="callapi"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="callapi"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjdXJyZW50X3Rva2VufQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRhcmdldH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="target_url"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="R0VU"/&gt;
                    &lt;L7p:VariableToSet stringValue="target_http_method"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="9481f86f-4c50-4500-b496-a5fa5a4a98b9"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="GET"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${request.http.parameter.target}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="${authorization_header}"/&gt;
                    &lt;L7p:Name stringValue="authorization"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Call API"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.code}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Z3JhbnRfdHlwZT1hdXRob3JpemF0aW9uX2NvZGUmY29kZT0ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuY29kZX0mcmVkaXJlY3RfdXJpPSR7cmVkaXJlY3RVcml9JmNsaWVudF9pZD0ke29hdXRoMl9jbGllbnRfaWR9JmNsaWVudF9zZWNyZXQ9JHtvYXV0aDJfY2xpZW50X3NlY3JldH0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="postMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CurrentSecurityHeaderHandling intValue="3"/&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="POST"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth2_auth_server}${oauth2_token_path}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="application/xml"/&gt;
                    &lt;L7p:Name stringValue="accept"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="postMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmV0cmlldmVkIGJ5IGNsaWVudCB2aWEgYSBjYWxsYmFjayB0byB0aGUgDQphdXRob3JpemF0aW9uIHNlcnZlciBiYXNlZCBvbiB0aGUgYXV0aG9yaXphdGlvbiBjb2RlIHZhbHVlIA0KcmV0dXJuZWQgKCR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5jb2RlfSkgb24gdGhlIHJlZGlyZWN0aW9uDQpiYWNrIGZyb20gdGhlIGF1dGhvcml6YXRpb24gc2VydmVyLg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:TargetVariable stringValue="tokenSessionId"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHt0b2tlblNlc3Npb25JZFswXX0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2ac=${tokenSessionId[0]}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Handshake callback"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="clearSession"/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="clearSession"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cacheKey}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/delete"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Tm8gY3VycmVudCB0b2tlbi4="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2ac="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Clear session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.error}"/&gt;
                    &lt;L7p:Expression2 stringValue="access_denied"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="access_denied"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="QWNjZXNzIHdhcyBkZW5pZWQu"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorMessage"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Denied"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.error}"/&gt;
                    &lt;L7p:Expression2 stringValue="invalid_request"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="invalid_request"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="VGhlIHJlcXVlc3Qgd2FzIGludmFsaWQuIFBsZWFzZSB0cnkgYWdhaW4u"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorMessage"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Invalid"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.error}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="QW4gZXJyb3IgaGFzIG9jY3VycmVkOiAke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuZXJyb3J9"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorMessage"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Unknown error"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiIiwNCiAgInRva2VuX3R5cGUiOiIiLA0KICAiZXhwaXJlc19pbiI6LA0KICAicmVmcmVzaF90b2tlbiI6IiIsDQogICJzY29wZSI6IiINCn0NCg0KJHtlcnJvck1lc3NhZ2V9"/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiIiwNCiAgInRva2VuX3R5cGUiOiIiLA0KICAiZXhwaXJlc19pbiI6LA0KICAicmVmcmVzaF90b2tlbiI6IiIsDQogICJzY29wZSI6IiINCn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:TargetVariable stringValue="tokenSessionId"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHt0b2tlblNlc3Npb25JZH0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2ac=${tokenSessionId[0]}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Error"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9Cgo8ZGl2IGlkPSJjb250ZW50Ij4KCgk8SUZSQU1FIGlkPW15aWZyYW1lIHNyYz0iIiBzdHlsZT0nZGlzcGxheTpub25lJyBmcmFtZWJvcmRlcj0iMCIgc2Nyb2xsaW5nPSJhdXRvIj4KCTwvSUZSQU1FPgoJCTxkaXYgaWQ9ImNvbnRlbnRfbGFuZGluZ19wYWdlIj4gICAgICAgICAgICAgIAoJCTxkaXYgY2xhc3M9InZpZXcgdmlldy1wcm9kdWN0czMgdmlldy1pZC1wcm9kdWN0czMgdmlldy1kaXNwbGF5LWlkLXBhZ2VfMSB2aWV3LWRvbS1pZC0xIj4JCQoJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CgkJPGRpdiBjbGFzcz0idGl0bGUtYm94Ij4KCQk8aDE+T0F1dGhWMkNsaWVudDwvaDE+CgkJPGJyIC8+CgkJPGgzPk9BdXRoIHZlcnNpb246ICR7b2F1dGgyX3ZlcnNpb259PC9oMz4KCQk8YnIgLz4KCQk8aDM+R3JhbnQgdHlwZTogQXV0aG9yaXphdGlvbiBjb2RlPC9oMz4KCQk8YnIgLz4KCQk8aDM+Q3VycmVudCBBY2Nlc3MgVG9rZW46PC9oMz4KCQk8YnIgLz4KICAgICAgICAgICAgICAgICR7Y2xlYXJTZXNzaW9uRm9ybX0KCQk8cD48cHJlPgoke2N1cnJlbnRfdG9rZW59CgkJPC9wcmU+CgkJPC9wPgoJCTwvZGl2PgoJCTwvZGl2PgoJCQk8Y2FwdGlvbj48aDQ+PGI+PC9iPjwvaDQ+PGhyPjxwPjwvcD48L2NhcHRpb24+CgkJPC9kaXY+CgoJCSA8ZGl2IGNsYXNzPSJ2aWV3IHZpZXctcHJvZHVjdHMzIHZpZXctaWQtcHJvZHVjdHMzIHZpZXctZGlzcGxheS1pZC1wYWdlXzEgdmlldy1kb20taWQtMSI+CQkKCQk8ZGl2IGNsYXNzPSJjb250YWluZXIiPgoJCTxiciAvPgoKCQkKCQk8aDM+SW5pdGlhdGUgbmV3IE9BdXRoIGhhbmRzaGFrZTwvaDM+CgkJPGJyIC8+CgoJCTxmb3JtIGFjdGlvbj0iJHthdXRoU2VydmVyfSI+CgkJCTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InJlc3BvbnNlX3R5cGUiCgkJCQkJCQl2YWx1ZT0iY29kZSIvPgoJCQk8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJjbGllbnRfaWQiCgkJCQkJCQl2YWx1ZT0iJHtvYXV0aDJfY2xpZW50X2lkfSIvPgoJCQk8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJyZWRpcmVjdF91cmkiCgkJCQkJCQl2YWx1ZT0iJHtyZWRpcmVjdFVyaX0iLz4KCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2NvcGUiCgkJCQkJCQl2YWx1ZT0iJHtvYXV0aDJfc2NvcGV9Ii8+CgkJCTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN0YXRlIgoJCQkJCQkJdmFsdWU9InN0YXRlX3Rlc3QiLz4KCgkJCTxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJJbml0aWF0ZSIvPgkJCQoJCTwvZm9ybT4KCgkJPGJyIC8+PGJyIC8+PGJyIC8+CgoJCTxoMz5SZWZyZXNoIEN1cnJlbnQgQWNjZXNzIFRva2VuPC9oMz4KCQk8YnIgLz4KCgoJCTxmb3JtIGFjdGlvbj0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9Ij4KCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIgoJCQkJCQkgIHZhbHVlPSJyZWZyZXNoIi8+CgkJCTxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJSZWZyZXNoIi8+CgkJPC9mb3JtPgoKCQk8YnIgLz48YnIgLz48YnIgLz4KCQkKCQk8aDM+Q2FsbCBBUEkgVXNpbmcgQ3VycmVudCBBY2Nlc3MgVG9rZW48L2gzPgoJCTxiciAvPgoKCQk8Zm9ybSBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSI+CgkJCTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImFjdGlvbiIKCQkJCQkJICB2YWx1ZT0iY2FsbGFwaSIvPgoJCQk8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJzdGF0ZSIKCQkJCQkJICB2YWx1ZT0ic3RhdGVfdGVzdCIvPgoJCQlUYXJnZXQ6IDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJ0YXJnZXQiIHNpemU9ODAgdmFsdWU9IiR7YXBpY2FsbHRhcmdldH0iLz4KCQkJPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkNhbGwgQVBJIi8+CgkJPC9mb3JtPgoJCTxiciAvPgoJCTxwPjxwcmU+CiR7YXBpb3V0cHV0fQoJCTwvcHJlPgoJCTwvcD4KCQkKCQk8L2Rpdj4KCQkJPGNhcHRpb24+PGg0PjxiPjwvYj48L2g0Pjxocj48cD48L3A+PC9jYXB0aW9uPgoJCTwvZGl2PgoKCTwvZGl2Pgo8L2Rpdj4KCiR7aHRtbFRlbXBsYXRlQm90dG9tfQ=="/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a7a0a"
                version="2">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a75e1" id="57477c668279c3c8d34da687b89a7a0a" version="2">
            <l7:Name>client credentials</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/v2/client/clientcreds*</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>2</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This is a test client for an OAuth 2 implementation using the client                     credentials grant type"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion/&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2xpZW50Y3JlZHM="/&gt;
                    &lt;L7p:VariableToSet stringValue="client_page"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="6042809d-5ef7-4bb1-a9f3-af3584a06d5c"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="e503f8c2-0466-478d-937d-87c5a5f19bee"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CookieCredentialSource&gt;
                    &lt;L7p:CookieName stringValue="l7otk2cc"/&gt;
                    &lt;/L7p:CookieCredentialSource&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cookie.l7otk2cc}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjb29raWUubDdvdGsyY2N9"/&gt;
                    &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="check cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="none"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;/L7p:TrueAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="get current token session id"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="4fb19dfb-0d61-4ec1-a843-b0493badf7da"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${clearSessionForm}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="clear cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2cc="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="callapi"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="callapi"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjdXJyZW50X3Rva2VufQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRhcmdldH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="target_url"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="R0VU"/&gt;
                    &lt;L7p:VariableToSet stringValue="target_http_method"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="9481f86f-4c50-4500-b496-a5fa5a4a98b9"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="GET"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${request.http.parameter.target}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="${authorization_header}"/&gt;
                    &lt;L7p:Name stringValue="authorization"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="apioutput"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Call API"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="handshake"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="handshake"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Z3JhbnRfdHlwZT1jbGllbnRfY3JlZGVudGlhbHMmc2NvcGU9JHtvYXV0aDJfc2NvcGV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="postMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_id"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="oauth2_client_secret"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CurrentSecurityHeaderHandling intValue="3"/&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:HttpMethod httpMethod="POST"/&gt;
                    &lt;L7p:Login stringValue="${oauth2_client_id}"/&gt;
                    &lt;L7p:Password stringValue="${oauth2_client_secret}"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth2_auth_server}${oauth2_token_path}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:CustomizeValue stringValue="application/xml"/&gt;
                    &lt;L7p:Name stringValue="accept"/&gt;
                    &lt;L7p:UsesCustomizedValue booleanValue="true"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="postMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmV0cmlldmVkLg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:TargetVariable stringValue="tokenSessionId"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHt0b2tlblNlc3Npb25JZFswXX0mdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGZvcm0gYWN0aW9uPSIiPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiIvPgkJCQ0KPC9mb3JtPg0KPGJyIC8+"/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2cc=${tokenSessionId[0]}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Handshake"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="clearSession"/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="clearSession"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${cacheKey}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteMsg"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/delete"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteMsg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Tm8gY3VycmVudCB0b2tlbi4="/&gt;
                    &lt;L7p:VariableToSet stringValue="current_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="clearSessionForm"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2cc="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Clear session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9CjxkaXYgaWQ9ImNvbnRlbnQiPgoJCTxJRlJBTUUgaWQ9bXlpZnJhbWUgc3JjPSIiIHN0eWxlPSdkaXNwbGF5Om5vbmUnIGZyYW1lYm9yZGVyPSIwIiBzY3JvbGxpbmc9ImF1dG8iPgoJCTwvSUZSQU1FPgogICAgICAgICAgICAgICAgPGRpdiBpZD0iY29udGVudF9sYW5kaW5nX3BhZ2UiPiAgICAgICAgICAgICAgCgkJCTxkaXYgY2xhc3M9InZpZXcgdmlldy1wcm9kdWN0czMgdmlldy1pZC1wcm9kdWN0czMgdmlldy1kaXNwbGF5LWlkLXBhZ2VfMSB2aWV3LWRvbS1pZC0xIj4JCQoJCQkJPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KCQkJCTxkaXYgY2xhc3M9InRpdGxlLWJveCI+CgkJCQk8aDE+T0F1dGhWMkNsaWVudDwvaDE+CgkJCQk8YnIgLz4KCQkJCTxoMz5PQXV0aCB2ZXJzaW9uOiAke29hdXRoMl92ZXJzaW9ufTwvaDM+CgkJCQk8YnIgLz4KCQkJCTxoMz5HcmFudCB0eXBlOiBDbGllbnQgY3JlZGVudGlhbHM8L2gzPgoJCQkJPGJyIC8+CgkJCQk8aDM+Q3VycmVudCBBY2Nlc3MgVG9rZW46PC9oMz4KCQkJCTxiciAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7Y2xlYXJTZXNzaW9uRm9ybX0KCQkJCTxwPjxwcmU+CiR7Y3VycmVudF90b2tlbn0KCQkJCTwvcHJlPgoJCQkJPC9wPgoJCQkJPC9kaXY+CgkJCQk8L2Rpdj4KCQkJICAgICAgICA8Y2FwdGlvbj48aDQ+PGI+PC9iPjwvaDQ+PGhyPjxwPjwvcD48L2NhcHRpb24+CgkJICAgIAk8L2Rpdj4KCiAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmlldyB2aWV3LXByb2R1Y3RzMyB2aWV3LWlkLXByb2R1Y3RzMyB2aWV3LWRpc3BsYXktaWQtcGFnZV8xIHZpZXctZG9tLWlkLTEiPgkJCgkJCQk8ZGl2IGNsYXNzPSJjb250YWluZXIiPgoJCQkJPGJyIC8+CgoJCQkJCgkJCQk8aDM+SW5pdGlhdGUgbmV3IE9BdXRoIGhhbmRzaGFrZTwvaDM+CgkJCQk8YnIgLz4KCgkJCQk8Zm9ybSBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSI+CiAgIAkJCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIgogICAgICAgICAgICAgICAgICAgIAkJCQl2YWx1ZT0iaGFuZHNoYWtlIi8+CgkJCQkJPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkluaXRpYXRlIi8+CgkJCQk8L2Zvcm0+CgoJCQkJPGJyIC8+PGJyIC8+PGJyIC8+CgkJCQkKCQkJCTxoMz5DYWxsIEFQSSBVc2luZyBDdXJyZW50IEFjY2VzcyBUb2tlbjwvaDM+CgkJCQk8YnIgLz4KCgkJCQk8Zm9ybSBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSI+CiAgIAkJCQkJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIgogICAgICAgICAgICAgICAgICAgIAkJCQl2YWx1ZT0iY2FsbGFwaSIvPgoJCQkJCTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN0YXRlIgogICAgICAgICAgICAgICAgICAgIAkJCQl2YWx1ZT0ic3RhdGVfdGVzdCIvPgoJCQkJCVRhcmdldDogPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InRhcmdldCIgc2l6ZT04MCB2YWx1ZT0iJHthcGljYWxsdGFyZ2V0fSIvPgoJCQkJCTxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJDYWxsIEFQSSIvPgoJCQkJPC9mb3JtPgoJCQkJPGJyIC8+CgkJCQk8cD48cHJlPgoke2FwaW91dHB1dH0KCQkJCTwvcHJlPgoJCQkJPC9wPgoJCQkJCgkJCQk8L2Rpdj4KCQkJICAgICAgICA8Y2FwdGlvbj48aDQ+PGI+PC9iPjwvaDQ+PGhyPjxwPjwvcD48L2NhcHRpb24+CgkgICAgCTwvZGl2PgoKCgkJPC9kaXY+CjwvZGl2PgoKJHtodG1sVGVtcGxhdGVCb3R0b219"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a790e"
                version="2">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a7661" id="57477c668279c3c8d34da687b89a790e" version="2">
            <l7:Name>oauth/v2</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/auth/oauth/v2/authorize/website</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>1</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="0">&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;&lt;L7p:Comment stringValue="Component version 2.0 installed by OAuth
                    installer version otk2.0"/&gt;&lt;/L7p:CommentAssertion&gt;&lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="T0F1dGggMi4wIEF1dGhvcml6YXRpb24gU2VydmVy"/&gt;
                    &lt;L7p:VariableToSet stringValue="this.app.name"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCmJvZHkuZHJhZ3tjdXJzb3I6bW92ZTt9dGguYWN0aXZlIGltZ3tkaXNwbGF5OmlubGluZTt9dHIuZXZlbix0ci5vZGR7YmFja2dyb3VuZC1jb2xvcjojZWVlO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNjY2M7cGFkZGluZzowLjFlbSAwLjZlbTt9DQp0ci5kcmFne2JhY2tncm91bmQtY29sb3I6I2ZmZmZmMDt9dHIuZHJhZy1wcmV2aW91c3tiYWNrZ3JvdW5kLWNvbG9yOiNmZmQ7fQ0KdGQuYWN0aXZle2JhY2tncm91bmQtY29sb3I6I2RkZDt9dGQuY2hlY2tib3gsdGguY2hlY2tib3h7dGV4dC1hbGlnbjpjZW50ZXI7fQ0KdGJvZHl7Ym9yZGVyLXRvcDoxcHggc29saWQgI2NjYzt9dGJvZHkgdGh7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2NjYzt9DQp0aGVhZCB0aHt0ZXh0LWFsaWduOmxlZnQ7DQogIHBhZGRpbmctcmlnaHQ6MWVtOw0KICBib3JkZXItYm90dG9tOjNweCBzb2xpZCAjY2NjO30NCi5icmVhZGNydW1ie3BhZGRpbmctYm90dG9tOi41ZW19ZGl2LmluZGVudGF0aW9ue3dpZHRoOjIwcHg7aGVpZ2h0OjEuN2VtO21hcmdpbjotMC40ZW0gMC4yZW0gLTAuNGVtIC0wLjRlbTsNCiAgcGFkZGluZzowLjQyZW0gMCAwLjQyZW0gMC42ZW07DQogIGZsb2F0OmxlZnQ7fQ0KdWwucHJpbWFyeXtib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7cGFkZGluZzowIDAgMCAxZW07DQogIHdoaXRlLXNwYWNlOm5vd3JhcDtsaXN0LXN0eWxlOm5vbmU7bWFyZ2luOjVweDtoZWlnaHQ6YXV0bztsaW5lLWhlaWdodDpub3JtYWw7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2JiYjt9DQp1bC5wcmltYXJ5IGxpe2Rpc3BsYXk6aW5saW5lO311bC5wcmltYXJ5IGxpIGF7YmFja2dyb3VuZC1jb2xvcjojZGRkO2JvcmRlci1jb2xvcjojYmJiO2JvcmRlci13aWR0aDoxcHg7Ym9yZGVyLXN0eWxlOnNvbGlkIHNvbGlkIG5vbmUgc29saWQ7aGVpZ2h0OmF1dG87bWFyZ2luLXJpZ2h0OjAuNWVtOw0KICBwYWRkaW5nOjAgMWVtO3RleHQtZGVjb3JhdGlvbjpub25lO311bC5wcmltYXJ5IGxpLmFjdGl2ZSBhe2JhY2tncm91bmQtY29sb3I6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICNiYmI7Ym9yZGVyLWJvdHRvbTojZmZmIDFweCBzb2xpZDt9DQp1bC5wcmltYXJ5IGxpIGE6aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojZWVlO2JvcmRlci1jb2xvcjojY2NjO2JvcmRlci1ib3R0b20tY29sb3I6I2VlZTt9dWwuc2Vjb25kYXJ5e2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNiYmI7cGFkZGluZzowLjVlbSAxZW07bWFyZ2luOjVweDt9DQoNCip7bWFyZ2luOjA7fQ0KaHRtbCxib2R5e2JhY2tncm91bmQ6I2ZmZjtmb250OjEycHgvMS4yZW0gaGVsdmV0aWNhLGFyaWFsLHNhbnMtc2VyaWY7Y29sb3I6IzRiNGI0YjtoZWlnaHQ6MTAwJTtsaW5lLWhlaWdodDoxLjNlbTt9DQpocntoZWlnaHQ6MXB4O2JhY2tncm91bmQtY29sb3I6I2RkZDsgbm8tcmVwZWF0IGNlbnRlciBib3R0b207cGFkZGluZzo4cHggYXV0bztib3JkZXI6MCBub25lO30NCmlucHV0e2NvbG9yOiM0YjRiNGI7fQ0KaDEsaDIsaDMsaDQsaDUsaDZ7cGFkZGluZzowO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LWZhbWlseTpoZWx2ZXRpY2EsYXJpYWwsc2Fucy1zZXJpZjt9DQpoMXtmb250LXNpemU6MjUwJTtjb2xvcjp3aGl0ZTt6LWluZGV4OjU7fQ0KaDJ7Zm9udC1zaXplOjE3NSU7fQ0KaDN7Zm9udC1zaXplOjE1MCU7fQ0KaDR7Zm9udC1zaXplOjEyMCU7fQ0KaDV7Zm9udC1zaXplOjExMCU7fQ0KaDZ7Zm9udC1zaXplOjEwNSU7fQ0KYTphY3RpdmUsYS5hY3RpdmV7Y29sb3I6IzRiNGI0Yjt0ZXh0LWRlY29yYXRpb246bm9uZTt9DQphOmxpbmssYTp2aXNpdGVke2NvbG9yOiM0YjRiNGI7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTtvdXRsaW5lOm5vbmU7fQ0KYTpob3Zlcntjb2xvcjojZGIzYjJjO3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmU7fQ0KcHttYXJnaW4tYm90dG9tOi41ZW07bGluZS1oZWlnaHQ6MS4zZW07bGlzdC1zdHlsZTpub25lO3RleHQtYWxpZ246bGVmdDtsaW5lLWhlaWdodDoxLjVlbTtjb2xvcjojNGI0YjRiO30NCmJsb2NrcXVvdGUgKnttYXJnaW46NXB4IDAgMCAxMHB4O311bHtsaW5lLWhlaWdodDoxLjVlbTsNCnBhZGRpbmc6LjJlbSAxZW0gMWVtIDFlbTt9b2x7bGluZS1oZWlnaHQ6MS41ZW07cGFkZGluZzouMmVtIDFlbSAxZW0gMWVtO310ci5ldmVuLHRyLm9kZHtiYWNrZ3JvdW5kOm5vbmU7fWltZyxhIGltZ3tib3JkZXI6bm9uZTt9DQpuby1yZXBlYXQgbGVmdCAzNSU7bWFyZ2luLWxlZnQ6LjVlbTtwYWRkaW5nLWxlZnQ6MWVtO30NCiN3cmFwcGVye21pbi1oZWlnaHQ6MTAwJTtoZWlnaHQ6YXV0byAhaW1wb3J0YW50O2hlaWdodDoxMDAlO21hcmdpbjowIGF1dG8gLTVlbTt9I2NvbnRhaW5lcnttYXJnaW46LTIuNWVtIGF1dG8gMCAyLjVlbTt9DQouZmllbGQtY29udGVudCAudmlldy1kb20taWQtNSAudmlldy1jb250ZW50IC52aWV3cy1yb3d7DQogICAgbWFyZ2luOjBweDtwYWRkaW5nOjBweDt9DQoNCiNzaWRlYmFyLWxlZnR7cG9zaXRpb246cmVsYXRpdmU7ZmxvYXQ6bGVmdDtjbGVhcjpsZWZ0O3BhZGRpbmc6MmVtIDAgNmVtIDA7ei1pbmRleDo1MDA7d2lkdGg6MTMuNWVtO30NCiNzaWRlYmFyLWxlZnQgLmNvbnRlbnR7bWFyZ2luLXRvcDouOGVtO30NCiNzaWRlYmFyLWxlZnQgYXtkaXNwbGF5OmJsb2NrO2xpbmUtaGVpZ2h0OjEuMmVtO3BhZGRpbmc6M3B4IDAgMXB4IDNweDt0ZXh0LWRlY29yYXRpb246bm9uZTtmb250LXNpemU6MTA1JTttYXJnaW4tbGVmdDozcHg7bWFyZ2luLXJpZ2h0OjNweDt9DQojc2lkZWJhci1sZWZ0IHVse3dpZHRoOjEzLjVlbTtkaXNwbGF5OmJsb2NrO2xpc3Qtc3R5bGU6bm9uZTt9DQojc2lkZWJhci1sZWZ0IHVsIHVse25vLXJlcGVhdCBjZW50ZXIgdG9wO3BhZGRpbmctbGVmdDouMmVtO30NCiNzaWRlYmFyLWxlZnQgYTpob3ZlciwNCiNzaWRlYmFyLWxlZnQgYS5hY3RpdmV7YmFja2dyb3VuZC1jb2xvcjojZDgzYjJjO2NvbG9yOndoaXRlO30NCiNzaWRlYmFyLWxlZnQgLm5vbGluay1saXtwYWRkaW5nLXRvcDoxLjNlbTt9DQojc2lkZWJhci1sZWZ0IC5maXJzdC5ub2xpbmstbGl7cGFkZGluZy10b3A6MDt9DQojc2lkZWJhci1sZWZ0IC5ub2xpbmt7Y29sb3I6IzIzMjAyMTtmb250LXNpemU6MTIwJTtmb250LXdlaWdodDo2MDA7fQ0KI3NpZGViYXItbGVmdCAubWVudS1uYW1lLW1lbnUtcmVzb3VyY2VzIC5ub2xpbmt7Zm9udC13ZWlnaHQ6MTAwO2ZvbnQtc2l6ZToxMDUlO30NCiNzaWRlYmFyLWxlZnQgbGkubGVhZntib3JkZXI6bm9uZTt0ZXh0LWluZGVudDpub25lOyBuby1yZXBlYXQgY2VudGVyIGJvdHRvbTtkaXNwbGF5OmJsb2NrO3BhZGRpbmc6MXB4IDAgMnB4O30NCiNzaWRlYmFyLWxlZnQgdWwgdWwgbGkuZmlyc3R7cGFkZGluZy10b3A6MnB4O30NCg0KLnZpZXctY29udGVudCBoNHtmb250LXNpemU6MTAwJTt9I25hdmlnYXRpb257cG9zaXRpb246cmVsYXRpdmU7Ym9yZGVyOjBweCBzb2xpZCByZWQ7bWFyZ2luOjBweDtwYWRkaW5nOjBweDt9DQoNCi5icmVhZGNydW1ie3RleHQtYWxpZ246bGVmdDtwYWRkaW5nOjA7cG9zaXRpb246YWJzb2x1dGU7dG9wOjQuN2VtO2xlZnQ6MTUuOGVtO3otaW5kZXg6NTA7fS5icmVhZGNydW1iIGEuYWN0aXZlLC5icmVhZGNydW1iIGE6YWN0aXZle2NvbG9yOiMyMzIwMjE7dGV4dC1kZWNvcmF0aW9uOm5vbmU7fS5icmVhZGNydW1iIGE6aG92ZXJ7Y29sb3I6I2RiM2IyYzt9bGkubGVhZntkaXNwbGF5OmlubGluZTtwYWRkaW5nOjAgMC41ZW0gMCAwLjNlbTt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ym9yZGVyLXJpZ2h0OjFweCBzb2xpZCAjNzI3MjcyO30NCg0KI2hlYWRlcntoZWlnaHQ6Ni41ZW07bWF4LXdpZHRoOjEwMCU7cG9zaXRpb246cmVsYXRpdmU7fSNoZWFkZXIgI2xvZ28tZmxvYXRlcntmbG9hdDpsZWZ0O3Bvc2l0aW9uOnJlbGF0aXZlO3RvcDoxMCU7d2lkdGg6MTU5cHg7aGVpZ2h0OjUzcHg7bWFyZ2luLWxlZnQ6Mi41ZW07fWRpdiNyZXN7ZGlzcGxheTpub25lO3Zpc2liaWxpdHk6aGlkZGVuO30jbWVudWJrZ3twb3NpdGlvbjpyZWxhdGl2ZTt3aWR0aDoxMDAlO2hlaWdodDozMXB4O2JhY2tncm91bmQtY29sb3I6IzY2Njt0b3A6Ni42ZW07ei1pbmRleDowO30NCg0KZGl2Lmxpbmtze2Rpc3BsYXk6bm9uZTt9DQoNCiNjb250ZW50e21hcmdpbjo0LjNlbSBhdXRvIDFlbSAyLjVlbTt9DQouc3VibWl0dGVke2Rpc3BsYXk6bm9uZTt9LmNvbnRhaW5lcnt6LWluZGV4OjU7aGVpZ2h0OjEwMCU7cGFkZGluZy10b3A6LjJlbTt9DQoudGl0bGUtYm94IGgxe2NvbG9yOiNkYjNiMmM7bGluZS1oZWlnaHQ6MWVtO30NCg0KI25hdmlnYXRpb24gZGl2Lm1lbnUtbmFtZS1wcmltYXJ5LWxpbmtzIHVse2JvcmRlcjowO2xpc3Qtc3R5bGU6bm9uZTtoZWlnaHQ6MzFweDttYXJnaW46MDtwYWRkaW5nOjA7d2lkdGg6MTAwJTt9DQojbmF2aWdhdGlvbiBkaXYubWVudS1uYW1lLXByaW1hcnktbGlua3MgdWwgbGl7YmFja2dyb3VuZDp0cmFuc3BhcmVudDtib3JkZXI6MDtmbG9hdDpsZWZ0O21hcmdpbjowO3BhZGRpbmc6MDtsaXN0LXN0eWxlOm5vbmU7cG9zaXRpb246cmVsYXRpdmU7fQ0KI25hdmlnYXRpb24gZGl2Lm1lbnUtbmFtZS1wcmltYXJ5LWxpbmtzIHVsIGxpIGF7ZGlzcGxheTpibG9jaztoZWlnaHQ6MzFweDt0ZXh0LWluZGVudDotNTAwMHB4O30NCiNuYXZpZ2F0aW9uIGRpdi5tZW51LW5hbWUtcHJpbWFyeS1saW5rcyBsaSBhe2JhY2tncm91bmQtY29sb3I6I2NjYzt9DQojbmF2aWdhdGlvbiBkaXYubWVudS1uYW1lLXByaW1hcnktbGlua3MgbGkgYTpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNjY2M7fQ0KI25hdmlnYXRpb24gZGl2Lm1lbnUtbmFtZS1wcmltYXJ5LWxpbmtzIGxpLm1lbnUtbWxpZC0yMzkzID4gYTpob3Zlcnt9DQoNCiNib3R0b21iYXJ7cG9zaXRpb246cmVsYXRpdmU7cGFkZGluZzoyZW0gMCA2ZW0gMDt6LWluZGV4OjUwMDt3aWR0aDoxMy41ZW07Zm9udC1zaXplOjEzMCU7fQ0KI2JvdHRvbWJhciAuY29udGVudHttYXJnaW4tdG9wOi44ZW07fQ0KI2JvdHRvbWJhciBhe2xpbmUtaGVpZ2h0OjEuMmVtO3BhZGRpbmc6M3B4IDNweCAzcHggM3B4O3RleHQtZGVjb3JhdGlvbjpub25lO30NCiNib3R0b21iYXIgYTpob3ZlciwNCiNib3R0b21iYXIgYS5hY3RpdmV7Y29sb3I6I2Q4M2IyYzt9DQojYm90dG9tYmFyIGJ7Zm9udC1zaXplOjEzMyU7fQ0KDQo8L3N0eWxlPg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="website_style"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PCFET0NUWVBFIGh0bWwgUFVCTElDICItLy9XM0MvL0RURCBYSFRNTCAxLjAgU3RyaWN0Ly9FTiINCiJodHRwOi8vd3d3LnczLm9yZy9UUi94aHRtbDEvRFREL3hodG1sMS1zdHJpY3QuZHRkIj4NCjxodG1sIGNsYXNzPSJqcyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHhtbDpsYW5nPSJlbiIgZGlyPSJsdHIiIGxhbmc9ImVuIj4NCjxoZWFkPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ij4NCiAgICA8dGl0bGU+JHt0aGlzLmFwcC5uYW1lfTwvdGl0bGU+DQo8L2hlYWQ+DQoke3dlYnNpdGVfc3R5bGV9DQo8Ym9keSBjbGFzcz0ic2lkZWJhci1sZWZ0IGNyb24tY2hlY2stcHJvY2Vzc2VkIj4NCjxkaXYgaWQ9IndyYXBwZXIiPg0KPGRpdiBpZD0ibWVudWJrZyI+PC9kaXY+DQo8ZGl2IGlkPSJjb250YWluZXIiPg0KPGRpdiBpZD0iaGVhZGVyIj4NCiAgICA8ZGl2IGlkPSJsb2dvLWZsb2F0ZXIiPg0KCQk8YSB0aXRsZT0iIiBocmVmPSIke3JlcXVlc3QudXJsLnBhdGh9Ij48aW1nIGlkPSJsb2dvIiAgaGVpZ2h0PSI1MyIgd2lkdGg9IjE1OSIgYWx0PSJMYXllcjciIHNyYz0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFKOEFBQUExQ0FNQUFBQm9Rc2xhQUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUFNQlFURlJGRkJBTWpJNk83cU9sYTI5dzV1Zm45TWpKNW1GZ3lNaklUMUpTNFR3dDFkZll0TGU0K2ZuNTgvVDBwNmluWFdObStlVGwvdno3K3YzK3E3cTgrdno1K3Uvdy9mbjd3TVBFNm9lSWdJU0cwZExTK2Z2OC9mei85dmo2Ny9Eem82R2ZWVnhmOS9qM3E2NncrZmYwdWJ1OW5xS2tSRUU5Mjl6ZHk4M092OEMrOWZYMTdlN3U2dXZyNHVQazVFeElkM3Q3cnEyclhsdFhob1NCOTlqYWxaaVozK0RnTHl3b1pXUmhzck95OGZIeG5aNmQrUGo3Ky96Ny9QejgvZjM5Ly8vL0FTRERZd0FBREZwSlJFRlVlTnJVV1d0N3Fqb1dOcUxGZWdGaEtCWjMyb3ExRmF1VTNZcHVXNU9zLy8rdlpxMGtJTFoyNW5ubXc1eHpjczYyR0lKNTg2NzdvZ1YvNzlINlIrQlRVa2twaFZENkd3ZWhGTWhBcWI4SlBnVUtFVWtKc0o0YzVvdWNBRXNoYVFJdjFWK1BUeGwwZDVPRXNZUWxneGZnZ1FqMXJQcHJFYllxOFFLSWFabDhac3RsMzJQTTVVRFFDSjhlZnprK2dKMlhNTmRNTGxuaW9aQVJtelFVL25VQXJYd2h6SkprRUFPWElsQ1NpMFhDc2tmU1FRV2FRdmovQU5TN3lPLzJ5L2w2L3JuUlZxSUN4QU44VTVZZFE2Mm05MzlDK0RQdjZvZHJZd3ZmOFVrK0dpRW9kREN4aUJYQ1JGUzdUdDVmZHNqWGtKQTF5Sys3Zk45ZFdVeXF3bWVWdDlwVk5VZmwyaG9UeWpKUjM5YjRBbjR6ZmdRZWNhRUNycmdJT01MS0Z5eEp5c2thMFpQelVlZG4vV0kwcCswMUxERGJHTnRYcCtYcXpOcVVPVTBOVDlvSitSV2ZpdHV2dCtNSXRTOEt3b0NneU0ycUtEeDN4Wnl5bjJvejF0NVFuVW5OL0RaODIxNXZKSnZFV0FkbXI0U3NWMVdjNmNmbDJZTk4rVzZ2cnErdjJ6Y2hpQUFDQkRQS21EUFFkemJNV1d4Q2E4b25RS0EzcktmTS9xZlAwMTF6Tkh0RG1tblpQTVdGSVdtYzQzdEZmTmRYM1VjRmtlQXlMLzJuRDJKTkJnQnVrVXp2eUpJMWg2cnk1cktHSXB1QURBejdXWCtUTmI3R0FVUURkUFZEMVZKUUpuaForUnA4MTllM04xeHk5VkVrNVAwNDJvdFFBbDZlbkRrb0RSQXNDRU9MYXNySlRndWhUNitqbzdUWDFhelFmNFRHWlNjYTRQUTU2a2R3djIvODRYZ2RjeDUwbGdvRWo1UUkwRjRvWjFnK1FZeGlGeUFxSGFIZmpYQS9YQjFvV0lUOWx4aUs0UkNQUkVpRytJbi82VU5pcU1UdmRGZlBSMUpHMFRFMGl5SzlEbjlIeFhFVTR3aGlFZUFmeGIvcW54NVhZWWg3eGZnTENwOElTSnNEY3g2QkY0cHpmVmJBMDIwbXJqdEZueVJCUnFBem5rN211bTZXNHhsZThNSmRJejFDYmFhdTJ4OUJ4NjFHSDJkaDZtYjZ5M1N0UWg0ckNBS1EzZWJZM3NBRitlSVk4NUE4RFI1SUJzaElFQWp0VzVSd2wwWlFXa1lJOGRCcXRaNUJLNmJVMGdjSFovYXROL1FQblI1ZUZTK2tSQVZPRmkvd29PL1J2ejhZbCtEWmZtM3RlMmlISVc3QjFYVnp2SGJEaS95aEZWK2hHb1lTTXhqRUZSTmF5RXRuRUhvKzJ5bEpISklhQ2ZodDhCRzE1TkFGYk41b3cxYXZBeXFsbTYwbEt1OEhJVDBBZkxhcThmWUlCcDhkZTQraUtqNy9CUjljMGovRTE2VzdiVkE4TkJvTkw1N2ordzY4N0o1OGI0U1NESVcyWTgyZkVsYW5VVTFYWnRQbkZhcHBoNjQvWHdBOFpNbjVBTU5mK2M3ZTM3MVVDSTN2YzVNUGVuUWdDREVxeFB3THZxYitqYS9POGFFZWJrbW1LQW51RnI1UCtBUjZ4YVNZWUxRaDhVckxYeWhqUEFVRlFYaEhibWkvZHpUOWlPN3UwUXZRaEljK3ZTUWdqeDg0Um1TYWhPODNia0R3bjljUTQxdzRyZ2FCdVkwYjhnMzU3VmQ4dU9JUmpaYm56UEVOdmdDTmVuTnd5ZzBRcTVhL29ISUpTajJpZUowUzkzdkRmV0ZEQ0E1OGluL2VkaEJxL25xQkRuYlM2dDhEOHV6aXhmT0c0L05oSFN2YlJNOFlnbVorZFZMQUd0LzE3WmhEdi9CbkJoODZBUHo1ZE1reXJyUmJOUHdKVFNaNkRNaHdLNVlqWDg5b3dVSHM2ZHVPNFNrdy9Kbjl1Y1huSWI0SjRmc0FOR0VWb1pESm14RzgxMjNZOUMraENydXYzL0JkdDJIMGFkQVJmeEtmUnArNVNWeUk1Y2wrY1RkQjV3ZTJiKzEvRTZEOWdxeDZRK2I1WU9oRFFNVGZjN2JDZ1c2SFcvbUNodjJHZ3RHdW1ZZGhEQVRrdFJ0RXZKRWZTQjZxN2UwM2ZGZmp6RG5oRTlhcFQzZEEvcmppTDR6STV3aUFQN2hUcmpjc0tPT1J6THFRMytTQXRQM3VuMmxNSTJudy9mbjhMRWo5TWx3ZUNSUFpqQ1cwWTJrVEppdGZqQUxoWS9mcUM3N3I3cjhxZUFaZmhQQW1aWkxCaVQvaVRwQjFrTVcrcmFhRXFrY2lWNXBBUTU4dy9Ka3hpV1hsWDNERjNza3BCZFJueEdnZjNock5EN2hzK0JkU2QxU3Vtelp5MnozRDE2dncvUUU4STBELzA1bjFQQXh6dGYvajJqdEw3VWlJSUdKa2lSSU40WDFQQUI2R1FFNUs4L2RlRk1YN0xsREd2enkvMFdjUG5hTkdSd2xEWlJ0WWFEVGxpeXJMTWQ1Q3VHMjNiN1lYOFNVb1Njam54V3ptOTd3WGltOE4vVk5HdkxYSEpjOFJDbTNDaUpYSU1mWUw2VXVheGp3eS9MSGMxZkx0RThIRzU0KzE4aW5LUTRNbVBzenQwZFBGK2lxK3VvVFB4ZmpxTW0zTVBlOE8vVjNGWDJneXVnOHl4SUl4UmtFRXlaYWhnais0T3h1UlB6SDhXZnNsYVZuNzBDSG5YYXVyVHFpTThtbnllTlN3RDFRQml2d2l4clNGZDcvam15VnBBSzQxRm8xUFdQNVVxRDBnTFBhMEVZNFZUYWU2aEhGSXZLbkJaL2pEQ2dLTFF5bXMvd1ByZGloQ2toQm81NnNiRENka0VHZjhZZFdHa2lKRjRnRzBYOC94emZ3eWg3aFQyWExQTzBKdHY1WVNuUVo0cEFOOUNyZ1paZUVWUHZMaFRmOEgxbjdKLytrZnljSDRlRTFmbHhKeXJrQis2VjloMnNTeCtFQlhPQjUzYnh2NFpuNHlXT2FqeDNrbDZwbEhuR2orOWg2TmgxeW16OXBSVU5xRlNQY01pQTV5enArMDF1cmZzMTd0ZFd6OGZiTHhBLzJsRHVOd280MGprczJtU3V0VTZtRG1URG5WemRWcmU5dStzdmhtdnZQVVh6NFZnNGlkOE4wUkVPOWtFQWZsSWxYRm1xcGxVWWxNMXZnSWEzbGF2UmlxbXIvOGp6a05LVW5RTmRxbi9TQ2MxUittcHFDR1VCRHIvS1c3dlgzRnMweDhoMlg1d08vTkhGWGpRL3NkcGNUZm5nYjVrQldVZVBFQU9rMlk0UHh6U2ljb2FKS3VVT0c4bGxtTS8wK0dFdE9HdmNhWE1wenlYMHluZ3FUV0JhbWFOWHFyV1ZoVGJoZFYrY3YydHN0SGswV2VKYVNFRFh5enczcmFRVmY0enFyUmg5LzRpVjZQV09zOHZMT3lReHdjR0h2UGhwVHVZM1JPNnRVN3hQS0F0NmFVUnl3WnJrWUZKSXNqbVcyMXg2L0x0N1ArcVJKWW5NZU4vQVhMOUE3cnpVejhxUERObkt6ajV1ZGRFdk1sVWpyUHRFN0VGbUFxTWdBYlExaDY4RGpxdEZxYngrc1d6aHRtRFh3cUNNaUV1NmZ3aXlRVnZTcStXWHl6MlFCMkIrTEtWbUttRU1NTHJuUkNxNGVlVjFVUlo1SWNrNGNOVlpYUm1wdkNya1QrWGcyK1FGN0doM2VVaWtVamZ3bEdaZVdnVC9KOXV0ZG5yd0RVdjYrTE9BTkdhbmRXTFJDbnNyRytQQU5KZzRKZXQ5M3Uzb1JWTCtYY1BrQjdIUlh3NklmOFJScDhSY1loRXVlbmw2cXVjeFZ0VkpkUnBxa3RxNlU2c2JYek5xTFY0QU9qY3FpMVhQM1V2MGZwWWhGNk9UOXdPT0Z6RGltRlZqazhVcDBicFZUQTRpWjNSNUpvZEF4K0hkRkRpU2lTUjhRcG96VDlGUVJCTk1SU04rRGg4VTVFRkFXR3VCekw2V0g4SzZhMVE0VEwwNVR1eWFvcDhnTSt2QkZFUCtDREo5OHZONkh1RSswV2g4T3FBNXY1WVhHUHoweFlPVDFDdXNxZ1AwbGgyQi9rbzhNYWZVSEdtSnRpZGIvS0tZUGVlR3lPdFFFZkxkQzhNZHhQSnFnb3kvbkJmWUcwWHpJWHF0YkRqL3pwTkNZZS81Qy9qQmI1a0pPU1NSaE5ITFlaUWQ5M2Q2bU1YU2YzaWh4R3lSTjRDVzQybUQzZCt6bUl6TzlQL0NuQW9NREFBdXRQdGlreGN6M2kyckpjQXpCcW9oeWNhVDZFRGZ1OTlEZXFxbVIreEVmbExiK1l2emdUVUVPdEtoVExZVmVVdUdYZnozTEVWeWFqSFRMelViQk9pZWxLT3VnbGZjVEg1OG5IeGhta2lNOUZCOVF2NW1yaGRPQll6SWZySGFZYkxFRW5PaSttRzB4ajNwUHB2UWhNRStxODdkbjYwbHNOd2t2NWk1OGNkWjlBNkVSWGFud0srck9rM0tpWUpSK2sxS09rR0NRTStUdjRIbk55R1RJMnN2Z3lpQWdmVEJEMjBUOTBQcjBQTVBnR2ZuTEF4RzdKL09RbE1EbSsrdkg5Rm5WYjBJdUYzZXV2K1F1N1Y5YWJtVVROOERkMThpT1h2eGc3NWhnQzdvc3lmU0w1em90K3o4bTVtaWZIa2JNWUlqNFVNdlFSeU1LWDZxN3crSXAxb09KdmczWGF4MlM5OUplYUFWQS82eCttVmhKQkJ2RzJtYi80c3dJMW1Tby8reFlNUThUU1liaDAybU5QVXhDVEdmTFdnWHVuaEtkaUJFUFBPUmIrTHBEOTJaejVmZFF4UHlrbmNGODZpK1FUa3dYUFdiQUNvU1dvc3pDZmxkNE9Pc25ud1YvYlYxZy82eCtsRFFGd3JLWnZ1bFgrNHZkUUhoRmd1b2poSmJEOVF6endsRlIrc01KQUY5MjUyU1RIVU8vMlZUOGJ3bkE1Z2VYaVE4bzBjMWZMUndXNzFXcUI4WVk2V0dqdFlqM0pwdTRJSUtPUDNXRGlidkNSbGRzWDVvM1FmM2gvYVhxak9zaUhZNnhEWDhlVDNxeGMzZ0hJWm9lVGFFeUgxSEJMMHhTTkJzUkl0NmlGYWVoSmdTRXNwVGNWS2swcHRBNXhXVXFDR3cxMTJpVkcxQWRVcVY2THR5aDFlVWxCeVV0dnFsb1hYaEZ3VXNSZzI5N0c2eW1aMTZtQnJPb0dzbW5PNkI2TnN2MXpxQnZRMHJRc2RVTmNMOU9tcFV4SHh4N1VObHUxMWxENm9NeUMvL2IrVjNjZmpSMURhTDIyUE85aU54dmV0c2RyTzdLNnF5eDBGMWlhQnJNUTByYVZxLzYxZmxiVTRidHVzWXZMYi9rdXZKOXVOT09wQ1JKRWxjOVU5ZnNNZVhwNWFMU21sbjdWZjY5YjMrWTFudTFhYXlhMW00TnE3YWxsRDVjUS9qUGVuLzk5eDc4RkdBQ0Q5Z1pIaXo2ZUZnQUFBQUJKUlU1RXJrSmdnZz09Ij48L2E+DQoJPC9kaXY+CQ0KPC9kaXY+DQo8ZGl2IGlkPSJjb250ZW50Ij4NCgk8aWZyYW1lIHN0eWxlPSJkaXNwbGF5Om5vbmUiIHNyYz0iIiBpZD0ibXlpZnJhbWUiIGZyYW1lYm9yZGVyPSIwIiBzY3JvbGxpbmc9ImF1dG8iPg0KCTwvaWZyYW1lPg0KCQk8ZGl2IGlkPSJjb250ZW50X2xhbmRpbmdfcGFnZSI+ICAgICAgICAgICAgICANCgkJPGRpdiBjbGFzcz0idmlldyB2aWV3LXByb2R1Y3RzMyB2aWV3LWlkLXByb2R1Y3RzMyB2aWV3LWRpc3BsYXktaWQtcGFnZV8xIHZpZXctZG9tLWlkLTEiPgkJDQoJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+DQoJCTxkaXYgY2xhc3M9InRpdGxlLWJveCI+DQoJCTxoMT4ke3RoaXMuYXBwLm5hbWV9PC9oMT4NCgkJPGJyPg0KCQk8aDM+T0F1dGggdmVyc2lvbjogJHtvYXV0aDJfdmVyc2lvbn08L2gzPg0KCQk8YnI+DQoJCQ0KCQk8cD48L3A+DQoJCQkNCgkJPC9kaXY+DQoNCgkJIDxkaXYgY2xhc3M9InZpZXcgdmlldy1wcm9kdWN0czMgdmlldy1pZC1wcm9kdWN0czMgdmlldy1kaXNwbGF5LWlkLXBhZ2VfMSB2aWV3LWRvbS1pZC0xIj4JDQo8ZGl2IGNsYXNzPSJjb250YWluZXIiPg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="website_top"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PC9kaXY+DQo8L2Rpdj48L2Rpdj4NCjwvYm9keT4NCjwvaHRtbD4="/&gt;
                    &lt;L7p:VariableToSet stringValue="website_bottom"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="JHt3ZWJzaXRlX3RvcH0KCQkgCjwhLS1vYXV0aF9jb250ZW50X3BsYWNlaG9sZGVyLS0+Cgoke3dlYnNpdGVfYm90dG9tfQ=="/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;</l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a794d"
                version="10">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a7621" id="57477c668279c3c8d34da687b89a794d"
                          version="10">
            <l7:Name>oauth/v2</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/auth/oauth/v2/token</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>15</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="14">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This policy issues an access token"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="=================================="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="In order to get a better performance during token requests "/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="a local cache is used in order to support that requirement."/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Police lines as of line 22 are caching client lookup results."/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Since client configurations will hardly change these values can likely be cached for some time."/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="---------------------------------------------"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Configure the cache name and the accepted cache life time here:"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="(the cache allows up to one hundred client configurations to be cached for the operation 'getAll')"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="(the cache allows configurations for up to 100000 byte)"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW5FbmRwb2ludENhY2hl"/&gt;
                    &lt;L7p:VariableToSet stringValue="tokenEndpointCacheName"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="MzA="/&gt;
                    &lt;L7p:VariableToSet stringValue="tokenEndpointCacheLifetimeInSeconds"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="=================================="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SslAssertion/&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Lifetime for caching client credentials validation result"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Lifetime in s"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue="MzA="/&gt;
                    &lt;L7p:VariableToSet stringValue="clientAuthCacheLifetime"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="ffe30a9e-0d90-45cb-8419-d5c85c883642"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="e503f8c2-0466-478d-937d-87c5a5f19bee"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.method}"/&gt;
                    &lt;L7p:Expression2 stringValue="POST"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="POST"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfcmVxdWVzdCIsCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiJHtyZXF1ZXN0Lmh0dHAubWV0aG9kfSBub3QgcGVybWl0dGVkIgp9Cg=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check HTTP POST"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5ncmFudF90eXBlfEBAfSMjJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5zY29wZXxAQH0jIyR7cmVxdWVzdC5odHRwLnBhcmFtZXRlcnMuY29kZXxAQH0jIyR7cmVxdWVzdC5odHRwLnBhcmFtZXRlcnMucmVkaXJlY3RfdXJpfEBAfSMjJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5jbGllbnRfaWR8QEB9IyMke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXJzLmNsaWVudF9zZWNyZXR8QEB9IyMke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXJzLnVzZXJuYW1lfEBAfSMjJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5wYXNzd29yZHxAQH0jIyR7cmVxdWVzdC5odHRwLnBhcmFtZXRlcnMuYXNzZXJ0aW9ufEBAfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="requestParams"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Presence of &amp;quot;@@&amp;quot; indicates duplicate parameters"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="requestParams"/&gt;
                    &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
                    &lt;L7p:Regex stringValue="@@"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfcmVxdWVzdCIsCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiRHVwbGljYXRlIHBhcmFtZXRlcnMiCn0="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check for duplicate parameters in the request"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="authorization_code"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="authorization_code"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="client_credentials"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="client_credentials"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="password"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="password"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="urn:ietf:params:oauth:grant-type:saml2-bearer"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="urn:ietf:params:oauth:grant-type:saml2-bearer"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="refresh_token"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="refresh_token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfcmVxdWVzdCIsCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiTWlzc2luZyBncmFudF90eXBlIgp9"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check grant_type"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item regex="included"&gt;
                    &lt;L7p:Pattern stringValue="BEARER|MAC"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfdG9rZW5fdHlwZSIKfQ=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Invalid token_type"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Make sure the ssg is configured for BEARER or MAC token types"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HttpBasic/&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNsaWVudF9pZH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="otherClientId"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${otherClientId}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnVzZXJuYW1lfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="client_id"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnBhc3N3b3JkfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="client_secret"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="client_id"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="client_secret"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="client_secret"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${client_id}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${client_secret}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Client credentials from Authorization header"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnVzZXJuYW1lfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="otherClientId"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${otherClientId}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNsaWVudF9pZH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="client_id"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNsaWVudF9zZWNyZXR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="client_secret"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${client_id}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${client_secret}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Client credentials from POST body"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLkF1dGhvcml6YXRpb259"/&gt;
                    &lt;L7p:VariableToSet stringValue="requestAuthHeader"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${requestAuthHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="authScheme"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="requestAuthHeader"/&gt;
                    &lt;L7p:Regex stringValue="(.*)\s.*"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="WWW-Authenticate"/&gt;
                    &lt;L7p:HeaderValue stringValue="${authScheme[1]}"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Add WWW-Authenticate response header"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfY2xpZW50IiwKICAiZXJyb3JfZGVzY3JpcHRpb24iOiJGYWlsZWQgdG8gZ2V0IGNsaWVudCBjcmVkZW50aWFscyIKfQ=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Get client credentials"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Get client registration information =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="client_id"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="client_secret"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="client_secret"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:GenerateSecurityHash&gt;
                    &lt;L7p:Algorithm stringValue="SHA-1"/&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Only sha1, but good enough for this use case"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="CacheKey"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Data stringValue="JHtjbGllbnRfaWR9JHtjbGllbnRfc2VjcmV0fQ=="/&gt;
                    &lt;L7p:LineBreak lineBreak="CR-LF"/&gt;
                    &lt;L7p:TargetOutputVariable stringValue="cacheKey"/&gt;
                    &lt;/L7p:GenerateSecurityHash&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:CacheLookup&gt;
                    &lt;L7p:CacheEntryKey stringValue="${cacheKey}"/&gt;
                    &lt;L7p:CacheId stringValue="${tokenEndpointCacheName}"/&gt;
                    &lt;L7p:ContentTypeOverride stringValue="text/xml"/&gt;
                    &lt;L7p:MaxEntryAgeSeconds stringValue="${tokenEndpointCacheLifetimeInSeconds}"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="validationResult"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheLookup&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2xpZW50X2tleT0ke2NsaWVudF9pZH0mc2VjcmV0PSR7Y2xpZW50X3NlY3JldH0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="validateRequest"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_ovp_server}/oauth/validation/validate/v2/tokenrequest"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="validateRequest"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="validationResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CacheStorage&gt;
                    &lt;L7p:CacheEntryKey stringValue="${cacheKey}"/&gt;
                    &lt;L7p:CacheId stringValue="${tokenEndpointCacheName}"/&gt;
                    &lt;L7p:MaxEntries stringValue="100"/&gt;
                    &lt;L7p:MaxEntryAgeSeconds stringValue="${tokenEndpointCacheLifetimeInSeconds}"/&gt;
                    &lt;L7p:MaxEntrySizeBytes stringValue="100000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="validationResult"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheStorage&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue=""/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:result[text()='valid']"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathType"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:type/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathName"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:client_name/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:RateLimit&gt;
                    &lt;L7p:BlackoutPeriodInSeconds stringValue="30"/&gt;
                    &lt;L7p:CounterName stringValue="8126ba96-${client_id}"/&gt;
                    &lt;L7p:MaxRequestsPerSecond stringValue="${oauth2_client_max_fail_per_sec}"/&gt;
                    &lt;L7p:WindowSizeInSeconds stringValue="5"/&gt;
                    &lt;/L7p:RateLimit&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLkF1dGhvcml6YXRpb259"/&gt;
                    &lt;L7p:VariableToSet stringValue="requestAuthHeader"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${requestAuthHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="authScheme"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="requestAuthHeader"/&gt;
                    &lt;L7p:Regex stringValue="(.*)\s.*"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="WWW-Authenticate"/&gt;
                    &lt;L7p:HeaderValue stringValue="${authScheme[1]}"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Add WWW-Authenticate response header"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorCacheContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:CacheLookup&gt;
                    &lt;L7p:CacheEntryKey stringValue="${cacheKey}"/&gt;
                    &lt;L7p:CacheId stringValue="${tokenEndpointCacheName}"/&gt;
                    &lt;L7p:ContentTypeOverride stringValue="text/xml"/&gt;
                    &lt;L7p:MaxEntryAgeSeconds stringValue="5"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorCacheContent"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheLookup&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfY2xpZW50IiwKICAiZXJyb3JfZGVzY3JpcHRpb24iOiJDbGllbnQgYXV0aGVudGljYXRpb24gZmFpbGVkIgp9"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Authenticate client and receive client values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNjb3BlfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${scope}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="client_credentials"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="client_credentials"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="password"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="password"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="urn:ietf:params:oauth:grant-type:saml2-bearer"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="urn:ietf:params:oauth:grant-type:saml2-bearer"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNjb3BlLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="If scope parameter is missing in the request, return the default scope.                     The default scope in from client registration"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Set scope parameter to return"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="scope"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="scope"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Handle scope and set a default value for certain grant_types"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="YXRfMg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="2dc66d50-fa74-489e-97f8-d6b2f4a13c08"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtnZW5Ub2tlbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="at_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtnZW5FeHBpcmF0aW9ufQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="at_expiration"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtnZW5TZWNyZXR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="mac_secret"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="cmZ0"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="2dc66d50-fa74-489e-97f8-d6b2f4a13c08"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtnZW5Ub2tlbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="rtoken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtnZW5FeHBpcmF0aW9ufQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="rexpiration"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Generate tokens to be used later"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="authorization_code"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="authorization_code"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.code}"/&gt;
                    &lt;L7p:Expression2 stringValue="authorization_code"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue="authorization_code"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfcmVxdWVzdCIsCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiTWlzc2luZyBhdXRob3JpemF0aW9uIGNvZGUiCn0="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check for existince of the code"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlZGlyZWN0X3VyaX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="redirect_uri"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="redirect_uri"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="callback"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2xpZW50X2tleT0ke2NsaWVudF9pZH0mdG9rZW49JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNvZGV9JmNhbGxiYWNrPSR7Y2FsbGJhY2t9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="toValidation"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_ovp_server}/oauth/validation/validate/v2/granttype"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="toValidation"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="validationResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue=""/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:result[text()='valid']"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathOwner"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathScope.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="scope"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathOwner.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="owner"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfcmVxdWVzdCIsCn0="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Validate and retrieve values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Delete the authorization code. The authorization code should                     be consumed at most once. =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dGVtcF90b2tlbj0ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuY29kZX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteMessage"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Delete authorization_code"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/delete"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteMessage"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="deleteResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="BEARER"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="BEARER"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnJ0b2tlbj0ke3J0b2tlbn0mcmV4cGlyYXRpb249JHtyZXhwaXJhdGlvbn0mc2NvcGU9JHtzY29wZX0mcmVzb3VyY2Vfb3duZXI9JHtvd25lcn0mY2xpZW50X2tleT0ke2NsaWVudF9pZH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6IkJlYXJlciIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInJlZnJlc2hfdG9rZW4iOiIke3J0b2tlbn0iLA0KICAic2NvcGUiOiIke3Njb3BlfSINCn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=BEARER"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnJ0b2tlbj0ke3J0b2tlbn0mcmV4cGlyYXRpb249JHtyZXhwaXJhdGlvbn0mc2NvcGU9JHtzY29wZX0mcmVzb3VyY2Vfb3duZXI9JHtvd25lcn0mY2xpZW50X2tleT0ke2NsaWVudF9pZH0mc2VjcmV0PSR7bWFjX3NlY3JldH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6Im1hYyIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInJlZnJlc2hfdG9rZW4iOiIke3J0b2tlbn0iLA0KICAic2NvcGUiOiIke3Njb3BlfSIsDQogICJtYWNfa2V5IjoiJHttYWNfc2VjcmV0fSIsDQogICJtYWNfYWxnb3JpdGhtIjoiaG1hYy1zaGEtMSINCn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=MAC"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create tokens"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="grant_type: auth_code"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="client_credentials"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="client_credentials"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="confidential"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="confidential"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfZ3JhbnQiLAogICJlcnJvcl9kZXNjcmlwdGlvbiI6Ik11c3QgYmUgY29uZmlkZW50aWFsIGNsaWVudCIKfQ=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check confidential clients"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathName.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="owner"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="BEARER"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="BEARER"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnNjb3BlPSR7c2NvcGV9JnJlc291cmNlX293bmVyPSR7b3duZXJ9JmNsaWVudF9rZXk9JHtjbGllbnRfaWR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6IkJlYXJlciIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInNjb3BlIjoiJHtzY29wZX0iDQp9"/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=BEARER"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnNjb3BlPSR7c2NvcGV9JnJlc291cmNlX293bmVyPSR7b3duZXJ9JmNsaWVudF9rZXk9JHtjbGllbnRfaWR9JnNlY3JldD0ke21hY19zZWNyZXR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6Im1hYyIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInNjb3BlIjoiJHtzY29wZX0iLA0KICAibWFjX2tleSI6IiR7bWFjX3NlY3JldH0iLA0KICAibWFjX2FsZ29yaXRobSI6ImhtYWMtc2hhLTEiDQp9"/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=MAC"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create tokens"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="grant_type: client_credentials"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="password"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="password"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:RateLimit&gt;
                    &lt;L7p:BlackoutPeriodInSeconds stringValue="30"/&gt;
                    &lt;L7p:CounterName stringValue="cd416d07-${request.http.parameter.username}"/&gt;
                    &lt;L7p:MaxRequestsPerSecond stringValue="${oauth2_resource_owner_max_fail_per_sec}"/&gt;
                    &lt;L7p:WindowSizeInSeconds stringValue="5"/&gt;
                    &lt;/L7p:RateLimit&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:XpathCredentialSource&gt;
                    &lt;L7p:PasswordExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="$request.http.parameter.password"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:PasswordExpression&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="$request.http.parameter.username"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:XpathCredentialSource&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Authenticate resource owner =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:Authentication&gt;
                    &lt;L7p:IdentityProviderOid goidValue="0000000000000000fffffffffffffffe"/&gt;
                    &lt;/L7p:Authentication&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfZ3JhbnQiLAogICJlcnJvcl9kZXNjcmlwdGlvbiI6IlJlc291cmNlIE93bmVyIGF1dGhlbnRpY2F0aW9uIGZhaWxlZCIKfQ=="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Authenticate user"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="request.authenticatedUser"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="owner"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="BEARER"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="BEARER"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnJ0b2tlbj0ke3J0b2tlbn0mcmV4cGlyYXRpb249JHtyZXhwaXJhdGlvbn0mc2NvcGU9JHtzY29wZX0mcmVzb3VyY2Vfb3duZXI9JHtvd25lcn0mY2xpZW50X2tleT0ke2NsaWVudF9pZH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6IkJlYXJlciIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInJlZnJlc2hfdG9rZW4iOiIke3J0b2tlbn0iLA0KICAic2NvcGUiOiIke3Njb3BlfSINCn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=BEARER"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnJ0b2tlbj0ke3J0b2tlbn0mcmV4cGlyYXRpb249JHtyZXhwaXJhdGlvbn0mc2NvcGU9JHtzY29wZX0mcmVzb3VyY2Vfb3duZXI9JHtvd25lcn0mY2xpZW50X2tleT0ke2NsaWVudF9pZH0mc2VjcmV0PSR7bWFjX3NlY3JldH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6Im1hYyIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInJlZnJlc2hfdG9rZW4iOiIke3J0b2tlbn0iLA0KICAic2NvcGUiOiIke3Njb3BlfSIsDQogICJtYWNfa2V5IjoiJHttYWNfc2VjcmV0fSIsDQogICJtYWNfYWxnb3JpdGhtIjoiaG1hYy1zaGEtMSINCn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=MAC"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create tokens"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="grant_type: password"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="urn:ietf:params:oauth:grant-type:saml2-bearer"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="urn:ietf:params:oauth:grant-type:saml2-bearer"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.assertion}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item stringLength="included"&gt;
                    &lt;L7p:Max intValue="-1"/&gt;
                    &lt;L7p:Min intValue="1"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Validation of the SAML assertion =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFzc2VydGlvbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="bearerToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:CharacterEncoding stringValueNull="null"/&gt;
                    &lt;L7p:SourceVariableName stringValue="bearerToken"/&gt;
                    &lt;L7p:TargetContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:TargetDataType variableDataType="message"/&gt;
                    &lt;L7p:TargetVariableName stringValue="bearerToken"/&gt;
                    &lt;L7p:TransformType transformType="BASE64_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="============================"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Validate the trusted issuer by adding a FIP here                     =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="A FIP has to be introduced in order to accept only trusted clients"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Remove the Stop assertion once the FIP is configured"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:FalseAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="WARNING"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Replace this assertion with a federated identity assertion. Do not just delete it!"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;/L7p:FalseAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="============================"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ValidateNonSoapSamlToken&gt;
                    &lt;L7p:AudienceRestriction stringValue="${request.url.protocol}://${request.url.host}:${request.url.port}${request.http.uri}"/&gt;
                    &lt;L7p:AuthenticationStatement samlAuthenticationInfo="included"&gt;
                    &lt;L7p:AuthenticationMethods stringArrayValue="included"&gt;
                    &lt;L7p:item stringValue="urn:ietf:rfc:1510"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:MobileTwoFactorContract"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:1.0:am:unspecified"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:1.0:am:SPKI"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:1.0:am:X509-PKI"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:Smartcard"/&gt;
                    &lt;L7p:item stringValue="urn:ietf:rfc:3075"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:TimeSyncToken"/&gt;
                    &lt;L7p:item stringValue="urn:ietf:rfc:2945"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:SmartcardPKI"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:PreviousSession"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:MobileTwoFactorUnregistered"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:MobileOneFactorContract"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:NomadTelephony"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:MobileOneFactorUnregistered"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:AuthenticatedTelephony"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:1.0:am:PGP"/&gt;
                    &lt;L7p:item stringValue="urn:ietf:rfc:2246"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:PersonalizedTelephony"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:InternetProtocol"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:Telephony"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:InternetProtocolPassword"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:2.0:ac:classes:SoftwarePKI"/&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:1.0:am:password"/&gt;
                    &lt;/L7p:AuthenticationMethods&gt;
                    &lt;/L7p:AuthenticationStatement&gt;
                    &lt;L7p:MaxExpiry longValue="3600000"/&gt;
                    &lt;L7p:NameFormats stringArrayValue="included"&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"/&gt;
                    &lt;/L7p:NameFormats&gt;
                    &lt;L7p:NameQualifier stringValue=""/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="bearerToken"/&gt;
                    &lt;L7p:SubjectConfirmationDataCheckValidity booleanValue="false"/&gt;
                    &lt;L7p:SubjectConfirmationDataRecipient stringValue="${request.url.protocol}://${request.url.host}:${request.url.port}${request.http.uri}"/&gt;
                    &lt;L7p:SubjectConfirmations stringArrayValue="included"&gt;
                    &lt;L7p:item stringValue="urn:oasis:names:tc:SAML:1.0:cm:bearer"/&gt;
                    &lt;/L7p:SubjectConfirmations&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;L7p:Version boxedIntegerValue="2"/&gt;
                    &lt;/L7p:ValidateNonSoapSamlToken&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfZ3JhbnQiLAogICJlcnJvcl9kZXNjcmlwdGlvbiI6IkFzc2VydGlvbiB2YWxpZGF0aW9uIGZhaWxlZCIKfQo="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Validate SAML Assertion or return error"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Get Subject Name ID from SAML token =========="/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue=""/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="bearerToken"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/saml2:Assertion/saml2:Subject/saml2:NameID"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="saml2"/&gt;
                    &lt;L7p:value stringValue="urn:oasis:names:tc:SAML:2.0:assertion"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="responseXpath.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="owner"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="BEARER"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="BEARER"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnNjb3BlPSR7c2NvcGV9JnJlc291cmNlX293bmVyPSR7b3duZXJ9JmNsaWVudF9rZXk9JHtjbGllbnRfaWR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6IkJlYXJlciIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInNjb3BlIjoiJHtzY29wZX0iDQp9"/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=BEARER"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnNjb3BlPSR7c2NvcGV9JnJlc291cmNlX293bmVyPSR7b3duZXJ9JmNsaWVudF9rZXk9JHtjbGllbnRfaWR9JnNlY3JldD0ke21hY19zZWNyZXR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6Im1hYyIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInNjb3BlIjoiJHtzY29wZX0iLA0KICAibWFjX2tleSI6IiR7bWFjX3NlY3JldH0iLA0KICAibWFjX2FsZ29yaXRobSI6ImhtYWMtc2hhLTEiDQp9"/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=MAC"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create tokens"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="grant_type: saml"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.grant_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="refresh_token"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="refresh_token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="c2NvcGU9JHtzY29wZX0mcnRva2VuPSR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5yZWZyZXNoX3Rva2VufSZjbGllbnRfa2V5PSR7Y2xpZW50X2lkfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="toValidation"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_ovp_server}/oauth/validation/validate/v2/refreshtoken"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="toValidation"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="validationResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue=""/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:result[text()='valid']"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="ewogICJlcnJvciI6ImludmFsaWRfcmVxdWVzdCIsCn0="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Validate and retrieve values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathValidationResultScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathValidationResultOwner"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathValidationResultScope.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="scope"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathValidationResultOwner.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="owner"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="BEARER"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="BEARER"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnJ0b2tlbj0ke3J0b2tlbn0mcmV4cGlyYXRpb249JHtyZXhwaXJhdGlvbn0mc2NvcGU9JHtzY29wZX0mcmVzb3VyY2Vfb3duZXI9JHtvd25lcn0mY2xpZW50X2tleT0ke2NsaWVudF9pZH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6IkJlYXJlciIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInJlZnJlc2hfdG9rZW4iOiIke3J0b2tlbn0iLA0KICAic2NvcGUiOiIke3Njb3BlfSINCn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=BEARER"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHthdF90b2tlbn0mZXhwaXJhdGlvbj0ke2F0X2V4cGlyYXRpb259JnJ0b2tlbj0ke3J0b2tlbn0mcmV4cGlyYXRpb249JHtyZXhwaXJhdGlvbn0mc2NvcGU9JHtzY29wZX0mcmVzb3VyY2Vfb3duZXI9JHtvd25lcn0mY2xpZW50X2tleT0ke2NsaWVudF9pZH0mc2VjcmV0PSR7bWFjX3NlY3JldH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="ew0KICAiYWNjZXNzX3Rva2VuIjoiJHthdF90b2tlbn0iLA0KICAidG9rZW5fdHlwZSI6Im1hYyIsDQogICJleHBpcmVzX2luIjoke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfSwNCiAgInJlZnJlc2hfdG9rZW4iOiIke3J0b2tlbn0iLA0KICAic2NvcGUiOiIke3Njb3BlfSIsDQogICJtYWNfa2V5IjoiJHttYWNfc2VjcmV0fSIsDQogICJtYWNfYWxnb3JpdGhtIjoiaG1hYy1zaGEtMSINCn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="clientResponse"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=MAC"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create tokens"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="cnRva2VuPSR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5yZWZyZXNoX3Rva2VufQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteRtoken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/delete"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="deleteRtoken"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="grant_type: refresh_token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="grant types"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathName.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="client_name"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzdG9yZVRva2VufSZjbGllbnRfbmFtZT0ke2NsaWVudF9uYW1lfSZzdGF0dXM9RU5BQkxFRA=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeToken"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeToken"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="storeTokenResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${storeTokenResult.mainpart}"/&gt;
                    &lt;L7p:Expression2 stringValue="persisted"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="persisted"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtjbGllbnRSZXNwb25zZX0="/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Pragma"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-cache"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Cache-Control"/&gt;
                    &lt;L7p:HeaderValue stringValue="no-store"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a77d3"
                version="2">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a75e1" id="57477c668279c3c8d34da687b89a77d3" version="2">
            <l7:Name>REST STS</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/oauth/v2/samlTokenServer*</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>2</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This is a SAML token server used by SAML grant type test client"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:HttpBasic/&gt;
                    &lt;L7p:Authentication&gt;
                    &lt;L7p:IdentityProviderOid goidValue="0000000000000000fffffffffffffffe"/&gt;
                    &lt;/L7p:Authentication&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:LookupDynamicContextVariables&gt;
                    &lt;L7p:SourceVariable stringValue="request.http.parameter.audience_recipient_restriction"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;/L7p:LookupDynamicContextVariables&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtsb29rdXAub3V0cHV0fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="audience_recipient_restriction"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Audience restriction must be created in advance as multiple variables
                    are used"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtob3N0X29hdXRoMl9hdXRoX3NlcnZlcn0ke29hdXRoMl90b2tlbl9wYXRofQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="audience_recipient_restriction"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Allow requester to configure the recipient and audience restrictions"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SamlIssuer&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Variable for audience and recipient restriction must be created in
                    advance if more than one variable is referenced"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AudienceRestriction stringValue="${audience_recipient_restriction}"/&gt;
                    &lt;L7p:AuthenticationStatement samlAuthenticationInfo="included"&gt;
                    &lt;L7p:AuthenticationMethods stringArrayValue="included"/&gt;
                    &lt;L7p:IncludeAuthenticationContextDeclaration booleanValue="false"/&gt;
                    &lt;/L7p:AuthenticationStatement&gt;
                    &lt;L7p:NameQualifier stringValue=""/&gt;
                    &lt;L7p:SubjectConfirmationDataRecipient stringValue="${audience_recipient_restriction}"/&gt;
                    &lt;L7p:SubjectConfirmationMethodUri stringValue="urn:oasis:names:tc:SAML:1.0:cm:bearer"/&gt;
                    &lt;L7p:Version boxedIntegerValue="2"/&gt;
                    &lt;/L7p:SamlIssuer&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="issuedSamlAssertion"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="encodedSaml"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlZGlyZWN0X3VyaX0/c2FtbD0ke2VuY29kZWRTYW1sfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Redirect"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="302"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:ResponseContentType stringValue=""/&gt;
                    &lt;L7p:ResponseStatus stringValue="302"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Location"/&gt;
                    &lt;L7p:HeaderValue stringValue="${location}"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
    <l7:Service xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" id="57477c668279c3c8d34da687b89a798c"
                version="14">
        <l7:ServiceDetail folderId="57477c668279c3c8d34da687b89a7621" id="57477c668279c3c8d34da687b89a798c"
                          version="14">
            <l7:Name>oauth/v2</l7:Name>
            <l7:Enabled>true</l7:Enabled>
            <l7:ServiceMappings>
                <l7:HttpMapping>
                    <l7:UrlPattern>/auth/oauth/v2/authorize</l7:UrlPattern>
                    <l7:Verbs>
                        <l7:Verb>GET</l7:Verb>
                        <l7:Verb>POST</l7:Verb>
                        <l7:Verb>PUT</l7:Verb>
                        <l7:Verb>DELETE</l7:Verb>
                    </l7:Verbs>
                </l7:HttpMapping>
            </l7:ServiceMappings>
            <l7:Properties>
                <l7:Property key="policyRevision">
                    <l7:LongValue>36</l7:LongValue>
                </l7:Property>
                <l7:Property key="wssProcessingEnabled">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
                <l7:Property key="internal">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:ServiceDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy" version="35">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                    &lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy"
                    xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="This policy issues an authorization grant"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="dfdc6c16-7c02-4415-b0e1-b4a9de10316f"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="e503f8c2-0466-478d-937d-87c5a5f19bee"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="ffe30a9e-0d90-45cb-8419-d5c85c883642"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SslAssertion/&gt;
                    &lt;L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:Content stringValue="An error occurred. Please contact the system administrator or try again
                    later."/&gt;
                    &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
                    &lt;L7p:HttpStatus stringValue="400"/&gt;
                    &lt;/L7p:CustomizeErrorResponse&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="errorRedirectURI.result"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="authorizeRedirectURI.result"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="MzAwMA=="/&gt;
                    &lt;L7p:VariableToSet stringValue="ownerCacheAge"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="NjAw"/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionIdCacheAge"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="NQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="deleteCacheAge"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:CacheLookup&gt;
                    &lt;L7p:CacheEntryKey stringValue="${request.url.host}${request.url.path}"/&gt;
                    &lt;L7p:CacheId stringValue="OAuthAuthpageCache"/&gt;
                    &lt;L7p:ContentTypeOverride stringValue="text/html;charset=UTF-8"/&gt;
                    &lt;L7p:MaxEntryAgeSeconds stringValue="60"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="websiteTemplate"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheLookup&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl
                    stringValue="${host_oauth2_auth_template_server}${oauth2_auth_template_path}"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="websiteTemplate"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CacheStorage&gt;
                    &lt;L7p:CacheEntryKey stringValue="${request.url.host}${request.url.path}"/&gt;
                    &lt;L7p:CacheId stringValue="OAuthAuthpageCache"/&gt;
                    &lt;L7p:MaxEntryAgeSeconds stringValue="60"/&gt;
                    &lt;L7p:MaxEntrySizeBytes stringValue="100000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="websiteTemplate"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheStorage&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Either from local cache or from another server"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Load website template"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt3ZWJzaXRlVGVtcGxhdGUubWFpbnBhcnR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="content"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt3ZWJzaXRlVGVtcGxhdGUubWFpbnBhcnR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.method}"/&gt;
                    &lt;L7p:Expression2 stringValue="POST"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="POST"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.method}"/&gt;
                    &lt;L7p:Expression2 stringValue="GET"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="GET"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="ewogICJlcnJvciI6ImludmFsaWRfcmVxdWVzdCIsCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiJHtyZXF1ZXN0Lmh0dHAubWV0aG9kfSBub3QgcGVybWl0dGVkIgp9"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check HTTP POST or GET"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5yZXNwb25zZV90eXBlfEBAfSMjJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5jbGllbnRfaWR8QEB9IyMke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXJzLnJlZGlyZWN0X3VyaXxAQH0jIyR7cmVxdWVzdC5odHRwLnBhcmFtZXRlcnMuc2NvcGV8QEB9IyMke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXJzLnN0YXRlfEBAfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="requestParams"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Presence of &amp;quot;@@&amp;quot; indicates duplicate parameters"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="requestParams"/&gt;
                    &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
                    &lt;L7p:Regex stringValue="@@"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody
                    stringValue="ewogICJlcnJvciI6ImludmFsaWRfcmVxdWVzdCIsCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiRHVwbGljYXRlIHBhcmFtZXRlcnMiCn0="/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check for duplicate parameters in the request"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="sessionID"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="action"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                    &lt;/L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.sessionID}"/&gt;
                    &lt;L7p:Expression2 stringValue="client_authorize"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue="client_authorize"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="userSessionCookieValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:XpathCredentialSource&gt;
                    &lt;L7p:PasswordExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="$request.http.parameter.password"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:PasswordExpression&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="$request.http.parameter.username"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:XpathCredentialSource&gt;
                    &lt;L7p:HttpBasic/&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:Authentication&gt;
                    &lt;L7p:IdentityProviderOid goidValue="0000000000000000fffffffffffffffe"/&gt;
                    &lt;/L7p:Authentication&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0LmF1dGhlbnRpY2F0ZWRVc2VyfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="resource_owner"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="resource_owner"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="resource_owner"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.persistent_cookie}"/&gt;
                    &lt;L7p:Expression2 stringValue="yes"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="yes"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Generate a random UUID"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:MaximumQuantity intValue="1"/&gt;
                    &lt;L7p:TargetVariable stringValue="sessionUserID"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:GenerateSecurityHash&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Hash UUID with ${gateway.time.millis}"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Data stringValue="JHtzZXNzaW9uVXNlcklEWzBdfQ=="/&gt;
                    &lt;L7p:KeyText stringValue="${gateway.time.millis}"/&gt;
                    &lt;L7p:LineBreak lineBreak="CR-LF"/&gt;
                    &lt;L7p:TargetOutputVariable stringValue="userSessionIdentifier"/&gt;
                    &lt;/L7p:GenerateSecurityHash&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="userSessionIdentifier"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="userSessionIdentifier"/&gt;
                    &lt;L7p:TransformType transformType="BASE64_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="userSessionIdentifier"/&gt;
                    &lt;L7p:Regex stringValue="[=]{1,2}$"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PHM+DQo8cmVzb3VyY2Vfb3duZXI+JHtyZXF1ZXN0LmF1dGhlbnRpY2F0ZWRVc2VyfTwvcmVzb3VyY2Vfb3duZXI+DQo8L3M+"/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHt1c2VyU2Vzc2lvbklkZW50aWZpZXJ9JmNhY2hlSWQ9dXNlclNlc3Npb25JRENhY2hlVjImY2FjaGVBZ2U9JHtvd25lckNhY2hlQWdlfSZjYWNoZU1heEVudHJpZXM9MTAwMCZjYWNoZU1heFNpemU9MTAwMDAmdmFsdWU9JHtzZXNzaW9uVmFsdWV9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt1c2VyU2Vzc2lvbklkZW50aWZpZXJ9"/&gt;
                    &lt;L7p:VariableToSet stringValue="userSessionCookieValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create a session for the user"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Check if a user session should be created"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Authenticate"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="If a session is found with value from cookie then we accept the user
                    previously authenticated"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;L7p:CookieCredentialSource&gt;
                    &lt;L7p:CookieName stringValue="l7otk2a"/&gt;
                    &lt;/L7p:CookieCredentialSource&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjb29raWUubDdvdGsyYX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="user_session_key"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHt1c2VyX3Nlc3Npb25fa2V5fSZjYWNoZUlkPXVzZXJTZXNzaW9uSURDYWNoZVYyJmNhY2hlQWdlPSR7b3duZXJDYWNoZUFnZX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="lookupSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="sessionValue"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:found/ns:value/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="decoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtkZWNvZGVkfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="userSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="resource_owner_ref"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="userSession"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/s/resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNvdXJjZV9vd25lcl9yZWYucmVzdWx0fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="resource_owner"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="resource_owner"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="resource_owner"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Use session-cookie"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:LookupDynamicContextVariables&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Test if variable was set above"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:SourceVariable stringValue="user_session_key"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;/L7p:LookupDynamicContextVariables&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGRpdj4NCjxwPjxiPlNlc3Npb24gRXhwaXJlZDwvYj48L3A+DQo8L2Rpdj4="/&gt;
                    &lt;L7p:VariableToSet stringValue="newErrorContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPjxiPkF1dGhlbnRpY2F0aW9uIGZhaWxlZDwvYj48L3A+DQo8L2Rpdj4="/&gt;
                    &lt;L7p:VariableToSet stringValue="newErrorContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Get correct error message"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorContent"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;!--oauth_content_placeholder--&gt;"/&gt;
                    &lt;L7p:RegexName stringValue="update the content of the website"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="${newErrorContent}"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="NDAx"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorStatus"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtlcnJvckNvbnRlbnR9"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="${errorStatus}"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2a="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Authentication error"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Authenticate resource_owner"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="Grant"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="Grant"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlc3Npb25JRH0mY2FjaGVJZD1hdXRob3JpemVDYWNoZSZjYWNoZUFnZT0ke3Nlc3Npb25JZENhY2hlQWdlfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="lookupSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="sessionValue"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:found/ns:value/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="decoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtkZWNvZGVkfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="grantedContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeClientName"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/clientName/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeClientID"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/client_id/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeRedirectURI"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/redirect_uri/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeGivenRedirectURI"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/given_redirect_uri"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeResponseType"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/response_type/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeState"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/state"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="authorizeClientName.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="authorizeClientNameDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="authorizeClientID.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="authorizeClientIDDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="authorizeRedirectURI.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="authorizeRedirectURIDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="authorizeResponseType.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="authorizeResponseTypeDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="authorizeScope.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="authorizeScopeDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthdXRob3JpemVTdGF0ZS5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="state"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="state"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="authorizeStateDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGF1dGhvcml6ZT4NCiAgICA8Y2xpZW50TmFtZT48L2NsaWVudE5hbWU+DQogICAgPGNsaWVudF9pZD48L2NsaWVudF9pZD4NCiAgICA8Z2l2ZW5fcmVkaXJlY3RfdXJpPjwvZ2l2ZW5fcmVkaXJlY3RfdXJpPg0KICAgIDxyZWRpcmVjdF91cmk+PC9yZWRpcmVjdF91cmk+DQogICAgPG9yaWdpbmFsX3JlZGlyZWN0X3VyaT48L29yaWdpbmFsX3JlZGlyZWN0X3VyaT4NCiAgICA8cmVzcG9uc2VfdHlwZT48L3Jlc3BvbnNlX3R5cGU+DQogICAgPHNjb3BlPjwvc2NvcGU+DQogICAgPHN0YXRlPjwvc3RhdGU+DQo8L2F1dGhvcml6ZT4="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlc3Npb25JRH0mY2FjaGVJZD1hdXRob3JpemVDYWNoZSZjYWNoZUFnZT0ke2RlbGV0ZUNhY2hlQWdlfSZjYWNoZU1heEVudHJpZXM9MTAwMDAmY2FjaGVNYXhTaXplPTEwMDAwJnZhbHVlPSR7c2Vzc2lvblZhbHVlfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Override (delete) cache entry"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Access the values stored in the cache"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPjxiPlRoZSBzZXNzaW9uIGhhcyBleHBpcmVkIG9yIGFscmVhZHkgYmVlbiBncmFudGVkPC9iPjwvcD4NCjwvZGl2Pg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="newErrorContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorContent"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;!--oauth_content_placeholder--&gt;"/&gt;
                    &lt;L7p:RegexName stringValue="update the content of the website"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="${newErrorContent}"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtlcnJvckNvbnRlbnR9"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="The granted process has takten too long"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Get granted values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeResponseTypeDecoded}"/&gt;
                    &lt;L7p:Expression2 stringValue="token"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="BEARER"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;

                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="BEARER"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="MAC"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;

                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="MAC"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Must be BEARER or MAC"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="YXRfMg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="2dc66d50-fa74-489e-97f8-d6b2f4a13c08"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtnZW5Ub2tlbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="access_token"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create access_token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHthdXRob3JpemVSZWRpcmVjdFVSSURlY29kZWR9I2FjY2Vzc190b2tlbj0ke2FjY2Vzc190b2tlbn0mZXhwaXJlc19pbj0ke29hdXRoMl9hY2Nlc3NfdG9rZW5fbGlmZXRpbWVfc2VjfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="dG9rZW49JHthY2Nlc3NfdG9rZW59JmV4cGlyYXRpb249JHtnZW5FeHBpcmF0aW9ufSZzY29wZT0ke2F1dGhvcml6ZVNjb3BlLnJlc3VsdH0mcmVzb3VyY2Vfb3duZXI9JHtyZXNvdXJjZV9vd25lcn0mY2xpZW50X2tleT0ke2F1dGhvcml6ZUNsaWVudElELnJlc3VsdH0mY2xpZW50X25hbWU9JHthdXRob3JpemVDbGllbnROYW1lLnJlc3VsdH0mc3RhdHVzPUVOQUJMRUQ="/&gt;
                    &lt;L7p:VariableToSet stringValue="toStore"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${oauth2_token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="BEARER"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;

                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;

                    &lt;L7p:RightValue stringValue="BEARER"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;

                    &lt;L7p:Base64Expression stringValue="JHtsb2NhdGlvbn0mdG9rZW5fdHlwZT1CZWFyZXI="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=BEARER"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;

                    &lt;L7p:Base64Expression stringValue="JHtnZW5TZWNyZXR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="mac_key"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;

                    &lt;L7p:Base64Expression stringValue="JHt0b1N0b3JlfSZzZWNyZXQ9JHttYWNfa2V5fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="toStore"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;

                    &lt;L7p:Base64Expression
                    stringValue="JHtsb2NhdGlvbn0mdG9rZW5fdHlwZT1tYWMmbWFjX2tleT0ke21hY19rZXl9Jm1hY19hbGdvcml0aG09aG1hYy1zaGEtMQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="token_type=MAC"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeRedirectURIDecoded}"/&gt;
                    &lt;L7p:Expression2 stringValue="?"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;

                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:RightValue stringValue="?"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHthdXRob3JpemVSZWRpcmVjdFVSSURlY29kZWR9JmVycm9yPWludmFsaWRfdG9rZW5fdHlwZQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Invalid token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHthdXRob3JpemVSZWRpcmVjdFVSSURlY29kZWR9P2Vycm9yPWludmFsaWRfdG9rZW5fdHlwZQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Access was granted: response_type=token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeResponseType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="code"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="code"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="YWM="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="2dc66d50-fa74-489e-97f8-d6b2f4a13c08"/&gt;
                    &lt;/L7p:Include&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtnZW5Ub2tlbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="authorization_code"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="dG9rZW49JHthdXRob3JpemF0aW9uX2NvZGV9JmV4cGlyYXRpb249JHtnZW5FeHBpcmF0aW9ufSZzY29wZT0ke2F1dGhvcml6ZVNjb3BlLnJlc3VsdH0mcmVzb3VyY2Vfb3duZXI9JHtyZXNvdXJjZV9vd25lcn0mY2xpZW50X2tleT0ke2F1dGhvcml6ZUNsaWVudElELnJlc3VsdH0mY2xpZW50X25hbWU9JHthdXRob3JpemVDbGllbnROYW1lLnJlc3VsdH0mY2FsbGJhY2s9JHthdXRob3JpemVHaXZlblJlZGlyZWN0VVJJLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="toStore"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeRedirectURIDecoded}"/&gt;
                    &lt;L7p:Expression2 stringValue="?"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:RightValue stringValue="?"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHthdXRob3JpemVSZWRpcmVjdFVSSURlY29kZWR9JmNvZGU9JHthdXRob3JpemF0aW9uX2NvZGV9"/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Invalid token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHthdXRob3JpemVSZWRpcmVjdFVSSURlY29kZWR9P2NvZGU9JHthdXRob3JpemF0aW9uX2NvZGV9"/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Access was granted: response_type=code"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Decide wether to issue an access_token or an authorization_code"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt0b1N0b3JlfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="toStore"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="toStore"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="storeResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${storeResult.mainpart}"/&gt;
                    &lt;L7p:Expression2 stringValue="persisted"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="persisted"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Persist"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPjxiPlRoZSB0b2tlbiBjb3VsZCBub3QgYmUgaXNzdWVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyIG9yIGNvbnRhY3QgeW91ciBzeXN0ZW0gYWRtaW5pc3RyYXRvcjwvYj48L3A+DQo8L2Rpdj4="/&gt;
                    &lt;L7p:VariableToSet stringValue="newErrorContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorContent"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;!--oauth_content_placeholder--&gt;"/&gt;
                    &lt;L7p:RegexName stringValue="update the content of the website"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="${newErrorContent}"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtlcnJvckNvbnRlbnR9"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Error persisting the token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Persist the issued token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeState.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtsb2NhdGlvbn0mc3RhdGU9JHthdXRob3JpemVTdGF0ZS5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="add state parameter if sent in request message"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeScopeDecoded}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtsb2NhdGlvbn0mc2NvcGU9JHthdXRob3JpemVTY29wZS5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="add scope parameter if sent in request message"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="resource_owner"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="resource_owner_cookie"/&gt;
                    &lt;L7p:TransformType transformType="BASE64_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Redirect back to the client"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="302"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html;"/&gt;
                    &lt;L7p:ResponseStatus stringValue="302"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Location"/&gt;
                    &lt;L7p:HeaderValue stringValue="${location}"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${userSessionCookieValue}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2a=${userSessionCookieValue}"/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue=" Set l7otk2a cookie if user just authenticated"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Access was granted"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="Deny"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="Deny"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlc3Npb25JRH0mY2FjaGVJZD1hdXRob3JpemVDYWNoZSZjYWNoZUFnZT0ke3Nlc3Npb25JZENhY2hlQWdlfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="lookupSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="sessionValue"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:found/ns:value/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="decoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtkZWNvZGVkfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="grantedContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeRedirectURI"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/redirect_uri/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="authorizeState"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="grantedContent"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/authorize/state"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="authorizeRedirectURI.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="authorizeRedirectURIDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="authorizeState.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="authorizeStateDecoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeRedirectURIDecoded}"/&gt;
                    &lt;L7p:Expression2 stringValue="?"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:RightValue stringValue="?"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHthdXRob3JpemVSZWRpcmVjdFVSSURlY29kZWR9JmVycm9yPWFjY2Vzc19kZW5pZWQ="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHthdXRob3JpemVSZWRpcmVjdFVSSURlY29kZWR9P2Vycm9yPWFjY2Vzc19kZW5pZWQ="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Get the redirect URI and state value"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPjxiPlRoZSBwZXJpb2Qgb2YgdGltZSB0byBkZW55IGFjY2VzcyBoYXMgZXhwaXJlZDwvYj48L3A+DQo8L2Rpdj4="/&gt;
                    &lt;L7p:VariableToSet stringValue="newErrorContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorContent"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;!--oauth_content_placeholder--&gt;"/&gt;
                    &lt;L7p:RegexName stringValue="update the content of the website"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="${newErrorContent}"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="401"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtlcnJvckNvbnRlbnR9"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="401"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Create the redirect location"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGF1dGhvcml6ZT4NCiAgICA8Y2xpZW50TmFtZT48L2NsaWVudE5hbWU+DQogICAgPGNsaWVudF9pZD48L2NsaWVudF9pZD4NCiAgICA8cmVkaXJlY3RfdXJpPjwvcmVkaXJlY3RfdXJpPg0KICAgIDxvcmlnaW5hbF9yZWRpcmVjdF91cmk+PC9vcmlnaW5hbF9yZWRpcmVjdF91cmk+DQogICAgPHJlc3BvbnNlX3R5cGU+PC9yZXNwb25zZV90eXBlPg0KICAgIDxzY29wZT48L3Njb3BlPg0KICAgIDxzdGF0ZT48L3N0YXRlPg0KPC9hdXRob3JpemU+"/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlc3Npb25JRH0mY2FjaGVJZD1hdXRob3JpemVDYWNoZSZjYWNoZUFnZT0ke2RlbGV0ZUNhY2hlQWdlfSZjYWNoZU1heEVudHJpZXM9MTAwMDAmY2FjaGVNYXhTaXplPTEwMDAwJnZhbHVlPSR7c2Vzc2lvblZhbHVlfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Override (delete) cache entry"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeStateDecoded}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtsb2NhdGlvbn0mc3RhdGU9JHthdXRob3JpemVTdGF0ZS5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="add state parameter if sent in request message"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="302"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Redirect"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:ResponseContentType stringValue="text/plain; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="302"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Location"/&gt;
                    &lt;L7p:HeaderValue stringValue="${location}"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Access was denied"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.action}"/&gt;
                    &lt;L7p:Expression2 stringValue="reset"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="reset"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPlBsZWFzZSBnbyBiYWNrIHRvIHRoZSBjbGllbnQgYW5kIHJlcXVlc3QgYWNjZXNzIHRvIHJlc291cmNlcyBhZ2FpbjwvcD4NCjwvZGl2Pg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="newContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="content"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;!--oauth_content_placeholder--&gt;"/&gt;
                    &lt;L7p:RegexName stringValue="update the content of the website"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="${newContent}"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtjb250ZW50fQ=="/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Set-Cookie"/&gt;
                    &lt;L7p:HeaderValue stringValue="l7otk2a="/&gt;
                    &lt;L7p:RemoveExisting booleanValue="true"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Wrong user"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.client_id}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlc3Npb25JRH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionID"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${sessionID}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlZGlyZWN0X3VyaX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="redirect_uri"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlc3BvbnNlX3R5cGV9"/&gt;
                    &lt;L7p:VariableToSet stringValue="response_type"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNjb3BlfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="redirect_uri"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="redirectURIEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="scope"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="scopeEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="response_type"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="response_typeEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="request.http.parameter.client_id"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="client_idEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2xpZW50X2tleT0ke2NsaWVudF9pZEVuY29kZWR9JmNhbGxiYWNrPSR7cmVkaXJlY3RVUklFbmNvZGVkfSZyZXNwb25zZV90eXBlPSR7cmVzcG9uc2VfdHlwZUVuY29kZWR9JnNjb3BlPSR7c2NvcGVFbmNvZGVkfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="validationRequest"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_ovp_server}/oauth/validation/v2/authorize"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="Cookie"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                    &lt;L7p:Name stringValue="SOAPAction"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Rules&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="validationRequest"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="validationResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathResult"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:result/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathResult.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="valid"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:RightValue stringValue="valid"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:scope/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathName"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:clientName/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathRedirectURI"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:redirect_uri/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathResponseType"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:response_type"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathScope.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="xpathScopeEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathName.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="xpathNameEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathRedirectURI.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="xpathRedirectURIEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="xpathResponseType.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="xpathResponseTypeEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="success"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathError"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:error/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="errorRedirectURI"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="validationResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:validation/ns:redirect_uri/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Get error redirect_uri"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPg0KJHt4cGF0aEVycm9yLnJlc3VsdH0NCjwvcD4NCjwvZGl2Pg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="newErrorContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorContent"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;!--oauth_content_placeholder--&gt;"/&gt;
                    &lt;L7p:RegexName stringValue="update the content of the website"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="${newErrorContent}"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="400"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtlcnJvckNvbnRlbnR9"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Return error in html"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Error"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Get the client values"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.response_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="code"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="code"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.response_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="token"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathResponseType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="ddd"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue="ddd"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:UUIDGenerator&gt;
                    &lt;L7p:MaximumQuantity intValue="2"/&gt;
                    &lt;L7p:Quantity stringValue="2"/&gt;
                    &lt;L7p:TargetVariable stringValue="sessionID"/&gt;
                    &lt;/L7p:UUIDGenerator&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="State may not be available"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnN0YXRlfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="state"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="state"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="stateEncoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGF1dGhvcml6ZT4NCiAgICA8Y2xpZW50TmFtZT4ke3hwYXRoTmFtZUVuY29kZWR9PC9jbGllbnROYW1lPg0KICAgIDxjbGllbnRfaWQ+JHtjbGllbnRfaWRFbmNvZGVkfTwvY2xpZW50X2lkPg0KICAgIDxnaXZlbl9yZWRpcmVjdF91cmk+JHtyZWRpcmVjdFVSSUVuY29kZWR9PC9naXZlbl9yZWRpcmVjdF91cmk+DQogICAgPHJlZGlyZWN0X3VyaT4ke3hwYXRoUmVkaXJlY3RVUklFbmNvZGVkfTwvcmVkaXJlY3RfdXJpPg0KICAgIDxyZXNwb25zZV90eXBlPiR7cmVzcG9uc2VfdHlwZUVuY29kZWR9PC9yZXNwb25zZV90eXBlPg0KICAgIDxzY29wZT4ke3hwYXRoU2NvcGVFbmNvZGVkfTwvc2NvcGU+DQogICAgPHN0YXRlPiR7c3RhdGVFbmNvZGVkfTwvc3RhdGU+DQogICAgPHNlc3Npb24+JHtzZXNzaW9uSURbMV19PC9zZXNzaW9uPg0KPC9hdXRob3JpemU+"/&gt;
                    &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHtzZXNzaW9uSURbMF19JmNhY2hlSWQ9YXV0aG9yaXplQ2FjaGUmY2FjaGVBZ2U9JHtzZXNzaW9uSWRDYWNoZUFnZX0mY2FjaGVNYXhFbnRyaWVzPTEwMDAwJmNhY2hlTWF4U2l6ZT0xMDAwMCZ2YWx1ZT0ke3Nlc3Npb25WYWx1ZX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="All validation passed. Generate website content"/&gt;
                    &lt;/L7p:CommentAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:CookieCredentialSource&gt;
                    &lt;L7p:CookieName stringValue="l7otk2a"/&gt;
                    &lt;/L7p:CookieCredentialSource&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtjb29raWUubDdvdGsyYX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="user_session_key"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="Y2FjaGVLZXk9JHt1c2VyX3Nlc3Npb25fa2V5fSZjYWNoZUlkPXVzZXJTZXNzaW9uSURDYWNoZVYyJmNhY2hlQWdlPSR7b3duZXJDYWNoZUFnZX0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="lookupSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="lookupSession"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:ForwardAll booleanValue="true"/&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                    &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="sessionValue"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="lookupSessionResult"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:found/ns:value/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="ns"/&gt;
                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-session"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="sessionValue.result"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="decoded"/&gt;
                    &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtkZWNvZGVkfQ=="/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="userSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="resource_owner_ref"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="userSession"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/s/resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="s"/&gt;
                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXNvdXJjZV9vd25lcl9yZWYucmVzdWx0fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="resource_owner"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPldlbGNvbWUgYmFjayA8Yj4ke3Jlc291cmNlX293bmVyfTwvYj4gKG5vdCAke3Jlc291cmNlX293bmVyfT8gPGEgaHJlZj0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9P2FjdGlvbj1yZXNldCI+Q2xpY2sgaGVyZTwvYT4pPC9wPg0KPHA+DQpBIGNsaWVudCB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBpcyBzZWVraW5nIGFjY2VzcyB0byByZXNvdXJjZXM6DQo8dGFibGU+DQo8dHI+PHRkPjxiPmNsaWVudF9uYW1lOjwvYj48L3RkPjx0ZD4ke3hwYXRoTmFtZS5yZXN1bHR9PC90ZD48L3RyPg0KPHRyPjx0ZD48Yj5jbGllbnRfaWQ6PC9iPjwvdGQ+PHRkPiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5jbGllbnRfaWR9PC90ZD48L3RyPg0KPHRyPjx0ZD48Yj5yZWRpcmVjdF91cmk6PC9iPjwvdGQ+PHRkPiR7eHBhdGhSZWRpcmVjdFVSSS5yZXN1bHR9PC90ZD48L3RyPg0KPHRyPjx0ZD48Yj5yZXNwb25zZV90eXBlOjwvYj48L3RkPjx0ZD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVzcG9uc2VfdHlwZX08L3RkPjwvdHI+DQo8dHI+PHRkPjxiPnNjb3BlOjwvYj48L3RkPjx0ZD4ke3hwYXRoU2NvcGUucmVzdWx0fTwvdGQ+PC90cj4NCjwvdGFibGU+DQo8L3A+DQoNCjxwPlBsZWFzZSBncmFudCBvciBkZW55IHRoZSByZXF1ZXN0PC9wPg0KDQo8Zm9ybSBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSI+DQoJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2Vzc2lvbklEIiB2YWx1ZT0iJHtzZXNzaW9uSURbMF19Ii8+DQogPHRhYmxlPg0KIDx0cj4NCiAgPHRkPjxpbnB1dCB0eXBlPSJzdWJtaXQiIG5hbWU9ImFjdGlvbiIgdmFsdWU9IkdyYW50Ii8+PC90ZD4NCiAgPHRkPjxpbnB1dCB0eXBlPSJzdWJtaXQiIG5hbWU9ImFjdGlvbiIgdmFsdWU9IkRlbnkiLz48L3RkPg0KIDwvdHI+DQogPC90YWJsZT4NCjwvZm9ybT4NCg0KPC9kaXY+"/&gt;
                    &lt;L7p:VariableToSet stringValue="newContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPg0KQSBjbGllbnQgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXMgaXMgc2Vla2luZyBhY2Nlc3MgdG8gcmVzb3VyY2VzOg0KPHRhYmxlPg0KPHRyPjx0ZD48Yj5jbGllbnRfbmFtZTo8L2I+PC90ZD48dGQ+JHt4cGF0aE5hbWUucmVzdWx0fTwvdGQ+PC90cj4NCjx0cj48dGQ+PGI+Y2xpZW50X2lkOjwvYj48L3RkPjx0ZD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuY2xpZW50X2lkfTwvdGQ+PC90cj4NCjx0cj48dGQ+PGI+cmVkaXJlY3RfdXJpOjwvYj48L3RkPjx0ZD4ke3hwYXRoUmVkaXJlY3RVUkkucmVzdWx0fTwvdGQ+PC90cj4NCjx0cj48dGQ+PGI+cmVzcG9uc2VfdHlwZTo8L2I+PC90ZD48dGQ+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlc3BvbnNlX3R5cGV9PC90ZD48L3RyPg0KPHRyPjx0ZD48Yj5zY29wZTo8L2I+PC90ZD48dGQ+JHt4cGF0aFNjb3BlLnJlc3VsdH08L3RkPjwvdHI+DQo8L3RhYmxlPg0KPC9wPg0KDQo8cD5UbyBncmFudCBvciBkZW55IHRoZSByZXF1ZXN0IHlvdSBuZWVkIHRvIHByb3ZpZGUgeW91ciBjcmVkZW50aWFsczwvcD4NCg0KPGZvcm0gbWV0aG9kPSJQT1NUIiBhY3Rpb249IiR7cmVxdWVzdC51cmwucHJvdG9jb2x9Oi8vJHtyZXF1ZXN0LnVybC5ob3N0fToke3JlcXVlc3QudXJsLnBvcnR9JHtyZXF1ZXN0LnVybC5wYXRofSIgb25zdWJtaXQ9InJldHVybiB2YWxpZGF0ZUZvcm0oKSI+DQoJPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2Vzc2lvbklEIiB2YWx1ZT0iJHtzZXNzaW9uSURbMF19Ii8+DQogPHRhYmxlPg0KIDx0cj4NCiA8dGQ+VXNlcm5hbWU6PC90ZD48dGQ+PGlucHV0IHR5cGU9InRleHQiIGlkPSJ1c2VybmFtZSIgbmFtZT0idXNlcm5hbWUiLz48L3RkPg0KIDwvdHI+DQogPHRyPg0KIDx0ZD5QYXNzd29yZDo8L3RkPjx0ZD48aW5wdXQgdHlwZT0icGFzc3dvcmQiIGlkPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiLz48L3RkPg0KIDwvdHI+DQogPC90YWJsZT4NCg0KIDx0YWJsZT4NCiA8bGFiZWwgZm9yPSJwZXJzaXN0ZW50X2JveCI+S2VlcCBtZSBsb2dnZWQgaW46PC9sYWJlbD4NCiA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9InBlcnNpc3RlbnRfY29va2llIiBpZD0icGVyc2lzdGVudF9ib3giIHZhbHVlPSJ5ZXMiLz4NCiA8dHI+PHRkIGNvbHNwYW49IjIiPjxoci8+PC90ZD48L3RyPg0KIDx0cj4NCiAgPHRkPjxpbnB1dCB0eXBlPSJzdWJtaXQiIG5hbWU9ImFjdGlvbiIgdmFsdWU9IkdyYW50Ii8+PC90ZD4NCiAgPHRkPjxpbnB1dCB0eXBlPSJzdWJtaXQiIG5hbWU9ImFjdGlvbiIgdmFsdWU9IkRlbnkiLz48L3RkPg0KIDwvdHI+DQogPC90YWJsZT4NCjwvZm9ybT4NCg0KPC9kaXY+"/&gt;
                    &lt;L7p:VariableToSet stringValue="newContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="content"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;!--oauth_content_placeholder--&gt;"/&gt;
                    &lt;L7p:RegexName stringValue="update the content of the website"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="${newContent}"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtjb250ZW50fQ=="/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="bad response type"/&gt;
                    &lt;/L7p:AuditDetailAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathRedirectURI.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="?"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:RightValue stringValue="?"/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHt4cGF0aFJlZGlyZWN0VVJJLnJlc3VsdH0mZXJyb3I9dW5zdXBwb3J0ZWRfcmVzcG9uc2VfdHlwZQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Invalid token"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHt4cGF0aFJlZGlyZWN0VVJJLnJlc3VsdH0/ZXJyb3I9dW5zdXBwb3J0ZWRfcmVzcG9uc2VfdHlwZQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.state}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtsb2NhdGlvbn0mc3RhdGU9JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnN0YXRlfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="add state parameter if sent in request message"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="302"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Redirect"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:ResponseContentType stringValue="text/plain; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="302"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Location"/&gt;
                    &lt;L7p:HeaderValue stringValue="${location}"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Check response_type"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Initial call of the client"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${authorizeRedirectURI.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHthdXRob3JpemVSZWRpcmVjdFVSSS5yZXN1bHR9P2Vycm9yPWludmFsaWRfcmVxdWVzdA=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${errorRedirectURI.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtlcnJvclJlZGlyZWN0VVJJLnJlc3VsdH0/ZXJyb3I9aW52YWxpZF9yZXF1ZXN0"/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlZGlyZWN0X3VyaX0/ZXJyb3I9aW52YWxpZF9yZXF1ZXN0"/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request.http.parameter.state}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="JHtsb2NhdGlvbn0mc3RhdGU9JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnN0YXRlfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="location"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="302"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:ResponseContentType stringValue="text/plain; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="302"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:AddHeader&gt;
                    &lt;L7p:HeaderName stringValue="Location"/&gt;
                    &lt;L7p:HeaderValue stringValue="${location}"/&gt;
                    &lt;L7p:Target target="RESPONSE"/&gt;
                    &lt;/L7p:AddHeader&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Redirect error back to client"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression
                    stringValue="PGRpdj4NCjxwPkludmFsaWQgcmVxdWVzdC4gUGxlYXNlIHRyeSBhZ2Fpbi48L3A+DQo8L2Rpdj4="/&gt;
                    &lt;L7p:VariableToSet stringValue="newContent"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorContent"/&gt;
                    &lt;L7p:Regex stringValue="&amp;lt;!--oauth_content_placeholder--&gt;"/&gt;
                    &lt;L7p:RegexName stringValue="update the content of the website"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue="${newContent}"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:Regex&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${errorStatus}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtlcnJvckNvbnRlbnR9"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="${errorStatus}"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Custom error status"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="JHtlcnJvckNvbnRlbnR9"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Return error in html"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                    &lt;L7p:value stringValue="Unknown action"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;/wsp:All&gt;
                    &lt;/wsp:Policy&gt;
                </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Service>
</enumeration>