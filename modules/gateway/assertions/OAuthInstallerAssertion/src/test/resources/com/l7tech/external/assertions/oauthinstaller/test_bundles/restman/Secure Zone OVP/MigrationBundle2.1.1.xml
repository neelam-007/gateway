<?xml version="1.0" encoding="UTF-8"?>
<l7:Bundle xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management">
    <l7:References>
        <l7:Item xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management">
            <l7:Name>OAuth</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a1001f955</l7:Id>
            <l7:Type>FOLDER</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.709-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Folder folderId="0000000000000000ffffffffffffec76"
                    id="bf92fac9ef26014a856eaf8a1001f955" version="0">
                    <l7:Name>OAuth</l7:Name>
                </l7:Folder>
            </l7:Resource>
        </l7:Item>
        <l7:Item xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management">
            <l7:Name>OAuth 2.0</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a1001fa54</l7:Id>
            <l7:Type>FOLDER</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.699-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Folder folderId="bf92fac9ef26014a856eaf8a1001f955"
                    id="bf92fac9ef26014a856eaf8a1001fa54" version="0">
                    <l7:Name>OAuth 2.0</l7:Name>
                </l7:Folder>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>SecureZone - OVP</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a10020504</l7:Id>
            <l7:Type>FOLDER</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.565-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Folder folderId="bf92fac9ef26014a856eaf8a1001f955"
                    id="bf92fac9ef26014a856eaf8a10020504" version="0">
                    <l7:Name>SecureZone - OVP</l7:Name>
                </l7:Folder>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>OAuth Client Token Store Context Variables</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a1001f9d5</l7:Id>
            <l7:Type>POLICY</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.566-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Policy guid="fd850b8c-30fb-4058-bef2-b56b268ce582"
                    id="bf92fac9ef26014a856eaf8a1001f9d5" version="0">
                    <l7:PolicyDetail
                        folderId="bf92fac9ef26014a856eaf8a1001f955"
                        guid="fd850b8c-30fb-4058-bef2-b56b268ce582"
                        id="bf92fac9ef26014a856eaf8a1001f9d5" version="0">
                        <l7:Name>OAuth Client Token Store Context Variables</l7:Name>
                        <l7:PolicyType>Include</l7:PolicyType>
                        <l7:Properties>
                            <l7:Property key="revision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:PolicyDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0Mw=="/&gt;
            &lt;L7p:VariableToSet stringValue="host_oauth_tokenstore_server"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0Mw=="/&gt;
            &lt;L7p:VariableToSet stringValue="host_oauth_clientstore_server"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0Mw=="/&gt;
            &lt;L7p:VariableToSet stringValue="host_oauth_session_server"/&gt;
        &lt;/L7p:SetVariable&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Policy>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>oauth/validation</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a10020545</l7:Id>
            <l7:Type>SERVICE</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.574-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Service id="bf92fac9ef26014a856eaf8a10020545" version="2">
                    <l7:ServiceDetail
                        folderId="bf92fac9ef26014a856eaf8a10020504"
                        id="bf92fac9ef26014a856eaf8a10020545" version="2">
                        <l7:Name>oauth/validation</l7:Name>
                        <l7:Enabled>true</l7:Enabled>
                        <l7:ServiceMappings>
                            <l7:HttpMapping>
                                <l7:UrlPattern>/oauth/validation/validate/v2/tokenrequest</l7:UrlPattern>
                                <l7:Verbs>
                                    <l7:Verb>GET</l7:Verb>
                                    <l7:Verb>POST</l7:Verb>
                                    <l7:Verb>PUT</l7:Verb>
                                    <l7:Verb>DELETE</l7:Verb>
                                </l7:Verbs>
                            </l7:HttpMapping>
                        </l7:ServiceMappings>
                        <l7:Properties>
                            <l7:Property key="policyRevision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="wssProcessingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="internal">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="tracingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:ServiceDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy" version="0">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Validates the given client_id and secret"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Gets called when clients request an access_token"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="=================================="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="In order to get a better performance during token requests "/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="a local cache is used in order to support that requirement."/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Police lines as of line 22 are caching client lookup results."/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Since client configurations will hardly change these values can likely be cached for some time."/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="---------------------------------------------"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Configure the cache name and the accepted cache life time here:"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="(the cache allows up to one hundred client configurations to be cached for the operation 'getAll')"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="(the cache allows configurations for up to 100000 byte)"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="dG9rZW5SZXF1ZXN0Q2FjaGU="/&gt;
            &lt;L7p:VariableToSet stringValue="tokenRequestCacheName"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="NDU="/&gt;
            &lt;L7p:VariableToSet stringValue="tokenRequestCacheLifetimeInSeconds"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="=================================="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SslAssertion&gt;
            &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
        &lt;/L7p:SslAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="A FIP has to be introduced in order to accept only trusted clients"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Remove the Stop assertion once the FIP is configured"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:FalseAssertion&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="WARNING"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Replace this assertion with a federated identity assertion. Do not just delete it!"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
        &lt;/L7p:FalseAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:Include&gt;
            &lt;L7p:PolicyGuid stringValue="fd850b8c-30fb-4058-bef2-b56b268ce582"/&gt;
        &lt;/L7p:Include&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:HtmlFormDataAssertion&gt;
            &lt;L7p:AllowGet booleanValue="true"/&gt;
            &lt;L7p:AllowPost booleanValue="true"/&gt;
            &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
            &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="secret"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:FieldSpecs&gt;
        &lt;/L7p:HtmlFormDataAssertion&gt;
        &lt;L7p:EncodeDecode&gt;
            &lt;L7p:SourceVariableName stringValue="request.http.parameter.client_key"/&gt;
            &lt;L7p:TargetDataType variableDataType="string"/&gt;
            &lt;L7p:TargetVariableName stringValue="client_key"/&gt;
            &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
        &lt;/L7p:EncodeDecode&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;L7p:CacheLookup&gt;
                &lt;L7p:CacheEntryKey stringValue="${client_key}"/&gt;
                &lt;L7p:CacheId stringValue="${tokenRequestCacheName}"/&gt;
                &lt;L7p:ContentTypeOverride stringValue="text/xml"/&gt;
                &lt;L7p:MaxEntryAgeSeconds stringValue="${tokenRequestCacheLifetimeInSeconds}"/&gt;
                &lt;L7p:OtherTargetMessageVariable stringValue="clientValues"/&gt;
                &lt;L7p:Target target="OTHER"/&gt;
            &lt;/L7p:CacheLookup&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="Y2xpZW50X2tleT0ke2NsaWVudF9rZXl9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="msg"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_clientstore_server}/oauth/clientstore/getAll"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="msg"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:ForwardAll booleanValue="true"/&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="clientValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                &lt;/L7p:HttpRoutingAssertion&gt;
                &lt;L7p:CacheStorage&gt;
                    &lt;L7p:CacheEntryKey stringValue="${client_key}"/&gt;
                    &lt;L7p:CacheId stringValue="${tokenRequestCacheName}"/&gt;
                    &lt;L7p:MaxEntries stringValue="100"/&gt;
                    &lt;L7p:MaxEntryAgeSeconds stringValue="${tokenRequestCacheLifetimeInSeconds}"/&gt;
                    &lt;L7p:MaxEntrySizeBytes stringValue="100000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="clientValues"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:CacheStorage&gt;
            &lt;/wsp:All&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathSecret"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:keys/ns:values/ns:value/ns:secret/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:keys/ns:values/ns:value/ns:status/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:keys/ns:values/ns:value/ns:expiration/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:Expression1 stringValue="${xpathSecret.result}"/&gt;
                            &lt;L7p:Expression2 stringValue="${request.http.parameter.secret}"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="${request.http.parameter.secret}"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="${xpathStatus.result}"/&gt;
                            &lt;L7p:Expression2 stringValue="ENABLED"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                            &lt;L7p:ComparisonAssertion&gt;
                                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                &lt;L7p:Expression1 stringValue="${xpathExpiration.result}"/&gt;
                                &lt;L7p:Expression2 stringValue="0"/&gt;
                                &lt;L7p:Predicates predicates="included"&gt;
                                    &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:RightValue stringValue="0"/&gt;
                                    &lt;/L7p:item&gt;
                                &lt;/L7p:Predicates&gt;
                            &lt;/L7p:ComparisonAssertion&gt;
                            &lt;wsp:All wsp:Usage="Required"&gt;
                                &lt;L7p:SetVariable&gt;
                                    &lt;L7p:Base64Expression stringValue=""/&gt;
                                    &lt;L7p:DataType variableDataType="dateTime"/&gt;
                                    &lt;L7p:DateOffsetExpression stringValue=""/&gt;
                                    &lt;L7p:VariableToSet stringValue="now"/&gt;
                                &lt;/L7p:SetVariable&gt;
                                &lt;L7p:ComparisonAssertion&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:Expression1 stringValue="${now.seconds}"/&gt;
                                    &lt;L7p:Expression2 stringValue="${xpathExpiration.result}"/&gt;
                                    &lt;L7p:Operator operator="LE"/&gt;
                                    &lt;L7p:Predicates predicates="included"&gt;
                                    &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:Operator operator="LE"/&gt;
                                    &lt;L7p:RightValue stringValue="${xpathExpiration.result}"/&gt;
                                    &lt;/L7p:item&gt;
                                    &lt;/L7p:Predicates&gt;
                                &lt;/L7p:ComparisonAssertion&gt;
                            &lt;/wsp:All&gt;
                            &lt;L7p:assertionComment&gt;
                                &lt;L7p:Properties mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="check expiration date"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Properties&gt;
                            &lt;/L7p:assertionComment&gt;
                        &lt;/wsp:OneOrMore&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:AuditDetailAssertion&gt;
                            &lt;L7p:Detail stringValue="error: invalid_request, error_description: given client_secret is wrong                     or client_id has expired or it is disabled, given secret: ${request.http.parameter.secret}, status:                     ${token_status}, expiration: ${token_expiration}, time_now: ${now.seconds}"/&gt;
                            &lt;L7p:Level stringValue="WARNING"/&gt;
                        &lt;/L7p:AuditDetailAssertion&gt;
                        &lt;L7p:FalseAssertion/&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Check status and expiration and secret of key"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathType"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:clients/ns:values/ns:value/ns:type/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathName"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:clients/ns:values/ns:value/ns:name/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:keys/ns:values/ns:value/ns:scope/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorCacheContent"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:CacheStorage&gt;
                    &lt;L7p:CacheEntryKey stringValue="${client_key}"/&gt;
                    &lt;L7p:CacheId stringValue="${tokenRequestCacheName}"/&gt;
                    &lt;L7p:MaxEntries stringValue="100"/&gt;
                    &lt;L7p:MaxEntryAgeSeconds stringValue="5"/&gt;
                    &lt;L7p:MaxEntrySizeBytes stringValue="100000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorCacheContent"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:CacheStorage&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:HardcodedResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KICAgPHR5cGU+PCFbQ0RBVEFbJHt4cGF0aFR5cGUucmVzdWx0fV1dPjwvdHlwZT4KICAgPGNsaWVudF9uYW1lPjwhW0NEQVRBWyR7eHBhdGhOYW1lLnJlc3VsdH1dXT48L2NsaWVudF9uYW1lPgogICA8c2NvcGU+PCFbQ0RBVEFbJHt4cGF0aFNjb3BlLnJlc3VsdH1dXT48L3Njb3BlPgo8L3ZhbGlkYXRpb24+"/&gt;
            &lt;L7p:EarlyResponse booleanValue="true"/&gt;
        &lt;/L7p:HardcodedResponse&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Service>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>oauth/validation</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a10020587</l7:Id>
            <l7:Type>SERVICE</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.601-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Service id="bf92fac9ef26014a856eaf8a10020587" version="2">
                    <l7:ServiceDetail
                        folderId="bf92fac9ef26014a856eaf8a10020504"
                        id="bf92fac9ef26014a856eaf8a10020587" version="2">
                        <l7:Name>oauth/validation</l7:Name>
                        <l7:Enabled>true</l7:Enabled>
                        <l7:ServiceMappings>
                            <l7:HttpMapping>
                                <l7:UrlPattern>/oauth/validation/v2/authorize</l7:UrlPattern>
                                <l7:Verbs>
                                    <l7:Verb>GET</l7:Verb>
                                    <l7:Verb>POST</l7:Verb>
                                    <l7:Verb>PUT</l7:Verb>
                                    <l7:Verb>DELETE</l7:Verb>
                                </l7:Verbs>
                            </l7:HttpMapping>
                        </l7:ServiceMappings>
                        <l7:Properties>
                            <l7:Property key="policyRevision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="wssProcessingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="internal">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="tracingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:ServiceDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy" version="0">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="=================================="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="In order to get a better performance during token requests "/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="a local cache is used in order to support that requirement."/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Police lines as of line 27 are caching client lookup results."/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Since client configurations will hardly change these values can likely be cached for some time."/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="---------------------------------------------"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Configure the cache name and the accepted cache life time here:"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="(the cache allows up to one hundred client configurations to be cached for the operation 'getAll')"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="(the cache allows configurations for up to 100000 byte)"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="YXV0aG9yaXplQ2FjaGU="/&gt;
            &lt;L7p:VariableToSet stringValue="authorizeCacheName"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="NjA="/&gt;
            &lt;L7p:VariableToSet stringValue="authorizeCacheLifetimeInSeconds"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="=================================="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SslAssertion&gt;
            &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
        &lt;/L7p:SslAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="A FIP has to be introduced in order to accept only trusted clients"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Remove the Stop assertion once the FIP is configured"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:FalseAssertion&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="WARNING"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Replace this assertion with a federated identity assertion. Do not just delete it!"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
        &lt;/L7p:FalseAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:Include&gt;
            &lt;L7p:PolicyGuid stringValue="fd850b8c-30fb-4058-bef2-b56b268ce582"/&gt;
        &lt;/L7p:Include&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;error&gt;invalid request&lt;/error&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNsaWVudF9rZXl9"/&gt;
            &lt;L7p:VariableToSet stringValue="client_key"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNhbGxiYWNrfQ=="/&gt;
            &lt;L7p:VariableToSet stringValue="redirect_uri"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNjb3BlfQ=="/&gt;
            &lt;L7p:VariableToSet stringValue="scope"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlc3BvbnNlX3R5cGV9"/&gt;
            &lt;L7p:VariableToSet stringValue="response_type"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${client_key}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="========== Get client registration information =========="/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="client_key"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="client_key"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                &lt;/L7p:EncodeDecode&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:CacheLookup&gt;
                        &lt;L7p:CacheEntryKey stringValue="${client_key}"/&gt;
                        &lt;L7p:CacheId stringValue="${authorizeCacheName}"/&gt;
                        &lt;L7p:ContentTypeOverride stringValue="text/xml"/&gt;
                        &lt;L7p:MaxEntryAgeSeconds stringValue="${authorizeCacheLifetimeInSeconds}"/&gt;
                        &lt;L7p:OtherTargetMessageVariable stringValue="clientKeyValues"/&gt;
                        &lt;L7p:Target target="OTHER"/&gt;
                    &lt;/L7p:CacheLookup&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="Y2xpZW50X2tleT0ke2NsaWVudF9rZXl9"/&gt;
                            &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded; charset=utf-8"/&gt;
                            &lt;L7p:DataType variableDataType="message"/&gt;
                            &lt;L7p:VariableToSet stringValue="msg"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:HttpRoutingAssertion&gt;
                            &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_clientstore_server}/oauth/clientstore/getAll"/&gt;
                            &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                            &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                            &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:RequestHeaderRules&gt;
                            &lt;L7p:RequestMsgSrc stringValue="msg"/&gt;
                            &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:ForwardAll booleanValue="true"/&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:RequestParamRules&gt;
                            &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:ResponseHeaderRules&gt;
                            &lt;L7p:ResponseMsgDest stringValue="clientKeyValues"/&gt;
                            &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                        &lt;/L7p:HttpRoutingAssertion&gt;
                        &lt;L7p:CacheStorage&gt;
                            &lt;L7p:CacheEntryKey stringValue="${client_key}"/&gt;
                            &lt;L7p:CacheId stringValue="${authorizeCacheName}"/&gt;
                            &lt;L7p:MaxEntries stringValue="100"/&gt;
                            &lt;L7p:MaxEntryAgeSeconds stringValue="${authorizeCacheLifetimeInSeconds}"/&gt;
                            &lt;L7p:MaxEntrySizeBytes stringValue="100000"/&gt;
                            &lt;L7p:OtherTargetMessageVariable stringValue="clientKeyValues"/&gt;
                            &lt;L7p:Target target="OTHER"/&gt;
                        &lt;/L7p:CacheStorage&gt;
                    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathType"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:clients/ns:values/ns:value/ns:type/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathName"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:clients/ns:values/ns:value/ns:name/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathCallback"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:keys/ns:values/ns:value/ns:callback/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:keys/ns:values/ns:value/ns:scope/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:keys/ns:values/ns:value/ns:status/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="clientKeyValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:keys/ns:values/ns:value/ns:expiration/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Given client_id is invalid: ${client_key}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="errorCacheContent"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:EncodeDecode&gt;
                    &lt;L7p:SourceVariableName stringValue="client_key"/&gt;
                    &lt;L7p:TargetDataType variableDataType="string"/&gt;
                    &lt;L7p:TargetVariableName stringValue="client_key"/&gt;
                    &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                &lt;/L7p:EncodeDecode&gt;
                &lt;L7p:CacheStorage&gt;
                    &lt;L7p:CacheEntryKey stringValue="${client_key}"/&gt;
                    &lt;L7p:CacheId stringValue="${authorizeCacheName}"/&gt;
                    &lt;L7p:MaxEntries stringValue="100"/&gt;
                    &lt;L7p:MaxEntryAgeSeconds stringValue="5"/&gt;
                    &lt;L7p:MaxEntrySizeBytes stringValue="100000"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="errorCacheContent"/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:CacheStorage&gt;
                &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="400"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CjxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0Pgo8ZXJyb3I+SW52YWxpZCBjbGllbnRfaWQ8L2Vycm9yPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                &lt;/L7p:HardcodedResponse&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Get client info"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Return callback which can be used to deliver error messages"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;error&gt;invalid request&lt;/error&gt;
                    &lt;redirect_uri&gt;${xpathCallback.result}&lt;/redirect_uri&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:HtmlFormDataAssertion&gt;
            &lt;L7p:AllowGet booleanValue="true"/&gt;
            &lt;L7p:AllowPost booleanValue="true"/&gt;
            &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
            &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="callback"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="response_type"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="scope"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:FieldSpecs&gt;
        &lt;/L7p:HtmlFormDataAssertion&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathStatus.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="ENABLED"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                        &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                        &lt;L7p:Expression1 stringValue="${xpathExpiration.result}"/&gt;
                        &lt;L7p:Expression2 stringValue="0"/&gt;
                        &lt;L7p:Predicates predicates="included"&gt;
                            &lt;L7p:item binary="included"&gt;
                                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                &lt;L7p:RightValue stringValue="0"/&gt;
                            &lt;/L7p:item&gt;
                        &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="${gateway.time.seconds}"/&gt;
                            &lt;L7p:Expression2 stringValue="${xpathExpiration.result}"/&gt;
                            &lt;L7p:Operator operator="LE"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:Operator operator="LE"/&gt;
                                    &lt;L7p:RightValue stringValue="${xpathExpiration.result}"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="check expiration date"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:OneOrMore&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Given client_id is DISABLED or EXPIRED, statue: ${xpathStatus.result}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="400"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0PgogICA8ZXJyb3I+R2l2ZW4gY2xpZW50X2lkIGlzIERJU0FCTEVEIG9yIEVYUElSRUQ8L2Vycm9yPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                &lt;/L7p:HardcodedResponse&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check status and expiration of key"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="========== Add scope check here =========="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${scope}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNjb3BlLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="If scope parameter is missing in the request, return the default scope.                     The default scope in from client registration"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:TrueAssertion/&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Set scope parameter to return"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Do not return callback as it is invalid"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;error&gt;invalid request&lt;/error&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Public clients must have registered redirect_uri"/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="public"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="public"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Confidential clients utilizing implicit grant_type must have registered                     redirect_uri"/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="confidential"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="confidential"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${response_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="token"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="token"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${xpathType.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="confidential"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="confidential"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${response_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="token"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:RightValue stringValue="token"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Invalid redirect_uri: ${redirect_uri}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="400"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0PgogICA8ZXJyb3I+SW52YWxpZCByZWRpcmVjdF91cmk8L2Vycm9yPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                &lt;/L7p:HardcodedResponse&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check registered redirect_uri"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="If redirect_uri parameter is passed in, then it must match redirect_uri                     entered during client registration."/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aENhbGxiYWNrLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="callbacks"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:IncludeEntireExpressionCapture booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="callbacks"/&gt;
                    &lt;L7p:Regex stringValue="\s"/&gt;
                    &lt;L7p:RegexName stringValue="Remove white spaces"/&gt;
                    &lt;L7p:Replace booleanValue="true"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:Split&gt;
                    &lt;L7p:InputVariable stringValue="callbacks"/&gt;
                    &lt;L7p:OutputVariable stringValue="callbacks"/&gt;
                    &lt;L7p:SplitPattern stringValue=",|;"/&gt;
                &lt;/L7p:Split&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${callbacks}"/&gt;
                    &lt;L7p:Expression2 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:MultivaluedComparison multivaluedComparison="ANY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="${redirect_uri}"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="redirect_uri"/&gt;
                    &lt;L7p:Regex stringValue="^http"/&gt;
                    &lt;L7p:RegexName stringValue="Check that redirect_uri is an absolute URI"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Check that redirect_uri does not include a fragment component"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue="#"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="CONTAINS"/&gt;
                            &lt;L7p:RightValue stringValue="#"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="If redirect_uri parameter is not passed in, then use redirect_uri                     entered during client registration."/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aENhbGxiYWNrLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="redirect_uri"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="redirect_uri"/&gt;
                    &lt;L7p:Regex stringValue="^http"/&gt;
                    &lt;L7p:RegexName stringValue="Check that redirect_uri is an absolute URI"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="redirect_uri"/&gt;
                    &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
                    &lt;L7p:Regex stringValue="[,;][ \t\r\n]*http"/&gt;
                    &lt;L7p:RegexName stringValue="Check that redirect_uri is just one absolute URI"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Check that redirect_uri does not include a fragment component"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue="#"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="CONTAINS"/&gt;
                            &lt;L7p:RightValue stringValue="#"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item regex="included"&gt;
                            &lt;L7p:Pattern stringValue="|oob"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item regex="included"&gt;
                            &lt;L7p:Pattern stringValue="|oob"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="No redirect available"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="If redirect_uri parameter is passed and none was registered use the one                     passed in"/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item regex="included"&gt;
                            &lt;L7p:Pattern stringValue="|oob"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="redirect_uri"/&gt;
                    &lt;L7p:Regex stringValue="^http"/&gt;
                    &lt;L7p:RegexName stringValue="Check that redirect_uri is an absolute URI"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Check that redirect_uri does not include a fragment component"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue="#"/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="CONTAINS"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="CONTAINS"/&gt;
                            &lt;L7p:RightValue stringValue="#"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="Mismatching redirect uri. Given: ${request.http.parameter.callback},                     registered: ${xpathCallback.result}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:HardcodedResponse&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="400"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0PgogICA8ZXJyb3I+TWlzbWF0Y2hpbmcgcmVkaXJlY3QgdXJpLiBHaXZlbjogJyR7cmVkaXJlY3RfdXJpfSc8L2Vycm9yPgo8L3ZhbGlkYXRpb24+"/&gt;
                    &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                    &lt;L7p:ResponseStatus stringValue="400"/&gt;
                &lt;/L7p:HardcodedResponse&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Validate redirect_uri parameter against registered redirect_uri"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:HardcodedResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KICAgPGNsaWVudE5hbWU+PCFbQ0RBVEFbJHt4cGF0aE5hbWUucmVzdWx0fV1dPjwvY2xpZW50TmFtZT4KICAgPHJlZGlyZWN0X3VyaT48IVtDREFUQVske3JlZGlyZWN0X3VyaX1dXT48L3JlZGlyZWN0X3VyaT4KICAgPHNjb3BlPjwhW0NEQVRBWyR7c2NvcGV9XV0+PC9zY29wZT4KICAgPHJlc3BvbnNlX3R5cGU+PCFbQ0RBVEFbJHtyZXNwb25zZV90eXBlfV1dPjwvcmVzcG9uc2VfdHlwZT4KPC92YWxpZGF0aW9uPg=="/&gt;
            &lt;L7p:EarlyResponse booleanValue="true"/&gt;
        &lt;/L7p:HardcodedResponse&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Service>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>oauth/validation</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a100205c9</l7:Id>
            <l7:Type>SERVICE</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.621-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Service id="bf92fac9ef26014a856eaf8a100205c9" version="2">
                    <l7:ServiceDetail
                        folderId="bf92fac9ef26014a856eaf8a10020504"
                        id="bf92fac9ef26014a856eaf8a100205c9" version="2">
                        <l7:Name>oauth/validation</l7:Name>
                        <l7:Enabled>true</l7:Enabled>
                        <l7:ServiceMappings>
                            <l7:HttpMapping>
                                <l7:UrlPattern>/oauth/validation/validate/v1/signature</l7:UrlPattern>
                                <l7:Verbs>
                                    <l7:Verb>GET</l7:Verb>
                                    <l7:Verb>POST</l7:Verb>
                                    <l7:Verb>PUT</l7:Verb>
                                    <l7:Verb>DELETE</l7:Verb>
                                </l7:Verbs>
                            </l7:HttpMapping>
                        </l7:ServiceMappings>
                        <l7:Properties>
                            <l7:Property key="policyRevision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="wssProcessingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="internal">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="tracingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:ServiceDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy" version="0">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Validates oauth_signature for OAuth 1.0 requests"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Required request parameters: oauth_consumer_key, signatureBaseString"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Optional request parameters: oauth_token, oauth_verifier"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="MzA="/&gt;
            &lt;L7p:VariableToSet stringValue="cacheAge"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="MTAwMA=="/&gt;
            &lt;L7p:VariableToSet stringValue="cacheMaxEntries"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="MTAwMDA="/&gt;
            &lt;L7p:VariableToSet stringValue="cacheMaxSize"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SslAssertion&gt;
            &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
        &lt;/L7p:SslAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="A FIP has to be introduced in order to accept only trusted clients"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Remove the Stop assertion once the FIP is configured"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:FalseAssertion&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="WARNING"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Replace this assertion with a federated identity assertion. Do not just delete it!"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
        &lt;/L7p:FalseAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:Include&gt;
            &lt;L7p:PolicyGuid stringValue="fd850b8c-30fb-4058-bef2-b56b268ce582"/&gt;
        &lt;/L7p:Include&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLm9hdXRoX2NvbnN1bWVyX2tleX0="/&gt;
            &lt;L7p:VariableToSet stringValue="lookupApiKey"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:EncodeDecode&gt;
            &lt;L7p:SourceVariableName stringValue="request.http.parameter.oauth_signature"/&gt;
            &lt;L7p:TargetDataType variableDataType="string"/&gt;
            &lt;L7p:TargetVariableName stringValue="oauth_signature"/&gt;
            &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
        &lt;/L7p:EncodeDecode&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue=""/&gt;
            &lt;L7p:DataType variableDataType="dateTime"/&gt;
            &lt;L7p:DateOffsetExpression stringValue=""/&gt;
            &lt;L7p:VariableToSet stringValue="now"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;wsp:All wsp:Usage="Required"&gt;
            &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="Y29uc3VtZXJTZWNyZXRDYWNoZQ=="/&gt;
                        &lt;L7p:VariableToSet stringValue="cacheId"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="JHtsb29rdXBBcGlLZXl9"/&gt;
                        &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0mY2FjaGVJZD0ke2NhY2hlSWR9JmNhY2hlQWdlPSR7Y2FjaGVBZ2V9"/&gt;
                        &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                        &lt;L7p:DataType variableDataType="message"/&gt;
                        &lt;L7p:VariableToSet stringValue="lookupSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                        &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/get"/&gt;
                        &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                        &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                        &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:RequestHeaderRules&gt;
                        &lt;L7p:RequestMsgSrc stringValue="lookupSession"/&gt;
                        &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:ForwardAll booleanValue="true"/&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:RequestParamRules&gt;
                        &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:ResponseHeaderRules&gt;
                        &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                        &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:VariablePrefix stringValue="sessionValue"/&gt;
                        &lt;L7p:XmlMsgSrc stringValue="lookupSessionResult"/&gt;
                        &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                            &lt;L7p:Expression stringValue="/ns:found/ns:value/text()"/&gt;
                            &lt;L7p:Namespaces mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-session"/&gt;
                                &lt;/L7p:entry&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Namespaces&gt;
                            &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                        &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:EncodeDecode&gt;
                        &lt;L7p:SourceVariableName stringValue="sessionValue.result"/&gt;
                        &lt;L7p:TargetDataType variableDataType="string"/&gt;
                        &lt;L7p:TargetVariableName stringValue="decoded"/&gt;
                        &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="JHtkZWNvZGVkfQ=="/&gt;
                        &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                        &lt;L7p:DataType variableDataType="message"/&gt;
                        &lt;L7p:VariableToSet stringValue="consumerKeyValues"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Look in cache for client_key values"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:All&gt;
                &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="Y2xpZW50X2tleT0ke2xvb2t1cEFwaUtleX0="/&gt;
                        &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                        &lt;L7p:DataType variableDataType="message"/&gt;
                        &lt;L7p:VariableToSet stringValue="params"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                        &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_clientstore_server}/oauth/clientstore/getKey"/&gt;
                        &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                        &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                        &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:RequestHeaderRules&gt;
                        &lt;L7p:RequestMsgSrc stringValue="params"/&gt;
                        &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:RequestParamRules&gt;
                        &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:ResponseHeaderRules&gt;
                        &lt;L7p:ResponseMsgDest stringValue="consumerKeyValues"/&gt;
                        &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="JHtjb25zdW1lcktleVZhbHVlcy5tYWlucGFydH0="/&gt;
                        &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                        &lt;L7p:DataType variableDataType="message"/&gt;
                        &lt;L7p:VariableToSet stringValue="consumerKeyValues"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="Y29uc3VtZXJTZWNyZXRDYWNoZQ=="/&gt;
                        &lt;L7p:VariableToSet stringValue="cacheId"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="JHtsb29rdXBBcGlLZXl9"/&gt;
                        &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="JHtjb25zdW1lcktleVZhbHVlcy5tYWlucGFydH0="/&gt;
                        &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:EncodeDecode&gt;
                        &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                        &lt;L7p:TargetDataType variableDataType="string"/&gt;
                        &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                        &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                    &lt;/L7p:EncodeDecode&gt;
                    &lt;L7p:SetVariable&gt;
                        &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0mY2FjaGVJZD0ke2NhY2hlSWR9JmNhY2hlQWdlPSR7Y2FjaGVBZ2V9JmNhY2hlTWF4RW50cmllcz0ke2NhY2hlTWF4RW50cmllc30mY2FjaGVNYXhTaXplPSR7Y2FjaGVNYXhTaXplfSZ2YWx1ZT0ke3Nlc3Npb25WYWx1ZX0="/&gt;
                        &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                        &lt;L7p:DataType variableDataType="message"/&gt;
                        &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                    &lt;/L7p:SetVariable&gt;
                    &lt;L7p:HttpRoutingAssertion&gt;
                        &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                        &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                        &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                        &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:RequestHeaderRules&gt;
                        &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                        &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:ForwardAll booleanValue="true"/&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:RequestParamRules&gt;
                        &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                            &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                        &lt;/L7p:ResponseHeaderRules&gt;
                        &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                        &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                    &lt;/L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Look at client_store"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:All&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Get the client_key values"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:OneOrMore&gt;
            &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:VariablePrefix stringValue="clientSecret"/&gt;
                        &lt;L7p:XmlMsgSrc stringValue="consumerKeyValues"/&gt;
                        &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                            &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:secret/text()"/&gt;
                            &lt;L7p:Namespaces mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                                &lt;/L7p:entry&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Namespaces&gt;
                            &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                        &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:VariablePrefix stringValue="clientExpiration"/&gt;
                        &lt;L7p:XmlMsgSrc stringValue="consumerKeyValues"/&gt;
                        &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                            &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:expiration/text()"/&gt;
                            &lt;L7p:Namespaces mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                                &lt;/L7p:entry&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Namespaces&gt;
                            &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                        &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:VariablePrefix stringValue="clientStatus"/&gt;
                        &lt;L7p:XmlMsgSrc stringValue="consumerKeyValues"/&gt;
                        &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                            &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:status/text()"/&gt;
                            &lt;L7p:Namespaces mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                                &lt;/L7p:entry&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Namespaces&gt;
                            &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                        &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:VariablePrefix stringValue="clientName"/&gt;
                        &lt;L7p:XmlMsgSrc stringValue="consumerKeyValues"/&gt;
                        &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                            &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:client_name/text()"/&gt;
                            &lt;L7p:Namespaces mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-clientstore"/&gt;
                                &lt;/L7p:entry&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Namespaces&gt;
                            &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                        &lt;/L7p:XpathExpression&gt;
                    &lt;/L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:ComparisonAssertion&gt;
                        &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                        &lt;L7p:Expression1 stringValue="${clientStatus.result}"/&gt;
                        &lt;L7p:Expression2 stringValue="ENABLED"/&gt;
                        &lt;L7p:Predicates predicates="included"&gt;
                            &lt;L7p:item binary="included"&gt;
                                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                            &lt;/L7p:item&gt;
                        &lt;/L7p:Predicates&gt;
                    &lt;/L7p:ComparisonAssertion&gt;
                    &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="${clientExpiration.result}"/&gt;
                            &lt;L7p:Expression2 stringValue="0"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:RightValue stringValue="0"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="${now.seconds}"/&gt;
                            &lt;L7p:Expression2 stringValue="${clientExpiration.result}"/&gt;
                            &lt;L7p:Operator operator="LE"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:Operator operator="LE"/&gt;
                                    &lt;L7p:RightValue stringValue="${clientExpiration.result}"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="check expiration date"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:OneOrMore&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Validate client_key values"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:All&gt;
                &lt;wsp:All wsp:Usage="Required"&gt;
                    &lt;L7p:HardcodedResponse&gt;
                        &lt;L7p:AssertionComment assertionComment="included"&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="400"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:AssertionComment&gt;
                        &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0PgogICA8ZXJyb3I+b2F1dGhfY29uc3VtZXJfa2V5IGludmFsaWQgb3IgZXhwaXJlZDwvZXJyb3I+CjwvdmFsaWRhdGlvbj4="/&gt;
                        &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                        &lt;L7p:ResponseStatus stringValue="400"/&gt;
                    &lt;/L7p:HardcodedResponse&gt;
                    &lt;L7p:FalseAssertion/&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="invalid or expired"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:All&gt;
            &lt;/wsp:OneOrMore&gt;
            &lt;L7p:SetVariable&gt;
                &lt;L7p:Base64Expression stringValue="JHtjbGllbnRTZWNyZXQucmVzdWx0fSY="/&gt;
                &lt;L7p:VariableToSet stringValue="secrets"/&gt;
            &lt;/L7p:SetVariable&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Find the consumer_key_secret and validate values"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:All&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_consumer_key"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_signature"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_token"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_verifier"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="signatureBaseString"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                &lt;/L7p:HtmlFormDataAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLm9hdXRoX3Rva2VufSZ2ZXJpZmllcj0ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIub2F1dGhfdmVyaWZpZXJ9"/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="params"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:HttpMethod httpMethod="POST"/&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/getTemp"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="params"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                &lt;/L7p:HttpRoutingAssertion&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:ResponseXpathAssertion&gt;
                            &lt;L7p:VariablePrefix stringValue="tempTokenSecret"/&gt;
                            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:secret/text()"/&gt;
                                &lt;L7p:Namespaces mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                                    &lt;/L7p:entry&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Namespaces&gt;
                                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                            &lt;/L7p:XpathExpression&gt;
                        &lt;/L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:ResponseXpathAssertion&gt;
                            &lt;L7p:VariablePrefix stringValue="tempTokenExpiration"/&gt;
                            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:expiration/text()"/&gt;
                                &lt;L7p:Namespaces mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                                    &lt;/L7p:entry&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Namespaces&gt;
                                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                            &lt;/L7p:XpathExpression&gt;
                        &lt;/L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="${now.seconds}"/&gt;
                            &lt;L7p:Expression2 stringValue="${tempTokenExpiration.result}"/&gt;
                            &lt;L7p:Operator operator="LE"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:Operator operator="LE"/&gt;
                                    &lt;L7p:RightValue stringValue="${tempTokenExpiration.result}"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="JHtzZWNyZXRzfSR7dGVtcFRva2VuU2VjcmV0LnJlc3VsdH0="/&gt;
                            &lt;L7p:VariableToSet stringValue="secrets"/&gt;
                        &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:HardcodedResponse&gt;
                            &lt;L7p:AssertionComment assertionComment="included"&gt;
                                &lt;L7p:Properties mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="400"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Properties&gt;
                            &lt;/L7p:AssertionComment&gt;
                            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0PgogICA8ZXJyb3I+b2F1dGhfdG9rZW4gaXMgaW52YWxpZCBvciBleHBpcmVkPC9lcnJvcj4KPC92YWxpZGF0aW9uPg=="/&gt;
                            &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                            &lt;L7p:ResponseStatus stringValue="400"/&gt;
                        &lt;/L7p:HardcodedResponse&gt;
                        &lt;L7p:FalseAssertion/&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="invalid or expired"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="validate 'authorized request_token'"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_consumer_key"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_signature"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_token"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="signatureBaseString"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                &lt;/L7p:HtmlFormDataAssertion&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="dG9rZW5WYWx1ZXNDYWNoZQ=="/&gt;
                            &lt;L7p:VariableToSet stringValue="cacheId"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLm9hdXRoX3Rva2VufQ=="/&gt;
                            &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0mY2FjaGVJZD0ke2NhY2hlSWR9JmNhY2hlQWdlPSR7Y2FjaGVBZ2V9"/&gt;
                            &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                            &lt;L7p:DataType variableDataType="message"/&gt;
                            &lt;L7p:VariableToSet stringValue="lookupSession"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:HttpRoutingAssertion&gt;
                            &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/get"/&gt;
                            &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                            &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                            &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:RequestHeaderRules&gt;
                            &lt;L7p:RequestMsgSrc stringValue="lookupSession"/&gt;
                            &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:ForwardAll booleanValue="true"/&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:RequestParamRules&gt;
                            &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:ResponseHeaderRules&gt;
                            &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                            &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                        &lt;/L7p:HttpRoutingAssertion&gt;
                        &lt;L7p:ResponseXpathAssertion&gt;
                            &lt;L7p:VariablePrefix stringValue="sessionValue"/&gt;
                            &lt;L7p:XmlMsgSrc stringValue="lookupSessionResult"/&gt;
                            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                                &lt;L7p:Expression stringValue="/ns:found/ns:value/text()"/&gt;
                                &lt;L7p:Namespaces mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-session"/&gt;
                                    &lt;/L7p:entry&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Namespaces&gt;
                                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                            &lt;/L7p:XpathExpression&gt;
                        &lt;/L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:EncodeDecode&gt;
                            &lt;L7p:SourceVariableName stringValue="sessionValue.result"/&gt;
                            &lt;L7p:TargetDataType variableDataType="string"/&gt;
                            &lt;L7p:TargetVariableName stringValue="decoded"/&gt;
                            &lt;L7p:TransformType transformType="URL_DECODE"/&gt;
                        &lt;/L7p:EncodeDecode&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="JHtkZWNvZGVkfQ=="/&gt;
                            &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                            &lt;L7p:DataType variableDataType="message"/&gt;
                            &lt;L7p:VariableToSet stringValue="tokenValues"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="Look in cache for token values"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="dG9rZW49JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLm9hdXRoX3Rva2VufQ=="/&gt;
                            &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                            &lt;L7p:DataType variableDataType="message"/&gt;
                            &lt;L7p:VariableToSet stringValue="params"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:HttpRoutingAssertion&gt;
                            &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/get"/&gt;
                            &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                            &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                            &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:RequestHeaderRules&gt;
                            &lt;L7p:RequestMsgSrc stringValue="params"/&gt;
                            &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:RequestParamRules&gt;
                            &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:ResponseHeaderRules&gt;
                            &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                            &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                        &lt;/L7p:HttpRoutingAssertion&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="JHt0b2tlblZhbHVlcy5tYWlucGFydH0="/&gt;
                            &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                            &lt;L7p:DataType variableDataType="message"/&gt;
                            &lt;L7p:VariableToSet stringValue="tokenValues"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="dG9rZW5WYWx1ZXNDYWNoZQ=="/&gt;
                            &lt;L7p:VariableToSet stringValue="cacheId"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLm9hdXRoX3Rva2VufQ=="/&gt;
                            &lt;L7p:VariableToSet stringValue="cacheKey"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="JHt0b2tlblZhbHVlcy5tYWlucGFydH0="/&gt;
                            &lt;L7p:VariableToSet stringValue="sessionValue"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:EncodeDecode&gt;
                            &lt;L7p:SourceVariableName stringValue="sessionValue"/&gt;
                            &lt;L7p:TargetDataType variableDataType="string"/&gt;
                            &lt;L7p:TargetVariableName stringValue="sessionValue"/&gt;
                            &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
                        &lt;/L7p:EncodeDecode&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="Y2FjaGVLZXk9JHtjYWNoZUtleX0mY2FjaGVJZD0ke2NhY2hlSWR9JmNhY2hlQWdlPSR7Y2FjaGVBZ2V9JmNhY2hlTWF4RW50cmllcz0ke2NhY2hlTWF4RW50cmllc30mY2FjaGVNYXhTaXplPSR7Y2FjaGVNYXhTaXplfSZ2YWx1ZT0ke3Nlc3Npb25WYWx1ZX0="/&gt;
                            &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                            &lt;L7p:DataType variableDataType="message"/&gt;
                            &lt;L7p:VariableToSet stringValue="storeSession"/&gt;
                        &lt;/L7p:SetVariable&gt;
                        &lt;L7p:HttpRoutingAssertion&gt;
                            &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_session_server}/oauth/session/store"/&gt;
                            &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                            &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                            &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:RequestHeaderRules&gt;
                            &lt;L7p:RequestMsgSrc stringValue="storeSession"/&gt;
                            &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:ForwardAll booleanValue="true"/&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:RequestParamRules&gt;
                            &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                            &lt;/L7p:ResponseHeaderRules&gt;
                            &lt;L7p:ResponseMsgDest stringValue="lookupSessionResult"/&gt;
                            &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                        &lt;/L7p:HttpRoutingAssertion&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="Look at token store"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Get the token values"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:ResponseXpathAssertion&gt;
                            &lt;L7p:VariablePrefix stringValue="tokenSecret"/&gt;
                            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:secret/text()"/&gt;
                                &lt;L7p:Namespaces mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                                    &lt;/L7p:entry&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Namespaces&gt;
                                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                            &lt;/L7p:XpathExpression&gt;
                        &lt;/L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:ResponseXpathAssertion&gt;
                            &lt;L7p:VariablePrefix stringValue="tokenExpiration"/&gt;
                            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:expiration/text()"/&gt;
                                &lt;L7p:Namespaces mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                                    &lt;/L7p:entry&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Namespaces&gt;
                                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                            &lt;/L7p:XpathExpression&gt;
                        &lt;/L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:ResponseXpathAssertion&gt;
                            &lt;L7p:VariablePrefix stringValue="tokenStatus"/&gt;
                            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:status/text()"/&gt;
                                &lt;L7p:Namespaces mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="ns"/&gt;
                                    &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                                    &lt;/L7p:entry&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="s"/&gt;
                                    &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Namespaces&gt;
                                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                            &lt;/L7p:XpathExpression&gt;
                        &lt;/L7p:ResponseXpathAssertion&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="${tokenStatus.result}"/&gt;
                            &lt;L7p:Expression2 stringValue="ENABLED"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="${now.seconds}"/&gt;
                            &lt;L7p:Expression2 stringValue="${tokenExpiration.result}"/&gt;
                            &lt;L7p:Operator operator="LE"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:Operator operator="LE"/&gt;
                                    &lt;L7p:RightValue stringValue="${tokenExpiration.result}"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="Validate token values"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:HardcodedResponse&gt;
                            &lt;L7p:AssertionComment assertionComment="included"&gt;
                                &lt;L7p:Properties mapValue="included"&gt;
                                    &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="400"/&gt;
                                    &lt;/L7p:entry&gt;
                                &lt;/L7p:Properties&gt;
                            &lt;/L7p:AssertionComment&gt;
                            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+aW52YWxpZDwvcmVzdWx0PgogICA8ZXJyb3I+b2F1dGhfdG9rZW4gaXMgaW52YWxpZCBvciBleHBpcmVkPC9lcnJvcj4KPC92YWxpZGF0aW9uPg=="/&gt;
                            &lt;L7p:EarlyResponse booleanValue="true"/&gt;
                            &lt;L7p:ResponseStatus stringValue="400"/&gt;
                        &lt;/L7p:HardcodedResponse&gt;
                        &lt;L7p:FalseAssertion/&gt;
                        &lt;L7p:assertionComment&gt;
                            &lt;L7p:Properties mapValue="included"&gt;
                                &lt;L7p:entry&gt;
                                    &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                    &lt;L7p:value stringValue="invalid or expired"/&gt;
                                &lt;/L7p:entry&gt;
                            &lt;/L7p:Properties&gt;
                        &lt;/L7p:assertionComment&gt;
                    &lt;/wsp:All&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtzZWNyZXRzfSR7dG9rZW5TZWNyZXQucmVzdWx0fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="secrets"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="validate 'access_token'"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:HtmlFormDataAssertion&gt;
                    &lt;L7p:AllowGet booleanValue="true"/&gt;
                    &lt;L7p:AllowPost booleanValue="true"/&gt;
                    &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                    &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_consumer_key"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_signature"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="oauth_token"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item htmlFormFieldSpec="included"&gt;
                            &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                            &lt;L7p:DataType fieldDataType="any"/&gt;
                            &lt;L7p:MaxOccurs intValue="1"/&gt;
                            &lt;L7p:MinOccurs intValue="1"/&gt;
                            &lt;L7p:Name stringValue="signatureBaseString"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:FieldSpecs&gt;
                &lt;/L7p:HtmlFormDataAssertion&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="If oauth_token is present, it must be empty"/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:HtmlFormDataAssertion&gt;
                            &lt;L7p:AllowGet booleanValue="true"/&gt;
                            &lt;L7p:AllowPost booleanValue="true"/&gt;
                            &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
                            &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                                    &lt;L7p:DataType fieldDataType="any"/&gt;
                                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                                    &lt;L7p:MinOccurs intValue="1"/&gt;
                                    &lt;L7p:Name stringValue="oauth_token"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:FieldSpecs&gt;
                        &lt;/L7p:HtmlFormDataAssertion&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:Expression1 stringValue="${request.http.parameter.oauth_token}"/&gt;
                            &lt;L7p:Expression2 stringValue=""/&gt;
                            &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:Operator operator="EMPTY"/&gt;
                                    &lt;L7p:RightValue stringValue=""/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:TrueAssertion/&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="validate 'request_token' request"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="At least one token type must be present"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:GenerateSecurityHash&gt;
            &lt;L7p:Base64Data stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNpZ25hdHVyZUJhc2VTdHJpbmd9"/&gt;
            &lt;L7p:KeyText stringValue="${secrets}"/&gt;
            &lt;L7p:LineBreak lineBreak="CR-LF"/&gt;
            &lt;L7p:TargetOutputVariable stringValue="signature"/&gt;
        &lt;/L7p:GenerateSecurityHash&gt;
        &lt;L7p:AuditDetailAssertion&gt;
            &lt;L7p:Detail stringValue="Comparison did not match: ${signature} is equal to                     ${request.http.parameter.oauth_signature}, basestring:                     ${request.http.parameter.signatureBaseString}"/&gt;
            &lt;L7p:Enabled booleanValue="false"/&gt;
            &lt;L7p:Level stringValue="WARNING"/&gt;
        &lt;/L7p:AuditDetailAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${signature}"/&gt;
            &lt;L7p:Expression2 stringValue="${request.http.parameter.oauth_signature}"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${request.http.parameter.oauth_signature}"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:HardcodedResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KICAgPGNsaWVudF9uYW1lPjwhW0NEQVRBWyR7Y2xpZW50TmFtZS5yZXN1bHR9XV0+PC9jbGllbnRfbmFtZT4KPC92YWxpZGF0aW9uPg=="/&gt;
            &lt;L7p:EarlyResponse booleanValue="true"/&gt;
            &lt;L7p:ResponseContentType stringValue="text/xml; charset=utf-8"/&gt;
        &lt;/L7p:HardcodedResponse&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Service>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>oauth/validation</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a1002060b</l7:Id>
            <l7:Type>SERVICE</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.627-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Service id="bf92fac9ef26014a856eaf8a1002060b" version="2">
                    <l7:ServiceDetail
                        folderId="bf92fac9ef26014a856eaf8a10020504"
                        id="bf92fac9ef26014a856eaf8a1002060b" version="2">
                        <l7:Name>oauth/validation</l7:Name>
                        <l7:Enabled>true</l7:Enabled>
                        <l7:ServiceMappings>
                            <l7:HttpMapping>
                                <l7:UrlPattern>/oauth/validation/v1/authorize</l7:UrlPattern>
                                <l7:Verbs>
                                    <l7:Verb>GET</l7:Verb>
                                    <l7:Verb>POST</l7:Verb>
                                    <l7:Verb>PUT</l7:Verb>
                                    <l7:Verb>DELETE</l7:Verb>
                                </l7:Verbs>
                            </l7:HttpMapping>
                        </l7:ServiceMappings>
                        <l7:Properties>
                            <l7:Property key="policyRevision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="wssProcessingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="internal">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="tracingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:ServiceDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy" version="0">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Validates the authorization request for OAuth 1.0"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Moves a request_token to an authorized_request_token"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SslAssertion&gt;
            &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
        &lt;/L7p:SslAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="A FIP has to be introduced in order to accept only trusted clients"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Remove the Stop assertion once the FIP is configured"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:FalseAssertion&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="WARNING"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Replace this assertion with a federated identity assertion. Do not just delete it!"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
        &lt;/L7p:FalseAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:Include&gt;
            &lt;L7p:PolicyGuid stringValue="fd850b8c-30fb-4058-bef2-b56b268ce582"/&gt;
        &lt;/L7p:Include&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:HtmlFormDataAssertion&gt;
            &lt;L7p:AllowGet booleanValue="true"/&gt;
            &lt;L7p:AllowPost booleanValue="true"/&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="token, expiration, verifier"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:DisallowOtherFields booleanValue="true"/&gt;
            &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="expiration"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="token"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="verifier"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:FieldSpecs&gt;
        &lt;/L7p:HtmlFormDataAssertion&gt;
        &lt;L7p:HttpRoutingAssertion&gt;
            &lt;L7p:FailOnErrorStatus booleanValue="false"/&gt;
            &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/getTemp"/&gt;
            &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
            &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
            &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
            &lt;/L7p:RequestHeaderRules&gt;
            &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                        &lt;L7p:Name stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Rules&gt;
            &lt;/L7p:RequestParamRules&gt;
            &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
            &lt;/L7p:ResponseHeaderRules&gt;
            &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
            &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
        &lt;/L7p:HttpRoutingAssertion&gt;
        &lt;wsp:All wsp:Usage="Required"&gt;
            &lt;L7p:ResponseXpathAssertion&gt;
                &lt;L7p:VariablePrefix stringValue="xpathTokenValues"/&gt;
                &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:expiration/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="ns"/&gt;
                            &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="s"/&gt;
                            &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                &lt;/L7p:XpathExpression&gt;
            &lt;/L7p:ResponseXpathAssertion&gt;
            &lt;L7p:ComparisonAssertion&gt;
                &lt;L7p:Expression1 stringValue="${gateway.time.seconds}"/&gt;
                &lt;L7p:Expression2 stringValue="${xpathTokenValues.result}"/&gt;
                &lt;L7p:Operator operator="LE"/&gt;
                &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                        &lt;L7p:Operator operator="LE"/&gt;
                        &lt;L7p:RightValue stringValue="${xpathTokenValues.result}"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Predicates&gt;
            &lt;/L7p:ComparisonAssertion&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="validate expiration date"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:All&gt;
        &lt;wsp:All wsp:Usage="Required"&gt;
            &lt;L7p:ResponseXpathAssertion&gt;
                &lt;L7p:VariablePrefix stringValue="xpathTokenValues"/&gt;
                &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                    &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:resource_owner/text()"/&gt;
                    &lt;L7p:Namespaces mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="ns"/&gt;
                            &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                        &lt;/L7p:entry&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="s"/&gt;
                            &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Namespaces&gt;
                    &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                &lt;/L7p:XpathExpression&gt;
            &lt;/L7p:ResponseXpathAssertion&gt;
            &lt;L7p:ComparisonAssertion&gt;
                &lt;L7p:Expression1 stringValue="${xpathTokenValues.result}"/&gt;
                &lt;L7p:Expression2 stringValue="${request.http.parameter.resource_owner}"/&gt;
                &lt;L7p:Negate booleanValue="true"/&gt;
                &lt;L7p:Operator operator="EMPTY"/&gt;
                &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                        &lt;L7p:Negated booleanValue="true"/&gt;
                        &lt;L7p:Operator operator="EMPTY"/&gt;
                        &lt;L7p:RightValue stringValue="${request.http.parameter.resource_owner}"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Predicates&gt;
            &lt;/L7p:ComparisonAssertion&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="check the authorizing resource_owner"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:All&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathCallback"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:callback/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="dG9rZW49JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRva2VufSZ2ZXJpZmllcj0ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIudmVyaWZpZXJ9JmV4cGlyYXRpb249JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmV4cGlyYXRpb259"/&gt;
            &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
            &lt;L7p:DataType variableDataType="message"/&gt;
            &lt;L7p:VariableToSet stringValue="messageBody"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:HttpRoutingAssertion&gt;
            &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/update"/&gt;
            &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
            &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
            &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
            &lt;/L7p:RequestHeaderRules&gt;
            &lt;L7p:RequestMsgSrc stringValue="messageBody"/&gt;
            &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:ForwardAll booleanValue="true"/&gt;
                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
            &lt;/L7p:RequestParamRules&gt;
            &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                        &lt;L7p:Name stringValue="Set-Cookie"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Rules&gt;
            &lt;/L7p:ResponseHeaderRules&gt;
            &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
        &lt;/L7p:HttpRoutingAssertion&gt;
        &lt;L7p:HardcodedResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CjxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KPGNhbGxiYWNrPjwhW0NEQVRBWyR7eHBhdGhDYWxsYmFjay5yZXN1bHR9XV0+PC9jYWxsYmFjaz4KPC92YWxpZGF0aW9uPg=="/&gt;
            &lt;L7p:EarlyResponse booleanValue="true"/&gt;
        &lt;/L7p:HardcodedResponse&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Service>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>OAuth 2.0 Context Variables</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a1001fbd4</l7:Id>
            <l7:Type>POLICY</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.628-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Policy guid="1afdfe2b-8dd0-4ea6-b62e-bc14ee7870b2"
                    id="bf92fac9ef26014a856eaf8a1001fbd4" version="0">
                    <l7:PolicyDetail
                        folderId="bf92fac9ef26014a856eaf8a1001fa54"
                        guid="1afdfe2b-8dd0-4ea6-b62e-bc14ee7870b2"
                        id="bf92fac9ef26014a856eaf8a1001fbd4" version="0">
                        <l7:Name>OAuth 2.0 Context Variables</l7:Name>
                        <l7:PolicyType>Include</l7:PolicyType>
                        <l7:Properties>
                            <l7:Property key="revision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:PolicyDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="BEARER or MAC"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Base64Expression stringValue="QkVBUkVS"/&gt;
            &lt;L7p:VariableToSet stringValue="oauth2_token_type"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0Mw=="/&gt;
            &lt;L7p:VariableToSet stringValue="host_oauth_ovp_server"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0Mw=="/&gt;
            &lt;L7p:VariableToSet stringValue="host_oauth2_auth_template_server"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="L2F1dGgvb2F1dGgvdjIvYXV0aG9yaXplL3dlYnNpdGU="/&gt;
            &lt;L7p:VariableToSet stringValue="oauth2_auth_template_path"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="MTAw"/&gt;
            &lt;L7p:VariableToSet stringValue="oauth2_client_max_fail_per_sec"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="MTAw"/&gt;
            &lt;L7p:VariableToSet stringValue="oauth2_resource_owner_max_fail_per_sec"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="aHR0cHM6Ly9sb2NhbGhvc3Q6ODQ0Mw=="/&gt;
            &lt;L7p:VariableToSet stringValue="host_oauth2_auth_server"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="L2F1dGgvb2F1dGgvdjIvYXV0aG9yaXpl"/&gt;
            &lt;L7p:VariableToSet stringValue="oauth2_auth_path"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="L2F1dGgvb2F1dGgvdjIvdG9rZW4="/&gt;
            &lt;L7p:VariableToSet stringValue="oauth2_token_path"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="Mi4wIChSRkMgNjc0OSk="/&gt;
            &lt;L7p:VariableToSet stringValue="oauth2_version"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:ExportVariables&gt;
            &lt;L7p:ExportedVars stringArrayValue="included"&gt;
                &lt;L7p:item stringValue="oauth2_auth_path"/&gt;
                &lt;L7p:item stringValue="host_oauth2_auth_server"/&gt;
                &lt;L7p:item stringValue="oauth2_auth_template_path"/&gt;
                &lt;L7p:item stringValue="host_oauth2_auth_template_server"/&gt;
                &lt;L7p:item stringValue="oauth2_client_max_fail_per_sec"/&gt;
                &lt;L7p:item stringValue="oauth2_resource_owner_max_fail_per_sec"/&gt;
                &lt;L7p:item stringValue="oauth2_token_path"/&gt;
                &lt;L7p:item stringValue="oauth2_token_type"/&gt;
                &lt;L7p:item stringValue="host_oauth_ovp_server"/&gt;
                &lt;L7p:item stringValue="oauth2_version"/&gt;
            &lt;/L7p:ExportedVars&gt;
        &lt;/L7p:ExportVariables&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Policy>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>v2GenerateRequestMac</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a1001fbe8</l7:Id>
            <l7:Type>POLICY</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.639-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Policy guid="cd669be8-0f41-4265-8576-af87aa08f429"
                    id="bf92fac9ef26014a856eaf8a1001fbe8" version="0">
                    <l7:PolicyDetail
                        folderId="bf92fac9ef26014a856eaf8a1001f955"
                        guid="cd669be8-0f41-4265-8576-af87aa08f429"
                        id="bf92fac9ef26014a856eaf8a1001fbe8" version="0">
                        <l7:Name>v2GenerateRequestMac</l7:Name>
                        <l7:PolicyType>Include</l7:PolicyType>
                        <l7:Properties>
                            <l7:Property key="revision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:PolicyDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Generates request MAC using HMAC-SHA1 algorithm"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Inputs: timestamp_sec, nonce, http_method, url, ext, mac_key, mac_algorithm"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Outputs: mac"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="========== Validate inputs =========="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${timestamp_sec}"/&gt;
            &lt;L7p:Expression2 stringValue=""/&gt;
            &lt;L7p:Negate booleanValue="true"/&gt;
            &lt;L7p:Operator operator="EMPTY"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:Regex&gt;
            &lt;L7p:AutoTarget booleanValue="false"/&gt;
            &lt;L7p:OtherTargetMessageVariable stringValue="timestamp_sec"/&gt;
            &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
            &lt;L7p:Regex stringValue="^0+"/&gt;
            &lt;L7p:RegexName stringValue="Timestamp must not have leading zeros"/&gt;
            &lt;L7p:Replacement stringValue=""/&gt;
            &lt;L7p:Target target="OTHER"/&gt;
        &lt;/L7p:Regex&gt;
        &lt;L7p:Regex&gt;
            &lt;L7p:AutoTarget booleanValue="false"/&gt;
            &lt;L7p:OtherTargetMessageVariable stringValue="timestamp_sec"/&gt;
            &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
            &lt;L7p:Regex stringValue="^-"/&gt;
            &lt;L7p:RegexName stringValue="Timestamp must be a positive number"/&gt;
            &lt;L7p:Replacement stringValue=""/&gt;
            &lt;L7p:Target target="OTHER"/&gt;
        &lt;/L7p:Regex&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${nonce}"/&gt;
            &lt;L7p:Expression2 stringValue=""/&gt;
            &lt;L7p:Negate booleanValue="true"/&gt;
            &lt;L7p:Operator operator="EMPTY"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${http_method}"/&gt;
            &lt;L7p:Expression2 stringValue=""/&gt;
            &lt;L7p:Negate booleanValue="true"/&gt;
            &lt;L7p:Operator operator="EMPTY"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:Regex&gt;
            &lt;L7p:AutoTarget booleanValue="false"/&gt;
            &lt;L7p:OtherTargetMessageVariable stringValue="http_method"/&gt;
            &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
            &lt;L7p:Regex stringValue="[a-z]"/&gt;
            &lt;L7p:RegexName stringValue="HTTP method must be in upper case"/&gt;
            &lt;L7p:Replacement stringValue=""/&gt;
            &lt;L7p:Target target="OTHER"/&gt;
        &lt;/L7p:Regex&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${url}"/&gt;
            &lt;L7p:Expression2 stringValue=""/&gt;
            &lt;L7p:Negate booleanValue="true"/&gt;
            &lt;L7p:Operator operator="EMPTY"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${mac_key}"/&gt;
            &lt;L7p:Expression2 stringValue=""/&gt;
            &lt;L7p:Negate booleanValue="true"/&gt;
            &lt;L7p:Operator operator="EMPTY"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${mac_algorithm}"/&gt;
            &lt;L7p:Expression2 stringValue="hmac-sha-1"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="hmac-sha-1"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="========== Break URL into parts (protocol, hostname+port, path) =========="/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:Regex&gt;
            &lt;L7p:AutoTarget booleanValue="false"/&gt;
            &lt;L7p:CaptureVar stringValue="url_sub_string"/&gt;
            &lt;L7p:FindAll booleanValue="true"/&gt;
            &lt;L7p:OtherTargetMessageVariable stringValue="url"/&gt;
            &lt;L7p:Regex stringValue="([a-z]*)://([^/]*)(.*)"/&gt;
            &lt;L7p:Replacement stringValue=""/&gt;
            &lt;L7p:Target target="OTHER"/&gt;
        &lt;/L7p:Regex&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHt1cmxfc3ViX3N0cmluZ1szXX0="/&gt;
            &lt;L7p:VariableToSet stringValue="request_uri"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHt1cmxfc3ViX3N0cmluZ1syXX0="/&gt;
            &lt;L7p:VariableToSet stringValue="url_hostname_port"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue=""/&gt;
            &lt;L7p:VariableToSet stringValue="host"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue=""/&gt;
            &lt;L7p:VariableToSet stringValue="port"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="url_hostname_port_sub_string"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="url_hostname_port"/&gt;
                    &lt;L7p:Regex stringValue="([^:]*):([0-9]*)"/&gt;
                    &lt;L7p:RegexName stringValue="get hostname and port number"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt1cmxfaG9zdG5hbWVfcG9ydF9zdWJfc3RyaW5nWzFdfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="host"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt1cmxfaG9zdG5hbWVfcG9ydF9zdWJfc3RyaW5nWzJdfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="port"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="port is specified"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt1cmxfaG9zdG5hbWVfcG9ydH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="host"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:Expression1 stringValue="${url_sub_string[1]}"/&gt;
                            &lt;L7p:Expression2 stringValue="http"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="http"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="ODA="/&gt;
                            &lt;L7p:VariableToSet stringValue="port"/&gt;
                        &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:Expression1 stringValue="${url_sub_string[1]}"/&gt;
                            &lt;L7p:Expression2 stringValue="https"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:RightValue stringValue="https"/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="NDQz"/&gt;
                            &lt;L7p:VariableToSet stringValue="port"/&gt;
                        &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Use default port"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="port is not specified"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Get hostname and port number"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Check if there are any uppercases in hostname"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="host"/&gt;
                    &lt;L7p:Regex stringValue="[A-Z]"/&gt;
                    &lt;L7p:RegexName stringValue="Check for uppercase"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="PGhvc3RuYW1lPiR7aG9zdH08L2hvc3RuYW1lPg=="/&gt;
                    &lt;L7p:VariableToSet stringValue="xml"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4bWx9"/&gt;
                    &lt;L7p:ContentType stringValue="text/xml; charset=utf-8"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="forXSL"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:XslTransformation&gt;
                    &lt;L7p:Direction intValue="-1"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="forXSL"/&gt;
                    &lt;L7p:ResourceInfo staticResourceInfo="included"&gt;
                        &lt;L7p:Document stringValueReference="inline"&gt;&lt;![CDATA[&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
                    &lt;xsl:output method="text" omit-xml-declaration="yes"/&gt;
                    &lt;xsl:variable name="lowercase" select="'abcdefghijklmnopqrstuvwxyz'"/&gt;
                    &lt;xsl:variable name="uppercase" select="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"/&gt;
                    &lt;xsl:template match="/hostname"&gt;
                    &lt;xsl:value-of select="translate(., $uppercase, $lowercase)"/&gt;
                    &lt;/xsl:template&gt;
                    &lt;/xsl:stylesheet&gt;]]&gt;&lt;/L7p:Document&gt;
                    &lt;/L7p:ResourceInfo&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                    &lt;L7p:TransformName stringValue=""/&gt;
                &lt;/L7p:XslTransformation&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtmb3JYU0wubWFpbnBhcnR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="host"/&gt;
                &lt;/L7p:SetVariable&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:TrueAssertion/&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Change hostname to lowercase"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${request_uri}"/&gt;
            &lt;L7p:Expression2 stringValue=""/&gt;
            &lt;L7p:Negate booleanValue="true"/&gt;
            &lt;L7p:Operator operator="EMPTY"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${host}"/&gt;
            &lt;L7p:Expression2 stringValue=""/&gt;
            &lt;L7p:Negate booleanValue="true"/&gt;
            &lt;L7p:Operator operator="EMPTY"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${port}"/&gt;
            &lt;L7p:Expression2 stringValue=""/&gt;
            &lt;L7p:Negate booleanValue="true"/&gt;
            &lt;L7p:Operator operator="EMPTY"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Negated booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:RightValue stringValue=""/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:EncodeDecode&gt;
            &lt;L7p:SourceVariableName stringValue="request_uri"/&gt;
            &lt;L7p:TargetDataType variableDataType="string"/&gt;
            &lt;L7p:TargetVariableName stringValue="request_uri"/&gt;
            &lt;L7p:TransformType transformType="URL_ENCODE"/&gt;
        &lt;/L7p:EncodeDecode&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue=""/&gt;
            &lt;L7p:LineBreak lineBreak="LF"/&gt;
            &lt;L7p:VariableToSet stringValue="empty_line"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHt0aW1lc3RhbXBfc2VjfQ0KJHtub25jZX0NCiR7aHR0cF9tZXRob2R9DQoke3JlcXVlc3RfdXJpfQ0KJHtob3N0fQ0KJHtwb3J0fQ0KJHtleHR9DQoke2VtcHR5X2xpbmV9"/&gt;
            &lt;L7p:VariableToSet stringValue="normalized_request"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:GenerateSecurityHash&gt;
            &lt;L7p:Base64Data stringValue="JHtub3JtYWxpemVkX3JlcXVlc3R9"/&gt;
            &lt;L7p:KeyText stringValue="${mac_key}"/&gt;
            &lt;L7p:LineBreak lineBreak="CR-LF"/&gt;
            &lt;L7p:TargetOutputVariable stringValue="mac"/&gt;
        &lt;/L7p:GenerateSecurityHash&gt;
        &lt;L7p:ExportVariables&gt;
            &lt;L7p:ExportedVars stringArrayValue="included"&gt;
                &lt;L7p:item stringValue="mac"/&gt;
            &lt;/L7p:ExportedVars&gt;
        &lt;/L7p:ExportVariables&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Policy>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>oauth/validation</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a1002064d</l7:Id>
            <l7:Type>SERVICE</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.661-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Service id="bf92fac9ef26014a856eaf8a1002064d" version="2">
                    <l7:ServiceDetail
                        folderId="bf92fac9ef26014a856eaf8a10020504"
                        id="bf92fac9ef26014a856eaf8a1002064d" version="2">
                        <l7:Name>oauth/validation</l7:Name>
                        <l7:Enabled>true</l7:Enabled>
                        <l7:ServiceMappings>
                            <l7:HttpMapping>
                                <l7:UrlPattern>/oauth/validation/validate/v2/token</l7:UrlPattern>
                                <l7:Verbs>
                                    <l7:Verb>GET</l7:Verb>
                                    <l7:Verb>POST</l7:Verb>
                                    <l7:Verb>PUT</l7:Verb>
                                    <l7:Verb>DELETE</l7:Verb>
                                </l7:Verbs>
                            </l7:HttpMapping>
                        </l7:ServiceMappings>
                        <l7:Properties>
                            <l7:Property key="policyRevision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="wssProcessingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="internal">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="tracingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:ServiceDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy" version="0">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="For Bearer token, pass in Authorization header OR access_token"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="For MAC token, pass in Authorization header, http_method, url"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SslAssertion&gt;
            &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
        &lt;/L7p:SslAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="A FIP has to be introduced in order to accept only trusted clients"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Remove the Stop assertion once the FIP is configured"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:FalseAssertion&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="WARNING"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Replace this assertion with a federated identity assertion. Do not just delete it!"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
        &lt;/L7p:FalseAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:Include&gt;
            &lt;L7p:PolicyGuid stringValue="fd850b8c-30fb-4058-bef2-b56b268ce582"/&gt;
        &lt;/L7p:Include&gt;
        &lt;L7p:Include&gt;
            &lt;L7p:PolicyGuid stringValue="1afdfe2b-8dd0-4ea6-b62e-bc14ee7870b2"/&gt;
        &lt;/L7p:Include&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmF1dGhfc2NoZW1lfQ=="/&gt;
            &lt;L7p:VariableToSet stringValue="token_type"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFjY2Vzc190b2tlbn0="/&gt;
            &lt;L7p:VariableToSet stringValue="access_token"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLmF1dGhvcml6YXRpb259"/&gt;
            &lt;L7p:VariableToSet stringValue="authorizationHeader"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;L7p:ComparisonAssertion&gt;
                &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                &lt;L7p:Expression1 stringValue="${token_type}"/&gt;
                &lt;L7p:Expression2 stringValue="${oauth2_token_type}"/&gt;
                &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                        &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                        &lt;L7p:RightValue stringValue="${oauth2_token_type}"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Predicates&gt;
            &lt;/L7p:ComparisonAssertion&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: invalid token type"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check token type"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;L7p:ComparisonAssertion&gt;
                &lt;L7p:Expression1 stringValue="${access_token}"/&gt;
                &lt;L7p:Expression2 stringValue=""/&gt;
                &lt;L7p:Negate booleanValue="true"/&gt;
                &lt;L7p:Operator operator="EMPTY"/&gt;
                &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                        &lt;L7p:Negated booleanValue="true"/&gt;
                        &lt;L7p:Operator operator="EMPTY"/&gt;
                        &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Predicates&gt;
            &lt;/L7p:ComparisonAssertion&gt;
            &lt;L7p:ComparisonAssertion&gt;
                &lt;L7p:Expression1 stringValue="${authorizationHeader}"/&gt;
                &lt;L7p:Expression2 stringValue=""/&gt;
                &lt;L7p:Negate booleanValue="true"/&gt;
                &lt;L7p:Operator operator="EMPTY"/&gt;
                &lt;L7p:Predicates predicates="included"&gt;
                    &lt;L7p:item binary="included"&gt;
                        &lt;L7p:Negated booleanValue="true"/&gt;
                        &lt;L7p:Operator operator="EMPTY"/&gt;
                        &lt;L7p:RightValue stringValue=""/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Predicates&gt;
            &lt;/L7p:ComparisonAssertion&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description&amp;quot;: Missing access                     token"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check access token"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5hY2Nlc3NfdG9rZW58QEB9IyMke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXJzLmh0dHBfbWV0aG9kfEBAfSMjJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy51cmx8QEB9"/&gt;
                    &lt;L7p:VariableToSet stringValue="requestParams"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Presence of &amp;quot;@@&amp;quot; indicates duplicate parameters"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="requestParams"/&gt;
                    &lt;L7p:ProceedIfPatternMatches booleanValue="false"/&gt;
                    &lt;L7p:Regex stringValue="@@"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Duplicate parameters"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check for duplicate access tokens and parameters in the request"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue=""/&gt;
            &lt;L7p:VariableToSet stringValue="token"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${access_token}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="QmVhcmVy"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHthY2Nlc3NfdG9rZW59"/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Bearer - access_token parameter"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${authorizationHeader}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="auth_header"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="authorizationHeader"/&gt;
                    &lt;L7p:Regex stringValue="MAC\s+(.*)"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${auth_header[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="id"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="authorizationHeader"/&gt;
                    &lt;L7p:Regex stringValue="id\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${id[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="bWFj"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_type"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtpZFsxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="mac - Authorization Header"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Invalid request"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Get token type (Bearer or mac)"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="dG9rZW49JHt0b2tlbn0="/&gt;
                    &lt;L7p:ContentType stringValue="application/x-www-form-urlencoded"/&gt;
                    &lt;L7p:DataType variableDataType="message"/&gt;
                    &lt;L7p:VariableToSet stringValue="getTokenValues"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:HttpRoutingAssertion&gt;
                    &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/get"/&gt;
                    &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
                    &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
                    &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestHeaderRules&gt;
                    &lt;L7p:RequestMsgSrc stringValue="getTokenValues"/&gt;
                    &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:ForwardAll booleanValue="true"/&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:RequestParamRules&gt;
                    &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                        &lt;L7p:Rules httpPassthroughRules="included"/&gt;
                    &lt;/L7p:ResponseHeaderRules&gt;
                    &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
                    &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
                &lt;/L7p:HttpRoutingAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathClientKey"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:client_key/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathSecret"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:secret"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:expiration/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:scope/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathOwner"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:resource_owner/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:ResponseXpathAssertion&gt;
                    &lt;L7p:VariablePrefix stringValue="xpathStatus"/&gt;
                    &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
                    &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                        &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:status/text()"/&gt;
                        &lt;L7p:Namespaces mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="ns"/&gt;
                                &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="s"/&gt;
                                &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Namespaces&gt;
                        &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
                    &lt;/L7p:XpathExpression&gt;
                &lt;/L7p:ResponseXpathAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNlY3JldC5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_secret"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aEV4cGlyYXRpb24ucmVzdWx0fQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_expiration"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNjb3BlLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_scope"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aE93bmVyLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="token_resource_owner_id"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aENsaWVudEtleS5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_client_id"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFN0YXR1cy5yZXN1bHR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="token_status"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Look in tokenstore"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Access token is invalid or                     revoked"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="lookup token"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="Bearer"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="Bearer"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:TrueAssertion/&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="Bearer - No additional checks"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${token_type}"/&gt;
                    &lt;L7p:Expression2 stringValue="mac"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="mac"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="ts"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="request.http.header.authorization"/&gt;
                    &lt;L7p:Regex stringValue="ts\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${ts[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt0c1sxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="timestamp_sec"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="nonce"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="request.http.header.authorization"/&gt;
                    &lt;L7p:Regex stringValue="nonce\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${nonce[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtub25jZVsxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="nonce"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt0aW1lc3RhbXBfc2VjfSR7bm9uY2V9JHt0b2tlbn0="/&gt;
                    &lt;L7p:VariableToSet stringValue="replay_arg"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:WssReplayProtection&gt;
                    &lt;L7p:AssertionComment assertionComment="included"&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="Set the right timeframe!"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:CustomExpiryTime intValue="300000"/&gt;
                    &lt;L7p:CustomIdentifierVariable stringValue="replay_arg"/&gt;
                    &lt;L7p:CustomProtection booleanValue="true"/&gt;
                    &lt;L7p:CustomScope stringValue="${service.oid}"/&gt;
                &lt;/L7p:WssReplayProtection&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmh0dHBfbWV0aG9kfQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="http_method"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${http_method}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnVybH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="url"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${url}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:Regex&gt;
                            &lt;L7p:AutoTarget booleanValue="false"/&gt;
                            &lt;L7p:CaptureVar stringValue="ext"/&gt;
                            &lt;L7p:FindAll booleanValue="true"/&gt;
                            &lt;L7p:OtherTargetMessageVariable stringValue="request.http.header.authorization"/&gt;
                            &lt;L7p:Regex stringValue="ext\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                            &lt;L7p:Replacement stringValue=""/&gt;
                            &lt;L7p:Target target="OTHER"/&gt;
                        &lt;/L7p:Regex&gt;
                        &lt;L7p:ComparisonAssertion&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Expression1 stringValue="${ext[1]}"/&gt;
                            &lt;L7p:Expression2 stringValue=""/&gt;
                            &lt;L7p:Negate booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:Predicates predicates="included"&gt;
                                &lt;L7p:item binary="included"&gt;
                                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                                    &lt;L7p:Negated booleanValue="true"/&gt;
                                    &lt;L7p:Operator operator="EMPTY"/&gt;
                                    &lt;L7p:RightValue stringValue=""/&gt;
                                &lt;/L7p:item&gt;
                            &lt;/L7p:Predicates&gt;
                        &lt;/L7p:ComparisonAssertion&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue="JHtleHRbMV19"/&gt;
                            &lt;L7p:VariableToSet stringValue="ext"/&gt;
                        &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;wsp:All wsp:Usage="Required"&gt;
                        &lt;L7p:SetVariable&gt;
                            &lt;L7p:Base64Expression stringValue=""/&gt;
                            &lt;L7p:VariableToSet stringValue="ext"/&gt;
                        &lt;/L7p:SetVariable&gt;
                    &lt;/wsp:All&gt;
                    &lt;L7p:assertionComment&gt;
                        &lt;L7p:Properties mapValue="included"&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                                &lt;L7p:value stringValue="ext is optional"/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:assertionComment&gt;
                &lt;/wsp:OneOrMore&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt0b2tlbl9zZWNyZXR9"/&gt;
                    &lt;L7p:VariableToSet stringValue="mac_key"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${mac_key}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="aG1hYy1zaGEtMQ=="/&gt;
                    &lt;L7p:VariableToSet stringValue="mac_algorithm"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:Regex&gt;
                    &lt;L7p:AutoTarget booleanValue="false"/&gt;
                    &lt;L7p:CaptureVar stringValue="request_mac"/&gt;
                    &lt;L7p:FindAll booleanValue="true"/&gt;
                    &lt;L7p:OtherTargetMessageVariable stringValue="request.http.header.authorization"/&gt;
                    &lt;L7p:Regex stringValue="mac\s*=&amp;quot;\s*([^&amp;quot;]*)&amp;quot;"/&gt;
                    &lt;L7p:Replacement stringValue=""/&gt;
                    &lt;L7p:Target target="OTHER"/&gt;
                &lt;/L7p:Regex&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${request_mac[1]}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0X21hY1sxXX0="/&gt;
                    &lt;L7p:VariableToSet stringValue="request_mac"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue="Generate mac and compare to mac in the request message"/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:Include&gt;
                    &lt;L7p:PolicyGuid stringValue="cd669be8-0f41-4265-8576-af87aa08f429"/&gt;
                &lt;/L7p:Include&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${request_mac}"/&gt;
                    &lt;L7p:Expression2 stringValue="${mac}"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="${mac}"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="mac"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Invalid request"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="validate token"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=""/&gt;
                    &lt;L7p:DataType variableDataType="dateTime"/&gt;
                    &lt;L7p:DateOffsetExpression stringValue=""/&gt;
                    &lt;L7p:VariableToSet stringValue="now"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${now.seconds}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item dataType="included"&gt;
                            &lt;L7p:Type variableDataType="int"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Operator operator="LE"/&gt;
                            &lt;L7p:RightValue stringValue="${token_expiration}"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${token_status}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item dataType="included"&gt;
                            &lt;L7p:Type variableDataType="string"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="error: invalid_request, error_description: Access token expired or                     disabled, status: ${token_status}, expiration: ${token_expiration}, time_now: ${now.seconds}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check expiration and status of access token"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:HardcodedResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KICAgPGNsaWVudF9rZXk+PCFbQ0RBVEFbJHt0b2tlbl9jbGllbnRfaWR9XV0+PC9jbGllbnRfa2V5PgogICA8cmVzb3VyY2Vfb3duZXI+PCFbQ0RBVEFbJHt0b2tlbl9yZXNvdXJjZV9vd25lcl9pZH1dXT48L3Jlc291cmNlX293bmVyPgogICA8c2NvcGU+PCFbQ0RBVEFbJHt0b2tlbl9zY29wZX1dXT48L3Njb3BlPgogICA8ZXhwaXJhdGlvbj48IVtDREFUQVske3Rva2VuX2V4cGlyYXRpb259XV0+PC9leHBpcmF0aW9uPgo8L3ZhbGlkYXRpb24+"/&gt;
        &lt;/L7p:HardcodedResponse&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Service>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>oauth/validation</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a1002068f</l7:Id>
            <l7:Type>SERVICE</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.668-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Service id="bf92fac9ef26014a856eaf8a1002068f" version="2">
                    <l7:ServiceDetail
                        folderId="bf92fac9ef26014a856eaf8a10020504"
                        id="bf92fac9ef26014a856eaf8a1002068f" version="2">
                        <l7:Name>oauth/validation</l7:Name>
                        <l7:Enabled>true</l7:Enabled>
                        <l7:ServiceMappings>
                            <l7:HttpMapping>
                                <l7:UrlPattern>/oauth/validation/validate/v2/refreshtoken</l7:UrlPattern>
                                <l7:Verbs>
                                    <l7:Verb>GET</l7:Verb>
                                    <l7:Verb>POST</l7:Verb>
                                    <l7:Verb>PUT</l7:Verb>
                                    <l7:Verb>DELETE</l7:Verb>
                                </l7:Verbs>
                            </l7:HttpMapping>
                        </l7:ServiceMappings>
                        <l7:Properties>
                            <l7:Property key="policyRevision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="wssProcessingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="internal">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="tracingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:ServiceDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy" version="0">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Validates a OAuth 2.0 Refresh Token"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SslAssertion&gt;
            &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
        &lt;/L7p:SslAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="A FIP has to be introduced in order to accept only trusted clients"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Remove the Stop assertion once the FIP is configured"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:FalseAssertion&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="WARNING"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Replace this assertion with a federated identity assertion. Do not just delete it!"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
        &lt;/L7p:FalseAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:Include&gt;
            &lt;L7p:PolicyGuid stringValue="fd850b8c-30fb-4058-bef2-b56b268ce582"/&gt;
        &lt;/L7p:Include&gt;
        &lt;L7p:HtmlFormDataAssertion&gt;
            &lt;L7p:AllowGet booleanValue="true"/&gt;
            &lt;L7p:AllowPost booleanValue="true"/&gt;
            &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="rtoken"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="scope"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:FieldSpecs&gt;
        &lt;/L7p:HtmlFormDataAssertion&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNjb3BlfQ=="/&gt;
            &lt;L7p:VariableToSet stringValue="scope"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;L7p:HttpRoutingAssertion&gt;
            &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/get"/&gt;
            &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
            &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
            &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
            &lt;/L7p:RequestHeaderRules&gt;
            &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                        &lt;L7p:Name stringValue="rtoken"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Rules&gt;
            &lt;/L7p:RequestParamRules&gt;
            &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
            &lt;/L7p:ResponseHeaderRules&gt;
            &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
            &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
        &lt;/L7p:HttpRoutingAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:scope/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:rexpiration/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathClientKey"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:client_key/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathOwner"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:resource_owner/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathStatus"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:status/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${xpathClientKey.result}"/&gt;
            &lt;L7p:Expression2 stringValue="${request.http.parameter.client_key}"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${request.http.parameter.client_key}"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue=""/&gt;
            &lt;L7p:DataType variableDataType="dateTime"/&gt;
            &lt;L7p:DateOffsetExpression stringValue=""/&gt;
            &lt;L7p:VariableToSet stringValue="now"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathExpiration.result}"/&gt;
                    &lt;L7p:Expression2 stringValue="${now.seconds}"/&gt;
                    &lt;L7p:Operator operator="GE"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Operator operator="GE"/&gt;
                            &lt;L7p:RightValue stringValue="${now.seconds}"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathStatus.result}"/&gt;
                    &lt;L7p:Operator operatorNull="null"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item dataType="included"&gt;
                            &lt;L7p:Type variableDataType="string"/&gt;
                        &lt;/L7p:item&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:RightValue stringValue="ENABLED"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:AuditDetailAssertion&gt;
                    &lt;L7p:Detail stringValue="refresh token was expired or disabled. expiration:                     ${xpathExpiration.result}, time_now: ${now.seconds}, status: ${xpathStatus.result}"/&gt;
                    &lt;L7p:Level stringValue="WARNING"/&gt;
                &lt;/L7p:AuditDetailAssertion&gt;
                &lt;L7p:FalseAssertion/&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check expiration and status of refresh token"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${scope}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue="JHt4cGF0aFNjb3BlLnJlc3VsdH0="/&gt;
                    &lt;L7p:VariableToSet stringValue="scope"/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:assertionComment&gt;
                    &lt;L7p:Properties mapValue="included"&gt;
                        &lt;L7p:entry&gt;
                            &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                            &lt;L7p:value stringValue="If scope parameter is missing, use existing scope"/&gt;
                        &lt;/L7p:entry&gt;
                    &lt;/L7p:Properties&gt;
                &lt;/L7p:assertionComment&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:TrueAssertion/&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Set the scope to be used"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:HardcodedResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KICAgPHNjb3BlPjwhW0NEQVRBWyR7c2NvcGV9XV0+PC9zY29wZT4KICAgPHJlc291cmNlX293bmVyPjwhW0NEQVRBWyR7eHBhdGhPd25lci5yZXN1bHR9XV0+PC9yZXNvdXJjZV9vd25lcj4KPC92YWxpZGF0aW9uPg=="/&gt;
            &lt;L7p:EarlyResponse booleanValue="true"/&gt;
            &lt;L7p:ResponseContentType stringValue="text/xml; charset=utf-8"/&gt;
        &lt;/L7p:HardcodedResponse&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Service>
            </l7:Resource>
        </l7:Item>
        <l7:Item>
            <l7:Name>oauth/validation</l7:Name>
            <l7:Id>bf92fac9ef26014a856eaf8a100206d1</l7:Id>
            <l7:Type>SERVICE</l7:Type>
            <l7:TimeStamp>2014-11-13T12:49:46.677-08:00</l7:TimeStamp>
            <l7:Resource>
                <l7:Service id="bf92fac9ef26014a856eaf8a100206d1" version="2">
                    <l7:ServiceDetail
                        folderId="bf92fac9ef26014a856eaf8a10020504"
                        id="bf92fac9ef26014a856eaf8a100206d1" version="2">
                        <l7:Name>oauth/validation</l7:Name>
                        <l7:Enabled>true</l7:Enabled>
                        <l7:ServiceMappings>
                            <l7:HttpMapping>
                                <l7:UrlPattern>/oauth/validation/validate/v2/granttype</l7:UrlPattern>
                                <l7:Verbs>
                                    <l7:Verb>GET</l7:Verb>
                                    <l7:Verb>POST</l7:Verb>
                                    <l7:Verb>PUT</l7:Verb>
                                    <l7:Verb>DELETE</l7:Verb>
                                </l7:Verbs>
                            </l7:HttpMapping>
                        </l7:ServiceMappings>
                        <l7:Properties>
                            <l7:Property key="policyRevision">
                                <l7:LongValue>1</l7:LongValue>
                            </l7:Property>
                            <l7:Property key="wssProcessingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="soap">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="internal">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                            <l7:Property key="tracingEnabled">
                                <l7:BooleanValue>false</l7:BooleanValue>
                            </l7:Property>
                        </l7:Properties>
                    </l7:ServiceDetail>
                    <l7:Resources>
                        <l7:ResourceSet tag="policy">
                            <l7:Resource type="policy" version="0">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy"&gt;
    &lt;wsp:All wsp:Usage="Required"&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Component version 2.1.2 installed by OAuth installer version otk2.1.2"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Validates grant types. Right now only 'auth_code' type"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:SslAssertion&gt;
            &lt;L7p:RequireClientAuthentication booleanValue="true"/&gt;
        &lt;/L7p:SslAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="A FIP has to be introduced in order to accept only trusted clients"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="Remove the Stop assertion once the FIP is configured"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:FalseAssertion&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="WARNING"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Replace this assertion with a federated identity assertion. Do not just delete it!"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
        &lt;/L7p:FalseAssertion&gt;
        &lt;L7p:CommentAssertion&gt;
            &lt;L7p:Comment stringValue="============================"/&gt;
        &lt;/L7p:CommentAssertion&gt;
        &lt;L7p:Include&gt;
            &lt;L7p:PolicyGuid stringValue="fd850b8c-30fb-4058-bef2-b56b268ce582"/&gt;
        &lt;/L7p:Include&gt;
        &lt;L7p:HtmlFormDataAssertion&gt;
            &lt;L7p:AllowGet booleanValue="true"/&gt;
            &lt;L7p:AllowPost booleanValue="true"/&gt;
            &lt;L7p:FieldSpecs htmlFormFieldSpecArray="included"&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="true"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="callback"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="client_key"/&gt;
                &lt;/L7p:item&gt;
                &lt;L7p:item htmlFormFieldSpec="included"&gt;
                    &lt;L7p:AllowEmpty boxedBooleanValue="false"/&gt;
                    &lt;L7p:DataType fieldDataType="any"/&gt;
                    &lt;L7p:MaxOccurs intValue="1"/&gt;
                    &lt;L7p:MinOccurs intValue="1"/&gt;
                    &lt;L7p:Name stringValue="token"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:FieldSpecs&gt;
        &lt;/L7p:HtmlFormDataAssertion&gt;
        &lt;L7p:CustomizeErrorResponse&gt;
            &lt;L7p:Content stringValueReference="inline"&gt;&lt;![CDATA[&lt;validation
                    xmlns="http://ns.l7tech.com/2012/11/otk-ovp"&gt;
                    &lt;result&gt;invalid&lt;/result&gt;
                    &lt;/validation&gt;]]&gt;&lt;/L7p:Content&gt;
            &lt;L7p:ContentType stringValue="text/xml; charset=UTF-8"/&gt;
            &lt;L7p:ExtraHeaders nameValuePairArray="included"/&gt;
            &lt;L7p:HttpStatus stringValue="401"/&gt;
        &lt;/L7p:CustomizeErrorResponse&gt;
        &lt;L7p:HttpRoutingAssertion&gt;
            &lt;L7p:ProtectedServiceUrl stringValue="${host_oauth_tokenstore_server}/oauth/tokenstore/getTemp"/&gt;
            &lt;L7p:ProxyPassword stringValueNull="null"/&gt;
            &lt;L7p:ProxyUsername stringValueNull="null"/&gt;
            &lt;L7p:RequestHeaderRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
            &lt;/L7p:RequestHeaderRules&gt;
            &lt;L7p:RequestParamRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"&gt;
                    &lt;L7p:item httpPassthroughRule="included"&gt;
                        &lt;L7p:Name stringValue="token"/&gt;
                    &lt;/L7p:item&gt;
                &lt;/L7p:Rules&gt;
            &lt;/L7p:RequestParamRules&gt;
            &lt;L7p:ResponseHeaderRules httpPassthroughRuleSet="included"&gt;
                &lt;L7p:Rules httpPassthroughRules="included"/&gt;
            &lt;/L7p:ResponseHeaderRules&gt;
            &lt;L7p:ResponseMsgDest stringValue="tokenValues"/&gt;
            &lt;L7p:SamlAssertionVersion intValue="2"/&gt;
        &lt;/L7p:HttpRoutingAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathCallback"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:callback"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathExpiration"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:expiration/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathClientKey"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:client_key/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathScope"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:scope/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ResponseXpathAssertion&gt;
            &lt;L7p:VariablePrefix stringValue="xpathOwner"/&gt;
            &lt;L7p:XmlMsgSrc stringValue="tokenValues"/&gt;
            &lt;L7p:XpathExpression xpathExpressionValue="included"&gt;
                &lt;L7p:Expression stringValue="/ns:values/ns:value/ns:resource_owner/text()"/&gt;
                &lt;L7p:Namespaces mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="ns"/&gt;
                        &lt;L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-tokenstore"/&gt;
                    &lt;/L7p:entry&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="s"/&gt;
                        &lt;L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Namespaces&gt;
                &lt;L7p:XpathVersion xpathVersion="XPATH_1_0"/&gt;
            &lt;/L7p:XpathExpression&gt;
        &lt;/L7p:ResponseXpathAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:Expression1 stringValue="${xpathClientKey.result}"/&gt;
            &lt;L7p:Expression2 stringValue="${request.http.parameter.client_key}"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:RightValue stringValue="${request.http.parameter.client_key}"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:ComparisonAssertion&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check that authorization code is not expired"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Expression1 stringValue="${xpathExpiration.result}"/&gt;
            &lt;L7p:Expression2 stringValue="${gateway.time.seconds}"/&gt;
            &lt;L7p:Operator operator="GE"/&gt;
            &lt;L7p:Predicates predicates="included"&gt;
                &lt;L7p:item binary="included"&gt;
                    &lt;L7p:Operator operator="GE"/&gt;
                    &lt;L7p:RightValue stringValue="${gateway.time.seconds}"/&gt;
                &lt;/L7p:item&gt;
            &lt;/L7p:Predicates&gt;
        &lt;/L7p:ComparisonAssertion&gt;
        &lt;L7p:SetVariable&gt;
            &lt;L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNhbGxiYWNrfQ=="/&gt;
            &lt;L7p:VariableToSet stringValue="redirect_uri"/&gt;
        &lt;/L7p:SetVariable&gt;
        &lt;wsp:OneOrMore wsp:Usage="Required"&gt;
            &lt;L7p:CommentAssertion&gt;
                &lt;L7p:Comment stringValue="redirect_uri parameter must match redirect_uri parameter used in                     authorization request."/&gt;
            &lt;/L7p:CommentAssertion&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:Negate booleanValue="true"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Negated booleanValue="true"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:RightValue stringValue="${xpathCallback.result}"/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;wsp:All wsp:Usage="Required"&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${redirect_uri}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
                &lt;L7p:ComparisonAssertion&gt;
                    &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                    &lt;L7p:Expression1 stringValue="${xpathCallback.result}"/&gt;
                    &lt;L7p:Expression2 stringValue=""/&gt;
                    &lt;L7p:ExpressionIsVariable booleanValue="false"/&gt;
                    &lt;L7p:Operator operator="EMPTY"/&gt;
                    &lt;L7p:Predicates predicates="included"&gt;
                        &lt;L7p:item binary="included"&gt;
                            &lt;L7p:CaseSensitive booleanValue="false"/&gt;
                            &lt;L7p:Operator operator="EMPTY"/&gt;
                            &lt;L7p:RightValue stringValue=""/&gt;
                        &lt;/L7p:item&gt;
                    &lt;/L7p:Predicates&gt;
                &lt;/L7p:ComparisonAssertion&gt;
            &lt;/wsp:All&gt;
            &lt;L7p:assertionComment&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="RIGHT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="Check redirect_uri"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:assertionComment&gt;
        &lt;/wsp:OneOrMore&gt;
        &lt;L7p:HardcodedResponse&gt;
            &lt;L7p:AssertionComment assertionComment="included"&gt;
                &lt;L7p:Properties mapValue="included"&gt;
                    &lt;L7p:entry&gt;
                        &lt;L7p:key stringValue="LEFT.COMMENT"/&gt;
                        &lt;L7p:value stringValue="200"/&gt;
                    &lt;/L7p:entry&gt;
                &lt;/L7p:Properties&gt;
            &lt;/L7p:AssertionComment&gt;
            &lt;L7p:Base64ResponseBody stringValue="PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+CiAgIDxyZXN1bHQ+dmFsaWQ8L3Jlc3VsdD4KICAgPHNjb3BlPjwhW0NEQVRBWyR7eHBhdGhTY29wZS5yZXN1bHR9XV0+PC9zY29wZT4KICAgPHJlc291cmNlX293bmVyPjwhW0NEQVRBWyR7eHBhdGhPd25lci5yZXN1bHR9XV0+PC9yZXNvdXJjZV9vd25lcj4KPC92YWxpZGF0aW9uPg=="/&gt;
            &lt;L7p:EarlyResponse booleanValue="true"/&gt;
            &lt;L7p:ResponseContentType stringValue="text/xml; charset=utf-8"/&gt;
        &lt;/L7p:HardcodedResponse&gt;
    &lt;/wsp:All&gt;
&lt;/wsp:Policy&gt;
</l7:Resource>
                        </l7:ResourceSet>
                    </l7:Resources>
                </l7:Service>
            </l7:Resource>
        </l7:Item>
    </l7:References>
    <l7:Mappings>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a1001f955"
            srcUri="/1.0/folders/bf92fac9ef26014a856eaf8a1001f955" type="FOLDER">
            <l7:Properties/>
        </l7:Mapping>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a10020504"
            srcUri="/1.0/folders/bf92fac9ef26014a856eaf8a10020504" type="FOLDER"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a1001f9d5"
            srcUri="/1.0/policies/bf92fac9ef26014a856eaf8a1001f9d5" type="POLICY"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a10020545"
            srcUri="/1.0/services/bf92fac9ef26014a856eaf8a10020545" type="SERVICE"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a10020587"
            srcUri="/1.0/services/bf92fac9ef26014a856eaf8a10020587" type="SERVICE"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a100205c9"
            srcUri="/1.0/services/bf92fac9ef26014a856eaf8a100205c9" type="SERVICE"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a1002060b"
            srcUri="/1.0/services/bf92fac9ef26014a856eaf8a1002060b" type="SERVICE"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a1001fa54"
            srcUri="/1.0/folders/bf92fac9ef26014a856eaf8a1001fa54" type="FOLDER">
            <l7:Properties/>
        </l7:Mapping>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a1001fbd4"
            srcUri="/1.0/policies/bf92fac9ef26014a856eaf8a1001fbd4" type="POLICY"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a1001fbe8"
            srcUri="/1.0/policies/bf92fac9ef26014a856eaf8a1001fbe8" type="POLICY"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a1002064d"
            srcUri="/1.0/services/bf92fac9ef26014a856eaf8a1002064d" type="SERVICE"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a1002068f"
            srcUri="/1.0/services/bf92fac9ef26014a856eaf8a1002068f" type="SERVICE"/>
        <l7:Mapping action="NewOrExisting"
            srcId="bf92fac9ef26014a856eaf8a100206d1"
            srcUri="/1.0/services/bf92fac9ef26014a856eaf8a100206d1" type="SERVICE"/>
    </l7:Mappings>
</l7:Bundle>
