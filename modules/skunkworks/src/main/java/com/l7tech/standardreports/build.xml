
<project name="ReportApp" default="javac" basedir=".">
    <description>Run ReportApp</description>

	<property name="class.name" value="com.l7tech.standardreports.ReportApp" />
    <property name="test_data_class.name" value="com.l7tech.standardreports.CreateTestData" />
    <property name="demo_class.name" value="com.l7tech.standardreports.demo.RunJetty" />
    <property name="ems.classes.dir" value="../../../../../../../../modules/ems/build/classes" />
    <property name="lib" value="../../../../../../../../lib" />
    <property name="ems.dependency.dir" value="../../../../../../../../modules/ems/build/dependency" />

    <property name="jasper.jrxml_files" value="../../../../../../../../modules/ems/src/main/java/com/l7tech/server/ems/standardreports" />

    <path id="jrc.classpath">
        <file file="${lib}/repository/jasperreports/jasperreports-3.0.0.jar"/>
        <fileset dir="${lib}/repository/org.apache.tomcat">
            <include name="*.jar"/>
        </fileset>
        <file file="${lib}/repository/commons-digester/commons-digester-1.7.jar"/>
        <file file="${lib}/repository/commons-collections/commons-collections-3.2.jar"/>
        <file file="${lib}/repository/commons-logging/commons-logging-1.1.jar"/>
        <file file="${lib}/repository/commons-beanutils/commons-beanutils-1.7.0.jar"/>
    </path>

    <path id="classpath">
        <pathelement location="." />
        <!-- Don't want the ems jar as may compile the ems classes during development-->
        <pathelement location="${ems.classes.dir}" />
        <fileset dir="${ems.dependency.dir}">
            <include name="**/*.jar"/>
        </fileset>
        <file file="${lib}/repository/junit/junit-4.4.jar"/>
    </path>

    <target name="javac" description="Compiles the java source files of the test application.">

        <javac srcdir="./" destdir="./" debug="true" optimize="false" deprecation="false">
			<classpath refid="classpath"/>
		</javac>
	</target>

	<target name="compile" description="Compiles all the XML report designs and produces the .jasper files.">
		<taskdef name="jrc" classname="net.sf.jasperreports.ant.JRAntCompileTask">
			<classpath refid="jrc.classpath"/>
		</taskdef>
		<jrc destdir="./">
			<src>
				<fileset dir="${jasper.jrxml_files}">
					<include name="*.jrxml"/>
				</fileset>
                <fileset dir=".">
                    <include name="*.jrxml"/>
                </fileset>

            </src>
			<classpath refid="classpath"/>
		</jrc>
	</target>

	<target name="fill" description="Fills the compiled report design with data and produces the .jrprint file.">

        <copy file="../../../../../../../ems/src/main/resources/com/l7tech/server/ems/standardreports/Styles.jrtx" todir="."/>
        <java classname="${class.name}">
			<arg value="fill"/>
			<classpath refid="classpath"/>
		</java>
	</target>

    <target name="test_data" description="Creates test data for the supplied services for the maximum default retention
    period for hourly and daily metric bins">
        <java classname="${test_data_class.name}" fork="true">
            <classpath refid="classpath"/>
        </java>
    </target>

    <target name="run_demo" description="Runs demo">
        <java classname="${demo_class.name}" fork="true">
            <classpath refid="classpath"/>
        </java>
    </target>

    <target name="view" description="Launches the report viewer to preview the report stored in the .jrprint file.">
		<java classname="${class.name}" fork="true">
			<arg value="view"/>
			<classpath refid="classpath"/>
		</java>
	</target>

	<target name="pdf" description="Generates a PDF version of the report by converting the .jrprint file.">
		<java classname="${class.name}">
			<arg value="pdf"/>
    		<classpath refid="classpath"/>
		</java>
	</target>

	<target name="html" description="Generates an HTML version of the report by converting the .jrprint file.">
		<java classname="${class.name}">
			<arg value="html"/>
			<classpath refid="classpath"/>
		</java>
	</target>

	<target name="clean" description="Deletes all the generated files.">
		<delete>
			<fileset dir="." includes="**/*.class" />
			<fileset dir="." includes="**/*.jasper" />
			<fileset dir="." includes="**/*.jrprint" />
			<fileset dir="." includes="**/*.jrpxml" />
			<fileset dir="." includes="*.html" />
			<fileset dir="." includes="**/*.rtf" />
			<fileset dir="." includes="**/*.pdf" />
            <fileset dir="." includes="**/*.sql" />
            <fileset dir="." includes="**/*.jrtx" />
        </delete>
	</target>

	<target name="test" description="Runs the sample.">
		<echo message="==================================="/>
		<echo message=" Subreport Sample"/>
		<echo message="==================================="/>
		<antcall target="clean" />
		<antcall target="javac" />
		<antcall target="compile" />
		<antcall target="fill" />
		<antcall target="pdf" />
		<antcall target="html" />
	</target>
</project>