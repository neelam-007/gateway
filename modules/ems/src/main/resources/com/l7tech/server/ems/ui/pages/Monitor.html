<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- PROTOTYPE ONLY BEGIN -->
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <!-- PROTOTYPE ONLY END -->
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Monitor [Enterprise Service Manager]</title>

    <wicket:head>
    <link rel="stylesheet" type="text/css" href="/css/l7.css" />

    <!-- Required YUI modules: button, connection, container, datasource, datatable, dom, drag & drop, event, get, json, logger -->
    <link rel="stylesheet" type="text/css" href="/yui/assets/skins/sam/skin.css">
    <script type="text/javascript" src="/yui/utilities/utilities.js"></script>
    <script type="text/javascript" src="/yui/button/button-min.js"></script>
    <script type="text/javascript" src="/yui/container/container-min.js"></script>
    <script type="text/javascript" src="/yui/datasource/datasource-min.js"></script>
    <script type="text/javascript" src="/yui/datatable/datatable-min.js"></script>
    <script type="text/javascript" src="/yui/json/json-min.js"></script>
    <script type="text/javascript" src="/yui/logger/logger-min.js"></script>

    <link rel="stylesheet" type="text/css" href="/css/l7-yui-skin.css" /> <!-- modifies YUI sam skin; must come after YUI CSS files -->
    <style type="text/css">
        .note {
            font-size: 90%;
            white-space: normal;
        }

        .panelToolbar span {
            vertical-align: middle;
        }

        #notifDlg_eMailConfig .panel,
        #notifDlg_snmpTrapConfig .panel,
        #notifDlg_httpRequestConfig .panel {
            background-color: #ffffff;
            margin-top: 0;
            width: 500px;
        }

        #notifDlg_eMailConfig .panelToolbar,
        #notifDlg_eMailConfig .panelToolbar select,
        #notifDlg_snmpTrapConfig .panelToolbar,
        #notifDlg_snmpTrapConfig .panelToolbar select,
        #notifDlg_httpRequestConfig .panelToolbar,
        #notifDlg_httpRequestConfig .panelToolbar select {
            font-size: 90%;
        }

        #notifDlg_eMailConfig .panel textarea,
        #notifDlg_snmpTrapConfig .panel textarea,
        #notifDlg_httpRequestConfig .panel textarea {
            background-color: #ffffff;
            border: none;
            width: 98%;
        }
    </style>
    <script type="text/javascript" src="/js/l7.js"></script>
    <script type="text/javascript" src="/js/entityTreeTable.js"></script>
    <script type="text/javascript">
        /** Localized strings for passing into l7.EntityTreeTable constructor. */
        var entityTreeTableLocalizedStrings = {
            SSG_CLUSTER_STATE_UP : 'Up',
            SSG_CLUSTER_STATE_PARTIAL : 'Partial',
            SSG_CLUSTER_STATE_DOWN : 'Down',
            SSG_NODE_STATE_ON : 'On',
            SSG_NODE_STATE_OFF : 'Off',
            SSG_NODE_STATE_DOWN : 'Down',
            SSG_NODE_STATE_OFFLINE : 'Offline',
            ACCESS_ACCOUNT_IS_SET : 'Access account is set. Click to change access account.',
            ACCESS_ACCOUNT_CAN_SET : 'No access account. Click to enter access account.',
            ACCESS_ACCOUNT_CANNOT_CHANGE : 'Access account is set. Trust must be established before changing access account.',
            ACCESS_ACCOUNT_CANNOT_SET : 'No access account. Trust must be established before entering access account.',
            ACCESS_GRANTED : 'Access granted',
            ACCESS_NOT_GRANTED : 'Access not granted',
            MONITORED_PROPERTY_BUTTON_TOOLTIP : 'Click to configure this monitoring property',
            ENTERPRISE_FOLDER : 'folder',
            SSG_CLUSTER : 'SSG Cluster',
            SSG_NODE : 'SSG Node',
            SERVICE_FOLDER : 'folder',
            PUBLISHED_SERVICE : 'published service',
            POLICY_FRAGMENT : 'policy fragment',
            SSL_HOST_NAME : 'SSL host name',
            ADMINISTRATIVE_PORT_NUMBER : 'administrative port number',
            IP_ADDRESS : 'IP address',
            DATABASE_HOSTS : 'database host(s)',
            SELF_HOST_NAME : 'self host name',
            ZOOM_ICON_TOOLTIP : 'Show details'
        };

        /** Localized strings for local HTML markups, e.g., toolbar buttons, context menu, error dialogs. */
        var localizedStrings = {
            AUDIT_SIZE : 'audit size',
            OPERATING_STATUS : 'operating status',
            LOG_SIZE : 'log file size',
            DISK_USAGE : 'disk usage',
            RAID_STATUS : 'RAID status',
            CPU_TEMP : 'CPU temperature',
            CPU_USAGE : 'CPU usage',
            SWAP_USAGE : 'swap space usage',
            CLOCK_DRIFT : 'clock drift',
            E_MAIL : 'e-Mail',
            SNMP_TRAP : 'SNMP Trap',
            HTTP_REQUEST : 'HTTP Request',
            ADD_NOTIFICATION_RULE : 'New Notification Rule',
            EDIT_NOTIFICATION_RULE : 'Edit Notification Rule',
            OK : 'OK',
            CANCEL : 'Cancel',
            CLOSE : 'Close',
            ERROR : 'Error',
            SAVE : 'Save',
            CANNOT_PARSE_RESPONSE_JSON : 'Malformed response from server.',
            CANNOT_DOWNLOAD_ENTITY_DATA : 'Unable to retrieve array of enterprise entities from the server.',
            CANNOT_PARSE_ENTITY_DATA : 'Unable to parse array of enterprise entities retrieved from the server.',
            ENTITY_DATA_ERROR : 'Data error.',
            SAVING_MONITORING_SETUP : 'Saving monitoring setup',
            CANNOT_SAVE_MONITORING_SETUP : 'Unable to save monitoring setup.',
            CANNOT_DOWNLOAD_MONITORING_SETUP : 'Unable to retrieve monitoring setup from the server.',
            SAVING_NOTIFICATION_RULE : 'Saving notification rule',
            NOTIFICATION_RULE_SAVED_TITLE : 'Save Notification Rule',
            NOTIFICATION_RULE_SAVED : 'Notification rule saved.',
            CANNOT_SAVE_NOTIFICATION_RULE : 'Unable to save notification rule.',
            CANNOT_DELETE_NOTIFICATION_RULE : 'Unable to delete notification rule.',
            CANNOT_DOWNLOAD_MONITORING_PROPERTY_SETTING : 'Unable to retrieve monitoring property settings from the server.',
            CANNOT_SAVE_MONITORING_SETTINGS : 'Unable to save monitoring property settings.',
            WARN_REQUIRE_INTEGER : 'Must be an integer',
            WARN_LOWER_LIMIT : 'Must be greater than or equal to {0}',
            WARN_UPPER_LIMIT : 'Must be less than or equal to {0}'
        };
    </script>
    <script type="text/javascript">
        /**
         * Default interval in milliseconds to refresh monitoring property values.
         * Applies when previous refresh failed.
         * @final
         */
        var DEFAULT_MONITORING_PROPERTIES_REFRESH_INTERVAL = 10000;

        var ALL_PROPERTY_TYPES = l7.Util.getPropertyValues(l7.Constants.SSG_CLUSTER_MONITORING_PROPERTY, l7.Constants.SSG_NODE_MONITORING_PROPERTY);

        var ntpServersTextArea;
        var ntpServersWarningIcon;

        var samplingIntervalTextBoxes = {};         // map key is property type
        var samplingIntervalWarningIcons = {};      // map key is property type
        var defaultTriggerValueTextBoxes = {};      // map key is property type
        var defaultTriggerValueWarningIcons = {};   // map key is property type

        var saveMonitoringSetupButton;
        var revertMonitoringSetupButton;
        var addNotificationRuleButton;
        var editNotificationRuleButton;
        var deleteNotificationRuleButton;

        var disableAllNotificationCheckBox;
        var auditUponAlertStateCheckBox;
        var auditUponNormalStateCheckBox;
        var auditUponNotificationCheckBox;

        var notificationRulesDataSource;
        var notificationRulesDataTable;

        var addOrEditNotificationRuleDialog;
        var notifDlg_titleLabel;
        var notifDlg_id;
        var notifDlg_nameTextBox;
        var notifDlg_typeDropDown;
        var notifDlg_configs = {};              // map key is notification type
        var notifDlg_eMail_protocolDropDown;
        var notifDlg_eMail_hostTextBox;
        var notifDlg_eMail_portTextBox;
        var notifDlg_eMail_portWarningIcon;
        var notifDlg_eMail_requiresAuthenticationCheckBox;
        var notifDlg_eMail_userNameTextBox;
        var notifDlg_eMail_passwordTextBox;
        var notifDlg_eMail_toTextBox;
        var notifDlg_eMail_ccTextBox;
        var notifDlg_eMail_bccTextBox;
        var notifDlg_eMail_subjectTextBox;
        var notifDlg_eMail_bodyTextArea;
        var notifDlg_eMail_insertButton;
        var notifDlg_eMail_insertDropDown;
        var notifDlg_httpRequest_standardContentTypeRadioButton;
        var notifDlg_httpRequest_standardContentTypeDropDown;
        var notifDlg_httpRequest_customContentTypeRadioButton;
        var notifDlg_httpRequest_customContentTypeTextBox;
        var notifDlg_httpRequest_insertButton;
        var notifDlg_httpRequest_insertDropDown;
        var notifDlg_httpRequest_bodyTextArea;
        var notifDlg_snmpTrap_hostTextBox;
        var notifDlg_snmpTrap_defaultPortRadioButton;
        var notifDlg_snmpTrap_customPortRadioButton;
        var notifDlg_snmpTrap_customPortTextBox;
        var notifDlg_snmpTrap_customPortWarningIcon;
        var notifDlg_snmpTrap_communityTextBox;
        var notifDlg_snmpTrap_insertButton;
        var notifDlg_snmpTrap_insertDropDown;
        var notifDlg_snmpTrap_textDataTextArea;
        var notifDlg_snmpTrap_oidSuffixTextBox;
        var notifDlg_snmpTrap_oidSuffixWarningIcon;
        var notifDlg_httpRequest_urlTextBox;
        var notifDlg_httpRequest_methodDropDown;

        var saveNotificationRuleOverwriteDialog;
        var deleteNotificationRuleDialog;

        var monDlg;
        var monDlg_entityId;
        var monDlg_propertyType;
        var monDlg_entityTypeLabel;
        var monDlg_entityPathLabel;
        var monDlg_propertyLabel;
        var monDlg_enabledCheckBox;
        var monDlg_samplingIntervalLabel;
        var monDlg_triggerEnabledCheckBox;
        var monDlg_triggerConfigs = {};         // map key is property type
        var monDlg_triggerValueTextBoxes = {};  // map key is property type
        var monDlg_triggerValueWarningIcon;
        var monDlg_useDefaultTriggerValueButton;
        var monDlg_notificationEnabledCheckBox;
        var monDlg_notificationDisabledWarning;
        var monDlg_notificationRulesListBox;

        /**
         * @type object
         */
        var currentSetup;

        /**
         * List of notification rules defined.
         * @type array
         */
        var availableNotificationRules = [];

        /**
         * The enterpries tree table object.
         * @type l7.EntityTreeTable
         */
        var entityTreeTable;

        function showHideLogReader() {
            var debugLogReader = document.getElementById('debugLogReader');
            if (debugLogReader.style.display == '') {
                debugLogReader.style.display = 'none';
            } else {
                debugLogReader.style.display = '';
            }
        }

        /**
         * @param {string} type     an l7.Constants.SSG_CLUSTER_MONITORING_PROPERTY value
         * @return {string} localized string
         */
        function getMonitoringPropertyTypeLocalizedStrings(type) {
            if (type == l7.Constants.SSG_CLUSTER_MONITORING_PROPERTY.AUDIT_SIZE) {
                return localizedStrings.AUDIT_SIZE;
            } else if (type == l7.Constants.SSG_NODE_MONITORING_PROPERTY.OPERATING_STATUS) {
                return localizedStrings.OPERATING_STATUS;
            } else if (type == l7.Constants.SSG_NODE_MONITORING_PROPERTY.LOG_SIZE) {
                return localizedStrings.LOG_SIZE;
            } else if (type == l7.Constants.SSG_NODE_MONITORING_PROPERTY.DISK_USAGE) {
                return localizedStrings.DISK_USAGE;
            } else if (type == l7.Constants.SSG_NODE_MONITORING_PROPERTY.RAID_STATUS) {
                return localizedStrings.RAID_STATUS;
            } else if (type == l7.Constants.SSG_NODE_MONITORING_PROPERTY.CPU_TEMP) {
                return localizedStrings.CPU_TEMP;
            } else if (type == l7.Constants.SSG_NODE_MONITORING_PROPERTY.CPU_USAGE) {
                return localizedStrings.CPU_USAGE;
            } else if (type == l7.Constants.SSG_NODE_MONITORING_PROPERTY.SWAP_USAGE) {
                return localizedStrings.SWAP_USAGE;
            } else if (type == l7.Constants.SSG_NODE_MONITORING_PROPERTY.CLOCK_DRIFT) {
                return localizedStrings.CLOCK_DRIFT;
            }
            return null;
        }

        /**
         * @param {string} type     an l7.Constants.NOTIFICATION_TYPE value
         * @return {string} localized string
         */
        function getNotificationTypeLocalizedStrings(type) {
            if (type == l7.Constants.NOTIFICATION_TYPE.E_MAIL) {
                return localizedStrings.E_MAIL;
            } else if (type == l7.Constants.NOTIFICATION_TYPE.SNMP_TRAP) {
                return localizedStrings.SNMP_TRAP;
            } else if (type == l7.Constants.NOTIFICATION_TYPE.HTTP_REQUEST) {
                return localizedStrings.HTTP_REQUEST;
            }
            return null;
        }

        /**
         * Parses the lines in the NTP Servers input text area into an array of host names.
         * @return {array} may be empty but never null
         */
        function parseNtpServersTextArea() {
            var result = [];
            var lines = ntpServersTextArea.value.replace('\r\n', '\n').replace('\r', '\n').split('\n');
            for (var j = 0; j < lines.length; ++j) {
                var hostName = lines[j].replace(/^\s+/, '').replace(/\s+$/, '');
                if (hostName.length > 0) {
                    result.push(hostName);
                }
            }
            return result;
        }

        /**
         * Shows the collapsed headers instead of the stepped headers.
         */
        function collapseSteppedHeaders() {
            document.getElementById('collapsedHeaders').style.display = '';
            document.getElementById('steppedHeaders').style.display = 'none';
        }

        /**
         * Shows the stepped headers instead of the collapsed headers.
         */
        function expandSteppedHeaders() {
            document.getElementById('collapsedHeaders').style.display = 'none';
            document.getElementById('steppedHeaders').style.display = '';
        }

        function resetCollapsedHeaderWidths() {
            // We want the collapsed header content to be cropped. But just having
            // "overflow: hidden" is insufficient some how. We need to explicitly
            // set the width equal to the natural width of the TD contents.
            var BORDER_LEFT = 1;    // .dataTable th border-left
            var BORDER_RIGHT = 1;   // .dataTable th border-right
            var PADDING_LEFT = 7;   // .dataTable th padding-left
            var PADDING_RIGHT = 7;  // .dataTable th padding-right
            var MIN_WIDTH = 20;
            var thDivs = l7.Util.getElementsByClassName('collapsedHeader', null, 'div');
            for (var i = 0; i < thDivs.length; ++i) {
                var thDiv = thDivs[i];
                var th = thDiv.parentNode;
                thDiv.style.display = 'none';
                var contentWidth = th.offsetWidth - BORDER_LEFT - BORDER_RIGHT - PADDING_LEFT - PADDING_RIGHT;
                if (contentWidth < MIN_WIDTH) contentWidth = MIN_WIDTH;
                thDiv.style.width = contentWidth + 'px';
                thDiv.style.display = '';
                thDiv.title = thDiv.innerHTML;
            }
        }

        /**
         * @return {boolean}
         */
        function validateSetup() {
            var valid = true;

            for (var i = 0; i < ALL_PROPERTY_TYPES.length; ++i) {
                var propertyType = ALL_PROPERTY_TYPES[i];

                var warningIcon = samplingIntervalWarningIcons[propertyType];
                if (l7.Util.isIntString(samplingIntervalTextBoxes[propertyType].value)) {
                    var samplingInterval = parseInt(samplingIntervalTextBoxes[propertyType].value, 10);
                    if (samplingInterval < currentSetup.samplingIntervalLowerLimit) {
                        warningIcon.style.visibility = 'visible';
                        warningIcon.title = l7.Util.formatMessage(localizedStrings.WARN_LOWER_LIMIT, currentSetup.samplingIntervalLowerLimit);
                        valid = false;
                    } else {
                        warningIcon.style.visibility = 'hidden';
                        warningIcon.title = '';
                    }
                } else {
                    warningIcon.style.visibility = 'visible';
                    warningIcon.title = localizedStrings.WARN_REQUIRE_INTEGER;
                    valid = false;
                }

                var propertySetup = currentSetup.propertySetup[propertyType];
                warningIcon = defaultTriggerValueWarningIcons[propertyType];
                if (warningIcon != undefined) {
                    if (l7.Util.isIntString(defaultTriggerValueTextBoxes[propertyType].value)) {
                        var defaultTriggerValue = parseInt(defaultTriggerValueTextBoxes[propertyType].value, 10);
                        if (propertySetup.triggerValueLowerLimit != undefined &&
                            defaultTriggerValue < propertySetup.triggerValueLowerLimit) {
                            warningIcon.style.visibility = 'visible';
                            warningIcon.title = l7.Util.formatMessage(localizedStrings.WARN_LOWER_LIMIT, propertySetup.triggerValueLowerLimit);
                            valid = false;
                        } else if (propertySetup.triggerValueUpperLimit != undefined &&
                            defaultTriggerValue > propertySetup.triggerValueUpperLimit) {
                            warningIcon.style.visibility = 'visible';
                            warningIcon.title = l7.Util.formatMessage(localizedStrings.WARN_UPPER_LIMIT, propertySetup.triggerValueUpperLimit);
                            valid = false;
                        } else {
                            warningIcon.style.visibility = 'hidden';
                            warningIcon.title = '';
                        }
                    } else {
                        warningIcon.style.visibility = 'visible';
                        warningIcon.title = localizedStrings.WARN_REQUIRE_INTEGER;
                        valid = false;
                    }
                }
            }

            var ntpServers = parseNtpServersTextArea();
            if (ntpServers.length < 1) {
                ntpServersWarningIcon.style.visibility = 'visible';
                ntpServersWarningIcon.title = 'Must have at least one host name';
                valid = false;
            } else {
                ntpServersWarningIcon.style.visibility = 'hidden';
                ntpServersWarningIcon.title = '';
            }

            saveMonitoringSetupButton.set('disabled', !valid);
            return valid;
        }

        /**
         * @return {boolean}
         */
        function validateNotificationRuleDialog() {
            var valid = true;

            if (l7.Util.isBlankOnly(notifDlg_nameTextBox.value)) valid = false;

            var selectedType = notifDlg_typeDropDown.value;

            // Display the configuration for this notification type.
            for (var type in notifDlg_configs) {
                notifDlg_configs[type].style.display = type == selectedType ? '' : 'none';
            }

            if (selectedType == l7.Constants.NOTIFICATION_TYPE.E_MAIL) {
                if (l7.Util.isBlankOnly(notifDlg_eMail_hostTextBox.value)) valid = false;
                if (l7.Util.isBlankOnly(notifDlg_eMail_portTextBox.value)) {
                    notifDlg_eMail_portWarningIcon.style.display = 'none';
                    notifDlg_eMail_portWarningIcon.title = '';
                    valid = false;
                } else if (!l7.Util.isIntString(notifDlg_eMail_portTextBox.value)) {
                    notifDlg_eMail_portWarningIcon.style.display = '';
                    notifDlg_eMail_portWarningIcon.title = localizedStrings.WARN_REQUIRE_INTEGER;
                    valid = false;
                } else if (parseInt(notifDlg_eMail_portTextBox.value) < 1) {
                    notifDlg_eMail_portWarningIcon.style.display = '';
                    notifDlg_eMail_portWarningIcon.title = l7.Util.formatMessage(localizedStrings.WARN_LOWER_LIMIT, 1);
                    valid = false;
                } else {
                    notifDlg_eMail_portWarningIcon.style.display = 'none';
                    notifDlg_eMail_portWarningIcon.title = '';
                }
                if (notifDlg_eMail_requiresAuthenticationCheckBox.checked) {
                    notifDlg_eMail_userNameTextBox.disabled = false;
                    notifDlg_eMail_passwordTextBox.disabled = false;
                    if (l7.Util.isBlankOnly(notifDlg_eMail_userNameTextBox.value)) valid = false;
                } else {
                    notifDlg_eMail_userNameTextBox.disabled = true;
                    notifDlg_eMail_passwordTextBox.disabled = true;
                }
                if (l7.Util.isBlankOnly(notifDlg_eMail_toTextBox.value) &&
                    l7.Util.isBlankOnly(notifDlg_eMail_ccTextBox.value) &&
                    l7.Util.isBlankOnly(notifDlg_eMail_bccTextBox.value)) {
                    valid = false;
                }
            } else if (selectedType == l7.Constants.NOTIFICATION_TYPE.SNMP_TRAP) {
                if (l7.Util.isBlankOnly(notifDlg_snmpTrap_hostTextBox.value)) valid = false;
                notifDlg_snmpTrap_customPortTextBox.disabled = !notifDlg_snmpTrap_customPortRadioButton.checked;
                if (notifDlg_snmpTrap_customPortRadioButton.checked) {
                    if (l7.Util.isBlankOnly(notifDlg_snmpTrap_customPortTextBox.value)) {
                        notifDlg_snmpTrap_customPortWarningIcon.style.display = 'none';
                        notifDlg_snmpTrap_customPortWarningIcon.title = '';
                        valid = false;
                    } else if (!l7.Util.isIntString(notifDlg_snmpTrap_customPortTextBox.value)) {
                        notifDlg_snmpTrap_customPortWarningIcon.style.display = '';
                        notifDlg_snmpTrap_customPortWarningIcon.title = localizedStrings.WARN_REQUIRE_INTEGER;
                        valid = false;
                    } else if (parseInt(notifDlg_snmpTrap_customPortTextBox.value) < 1) {
                        notifDlg_snmpTrap_customPortWarningIcon.style.display = '';
                        notifDlg_snmpTrap_customPortWarningIcon.title = l7.Util.formatMessage(localizedStrings.WARN_LOWER_LIMIT, 1);
                        valid = false;
                    } else {
                        notifDlg_snmpTrap_customPortWarningIcon.style.display = 'none';
                        notifDlg_snmpTrap_customPortWarningIcon.title = '';
                    }
                } else {
                    notifDlg_snmpTrap_customPortWarningIcon.style.display = 'none';
                    notifDlg_snmpTrap_customPortWarningIcon.title = '';
                }
                if (l7.Util.isBlankOnly(notifDlg_snmpTrap_oidSuffixTextBox.value)) {
                    notifDlg_snmpTrap_oidSuffixWarningIcon.style.display = 'none';
                    notifDlg_snmpTrap_oidSuffixWarningIcon.title = '';
                    valid = false;
                } else if (!l7.Util.isIntString(notifDlg_snmpTrap_oidSuffixTextBox.value)) {
                    notifDlg_snmpTrap_oidSuffixWarningIcon.style.display = '';
                    notifDlg_snmpTrap_oidSuffixWarningIcon.title = localizedStrings.WARN_REQUIRE_INTEGER;
                    valid = false;
                } else if (parseInt(notifDlg_snmpTrap_oidSuffixTextBox.value) < 1) {
                    notifDlg_snmpTrap_oidSuffixWarningIcon.style.display = '';
                    notifDlg_snmpTrap_oidSuffixWarningIcon.title = l7.Util.formatMessage(localizedStrings.WARN_LOWER_LIMIT, 1);
                    valid = false;
                } else {
                    notifDlg_snmpTrap_oidSuffixWarningIcon.style.display = 'none';
                    notifDlg_snmpTrap_oidSuffixWarningIcon.title = '';
                }
            } else if (selectedType == l7.Constants.NOTIFICATION_TYPE.HTTP_REQUEST) {
                if (l7.Util.isBlankOnly(notifDlg_httpRequest_urlTextBox.value)) valid = false;
                var isPost = notifDlg_httpRequest_methodDropDown.value == 'POST';
                notifDlg_httpRequest_standardContentTypeRadioButton.disabled = !isPost;
                notifDlg_httpRequest_standardContentTypeDropDown.disabled = !isPost;
                notifDlg_httpRequest_customContentTypeRadioButton.disabled = !isPost;
                notifDlg_httpRequest_customContentTypeTextBox.disabled = !isPost;
                notifDlg_httpRequest_insertButton.set('disabled', !isPost);
                notifDlg_httpRequest_insertDropDown.disabled = !isPost;
                notifDlg_httpRequest_bodyTextArea.disabled = !isPost;
                if (notifDlg_httpRequest_methodDropDown.value == 'POST') {
                    notifDlg_httpRequest_standardContentTypeDropDown.disabled = !notifDlg_httpRequest_standardContentTypeRadioButton.checked;
                    notifDlg_httpRequest_customContentTypeTextBox.disabled = !notifDlg_httpRequest_customContentTypeRadioButton.checked;
                    if (!notifDlg_httpRequest_customContentTypeTextBox.disabled &&
                        l7.Util.isBlankOnly(notifDlg_httpRequest_customContentTypeTextBox.value)) valid = false;
                }
            } else {
                YAHOO.log('Unknown notification type.', 'error', 'Monitor.html validateNotificationRuleDialog()')
            }

            var saveButton = addOrEditNotificationRuleDialog.getButtons()[0];
            saveButton.set('disabled', !valid);
            return valid;
        }

        /**
         * @return {boolean}
         */
        function validateMonitoringPropertyDialog() {
            var valid = true;

            monDlg_triggerEnabledCheckBox.disabled = !monDlg_enabledCheckBox.checked;
            var triggerValueTextBox = monDlg_triggerValueTextBoxes[monDlg_propertyType.value];
            if (triggerValueTextBox) {
                var triggerEnabled = !monDlg_triggerEnabledCheckBox.disabled &&
                                     monDlg_triggerEnabledCheckBox.checked;
                triggerValueTextBox.disabled = !triggerEnabled;
                monDlg_useDefaultTriggerValueButton.setStyle('display', '');
                monDlg_useDefaultTriggerValueButton.set('disabled', !triggerEnabled);
                if (triggerEnabled) {
                    if (l7.Util.isIntString(triggerValueTextBox.value)) {
                        var triggerValue = parseInt(triggerValueTextBox.value, 10);
                        var propertySetup = currentSetup.propertySetup[monDlg_propertyType.value];
                        if (propertySetup.triggerValueLowerLimit != undefined &&
                            triggerValue < propertySetup.triggerValueLowerLimit) {
                            monDlg_triggerValueWarningIcon.style.visibility = 'visible';
                            monDlg_triggerValueWarningIcon.title = l7.Util.formatMessage(localizedStrings.WARN_LOWER_LIMIT, propertySetup.triggerValueLowerLimit);
                            valid = false;
                        } else if (propertySetup.triggerValueUpperLimit != undefined &&
                            triggerValue > propertySetup.triggerValueUpperLimit) {
                            monDlg_triggerValueWarningIcon.style.visibility = 'visible';
                            monDlg_triggerValueWarningIcon.title = l7.Util.formatMessage(localizedStrings.WARN_UPPER_LIMIT, propertySetup.triggerValueUpperLimit);
                            valid = false;
                        } else {
                            monDlg_triggerValueWarningIcon.style.visibility = 'hidden';
                            monDlg_triggerValueWarningIcon.title = '';
                        }
                    } else {
                        monDlg_triggerValueWarningIcon.style.visibility = 'visible';
                        monDlg_triggerValueWarningIcon.title = localizedStrings.WARN_REQUIRE_INTEGER;
                        valid = false;
                    }
                } else {
                    monDlg_triggerValueWarningIcon.style.visibility = 'hidden';
                    monDlg_triggerValueWarningIcon.title = '';
                }
            } else {
                // This property does not have a configurable trigger value,
                // so no button to use default value.
                monDlg_useDefaultTriggerValueButton.setStyle('display', 'none');

                monDlg_triggerValueWarningIcon.style.visibility = 'hidden';
                monDlg_triggerValueWarningIcon.title = '';
            }
            monDlg_notificationEnabledCheckBox.disabled = monDlg_triggerEnabledCheckBox.disabled ||
                                                          !monDlg_triggerEnabledCheckBox.checked;

            var saveButton = monDlg.getButtons()[0];
            saveButton.set('disabled', !valid);
            return true;
        }

        function updateNotificationRuleButtons() {
            var selectedRows = notificationRulesDataTable.getSelectedTrEls();
            var hasSelectedRows = (selectedRows != null) && (selectedRows.length != 0);
            editNotificationRuleButton.set('disabled', !hasSelectedRows);
            deleteNotificationRuleButton.set('disabled', !hasSelectedRows);
        }

        /**
         * Saves (may be add or edit) a notification rule.
         *
         * When adding a new notification rule, use the parameter "overwrite".
         *
         * If "overwrite" is false, the request is sent to a server address which should
         * respond, if duplicate rule name exists, with a JSON object whose property
         * "reconfirm" set to true; otherwise responds with a JSON "null".
         *
         * If "overwrite" is true, the request is sent to another server address which
         * should overwrite any duplicate rule name and responds with a JSON "null".
         *
         * Note: This uses a synchronous call.
         *
         * @param {boolean} overwrite   applies if adding new notification rule: true to overwrite existing settings with same name without confirmation dialog
         */
        function saveNotificationRule(overwrite) {
            var settings = {};
            if (notifDlg_id.value != '') {
                settings.id = notifDlg_id.value;    // Existence indicates editing an existing notification rule.
            }
            settings.name = notifDlg_nameTextBox.value;
            settings.type = notifDlg_typeDropDown.value;
            settings.params = {};
            if (settings.type == l7.Constants.NOTIFICATION_TYPE.E_MAIL) {
                settings.params.protocol = notifDlg_eMail_protocolDropDown.value;
                settings.params.host = notifDlg_eMail_hostTextBox.value;
                settings.params.port = notifDlg_eMail_portTextBox.value;
                settings.params.requiresAuthentication = notifDlg_eMail_requiresAuthenticationCheckBox.checked;
                if (settings.params.requiresAuthentication) {
                    settings.params.userName = notifDlg_eMail_userNameTextBox.value;
                    settings.params.password = notifDlg_eMail_passwordTextBox.value;
                }
                settings.params.to = notifDlg_eMail_toTextBox.value;
                settings.params.cc = notifDlg_eMail_ccTextBox.value;
                settings.params.bcc = notifDlg_eMail_bccTextBox.value;
                settings.params.subject = notifDlg_eMail_subjectTextBox.value;
                settings.params.body = notifDlg_eMail_bodyTextArea.value;
            } else if (settings.type == l7.Constants.NOTIFICATION_TYPE.SNMP_TRAP) {
                settings.params.host = notifDlg_snmpTrap_hostTextBox.value;
                settings.params.defaultPort = notifDlg_snmpTrap_defaultPortRadioButton.checked;
                if (!settings.params.defaultPort) {
                    settings.params.port = notifDlg_snmpTrap_customPortTextBox.value;
                }
                settings.params.community = notifDlg_snmpTrap_communityTextBox.value;
                settings.params.textData = notifDlg_snmpTrap_textDataTextArea.value;
                settings.params.oidSuffix = notifDlg_snmpTrap_oidSuffixTextBox.value;
            } else if (settings.type == l7.Constants.NOTIFICATION_TYPE.HTTP_REQUEST) {
                settings.params.url = notifDlg_httpRequest_urlTextBox.value;
                settings.params.httpMethod = notifDlg_httpRequest_methodDropDown.value;
                if (settings.params.httpMethod == 'POST') {
                    settings.params.standardContentType = notifDlg_httpRequest_standardContentTypeRadioButton.checked;
                    if (settings.params.standardContentType) {
                        settings.params.contentType = notifDlg_httpRequest_standardContentTypeDropDown.value;
                    } else {
                        settings.params.contentType = notifDlg_httpRequest_customContentTypeTextBox.value;
                    }
                    settings.params.body = notifDlg_httpRequest_bodyTextArea.value;
                }
            }

            var postData = YAHOO.lang.JSON.stringify(settings);
            // TODO Set saveNotificationRuleUrl and saveNotificationRuleOverwrite using Wicket.
            var url = overwrite ? saveNotificationRuleOverwriteUrl : saveNotificationRuleUrl;
            var xhr = l7.Connection.syncRequest('POST', url, postData, true);
            if (xhr.status == 200) {
                var result = l7.Dialog.parseJSON(
                        xhr.responseText,
                        localizedStrings.ERROR,
                        '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_SAVE_NOTIFICATION_RULE) + '</p>',
                        localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                        localizedStrings.OK);
                if (!l7.Util.isException(result)) {
                    if (result == null) {
                        l7.Dialog.showInfoDialog(localizedStrings.NOTIFICATION_RULE_SAVED_TITLE, localizedStrings.NOTIFICATION_RULE_SAVED, localizedStrings.OK);
                        loadNotificationRules();
                    } else if (result.reconfirm != undefined && result.reconfirm == true) {
                        document.getElementById('saveNotificationRuleOverwriteDialog_name').innerHTML = l7.Util.escapeAsText(settings.name);
                        saveNotificationRuleOverwriteDialog.show();
                    }
                }
            } else {
                l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_SAVE_NOTIFICATION_RULE + '<br/><br/>' + xhr.status + ' ' + xhr.statusText, localizedStrings.OK);
            }
        }

        /**
         * Save the settings for a single property of a single entity.
         * Note: This uses an asynchronous call.
         */
        function saveMonitoringPropertySettings() {
            var callback = {
                success : function(o) {
                    var result = l7.Dialog.parseJSON(
                            o.responseText,
                            localizedStrings.ERROR,
                            '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_SAVE_MONITORING_SETTINGS) + '</p>',
                            localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                            localizedStrings.OK);
                    if (!l7.Util.isException(result)) {
                        // No return object expected.
                    }
                },
                failure : function(o) {
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_SAVE_MONITORING_SETTINGS + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
                }
            };

            // Gathers data from input fields in the dialog.
            var settings = {};
            settings.entity = {};
            settings.entity.id = monDlg_entityId.value;
            settings.propertyType = monDlg_propertyType.value;
            settings.monitoringEnabled = monDlg_enabledCheckBox.checked;
            if (settings.monitoringEnabled) {
                settings.triggerEnabled = monDlg_triggerEnabledCheckBox.checked;
                if (settings.triggerEnabled) {
                    settings.triggerValue = parseFloat(monDlg_triggerValueTextBoxes[settings.propertyType].value);
                    settings.notificationEnabled = monDlg_notificationEnabledCheckBox.checked;
                }
            }
            settings.notificationRules = [];
            for (var i in monDlg_notificationRulesListBox.options) {
                if (monDlg_notificationRulesListBox.options[i].selected) {
                    var o = {};
                    o.id = monDlg_notificationRulesListBox.options[i].value
                    settings.notificationRules.push(o);
                }
            }

            var postData = YAHOO.lang.JSON.stringify(settings);
            // TODO Set saveMonitoringPropertySettingsUrl using Wicket.
            YAHOO.util.Connect.setDefaultPostHeader(false);
            YAHOO.util.Connect.initHeader('Content-Type', 'application/json; charset=utf-8');
            YAHOO.util.Connect.asyncRequest('POST', saveMonitoringPropertySettingsUrl, callback, postData);
            YAHOO.util.Connect.setDefaultPostHeader(true);  // Revert to default for next caller.
        }

        /**
         * Saves the system-wide setup.
         * Note: This uses an asynchronous call.
         */
        function onClickSaveMonitoringSetupButton(event, args) {
            // Get data from fields.
            var data = {};
            data.propertySetup = {};
            for (var i = 0; i < ALL_PROPERTY_TYPES.length; ++i) {
                var propertyType = ALL_PROPERTY_TYPES[i];
                data.propertySetup[propertyType] = {};
                data.propertySetup[propertyType].samplingInterval = samplingIntervalTextBoxes[propertyType].value;
                if (defaultTriggerValueTextBoxes[propertyType]) {
                    data.propertySetup[propertyType].defaultTriggerValue = defaultTriggerValueTextBoxes[propertyType].value;
                }
                if (propertyType == l7.Constants.SSG_NODE_MONITORING_PROPERTY.CLOCK_DRIFT) {
                    data.propertySetup[propertyType].ntpServers = parseNtpServersTextArea();
                }
            }
            data.disableAllNotifications = disableAllNotificationCheckBox.checked;
            data.auditUponAlertState = auditUponAlertStateCheckBox.checked;
            data.auditUponNormalState = auditUponNormalStateCheckBox.checked;
            data.auditUponNotification = auditUponNotificationCheckBox.checked;

            var callback = {
                success : function(o) {
                    l7.Dialog.hideWaitDialog();
                    var result = l7.Dialog.parseJSON(
                            o.responseText,
                            localizedStrings.ERROR,
                            '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_SAVE_MONITORING_SETUP) + '</p>',
                            localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                            localizedStrings.OK);
                    if (!l7.Util.isException(result)) {
                        // No return object expected.
                        l7.Dialog.showInfoDialog('Save Monitoring Setup', 'Monitoring setup is saved.', localizedStrings.OK);
                        loadMonitoringSetup();
                    }
                },
                failure : function(o) {
                    l7.Dialog.hideWaitDialog();
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_SAVE_MONITORING_SETUP + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
                }
            };
            var postData = YAHOO.lang.JSON.stringify(data);
            // TODO Set saveMonitoringSetupUrl using Wicket.
            l7.Dialog.showWaitDialog(localizedStrings.SAVING_MONITORING_SETUP + '...');
            YAHOO.util.Connect.setDefaultPostHeader(false);
            YAHOO.util.Connect.initHeader('Content-Type', 'application/json; charset=utf-8');
            YAHOO.util.Connect.asyncRequest('POST', saveMonitoringSetupUrl, callback, postData);
            YAHOO.util.Connect.setDefaultPostHeader(true);
        }

        function onChangeNotifDlg_eMail_protocol() {
            if (notifDlg_eMail_protocolDropDown.value == l7.Constants.NOTIFICATION_EMAIL_PROTOCOL.PLAIN_SMTP) {
                notifDlg_eMail_portTextBox.value = '25';
            } else if (notifDlg_eMail_protocolDropDown.value == l7.Constants.NOTIFICATION_EMAIL_PROTOCOL.SMTP_over_SSL) {
                notifDlg_eMail_portTextBox.value = '465';
            } else if (notifDlg_eMail_protocolDropDown.value == l7.Constants.NOTIFICATION_EMAIL_PROTOCOL.SMTP_WITH_STARTTLS) {
                notifDlg_eMail_portTextBox.value = '25';
            }
            validateNotificationRuleDialog();
        }

        /**
         * Onclick event handler for either the add or edit notification rule button.
         * @param {MouseEvent} event    the click event
         * @param {object} args         passed object whose property "isAdd" is true if adding; otherwise false
         */
        function onClickAddOrEditNotificationRuleButton(event, args) {
            var isAdd = args.isAdd;
            notifDlg_titleLabel.innerHTML = isAdd ? localizedStrings.ADD_NOTIFICATION_RULE : localizedStrings.EDIT_NOTIFICATION_RULE;

            // First, clears all input fields.
            var textBoxes = l7.Util.getElementsById('notifDlg_.+TextBox', 'addOrEditNotificationRuleDialog', 'input');
            for (var i = 0; i < textBoxes.length; ++i) {
                textBoxes[i].value = '';
            }
            var textAreas = l7.Util.getElementsById('notifDlg_.+TextArea', 'addOrEditNotificationRuleDialog', 'textarea');
            for (i = 0; i < textAreas.length; ++i) {
                textAreas[i].value = '';
            }
            var checkBoxes = l7.Util.getElementsById('notifDlg_.+CheckBox', 'addOrEditNotificationRuleDialog', 'input');
            for (i = 0; i < checkBoxes.length; ++i) {
                checkBoxes[i].checked = false;
            }
            var dropDowns = l7.Util.getElementsById('notifDlg_.+DropDown', 'addOrEditNotificationRuleDialog', 'select');
            for (i = 0; i < dropDowns.length; ++i) {
                dropDowns[i].selectedIndex = 0;
            }

            if (isAdd) {
                notifDlg_id.value = '';
                // Populate some fields with default values.
                onChangeNotifDlg_eMail_protocol();  // For side effect of populating the e-mail server default port number.
                notifDlg_eMail_subjectTextBox.value = 'ESM monitoring notification';
                notifDlg_eMail_bodyTextArea.value = '${monitoring.context.entityType} : ${monitoring.context.entityPathName}\n'
                                                  + 'Property : ${monitoring.context.propertyType}\n'
                                                  + 'Property State : ${monitoring.context.propertyState}\n'
                                                  + 'Property Value : ${monitoring.context.propertyValue}\n'
                                                  + 'Trigger Value : ${monitoring.context.triggerValue}';
            } else { // Editing an existing notification rule.
                var tr = notificationRulesDataTable.getSelectedTrEls()[0];
                var record = notificationRulesDataTable.getRecord(tr);
                notifDlg_id.value = record.getData('id');
                notifDlg_nameTextBox.value = l7.Util.escapeAsText(record.getData('name'));
                var notificationType = record.getData('type');
                l7.Widget.selectDropDownByValue(notifDlg_typeDropDown, notificationType);

                // Populates fields with parameters of existing notification rule.
                var params = record.getData('params');
                if (notificationType == l7.Constants.NOTIFICATION_TYPE.E_MAIL) {
                    l7.Widget.selectDropDownByValue(notifDlg_eMail_protocolDropDown, params.protocol);
                    notifDlg_eMail_hostTextBox.value = params.host;
                    notifDlg_eMail_portTextBox.value = params.port;
                    notifDlg_eMail_requiresAuthenticationCheckBox.checked = params.requiresAuthentication;
                    notifDlg_eMail_userNameTextBox.value = params.userName;
                    notifDlg_eMail_passwordTextBox.value = params.password;
                    notifDlg_eMail_toTextBox.value = params.to;
                    notifDlg_eMail_ccTextBox.value = params.cc;
                    notifDlg_eMail_bccTextBox.value = params.bcc;
                    notifDlg_eMail_bodyTextArea.value = params.body;
                } else if (notificationType == l7.Constants.NOTIFICATION_TYPE.SNMP_TRAP) {
                    notifDlg_snmpTrap_hostTextBox.value = params.host;
                    if (params.defaultPort) {
                        notifDlg_snmpTrap_defaultPortRadioButton.checked = true;
                    } else {
                        notifDlg_snmpTrap_customPortRadioButton.checked = true;
                        notifDlg_snmpTrap_customPortTextBox.value = params.port;
                    }
                    notifDlg_snmpTrap_communityTextBox.value = params.community;
                    notifDlg_snmpTrap_textDataTextArea.value = params.textData;
                    notifDlg_snmpTrap_oidSuffixTextBox.value = params.oidSuffix;
                } else if (notificationType == l7.Constants.NOTIFICATION_TYPE.HTTP_REQUEST) {
                    notifDlg_httpRequest_urlTextBox.value = params.url;
                    l7.Widget.selectDropDownByValue(notifDlg_httpRequest_methodDropDown, params.httpMethod);
                    if (params.httpMethod == 'POST') {
                        if (params.standardContentType) {
                            notifDlg_httpRequest_standardContentTypeRadioButton.checked = true;
                            l7.Widget.selectDropDownByValue(notifDlg_httpRequest_standardContentTypeDropDown, params.contentType);
                        } else {
                            notifDlg_httpRequest_customContentTypeRadioButton.checked = true;
                            notifDlg_httpRequest_customContentTypeTextBox.value = params.contentType;
                        }
                        notifDlg_httpRequest_bodyTextArea.value = params.body;
                    }
                }
            }
            validateNotificationRuleDialog();
            addOrEditNotificationRuleDialog.center();
            addOrEditNotificationRuleDialog.show();
        }

        function onClickDeleteNotificationRuleButton() {
            var tr = notificationRulesDataTable.getSelectedTrEls()[0];
            var record = notificationRulesDataTable.getRecord(tr);
            document.getElementById('deleteNotificationRuleDialog_id').value = record.getData('id');
            document.getElementById('deleteNotificationRuleDialog_name').innerHTML = l7.Util.escapeAsText(record.getData('name'));
            deleteNotificationRuleDialog.center();
            deleteNotificationRuleDialog.show();
        }

        function onClick_notifDlg_insertContextVariable(event, args) {
            var textArea = args.textArea;
            var dropDown = args.dropDown;
            var text = dropDown.value;
            if (document.selection != undefined && document.selection.createRange != undefined) { // IE
                textArea.focus();
                document.selection.createRange().text = text;
            } else if (textArea.selectionStart != undefined) {
                var startPos = textArea.selectionStart;
                var before = (textArea.value).substring(0, startPos);
                var after = (textArea.value).substring(startPos, textArea.value.length);
                textArea.value = before + text + after;
                textArea.selectionStart = startPos + text.length;
                textArea.selectionEnd = startPos + text.length;
                textArea.focus();
            }
        }

        function onClickMonitoringPropertyDialogButton(event, args) {
            var entity = args.entity;
            var propertyType = args.propertyType;

            // Get the current settings from server.
            var postData = 'entityType=' + encodeURIComponent(entity.type)
                         + '&entityId=' + encodeURIComponent(entity.id)
                         + '&propertyType=' + encodeURIComponent(propertyType);
            // TODO Set getMonitoringPropertySettingsUrl using Wicket.
            var xhr = l7.Connection.syncRequest('POST', getMonitoringPropertySettingsUrl, postData, false);
            if (xhr.status == 200) {
                var settings = l7.Dialog.parseJSON(
                        xhr.responseText,
                        localizedStrings.ERROR,
                        '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_DOWNLOAD_MONITORING_PROPERTY_SETTING) + '</p>',
                        localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                        localizedStrings.OK);
                if (l7.Util.isException(settings)) {
                    return;
                }
            } else {
                l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_MONITORING_PROPERTY_SETTING + '<br/><br/>' + xhr.statusText + ' (' + xhr.status + ')', localizedStrings.OK);
                return;
            }

            monDlg_entityId.value = entity.id;
            monDlg_propertyType.value = propertyType;
            monDlg_entityTypeLabel.innerHTML = '';
            if (settings.entity.type == l7.Constants.ENTITY_TYPE.SSG_CLUSTER) {
                monDlg_entityTypeLabel.innerHTML = entityTreeTableLocalizedStrings.SSG_CLUSTER;
            } else if (settings.entity.type == l7.Constants.ENTITY_TYPE.SSG_NODE) {
                monDlg_entityTypeLabel.innerHTML = entityTreeTableLocalizedStrings.SSG_NODE;
            }

            monDlg_entityPathLabel.innerHTML = settings.entity.ancestors.join(' / ') + ' / ' +  settings.entity.name;
            monDlg_propertyLabel.innerHTML = getMonitoringPropertyTypeLocalizedStrings(propertyType);
            monDlg_enabledCheckBox.checked = settings.monitoringEnabled;
            monDlg_samplingIntervalLabel.innerHTML = currentSetup.propertySetup[propertyType].samplingInterval;
            monDlg_triggerEnabledCheckBox.checked = settings.triggerEnabled;

            // Display the alert trigger configuration only for this property type.
            for (var property in monDlg_triggerConfigs) {
                monDlg_triggerConfigs[property].style.display = property == propertyType ? '' : 'none';
            }

            var triggerValueTextBox = monDlg_triggerValueTextBoxes[propertyType];
            if (triggerValueTextBox) {
                if (settings.triggerValue) {
                    triggerValueTextBox.value = settings.triggerValue;
                } else {
                    triggerValueTextBox.value = '';
                }
            }

            monDlg_notificationEnabledCheckBox.checked = settings.notificationEnabled;
            monDlg_notificationDisabledWarning.style.visibility = currentSetup.disableAllNotifications ? 'visible' : 'hidden';

            while (monDlg_notificationRulesListBox.options.length > 0) {
                monDlg_notificationRulesListBox.remove(0);
            }
            for (var i = 0; i < availableNotificationRules.length; ++i) {
                var option = document.createElement('option');
                option.value = availableNotificationRules[i].id;
                option.innerHTML = availableNotificationRules[i].name;
                if (l7.Util.findArrayElementsByProperty(settings.notificationRules, 'id', option.value).length == 1) {
                    option.selected = true;
                }
                monDlg_notificationRulesListBox.appendChild(option);
            }

            validateMonitoringPropertyDialog();
            monDlg.center();
            monDlg.show();
        }

        function onClickUseDefaultTriggerValueButton() {
            var propertyType = monDlg_propertyType.value;
            var textBox = monDlg_triggerValueTextBoxes[propertyType];
            textBox.value = currentSetup.propertySetup[propertyType].defaultTriggerValue;
        }

        function refreshMonitoringProperties() {
            var nextRefreshInterval = DEFAULT_MONITORING_PROPERTIES_REFRESH_INTERVAL;
            // TODO Set refreshMonitoringPropertiesUrl using Wicket.
            var xhr = l7.Connection.syncRequest('GET', refreshMonitoringPropertiesUrl, null, false);
            var result = l7.Connection.parseJsonResponse(xhr, false);
            if (result.success) {
                if (result.json.entities) {
                    for (var i = 0; i < result.json.entities.length; ++i) {
                        var entity = result.json.entities[i];
                        for (var propertyType in entity.monitoringProperties) {
                            entityTreeTable.setMonitoredProperty(entity.id, propertyType, entity.monitoringProperties[propertyType]);
                        }
                    }
                    resetCollapsedHeaderWidths();
                }

                if (result.json.nextRefreshInterval) {
                    nextRefreshInterval = result.json.nextRefreshInterval;
                }
            }
            setTimeout('refreshMonitoringProperties()', nextRefreshInterval);
        }

        function loadMonitoringSetup() {
            // TODO Set getMonitoringSetupUrl using Wicket.
            var xhr = l7.Connection.syncRequest('GET', getMonitoringSetupUrl, null, false);
            if (xhr.status == 200) {
                currentSetup = l7.Dialog.parseJSON(
                        xhr.responseText,
                        localizedStrings.ERROR,
                        '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_DOWNLOAD_MONITORING_SETUP) + '</p>',
                        localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                        localizedStrings.OK);
                if (l7.Util.isException(currentSetup)) {
                    return;
                }
            } else {
                l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_MONITORING_SETUP + '<br/><br/>' + xhr.statusText + ' (' + xhr.status + ')', localizedStrings.OK);
                return;
            }

            for (var propertyType in currentSetup.propertySetup) {
                var propertySetup = currentSetup.propertySetup[propertyType];
                samplingIntervalTextBoxes[propertyType].value = propertySetup.samplingInterval;
                if (propertySetup.defaultTriggerValue) {
                    defaultTriggerValueTextBoxes[propertyType].value = propertySetup.defaultTriggerValue;
                }
                if (propertyType == l7.Constants.SSG_NODE_MONITORING_PROPERTY.CLOCK_DRIFT) {
                    ntpServersTextArea.value = l7.Util.escapeAsText(propertySetup.ntpServers.join('\n'));
                }
            }

            disableAllNotificationCheckBox.checked = currentSetup.disableAllNotifications;
            auditUponAlertStateCheckBox.checked = currentSetup.auditUponAlertState;
            auditUponNormalStateCheckBox.checked = currentSetup.auditUponNormalState;
            auditUponNotificationCheckBox.checked = currentSetup.auditUponNotification;

            validateSetup();
        }

        /**
         * Downloads the list of defined notification rules, use it to populate the table and sets availableNotificationRules.
         */
        function loadNotificationRules() {
            notificationRulesDataSource.sendRequest('', {
                success : function(sRequest , oResponse , oPayload) {
                    notificationRulesDataTable.onDataReturnInitializeTable(sRequest , oResponse , oPayload);
                    notificationRulesDataTable.sortColumn(notificationRulesDataTable.getColumn('name'), YAHOO.widget.DataTable.CLASS_ASC);
                    updateNotificationRuleButtons();
                    availableNotificationRules = oResponse.results;
                },
                failure : notificationRulesDataTable.onDataReturnInitializeTable,
                scope   : notificationRulesDataTable
            });
        }

        function loadEntityTreeTable() {
            entityTreeTable.clear();

            function displayError() {
                var tbody = document.getElementById('entityTreeTableBody');
                var tr = tbody.insertRow(-1);
                var td = tr.insertCell(-1);
                td.colSpan = entityTreeTable._config.columns.length;
                td.innerHTML = localizedStrings.ENTITY_DATA_ERROR;
            }

            var callback = {
                success : function(o) {
                    var entities;
                    try {
                        entities = YAHOO.lang.JSON.parse(o.responseText);
                    } catch (e) {
                        displayError();
                        l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_PARSE_ENTITY_DATA + '<br/><br/>' + e, localizedStrings.OK);
                        return;
                    }
                    entityTreeTable.load(entities);
                    resetCollapsedHeaderWidths();
                    setTimeout('refreshMonitoringProperties()', 0);
                },
                failure : function(o) {
                    displayError();
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_ENTITY_DATA + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
                }
            };
            var getEntityTreeUrl = 'dataSource/monitor.json';
            YAHOO.util.Connect.asyncRequest('GET', getEntityTreeUrl, callback, null);
        }

        function initNotificationRulesDataTable() {
            function formatType(elCell, oRecord, oColumn, oData) {
                elCell.innerHTML = getNotificationTypeLocalizedStrings(oData);
            }
            var columnDefs = [
                {key:'name', label:'Name', resizeable:true, sortable:true, className:['nowrap']},
                {key:'type', label:'Type', resizeable:true, sortable:true, className:['nowrap'], formatter: formatType}
            ];

            notificationRulesDataSource = new YAHOO.util.DataSource('dataSource/monitoring/notificationRules.json', {
                    connXhrMode     : 'cancelStaleRequests',
                    responseType    : YAHOO.util.DataSource.TYPE_JSON,
                    responseSchema  : {
                        resultsList : 'records',
                        fields      : [
                            {key:'id'},
                            {key:'name'},
                            {key:'type'},
                            {key:'params'}
                        ],
                        metaFields  : {totalRecords:'totalRecords'}
                    }
                });

            notificationRulesDataTable = new YAHOO.widget.DataTable('notificationRulesDataTable', columnDefs, notificationRulesDataSource, {
                    draggableColumns : true,
                    height           : '100px',
                    initialLoad      : false,
                    scrollable       : true
                });
            notificationRulesDataTable.set('selectionMode', 'single');
            notificationRulesDataTable.subscribe('rowClickEvent', notificationRulesDataTable.onEventSelectRow);

            // Subscribes to user account selection changes for enabling/disabling toolbar buttons.
            notificationRulesDataTable.subscribe("rowSelectEvent", updateNotificationRuleButtons);
            notificationRulesDataTable.subscribe("rowUnSelectEvent", updateNotificationRuleButtons);

            loadNotificationRules();
        }

        /**
         * Fetches entities data from server and then populates table body.
         */
        function initEntityTreeTable() {
            var tbody = document.getElementById('entityTreeTableBody');
            var config = {
                localizedStrings : entityTreeTableLocalizedStrings,
                columns : [
                    l7.EntityTreeTable.COLUMN.NAME,
                    l7.EntityTreeTable.COLUMN.ONLINE_STATUS,
                    l7.EntityTreeTable.COLUMN.TYPE,
                    l7.EntityTreeTable.COLUMN.MONITORING_AUDIT_SIZE,
                    l7.EntityTreeTable.COLUMN.MONITORING_OPERATING_STATUS,
                    l7.EntityTreeTable.COLUMN.MONITORING_LOG_SIZE,
                    l7.EntityTreeTable.COLUMN.MONITORING_DISK_USAGE,
                    l7.EntityTreeTable.COLUMN.MONITORING_RAID_STATUS,
                    l7.EntityTreeTable.COLUMN.MONITORING_CPU_TEMP,
                    l7.EntityTreeTable.COLUMN.MONITORING_CPU_USAGE,
                    l7.EntityTreeTable.COLUMN.MONITORING_SWAP_USAGE,
                    l7.EntityTreeTable.COLUMN.MONITORING_CLOCK_DRIFT
                ],
                onClickMonitoringPropertyDialogButton : onClickMonitoringPropertyDialogButton
            };
            entityTreeTable = new l7.EntityTreeTable(tbody, [], '../images', config);

            loadEntityTreeTable();
        }

        function initButtons() {
            saveMonitoringSetupButton = new YAHOO.widget.Button('saveMonitoringSetupButton', {
                onclick : {
                    fn : onClickSaveMonitoringSetupButton
                }
            });
            revertMonitoringSetupButton = new YAHOO.widget.Button('revertMonitoringSetupButton', {
                onclick : {
                    fn : loadMonitoringSetup
                }
            });
            addNotificationRuleButton = new YAHOO.widget.Button('addNotificationRuleButton', {
                onclick : {
                    fn : onClickAddOrEditNotificationRuleButton,
                    obj : { isAdd : true }
                }
            });
            editNotificationRuleButton = new YAHOO.widget.Button('editNotificationRuleButton', {
                onclick : {
                    fn : onClickAddOrEditNotificationRuleButton,
                    obj : { isAdd : false }
                },
                disabled : true     // Initially disabled because no selection.
            });
            deleteNotificationRuleButton = new YAHOO.widget.Button('deleteNotificationRuleButton', {
                onclick : {
                    fn : onClickDeleteNotificationRuleButton
                },
                disabled : true     // Initially disabled because no selection.
            });
            notifDlg_eMail_insertButton = new YAHOO.widget.Button('notifDlg_eMail_insertButton', {
                onclick : {
                    fn : onClick_notifDlg_insertContextVariable,
                    obj : {
                        textArea : notifDlg_eMail_bodyTextArea,
                        dropDown : notifDlg_eMail_insertDropDown
                    }
                },
                type : 'push'
            });
            notifDlg_snmpTrap_insertButton = new YAHOO.widget.Button('notifDlg_snmpTrap_insertButton', {
                onclick : {
                    fn : onClick_notifDlg_insertContextVariable,
                    obj : {
                        textArea : notifDlg_snmpTrap_textDataTextArea,
                        dropDown : notifDlg_snmpTrap_insertDropDown
                    }
                },
                type : 'push'
            });
            notifDlg_httpRequest_insertButton = new YAHOO.widget.Button('notifDlg_httpRequest_insertButton', {
                onclick : {
                    fn : onClick_notifDlg_insertContextVariable,
                    obj : {
                        textArea : notifDlg_httpRequest_bodyTextArea,
                        dropDown : notifDlg_httpRequest_insertDropDown
                    }
                },
                type : 'push'
            });
            monDlg_useDefaultTriggerValueButton = new YAHOO.widget.Button('monDlg_useDefaultTriggerValueButton', {
                onclick : {
                    fn : onClickUseDefaultTriggerValueButton
                },
                type : 'push'
            });
        }

        function initAddOrEditNotificationRuleDialog() {
            addOrEditNotificationRuleDialog = new YAHOO.widget.Dialog('addOrEditNotificationRuleDialog', {
                buttons     : [
                    {
                        text      : localizedStrings.SAVE,
                        handler   : function() {
                            this.hide();
                            saveNotificationRule(false);
                            loadNotificationRules();
                        },
                        isDefault : true
                    },
                    {
                        text      : localizedStrings.CANCEL,
                        handler   : function() {
                            this.hide();
                        }
                    }
                ],
                close       : true,
                draggable   : true,
                fixedcenter : true,
                modal       : true,
                visible     : false
            });
            addOrEditNotificationRuleDialog.manualSubmitEvent.subscribe(function() {
                if (validateMonitoringPropertyDialog()) {
                    saveNotificationRule(false);
                    loadNotificationRules();
                } // else treat as cancel
            }); // To handle ENTER key press.
            addOrEditNotificationRuleDialog.render();
        }

        function initSaveNotificationRuleOverwriteDialog() {
            saveNotificationRuleOverwriteDialog = new YAHOO.widget.Dialog('saveNotificationRuleOverwriteDialog', {
                buttons     : [
                    {
                        text      : localizedStrings.SAVE,
                        handler   : function() {
                            this.hide();
                            saveNotificationRule(true);
                            loadNotificationRules();
                        },
                        isDefault : true
                    },
                    {
                        text      : localizedStrings.CANCEL,
                        handler   : function() {
                            this.hide();
                        }
                    }
                ],
                close       : true,
                draggable   : true,
                fixedcenter : true,
                modal       : true,
                visible     : false
            });
            saveNotificationRuleOverwriteDialog.render();
        }

        function initDeleteNotificationRuleDialog() {
            deleteNotificationRuleDialog = new YAHOO.widget.Dialog('deleteNotificationRuleDialog', {
                buttons     : [
                    {
                        text      : localizedStrings.OK,
                        handler   : function() {
                            this.submit();
                        },
                        isDefault : true
                    },
                    {
                        text      : localizedStrings.CANCEL,
                        handler   : function() {
                            this.hide();
                        }
                    }
                ],
                close       : true,
                draggable   : true,
                icon        : YAHOO.widget.SimpleDialog.ICON_BLOCK,
                modal       : true,
                postmethod  : 'async',
                visible     : false
            });
            deleteNotificationRuleDialog.render();
            deleteNotificationRuleDialog.callback.success = function(o) {
                var result = l7.Dialog.parseJSON(
                        o.responseText,
                        localizedStrings.ERROR,
                        '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_DELETE_NOTIFICATION_RULE) + '</p>',
                        localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                        localizedStrings.OK);
                if (!l7.Util.isException(result)) {
                    // No return object expected.
                    loadNotificationRules();    // Reloads to show notification rule gone.
                }
            }
            deleteNotificationRuleDialog.callback.failure = function(o) {
                l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DELETE_NOTIFICATION_RULE + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
            }
        }

        function initMonitoringPropertySettingsDialog() {
            monDlg = new YAHOO.widget.Dialog('monDlg', {
                buttons     : [
                    {
                        text      : localizedStrings.SAVE,
                        handler   : function() {
                            this.hide();
                            saveMonitoringPropertySettings();
                        },
                        isDefault : true
                    },
                    {
                        text      : localizedStrings.CANCEL,
                        handler   : function() {
                            this.hide();
                            monDlg_triggerValueWarningIcon.style.visibility = 'hidden'; // Workaround for bug in YUI?
                        }
                    }
                ],
                close       : true,
                draggable   : true,
                icon        : YAHOO.widget.SimpleDialog.ICON_BLOCK,
                modal       : true,
                postmethod  : 'manual', // Because payload is JSON data format, not FORM data.
                visible     : false
            });
            monDlg.manualSubmitEvent.subscribe(function() {
                if (validateMonitoringPropertyDialog()) {
                    saveMonitoringPropertySettings();
                } // else treat as cancel
            }); // To handle ENTER key press.
            monDlg.render();
        }

        function initDialogs() {
            initAddOrEditNotificationRuleDialog();
            initSaveNotificationRuleOverwriteDialog();
            initDeleteNotificationRuleDialog();
            initMonitoringPropertySettingsDialog();
        }

        function init() {
            var debugLogReader = new YAHOO.widget.LogReader('debugLogReader');
            debugLogReader.hide();   // Initially hidden.

            // Precomputes UI element references for efficiency.
            ntpServersTextArea = document.getElementById('ntpServersTextArea');
            ntpServersWarningIcon = document.getElementById('ntpServersWarningIcon');
            disableAllNotificationCheckBox = document.getElementById('disableAllNotificationCheckBox');
            auditUponAlertStateCheckBox = document.getElementById('auditUponAlertStateCheckBox');
            auditUponNormalStateCheckBox = document.getElementById('auditUponNormalStateCheckBox');
            auditUponNotificationCheckBox = document.getElementById('auditUponNotificationCheckBox');

            notifDlg_titleLabel = document.getElementById('notifDlg_titleLabel');
            notifDlg_id = document.getElementById('notifDlg_id');
            notifDlg_nameTextBox = document.getElementById('notifDlg_nameTextBox');
            notifDlg_typeDropDown = document.getElementById('notifDlg_typeDropDown');
            notifDlg_eMail_protocolDropDown = document.getElementById('notifDlg_eMail_protocolDropDown');
            notifDlg_eMail_hostTextBox = document.getElementById('notifDlg_eMail_hostTextBox');
            notifDlg_eMail_portTextBox = document.getElementById('notifDlg_eMail_portTextBox');
            notifDlg_eMail_portWarningIcon = document.getElementById('notifDlg_eMail_portWarningIcon');
            notifDlg_eMail_requiresAuthenticationCheckBox = document.getElementById('notifDlg_eMail_requiresAuthenticationCheckBox');
            notifDlg_eMail_userNameTextBox = document.getElementById('notifDlg_eMail_userNameTextBox');
            notifDlg_eMail_passwordTextBox = document.getElementById('notifDlg_eMail_passwordTextBox');
            notifDlg_eMail_toTextBox = document.getElementById('notifDlg_eMail_toTextBox');
            notifDlg_eMail_ccTextBox = document.getElementById('notifDlg_eMail_ccTextBox');
            notifDlg_eMail_bccTextBox = document.getElementById('notifDlg_eMail_bccTextBox');
            notifDlg_eMail_subjectTextBox = document.getElementById('notifDlg_eMail_subjectTextBox');
            notifDlg_eMail_insertButton = document.getElementById('notifDlg_eMail_insertButton');
            notifDlg_eMail_insertDropDown = document.getElementById('notifDlg_eMail_insertDropDown');
            notifDlg_eMail_bodyTextArea = document.getElementById('notifDlg_eMail_bodyTextArea');
            notifDlg_snmpTrap_hostTextBox = document.getElementById('notifDlg_snmpTrap_hostTextBox');
            notifDlg_snmpTrap_defaultPortRadioButton = document.getElementById('notifDlg_snmpTrap_defaultPortRadioButton');
            notifDlg_snmpTrap_customPortRadioButton = document.getElementById('notifDlg_snmpTrap_customPortRadioButton');
            notifDlg_snmpTrap_customPortTextBox = document.getElementById('notifDlg_snmpTrap_customPortTextBox');
            notifDlg_snmpTrap_customPortWarningIcon = document.getElementById('notifDlg_snmpTrap_customPortWarningIcon');
            notifDlg_snmpTrap_communityTextBox = document.getElementById('notifDlg_snmpTrap_communityTextBox');
            notifDlg_snmpTrap_insertButton = document.getElementById('notifDlg_snmpTrap_insertButton');
            notifDlg_snmpTrap_insertDropDown = document.getElementById('notifDlg_snmpTrap_insertDropDown');
            notifDlg_snmpTrap_textDataTextArea = document.getElementById('notifDlg_snmpTrap_textDataTextArea');
            notifDlg_snmpTrap_oidSuffixTextBox = document.getElementById('notifDlg_snmpTrap_oidSuffixTextBox');
            notifDlg_snmpTrap_oidSuffixWarningIcon = document.getElementById('notifDlg_snmpTrap_oidSuffixWarningIcon');
            notifDlg_httpRequest_urlTextBox = document.getElementById('notifDlg_httpRequest_urlTextBox');
            notifDlg_httpRequest_methodDropDown = document.getElementById('notifDlg_httpRequest_methodDropDown');
            notifDlg_httpRequest_standardContentTypeRadioButton = document.getElementById('notifDlg_httpRequest_standardContentTypeRadioButton');
            notifDlg_httpRequest_standardContentTypeDropDown = document.getElementById('notifDlg_httpRequest_standardContentTypeDropDown');
            notifDlg_httpRequest_customContentTypeRadioButton = document.getElementById('notifDlg_httpRequest_customContentTypeRadioButton');
            notifDlg_httpRequest_customContentTypeTextBox = document.getElementById('notifDlg_httpRequest_customContentTypeTextBox');
            notifDlg_httpRequest_insertButton = document.getElementById('notifDlg_httpRequest_insertButton');
            notifDlg_httpRequest_insertDropDown = document.getElementById('notifDlg_httpRequest_insertDropDown');
            notifDlg_httpRequest_bodyTextArea = document.getElementById('notifDlg_httpRequest_bodyTextArea');
            for (var i in l7.Constants.NOTIFICATION_TYPE) {
                var type = l7.Constants.NOTIFICATION_TYPE[i];
                notifDlg_configs[type] =  document.getElementById('notifDlg_' + type + 'Config');
            }

            monDlg_entityId = document.getElementById('monDlg_entityId');
            monDlg_propertyType = document.getElementById('monDlg_propertyType');
            monDlg_entityTypeLabel = document.getElementById('monDlg_entityTypeLabel');
            monDlg_entityPathLabel = document.getElementById('monDlg_entityPathLabel');
            monDlg_propertyLabel = document.getElementById('monDlg_propertyLabel');
            monDlg_enabledCheckBox = document.getElementById('monDlg_enabledCheckBox');
            monDlg_samplingIntervalLabel = document.getElementById('monDlg_samplingIntervalLabel');
            monDlg_triggerEnabledCheckBox = document.getElementById('monDlg_triggerEnabledCheckBox');
            monDlg_triggerValueWarningIcon = document.getElementById('monDlg_triggerValueWarningIcon');
            monDlg_notificationEnabledCheckBox = document.getElementById('monDlg_notificationEnabledCheckBox');
            monDlg_notificationDisabledWarning = document.getElementById('monDlg_notificationDisabledWarning');
            monDlg_notificationRulesListBox = document.getElementById('monDlg_notificationRulesListBox');

            for (i = 0; i < ALL_PROPERTY_TYPES.length; ++i) {
                var propertyType = ALL_PROPERTY_TYPES[i];
                samplingIntervalTextBoxes[propertyType] = document.getElementById(propertyType + 'SamplingIntervalTextBox');
                samplingIntervalWarningIcons[propertyType] = document.getElementById(propertyType + 'SamplingIntervalWarningIcon');
                defaultTriggerValueTextBoxes[propertyType] = document.getElementById(propertyType + 'DefaultTriggerValueTextBox');
                defaultTriggerValueWarningIcons[propertyType] = document.getElementById(propertyType + 'DefaultTriggerValueWarningIcon');
                monDlg_triggerConfigs[propertyType] = document.getElementById('monDlg_' + propertyType + 'TriggerConfig');
                monDlg_triggerValueTextBoxes[propertyType] = document.getElementById('monDlg_' + propertyType + 'TriggerValueTextBox');
            }

            l7.Tippy.toggleTippy('setupPanelTippy', 'setupPanel');  // collapsed on page load
            initButtons();
            initDialogs();
            initNotificationRulesDataTable();
            initEntityTreeTable();
            loadMonitoringSetup();
        }

        YAHOO.util.Event.onDOMReady(init);
    </script>
    </wicket:head>

</head>
<body class="yui-skin-sam">
<noscript><div class="javascriptWarning">This page requires JavaScript. Your browser either does not have JavaScript support or has disabled it.</div></noscript>
<table width="100%">
    <tr>
        <td>
            <div class="header">
                <table width="100%">
                    <tr class="header">
                        <td class="logoLeft"><img src="../images/logoLeft.png" alt="" /></td>
                        <td class="logo"><a href="Monitor.html"><img src="../images/l7Logo.png" alt="Layer 7 Technologies Inc." /><img src="../images/esmLogo.png" alt="" /></a></td>
                        <td class="logoRight"><img src="../images/logoRight.png" alt="" /></td>
                        <td width="100%"><img src="../images/spacer.png" alt="" /></td>
                        <td class="middle nowrap">Logged in as "admin"<br />since May 5, 2008 05:57:54 PM</td>
                        <td class="middle"><form method="get" action="Login.html"><input type="submit" value="Log Out" /></form></td>
                        <td class="middle help"><a href="Help.html" target="l7-esm-help" title="Open help page in a separate window">Help</a></td>
                    </tr>
                </table>
            </div>
            <div class="divider"><img src="../images/spacer.png" alt="" /></div>
            <div>
                <table>
                    <tr>
                        <td id="tabLTManageGateways"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTManageGateways" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTManageGateways"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTManagePolicies"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTManagePolicies" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTManagePolicies"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTReports"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTReports" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTReports"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTTools"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTTools" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTTools"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTSettings"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTSettings" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTSettings"><img src="../images/tabRT.png" alt="" /></td>
                        <td><img src="../images/tabLT.png" alt="" /></td>
                        <td class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td><img src="../images/tabRT.png" alt="" /></td>
                    </tr>
                    <tr>
                        <td id="tabLMManageGateways" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMManageGateways" class="tabCMon">Manage Gateways</td>
                        <td id="tabRMManageGateways" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMManagePolicies" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMManagePolicies" class="tabCM"><a href="PolicyMigration.html">Manage Policies</a></td>
                        <td id="tabRMManagePolicies" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMReports" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMReports" class="tabCM"><a href="StandardReports.html">Reports</a></td>
                        <td id="tabRMReports" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMTools" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMTools" class="tabCM"><a href="Messages.html">Tools</a></td>
                        <td id="tabRMTools" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMSettings" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMSettings" class="tabCM"><a href="UserSettings.html">Settings</a></td>
                        <td id="tabRMSettings" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabCM" width="100%"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                    </tr>
                    <tr>
                        <td id="tabLBManageGateways"><img src="../images/tabLBon.png" alt="" /></td>
                        <td id="tabCBManageGateways" class="tabCBon"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBManageGateways"><img src="../images/tabRBon.png" alt="" /></td>
                        <td id="tabLBManagePolicies"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBManagePolicies" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBManagePolicies"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBReports"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBReports" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBReports"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBTools"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBTools" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBTools"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBSettings"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBSettings" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBSettings"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td><img src="../images/tabLBoff.png" alt="" /></td>
                        <td class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td><img src="../images/tabRBoff.png" alt="" /></td>
                    </tr>
                </table>
            </div>
            <script language="JavaScript" type="text/javascript">
                l7.TabBar.initTab('ManagePolicies');
                l7.TabBar.initTab('Reports');
                l7.TabBar.initTab('Tools');
                l7.TabBar.initTab('Settings');
            </script>
            <div class="subtabBar">
                <span class="subtabOn">Monitor</span>
                |
                <span class="subtabOff"><a href="Configure.html">Configure</a></span>
                |
                <span class="subtabOff"><a href="Backup.html">Backup</a></span>
                |
                <span class="subtabOff"><a href="Restore.html">Restore</a></span>
            </div>
            <div class="content">

                <wicket:extend>
                <div class="panel">
                    <div class="panelTitle tippy"><img id="setupPanelTippy" class="tippy" src="../images/tippyExpanded.png" alt="" onclick="l7.Tippy.toggleTippy(this, 'setupPanel'); notificationRulesDataTable.render();" /><span class="clickable" onclick="l7.Tippy.toggleTippy('setupPanelTippy', 'setupPanel'); notificationRulesDataTable.render();">Monitoring Setup</span></div>
                    <div id="setupPanel">
                        <div class="panelContent">
                            <table class="spaced">
                                <tr>
                                    <th class="top">Property Settings:</th>
                                    <td>
                                        <table class="dataTable">
                                            <thead>
                                                <tr>
                                                    <th>Property Type</th>
                                                    <th>Sampling Interval (sec)</th>
                                                    <th>Default Alert Trigger</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>audit size</td>
                                                    <td class="center"><input id="auditSizeSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="auditSizeSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td>&ge; <input id="auditSizeDefaultTriggerValueTextBox" class="right" type="text" size="13" maxlength="13" onkeyup="validateSetup();"/> audit events <img id="auditSizeDefaultTriggerValueWarningIcon" src="../images/warning.png"/></td>
                                                </tr>
                                                <tr>
                                                    <td>operating status</td>
                                                    <td class="center"><input id="operatingStatusSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="operatingStatusSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td>upon failure</td>
                                                </tr>
                                                <tr>
                                                    <td>log file size</td>
                                                    <td class="center"><input id="logSizeSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="logSizeSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td>&ge; <input id="logSizeDefaultTriggerValueTextBox" class="right" type="text" size="7" maxlength="7" onkeyup="validateSetup();"/> MB <img id="logSizeDefaultTriggerValueWarningIcon" src="../images/warning.png"/></td>
                                                </tr>
                                                <tr>
                                                    <td>disk usage</td>
                                                    <td class="center"><input id="diskUsageSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="diskUsageSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td>&ge; <input id="diskUsageDefaultTriggerValueTextBox" class="right" type="text" size="7" maxlength="4" onkeyup="validateSetup();"/> % <img id="diskUsageDefaultTriggerValueWarningIcon" src="../images/warning.png"/></td>
                                                </tr>
                                                <tr>
                                                    <td>RAID status</td>
                                                    <td class="center"><input id="raidStatusSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="raidStatusSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td>upon failure</td>
                                                </tr>
                                                <tr>
                                                    <td>CPU temperature</td>
                                                    <td class="center"><input id="cpuTempSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="cpuTempSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td>&ge; <input id="cpuTempDefaultTriggerValueTextBox" class="right" type="text" size="7" maxlength="4" onkeyup="validateSetup();"/> &deg;C <img id="cpuTempDefaultTriggerValueWarningIcon" src="../images/warning.png"/></td>
                                                </tr>
                                                <tr>
                                                    <td>CPU usage</td>
                                                    <td class="center"><input id="cpuUsageSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="cpuUsageSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td>&ge; <input id="cpuUsageDefaultTriggerValueTextBox" class="right" type="text" size="7" maxlength="4" onkeyup="validateSetup();"/> % <img id="cpuUsageDefaultTriggerValueWarningIcon" src="../images/warning.png"/></td>
                                                </tr>
                                                <tr>
                                                    <td>swap space used</td>
                                                    <td class="center"><input id="swapUsageSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="swapUsageSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td>&ge; <input id="swapUsageDefaultTriggerValueTextBox" class="right" type="text" size="7" maxlength="7" onkeyup="validateSetup();"/> MB <img id="swapUsageDefaultTriggerValueWarningIcon" src="../images/warning.png"/></td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        clock drift
                                                        <br/>
                                                        using NTP servers: <img id="ntpServersWarningIcon" src="../images/warning.png"/>
                                                        <br/>
                                                        <textarea id="ntpServersTextArea" rows="3" cols="24" onkeyup="validateSetup();"></textarea>
                                                    </td>
                                                    <td class="center top"><input id="clockDriftSamplingIntervalTextBox" class="right" type="text" size="3" maxlength="3" onkeyup="validateSetup();"/> <img id="clockDriftSamplingIntervalWarningIcon" src="../images/warning.png"/></td>
                                                    <td class="top">
                                                        &ge; <input id="clockDriftDefaultTriggerValueTextBox" class="right" type="text" size="7" maxlength="4" onkeyup="validateSetup();"/> sec <img id="clockDriftDefaultTriggerValueWarningIcon" src="../images/warning.png"/>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Notification:</th>
                                    <td><input id="disableAllNotificationCheckBox" type="checkbox"/> <label for="disableAllNotificationCheckBox">Disable all notifications</label></td>
                                </tr>
                                <tr>
                                    <th class="top" rowspan="3">Audit:</th>
                                    <td>
                                        <input id="auditUponAlertStateCheckBox" type="checkbox"/> <label for="auditUponAlertStateCheckBox">When an alert is triggered</label>
                                        <br/>
                                        <input id="auditUponNormalStateCheckBox" type="checkbox"/> <label for="auditUponNormalStateCheckBox">When an alert no longer applies</label>
                                        <br/>
                                        <input id="auditUponNotificationCheckBox" type="checkbox"/> <label for="auditUponNormalStateCheckBox">When a notification is sent</label>
                                    </td>
                                </tr>
                            </table>
                            <button id="saveMonitoringSetupButton">Save</button>
                            <button id="revertMonitoringSetupButton" title="Revert to saved values">Revert</button>
                            <div class="fineRule"></div>
                            <h4 style="margin-top: 0.5em;">Notification Rules:</h4>
                            <div class="panel">
                                <div class="panelToolbar">
                                    <button id="addNotificationRuleButton">New</button>
                                    <button id="editNotificationRuleButton">Edit</button>
                                    <button id="deleteNotificationRuleButton">Delete</button>
                                    <img class="refresh clickableImg" src="../images/refresh.png" title="Refresh" alt="Refresh" onclick="loadNotificationRules();" />
                                </div>
                                <div id="notificationRulesResize" class="panelContent">
                                    <div id="notificationRulesDataTable"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel">
                    <div class="panelTitle tippy"><img id="enterpriseTreePanelTippy" class="tippy" src="../images/tippyExpanded.png" alt="" onclick="l7.Tippy.toggleTippy(this, 'enterpriseTreePanel')" /><span class="clickable" onclick="l7.Tippy.toggleTippy('enterpriseTreePanelTippy', 'enterpriseTreePanel')">Enterprise Gateways</span> <img class="refresh clickableImg" src="../images/refresh.png" title="Refresh" alt="Refresh" onclick="loadEntityTreeTable();" /></div>
                    <div id="enterpriseTreePanel">
                        <div class="panelContent">
                            <table id="entityTreeTable" class="dataTable">
                                <thead id="collapsedHeaders">
                                    <!-- These headers are initially shown. When tippy is clicked, switch to stepped headers. -->
                                    <tr>
                                        <th class="bottom" rowspan="2">Name<br /><img src="../images/spacer.png" alt="" height="0" width="140" /><!-- minimum width --></th>
                                        <th class="bottom" rowspan="2"><img src="../images/status.png" title="Online Status" alt="" /></th>
                                        <th class="bottom" rowspan="2">Type</th>
                                        <th colspan="9"><img class="tippy" src="../images/tippyCollapsed.png" title="Click to expand headers" alt="" onclick="expandSteppedHeaders();" /><span class="clickable" title="Click to expand headers" onclick="expandSteppedHeaders();">Monitored Properties</span></th>
                                    </tr>
                                    <tr>
                                        <th class="group0"><div class="collapsedHeader" style="display: none;">audit size (no. of audit events)</div></th>
                                        <th class="group1"><div class="collapsedHeader" style="display: none;">operating status</div></th>
                                        <th class="group1"><div class="collapsedHeader" style="display: none;">log files size</div></th>
                                        <th class="group1"><div class="collapsedHeader" style="display: none;">disk usage</div></th>
                                        <th class="group1"><div class="collapsedHeader" style="display: none;">RAID status</div></th>
                                        <th class="group1"><div class="collapsedHeader" style="display: none;">CPU temperature</div></th>
                                        <th class="group1"><div class="collapsedHeader" style="display: none;">CPU usage</div></th>
                                        <th class="group1"><div class="collapsedHeader" style="display: none;">swap space usage</div></th>
                                        <th class="group1">clock drift</th>
                                    </tr>
                                </thead>
                                <thead id="steppedHeaders" style="display: none;">
                                    <!-- These headers are initially hidden until tippy is clicked. -->
                                    <tr>
                                        <th class="bottom" rowspan="10">Name<br /><img src="../images/spacer.png" alt="" height="0" width="140" /><!-- minimum width --></th>
                                        <th class="bottom" rowspan="10"><img src="../images/status.png" title="Online Status" alt="" /></th>
                                        <th class="bottom" rowspan="10">Type</th>
                                        <th colspan="9"><img class="tippy" src="../images/tippyExpanded.png" title="Click to collapse headers" alt="" onclick="collapseSteppedHeaders();" /><span class="clickable" title="Click to collapse headers" onclick="collapseSteppedHeaders();">Monitored Properties</span></th>
                                        <th class="parentId" rowspan="10"><!-- hidden column --></th>
                                    </tr>
                                    <tr>
                                        <th class="topStep group0" colspan="9">audit size (no. of audit events)</th>
                                    </tr>
                                    <tr>
                                        <th class="group0 middleStep group0middleStep"> </th>
                                        <th class="group1 topStep" colspan="8">operating status</th>
                                    </tr>
                                    <tr>
                                        <th class="group0 middleStep group0middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 topStep" colspan="7">log files size</th>
                                    </tr>
                                    <tr>
                                        <th class="group0 middleStep group0middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 topStep" colspan="6">disk usage</th>
                                    </tr>
                                    <tr>
                                        <th class="group0 middleStep group0middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 topStep" colspan="5">RAID status</th>
                                    </tr>
                                    <tr>
                                        <th class="group0 middleStep group0middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 topStep" colspan="4">CPU temperature</th>
                                    </tr>
                                    <tr>
                                        <th class="group0 middleStep group0middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 topStep" colspan="3">CPU usage</th>
                                    </tr>
                                    <tr>
                                        <th class="group0 middleStep group0middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 middleStep group1middleStep"> </th>
                                        <th class="group1 topStep" colspan="2">swap space usage</th>
                                    </tr>
                                    <tr>
                                        <th class="group0 bottomStep group0bottomStep"> </th>
                                        <th class="group1 bottomStep group1bottomStep"> </th>
                                        <th class="group1 bottomStep group1bottomStep"> </th>
                                        <th class="group1 bottomStep group1bottomStep"> </th>
                                        <th class="group1 bottomStep group1bottomStep"> </th>
                                        <th class="group1 bottomStep group1bottomStep"> </th>
                                        <th class="group1 bottomStep group1bottomStep"> </th>
                                        <th class="group1 bottomStep group1bottomStep"> </th>
                                        <th class="group1">clock drift</th>
                                    </tr>
                                </thead>
                                <tbody id="entityTreeTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

<!-- Dialog for adding/editing one notification rule. -->
<div id="addOrEditNotificationRuleDialog">
    <div class="hd"><span id="notifDlg_titleLabel"></span></div>
    <div class="bd">
        <form>
            <input id="notifDlg_id" type="hidden"/> <!-- used if edit existing notfication rule -->
            <table class="spaced">
                <tr>
                    <th>Name:</th>
                    <td><input id="notifDlg_nameTextBox" type="text" size="64" maxlength="128" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th>Type:</th>
                    <td>
                        <select id="notifDlg_typeDropDown" onchange="validateNotificationRuleDialog();">
                            <option value="eMail">E-mail</option>
                            <option value="snmpTrap">SNMP Trap</option>
                            <option value="httpRequest">HTTP Request</option>
                        </select>
                    </td>
                </tr>
            </table>
            <div class="fineRule"></div>
            <table id="notifDlg_eMailConfig" class="spaced">
                <tr>
                    <th>Protocol:</th>
                    <td>
                        <select id="notifDlg_eMail_protocolDropDown" onchange="onChangeNotifDlg_eMail_protocol();">
                            <option value="plainSmtp">Plain SMTP</option>
                            <option value="sslSmtp">SMTP over SSL</option>
                            <option value="startTlsSmtp">SMTP with STARTTLS</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>Server Host:</th>
                    <td><input id="notifDlg_eMail_hostTextBox" type="text" size="64" maxlength="128" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th>Port Number:</th>
                    <td><input id="notifDlg_eMail_portTextBox" class="right" type="text" size="5" maxlength="5" onkeyup="validateNotificationRuleDialog();"/> <img id="notifDlg_eMail_portWarningIcon" src="../images/warning.png"/></td>
                </tr>
                <tr>
                    <th>Authentication:</th>
                    <td><input id="notifDlg_eMail_requiresAuthenticationCheckBox" type="checkbox" onclick="validateNotificationRuleDialog();"/> <label for="notifDlg_eMail_requiresAuthenticationCheckBox">required</label></td>
                </tr>
                <tr>
                    <th>User Name:</th>
                    <td><input id="notifDlg_eMail_userNameTextBox" type="text" size="64" maxlength="32" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th>Password:</th>
                    <td><input id="notifDlg_eMail_passwordTextBox" type="password" size="64" maxlength="128"/></td>
                </tr>
                <tr>
                    <th>To:</th>
                    <td><input id="notifDlg_eMail_toTextBox" type="text" maxlength="128" style="width: 98%" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th>CC:</th>
                    <td><input id="notifDlg_eMail_ccTextBox" type="text" maxlength="128" style="width: 98%" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th>BCC:</th>
                    <td><input id="notifDlg_eMail_bccTextBox" type="text" maxlength="128" style="width: 98%" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th>Subject:</th>
                    <td><input id="notifDlg_eMail_subjectTextBox" type="text" maxlength="128" style="width: 98%" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th class="top">Body Text:</th>
                    <td>
                        <div class="panel">
                            <div class="panelToolbar">
                                Context Variable:
                                <select id="notifDlg_eMail_insertDropDown">
                                    <option value="${monitoring.context.entityType}">Entity Type</option>
                                    <option value="${monitoring.context.entityPathName}">Entity Path & Name</option>
                                    <option value="${monitoring.context.propertyType}">Property Type</option>
                                    <option value="${monitoring.context.propertyValue}">Property Value</option>
                                    <option value="${monitoring.context.propertyState}">Property State</option>
                                    <option value="${monitoring.context.triggerValue}">Trigger Value</option>
                                </select>
                                <button id="notifDlg_eMail_insertButton">Insert</button>
                            </div>
                            <textarea id="notifDlg_eMail_bodyTextArea" rows="8" style="background-color: #ffffff; border: none; width: 98%;"></textarea>
                        </div>
                    </td>
                </tr>
            </table>
            <table id="notifDlg_snmpTrapConfig" class="spaced">
                <tr>
                    <th>Server Host:</th>
                    <td><input id="notifDlg_snmpTrap_hostTextBox" type="text" size="64" maxlength="128" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th>Port Number:</th>
                    <td>
                        <input id="notifDlg_snmpTrap_defaultPortRadioButton" name="notifDlg_snmpTrap_port" type="radio" checked onclick="validateNotificationRuleDialog();"/> <label for="notifDlg_snmpTrap_defaultPortRadioButton">Default (162)</label>
                        <input id="notifDlg_snmpTrap_customPortRadioButton" name="notifDlg_snmpTrap_port" type="radio" style="margin-left: 2em;" onclick="validateNotificationRuleDialog();"/> <label for="notifDlg_snmpTrap_customPortRadioButton">Custom: </label>
                        <input id="notifDlg_snmpTrap_customPortTextBox" type="text" size="5" maxlength="5" onkeyup="validateNotificationRuleDialog();"/> <img id="notifDlg_snmpTrap_customPortWarningIcon" src="../images/warning.png"/>
                    </td>
                </tr>
                <tr>
                    <th>Community:</th>
                    <td><input id="notifDlg_snmpTrap_communityTextBox" type="text" maxlength="128" style="width: 98%"/></td>
                </tr>
                <tr>
                    <th class="top">Text to Send:</th>
                    <td>
                        <div class="panel">
                            <div class="panelToolbar">
                                Context Variable:
                                <select id="notifDlg_snmpTrap_insertDropDown">
                                    <option value="${monitoring.context.entityType}">Entity Type</option>
                                    <option value="${monitoring.context.entityPathName}">Entity Path & Name</option>
                                    <option value="${monitoring.context.propertyType}">Property Type</option>
                                    <option value="${monitoring.context.propertyValue}">Property Value</option>
                                    <option value="${monitoring.context.propertyState}">Property State</option>
                                    <option value="${monitoring.context.triggerValue}">Trigger Value</option>
                                </select>
                                <button id="notifDlg_snmpTrap_insertButton">Insert</button>
                            </div>
                            <textarea id="notifDlg_snmpTrap_textDataTextArea" rows="8" style="background-color: #ffffff; border: none; width: 98%;"></textarea>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>OID to Send:</th>
                    <td>1.3.6.1.4.1.17304.7.3.<input id="notifDlg_snmpTrap_oidSuffixTextBox" type="text" size="5" maxlength="5" onkeyup="validateNotificationRuleDialog();"/> <img id="notifDlg_snmpTrap_oidSuffixWarningIcon" src="../images/warning.png"/></td>
                </tr>
            </table>
            <table id="notifDlg_httpRequestConfig" class="spaced">
                <tr>
                    <th>URL:</th>
                    <td colspan="2"><input id="notifDlg_httpRequest_urlTextBox" type="text" size="64" maxlength="128" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th>HTTP Method:</th>
                    <td colspan="2">
                        <select id="notifDlg_httpRequest_methodDropDown" onchange="validateNotificationRuleDialog();">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>Content-Type Header:</th>
                    <td><input id="notifDlg_httpRequest_standardContentTypeRadioButton" name="notifDlg_httpRequest_contentType" type="radio" checked onclick="validateNotificationRuleDialog();"/> <label for="notifDlg_httpRequest_standardContentTypeRadioButton">Standard:</label></td>
                    <td>
                        <select id="notifDlg_httpRequest_standardContentTypeDropDown">
                            <option value="text/plain; charset=utf-8">text/plain; charset=utf-8</option>
                            <option value="application/x-www-form-urlencoded; charset=utf-8">application/x-www-form-urlencoded; charset=utf-8</option>
                            <option value="text/xml; charset=utf-8">text/xml; charset=utf-8</option>
                            <option value="application/soap+xml; charset=utf-8">application/soap+xml; charset=utf-8</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th></th>
                    <td><input id="notifDlg_httpRequest_customContentTypeRadioButton" name="notifDlg_httpRequest_contentType" type="radio" onclick="validateNotificationRuleDialog();"/> <label for="notifDlg_httpRequest_customContentTypeRadioButton">Custom:</label></td>
                    <td><input id="notifDlg_httpRequest_customContentTypeTextBox" type="text" size="64" onkeyup="validateNotificationRuleDialog();"/></td>
                </tr>
                <tr>
                    <th class="top">Request Body:</th>
                    <td colspan="2">
                        <div class="panel">
                            <div class="panelToolbar">
                                Context Variable:
                                <select id="notifDlg_httpRequest_insertDropDown">
                                    <option value="${monitoring.context.entityType}">Entity Type</option>
                                    <option value="${monitoring.context.entityPathName}">Entity Path & Name</option>
                                    <option value="${monitoring.context.propertyType}">Property Type</option>
                                    <option value="${monitoring.context.propertyValue}">Property Value</option>
                                    <option value="${monitoring.context.propertyState}">Property State</option>
                                    <option value="${monitoring.context.triggerValue}">Trigger Value</option>
                                </select>
                                <button id="notifDlg_httpRequest_insertButton">Insert</button>
                            </div>
                            <textarea id="notifDlg_httpRequest_bodyTextArea" rows="8" style="background-color: #ffffff; border: none; width: 98%;"></textarea>
                        </div>
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>

<!-- Dialog to confirm overwrite existing notification rule. -->
<div id="saveNotificationRuleOverwriteDialog">
    <div class="hd">Duplicate Notification Rule Name</div>
    <div class="bd">
        <form>
            A notification rule with the name &ldquo;<span id="saveNotificationRuleOverwriteDialog_name"></span>&rdquo;
            already exists.
            <br/>
            <br/>
            Overwrite?
        </form>
    </div>
</div>

<!-- Dialog for confirming deletion of a notification rule. -->
<div id="deleteNotificationRuleDialog">
    <div class="hd">Delete Notification Rule</div>
    <div class="bd">
        <form name="deleteNotificationRuleForm" action="action/monitoring/deleteNotificationRule">
            <input id="deleteNotificationRuleDialog_id" type="hidden" name="id" />
            Delete notification rule &ldquo;<span id="deleteNotificationRuleDialog_name"></span>&rdquo;?
        </form>
    </div>
</div>

<!-- Dialog for settings of one monitoring property. -->
<div id="monDlg">
    <div class="hd">Monitoring Property Settings</div>
    <div class="bd">
        <form>
            <input id="monDlg_entityId" type="hidden"/>
            <input id="monDlg_propertyType" type="hidden"/>
            <table class="spaced">
                <tr>
                    <th><span id="monDlg_entityTypeLabel"></span>:</th>
                    <td id="monDlg_entityPathLabel"></td>
                </tr>
                <tr>
                    <th>Property:</th>
                    <td id="monDlg_propertyLabel"></td>
                </tr>
            </table>
            <div style="margin-left: 5px; margin-top:0.5em;">
                <div class="noWrap">
                    <input id="monDlg_enabledCheckBox" type="checkbox" onclick="validateMonitoringPropertyDialog();"/>
                    <label for="monDlg_enabledCheckBox">Enable monitoring</label>
                    &nbsp;<span class="note">(sampling interval = <span id="monDlg_samplingIntervalLabel"></span> sec)</span>
                </div>
                <table> <!-- Use table to middle-align YAHOO button. -->
                    <tr>
                        <td>
                            <input type="checkbox" style="visibility: hidden;"/> <!-- For indentation only. -->
                            <input id="monDlg_triggerEnabledCheckBox" type="checkbox" onclick="validateMonitoringPropertyDialog();"/>
                            <label for="monDlg_triggerEnabledCheckBox">Enable alert trigger :&nbsp;&nbsp;&nbsp;</label>
                        </td>
                        <td>
                            <!-- Only the matching one will be shown: -->
                            <div id="monDlg_auditSizeTriggerConfig">&ge; <input id="monDlg_auditSizeTriggerValueTextBox" class="right" type="text" size="13" maxlength="13" onkeyup="validateMonitoringPropertyDialog();"/> audit events</div>
                            <div id="monDlg_operatingStatusTriggerConfig">upon failure</div>
                            <div id="monDlg_logSizeTriggerConfig">&ge; <input id="monDlg_logSizeTriggerValueTextBox" class="right" type="text" size="7" maxlength="7" onkeyup="validateMonitoringPropertyDialog();"/> MB</div>
                            <div id="monDlg_diskUsageTriggerConfig">&ge; <input id="monDlg_diskUsageTriggerValueTextBox" class="right" type="text" size="4" maxlength="4" onkeyup="validateMonitoringPropertyDialog();"/> %</div>
                            <div id="monDlg_raidStatusTriggerConfig">upon failure</div>
                            <div id="monDlg_cpuTempTriggerConfig">&ge; <input id="monDlg_cpuTempTriggerValueTextBox" class="right" type="text" size="4" maxlength="4" onkeyup="validateMonitoringPropertyDialog();"/> &deg;C</div>
                            <div id="monDlg_cpuUsageTriggerConfig">&ge; <input id="monDlg_cpuUsageTriggerValueTextBox" class="right" type="text" size="4" maxlength="4" onkeyup="validateMonitoringPropertyDialog();"/> %</div>
                            <div id="monDlg_swapUsageTriggerConfig">&ge; <input id="monDlg_swapUsageTriggerValueTextBox" class="right" type="text" size="7" maxlength="7" onkeyup="validateMonitoringPropertyDialog();"/> MB</div>
                            <div id="monDlg_clockDriftTriggerConfig">&ge; <input id="monDlg_clockDriftTriggerValueTextBox" class="right" type="text" size="4" maxlength="4" onkeyup="validateMonitoringPropertyDialog();"/> sec</div>
                        </td>
                        <td><img id="monDlg_triggerValueWarningIcon" src="../images/warning.png"/></td>
                        <td><button id="monDlg_useDefaultTriggerValueButton" type="button" title="Reset to system-wide default">Use Default</button></td>
                    </tr>
                </table>
                <div class="noWrap">
                    <input type="checkbox" style="visibility: hidden;"/> <!-- For indentation only. -->
                    <input type="checkbox" style="visibility: hidden;"/> <!-- For indentation only. -->
                    <input id="monDlg_notificationEnabledCheckBox" type="checkbox"/> <label for="monDlg_notificationEnabledCheckBox">Enable notification</label>
                    &nbsp;<span id="monDlg_notificationDisabledWarning" class="note">(Note: All notifications are currently disabled in setup.)</span>
                </div>
            </div>
            <div class="fineRule"></div>
            <table class="spaced">
                <tr>
                    <th class="top">Notification Rules:</th>
                    <td class="note">
                        <div class="note">Select the rules to use (Ctrl-Click for multiple).</div>
                        <div class="note">The selected rules apply to the entire cluster and its nodes.</div>
                        <select id="monDlg_notificationRulesListBox" multiple="multiple" size="5" style="width: 100%">
                        </select>
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
                </wicket:extend>

            </div>
            <div class="statusBar">
                <table>
                    <tr>
                        <td width="100%">Time Zone: Canada/Pacific (GMT-08:00/<b>-07:00</b>)</td>
                        <td><a class="nowrap" href="http://www.layer7tech.com" target="_blank">Layer 7 Technologies Inc.</a></td>
                    </tr>
                </table>
            </div>
            <div class="divider"><img src="../images/spacer.png" alt="" /></div>
        </td>
    </tr>
</table>
</body>
</html>
