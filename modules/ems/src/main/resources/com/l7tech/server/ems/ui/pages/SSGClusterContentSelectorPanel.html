<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- PROTOTYPE ONLY BEGIN -->
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <!-- PROTOTYPE ONLY END -->
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Gateway Cluster Content Selector [Enterprise Service Manager]</title>
    <link rel="stylesheet" href="../css/l7.css" media="all" type="text/css" />

    <wicket:head>
    <!-- Required YUI modules: buton, connection, container, dom, event, json, logger, menu -->
    <link rel="stylesheet" type="text/css" href="../yui/assets/skins/sam/skin.css"/>
    <script type="text/javascript" src="../yui/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="../yui/connection/connection-min.js"></script>
    <script type="text/javascript" src="../yui/container/container-min.js"></script>
    <script type="text/javascript" src="../yui/menu/menu-min.js"></script>
    <script type="text/javascript" src="../yui/element/element-min.js"></script>
    <script type="text/javascript" src="../yui/button/button-min.js"></script>
    <script type="text/javascript" src="../yui/json/json-min.js"></script>
    <script type="text/javascript" src="../yui/logger/logger-min.js"></script>

    <link rel="stylesheet" type="text/css" href="../css/l7-yui-skin.css"/> <!-- modifies YUI sam skin; must come after YUI CSS files -->
    <script type="text/javascript" src="../js/l7.js"></script>
    <script type="text/javascript" src="../js/entityTreeTable.js"></script>
    <script type="text/javascript">
        function initContentEntityTree( id, data, selectedIds, callback, highlightableEntities, entitiesWithTristateCheckbox, entitiesWithRadioButton ) {

            /** Localized strings for passing into l7.EntityTreeTable constructor. */
            var entityTreeTableLocalizedStrings = {
                ENTITY_DATA_ERROR : 'Data error.',
                SERVICE_FOLDER : 'folder',
                PUBLISHED_SERVICE : 'published service',
                PUBLISHED_SERVICE_ALIAS : 'published service alias',
                OPERATION : 'operation',
                POLICY_FRAGMENT : 'policy fragment',
                POLICY_FRAGMENT_ALIAS : 'policy fragment alias'
            };

            /** Localized strings for local HTML markups, e.g., error dialogs. */
            var localizedStrings = {
                ACCESSING_SERVER : 'Accessing server...',
                OK : 'OK',
                ERROR : 'Error',
                SESSION_TIMEOUT : 'Your session has expired.',
                CANNOT_PARSE_RESPONSE_JSON : 'Malformed response from server.',
                CANNOT_DOWNLOAD_ENTITY_DATA : 'Unable to retrieve array of Gateway Cluster entities from the server.'
            };

            /**
             * The enterprise tree table object.
             * @type l7.EntityTreeTable
             */
            var entityTreeTable;

            /**
             * The TBODY element inside the entity tree table.
             * @type HTMLTableSectionElement
             */
            var entityTreeTableBody;

            /**
             * Is the entity selection callback enabled?
             */
            var entitySelectionCallbackEnabled = true;

            /**
             * (Re)loads the content of the entity tree table.
             */
            function loadSsgClusterContent() {
                entityTreeTable.setHighlightableEntities(highlightableEntities);
                entityTreeTable.setEntitiesWithTristateCheckbox(entitiesWithTristateCheckbox);
                entityTreeTable.setEntitiesWithRadioButton(entitiesWithRadioButton);

                var isMessage = false; // nested if since amp causes issues
                if ( data.message != undefined ) {
                    if ( data.message != null ) {
                        isMessage = true;
                    }
                }

                if ( l7.Util.isException( data ) ) {
                    entityTreeTable.displayDataError();
                } else if ( isMessage ) {
                    entityTreeTable.displayDataError(data.message);
                } else {
                    var entities = data;
                    entityTreeTable.load(entities);
                    entityTreeTable.collapseAll();

                    if ( selectedIds ) {
                        var item;
                        entitySelectionCallbackEnabled = false; // disable during reload of selections
                        for ( item in selectedIds ) {
                            if ( entitiesWithTristateCheckbox ) {
                                entityTreeTable.setEntityTristateCheckboxState( selectedIds[item], true );
                            } else {
                                entityTreeTable.setEntityRadioButtonState( selectedIds[item], true );
                            }
                            entityTreeTable.expandAncestorsOf( selectedIds[item] );
                        }
                        entitySelectionCallbackEnabled = true;
                    }
                }
            }

            /**
             * Initializes the enterprise tree table instance; but does not populate it.
             * Nor is there any tri-state checkbox, radio button, etc. Parent window
             * should call getEntityTreeTable() and add those elements that it needs.
             */
            function initEntityTreeTable() {
                var config = {
                    localizedStrings : entityTreeTableLocalizedStrings,
                    columns : [
                        l7.EntityTreeTable.COLUMN.NAME,
                        l7.EntityTreeTable.COLUMN.TYPE
                    ],
                    highlightableEntities : highlightableEntities,

                    onEntityHighlighted : function(previous, entity){ callback(entity.id, entity.type, "highlighted"); },
                    onClickEntityTristateCheckbox : function(event, entity){ if (entitySelectionCallbackEnabled) callback(entity.id, entity.type, "selected"); },
                    onClickEntityRadioButton : function(event, entity){ if (entitySelectionCallbackEnabled) callback(entity.id, entity.type, "selected"); }
                };
                entityTreeTable = new l7.EntityTreeTable(entityTreeTableBody, [] /* no entities initially */, '../images', config);

                loadSsgClusterContent();
            }

            entityTreeTableBody = document.getElementById(id);
            initEntityTreeTable();
        }
    </script>
    </wicket:head>
</head>
<body class="dataIFrame yui-skin-sam">
    <wicket:panel>
        <table class="dataTable" width="100%">
            <thead>
                <tr>
                    <th class="name" width="100%">Name<br /><img src="../images/spacer.png" alt="" height="0" width="140" /><!-- minimum width --></th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody wicket:id="entityTreeTableBody">
            </tbody>
        </table>
        <script wicket:id="tableScript" type="text/javascript"></script>
    </wicket:panel>
</body>
</html>
