<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- PROTOTYPE ONLY BEGIN -->
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <!-- PROTOTYPE ONLY END -->
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Gateway Cluster Selector [Enterprise Service Manager]</title>
    <link rel="stylesheet" href="../css/l7.css" media="all" type="text/css" />

    <wicket:head>
    <!-- Required YUI modules: button, connection, container, dom, event, json, logger, menu -->
    <link rel="stylesheet" type="text/css" href="../yui/assets/skins/sam/skin.css"/>
    <script type="text/javascript" src="../yui/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="../yui/connection/connection-min.js"></script>
    <script type="text/javascript" src="../yui/container/container-min.js"></script>
    <script type="text/javascript" src="../yui/menu/menu-min.js"></script>
    <script type="text/javascript" src="../yui/element/element-min.js"></script>
    <script type="text/javascript" src="../yui/button/button-min.js"></script>
    <script type="text/javascript" src="../yui/json/json-min.js"></script>
    <script type="text/javascript" src="../yui/logger/logger-min.js"></script>

    <link rel="stylesheet" type="text/css" href="../css/l7-yui-skin.css"/> <!-- modifies YUI sam skin; must come after YUI CSS files -->
    <script type="text/javascript" src="../js/l7.js"></script>
    <script type="text/javascript" src="../js/entityTreeTable.js"></script>
    <script type="text/javascript">
        /**
         * Initializes an enterprise tree table instance; and populates it.
         */
        function initEntityTreeTable( id, data, selectedId, callback ) {
            var entityTreeTableBody = document.getElementById(id);

            var entityTreeTableLocalizedStrings = {
                ENTITY_DATA_ERROR : 'Data error.',
                SSG_CLUSTER_STATE_UP : 'Up',
                SSG_CLUSTER_STATE_PARTIAL : 'Partial',
                SSG_CLUSTER_STATE_DOWN : 'Down',
                SSG_NODE_STATE_ON : 'On',
                SSG_NODE_STATE_OFF : 'Off',
                SSG_NODE_STATE_DOWN : 'Down',
                SSG_NODE_STATE_OFFLINE : 'Offline',
                ACCESS_ACCOUNT_IS_SET : 'Gateway user account is mapped. Click to change gateway user account.',
                ACCESS_ACCOUNT_CAN_SET : 'No gateway user account is mapped. Click to map gateway user account.',
                ACCESS_ACCOUNT_CANNOT_CHANGE : 'Gateway user account is mapped. Trust must be established before changing gateway user account.',
                ACCESS_ACCOUNT_CANNOT_SET : 'No gateway user account is mapped. Trust must be established before mapping gateway user account.',
                ACCESS_GRANTED : 'Role with access permission assigned',
                ACCESS_NOT_GRANTED : 'Role with access permission not assigned',
                ENTERPRISE_FOLDER : 'folder',
                SSG_CLUSTER : 'Gateway Cluster'
            };

            /** Localized strings for local HTML markups, e.g., error dialogs. */
            var localizedStrings = {
                OK : 'OK',
                ERROR : 'Error',
                SESSION_TIMEOUT : 'Your session has expired.',
                CANNOT_PARSE_RESPONSE_JSON : 'Malformed response from server.',
                CANNOT_DOWNLOAD_ENTITY_DATA : 'Unable to retrieve array of enterprise entities from the server.',
                CANNOT_PARSE_ENTITY_DATA : 'Unable to parse array of enterprise entities retrieved from the server: '
            };

            var config = {
                localizedStrings : entityTreeTableLocalizedStrings,
                columns : [
                    l7.EntityTreeTable.COLUMN.NAME,
                    l7.EntityTreeTable.COLUMN.ONLINE_STATUS,
                    l7.EntityTreeTable.COLUMN.TRUST_STATUS,
                    l7.EntityTreeTable.COLUMN.ACCESS_STATUS
                ],
                highlightableEntities : [
                    l7.Constants.ENTITY_TYPE.SSG_CLUSTER
                ],
                onEntityHighlighted : function(previous, ssgCluster, callbackId){ callback(ssgCluster.id, "selected"); },
                onClickTrustDialogButton : function(event, entity, callbackId){ callback(entity.id, "trust"); },
                onClickAccessDialogButton : function(event, entity, callbackId){ callback(entity.id, "access"); }
            };

            var entityTreeTable = new l7.EntityTreeTable(entityTreeTableBody, [], '../images', config);

            var isMessage = false; // nested if since amp causes issues
            if ( data.message != undefined ) {
                if ( data.message != null ) {
                    isMessage = true;
                }
            }

            // populate the table
            if (l7.Util.isException( data )) {
                l7.Dialog.showExceptionDialog(data, localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_ENTITY_DATA, localizedStrings.OK);
                entityTreeTable.displayDataError();
            } else if ( isMessage ) {
                entityTreeTable.displayDataError(data.message);
            } else {
                entityTreeTable.load(data);

                if ( selectedId ) {
                    entityTreeTable.highlightEntity( selectedId, false );
                }
            }
        }
    </script>
    </wicket:head>
</head>
<body>
<wicket:panel>
    <div class="dataIFrame yui-skin-sam">
        <table class="dataTable" width="100%">
            <thead>
                <tr>
                    <th class="name" width="100%">Name<br /><img src="../images/spacer.png" alt="" height="0" width="140" /><!-- minimum width --></th>
                    <th><img src="../images/status.png" title="Online Status" alt="" /></th>
                    <th><img src="../images/trust.png" title="Trust Status" alt="" /></th>
                    <th><img src="../images/accessAccount.png" title="Access Account" alt="" /></th>
                </tr>
            </thead>
            <tbody wicket:id="entityTreeTableBody">
            </tbody>
        </table>
    </div>
    <script wicket:id="tableScript" type="text/javascript"></script>
</wicket:panel>
</body>
</html>
