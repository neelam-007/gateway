<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- PROTOTYPE ONLY BEGIN -->
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <!-- PROTOTYPE ONLY END -->
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Standard Reports [Enterprise Service Manager]</title>
    <link rel="stylesheet" type="text/css" href="../css/l7.css" />

    <wicket:head>
    <!-- Required YUI modules: button, connection, event, json, logger -->
    <link rel="stylesheet" type="text/css" href="../yui/assets/skins/sam/skin.css">
    <script type="text/javascript" src="../yui/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="../yui/element/element-beta-min.js"></script>
    <script type="text/javascript" src="../yui/button/button-min.js"></script>
    <script type="text/javascript" src="../yui/calendar/calendar-min.js"></script>
    <script type="text/javascript" src="../yui/connection/connection-min.js"></script>
    <script type="text/javascript" src="../yui/container/container-min.js"></script>
    <script type="text/javascript" src="../yui/json/json-min.js"></script>
    <script type="text/javascript" src="../yui/logger/logger-min.js"></script>

    <link rel="stylesheet" type="text/css" href="../css/l7-yui-skin.css" /> <!-- modifies YUI sam skin; must come after YUI CSS files -->
    <style type="text/css">
        .note {
            font-size: 90%;
            margin-left: 8px;
            vertical-align: middle;
        }
    </style>
    <script type="text/javascript" src="../js/l7.js"></script>
    <script type="text/javascript" src="../js/entityTreeTable.js"></script>
    <script type="text/javascript">
        /** Localized strings for local HTML markups, e.g., error dialogs. */
        var localizedStrings = {
            REPORT_TYPE_PERFORMANCE : 'Performance Statistics',
            REPORT_TYPE_USAGE : 'Usage Report',
            SAVE_DEFAULT_BUTTON_LABEL : 'Save Settings as Default for &ldquo;REPORT_TYPE&rdquo;',
            PUBLISHED_SERVICE_S : 'Published Service(s)',
            OPERATION_S : 'Operation(s)',
            ADD_ENTITY_BUTTON_LABEL : 'Add Checked ENTITY_TYPE',
            OK : 'OK',
            CANCEL : 'Cancel',
            ERROR : 'Error',
            CANNOT_PARSE_RESPONSE_JSON : 'Malformed response from server: ',
            CANNOT_DOWNLOAD_SAVED_SETTINGS : 'Failed to download list of saved settings: ',
            CANNOT_DOWNLOAD_MESSAGE_CONTEXT_LIST : 'Failed to download list of message context for the selected SSG Clusers: ',
            SSG_CLUSTER_NOT_APPLICABLE : 'None of the selected entities belong to this SSG Cluster. Please delete, or, refresh and reselect.',
            STANDARD_MESSAGE_CONTEXT_MAPPING : 'Standard Mapping',
            CUSTOM_MESSAGE_CONTEXT_MAPPING : 'Custom Mapping',
            RELATIVE_TIME_PERIOD_HINT : 'Must be positive integer',
            ABSOLUTE_TIME_PERIOD_HINT : 'From time must be earlier than To time',
            TIME_INTERVAL_HINT : 'Must be positive integer',
            NUM_GROUPING_HINT : 'There must be at least one message context grouping for Usage Report.',
            SUBMITTING_GENERATE_REPORT : 'Submitting standard report generation',
            CANNOT_SUBMIT_GENERATE_REPORT : 'Failed to submit standard report generation: '
        }
    </script>
    <script type="text/javascript">
        var ReportType = {
            PERFORMANCE : 'performance',
            USAGE       : 'usage'
        };

        var TimePeriodType = {
            RELATIVE : 'relative',
            ABSOLUTE : 'absolute'
        };

        var loadSettingsButton;
        var saveSettingsButton;
        var manageSettingsButton;
        var saveDefaultButton;
        var addEntityButton;
        var addGroupingButton;
        var generateButton;
        var downloadOutputButton;
        var deleteOutputButton;

        var relativeTimePeriodRadioButton;
        var absoluteTimePeriodRadioButton;
        var hasTimeIntervalRadioButton;
        var noTimeIntervalRadioButton;
        var publishedServiceRadioButton;
        var operationRadioButton;

        var summaryChartCheckBox;

        var relativeTimePeriodTextBox;
        var relativeTimePeriodHint;
        var absoluteTimePeriodFromDateTextBox;
        var absoluteTimePeriodToDateTextBox;
        var absoluteTimePeriodHint;
        var timeIntervalTextBox;
        var timeIntervalHint;
        var groupingHint;
        var reportNameTextBox;

        var savedSettingsDropDown;
        var reportTypeDropDown;
        var relativeTimePeriodUnitDropDown;
        var absoluteTimePeriodFromHourDropDown;
        var absoluteTimePeriodToHourDropDown;
        var timePeriodTimeZoneDropDown;
        var timeIntervalUnitDropDown;

        var ssgClusterSelectorWindow;
        var ssgClusterContentSelectorWindow;

        var entitySelectionTableBody;
        var groupingTableBody;

        /**
         * List of saved settings available to choose from.
         * @type array
         */
        var savedSettings;

        /**
         * Current date values
         */
        var absoluteTimePeriodFromDate;
        var absoluteTimePeriodToDate;

        /**
         * Array of SSG Cluster entity object literals that have entities selected.
         * May be empty but never null.
         * @type array
         */
        var ssgClustersWithSelectedEntities = [];

        /**
         * Set of SSG Cluster IDs in ssgClustersWithSelectedEntities.
         * May be empty but never null.
         * For fast lookup by testing ssgClusterIdsWithSelectedEntities[id] != undefined.
         * @type object
         */
        var ssgClusterIdsWithSelectedEntities = {};

        /**
         * List of message context object literals.
         * @type array
         */
        var availableMessageContext;

        /**
         * Verifies if relative time period input is valid.
         * @return {boolean} true if valid
         */
        function validateRelativeTimePeriod() {
            var valid = false;
            if (relativeTimePeriodRadioButton.checked) {
                var timePeriod = relativeTimePeriodTextBox.value;
                valid = l7.Util.isIntString(timePeriod) && timePeriod >= 0;
            } else if (absoluteTimePeriodRadioButton.checked) {
                valid = true;
            }
            return valid;
        }

        /**
         * Verifies if absolute time period input is valid.
         * @return {boolean} true if valid
         */
        function validateAbsoluteTimePeriod() {
            var valid = false;
            if (relativeTimePeriodRadioButton.checked) {
                valid = true;
            } else if (absoluteTimePeriodRadioButton.checked) {
                if (absoluteTimePeriodFromDate == absoluteTimePeriodToDate) {
                    var fromHour = absoluteTimePeriodFromHourDropDown.value;
                    var toHour = absoluteTimePeriodToHourDropDown.value;
                    valid = fromHour < toHour;
                } else {
                    valid = true;
                }
            }
            return valid;
        }

        /**
         * Verifies if time period input is valid.
         * @return {boolean} true if valid
         */
        function validateTimePeriod() {
            return timePeriodTimeZoneDropDown.value != '' && validateRelativeTimePeriod() && validateAbsoluteTimePeriod();
        }

        /**
         * Verifies if time interval input is valid.
         * @return {boolean} true if valid
         */
        function validateTimeInterval() {
            var valid = false;
            if (noTimeIntervalRadioButton.checked) {
                valid = true;
            } else if (hasTimeIntervalRadioButton.checked) {
                var timeInterval = timeIntervalTextBox.value;
                valid = l7.Util.isIntString(timeInterval) && timeInterval >= 0;
            }
            return valid;
        }

        /**
         * Verifies if a grouping is valid and raise or clear any warning UI.
         * It is valid if the SSG Cluster has entities selected.
         * @return {boolean} true if valid
         */
        function validateGrouping(tr) {
            var ssgClusterDropDown = tr._ssgClusterDropDown;
            var valid = false;
            for (var j = 0; j < ssgClustersWithSelectedEntities.length; ++j) {
                if (ssgClustersWithSelectedEntities[j].id == ssgClusterDropDown.value) {
                    valid = true;
                    break;
                }
            }
            tr._warningImg.style.display = valid ? 'none' : '';
            return valid;
        }

        /**
         * Verifies if all groupings are valid and raise or clear any warning UI.
         * @return {boolean} true if valid
         */
        function validateGroupings() {
            var valid = true;
            var trs = groupingTableBody.rows;
            for (var i = 0; i < trs.length; ++i) {
                var tr = trs[i];
                valid = valid && validateGrouping(tr);
            }

            if (reportTypeDropDown.value == ReportType.USAGE &&
                getEntityType() == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE &&
                trs.length == 0) {
                groupingHint.innerHTML = '(' + localizedStrings.NUM_GROUPING_HINT + ')';
                valid = false;
            } else {
                groupingHint.innerHTML = '';
            }

            return valid;
        }

        /**
         * Verifies if all settings input fields are valid.
         * @return {boolean} true if valid
         */
        function validateSettings() {
            var valid = validateGroupings();
            return valid &&
                   entitySelectionTableBody.rows.length > 0 &&
                   validateTimePeriod() &&
                   validateTimeInterval() &&
                   reportNameTextBox.value.search(/\S/) != -1;
        }

        /**
         * Updates ssgClustersWithSelectedEntities and ssgClusterIdsWithSelectedEntities.
         * Should be called upon change in selected entities.
         */
        function updateSsgClustersWithSelectedEntities() {
            ssgClustersWithSelectedEntities = [];
            ssgClusterIdsWithSelectedEntities = {};
            for (var i = 0; i < entitySelectionTableBody.rows.length; ++i) {
                var ssgCluster = entitySelectionTableBody.rows[i]._ssgCluster;
                if (!l7.Util.arrayContains(ssgClustersWithSelectedEntities, ssgCluster)) {
                    ssgClustersWithSelectedEntities.push(ssgCluster);
                    ssgClusterIdsWithSelectedEntities[ssgCluster.id] = ssgCluster.id;
                }
            }

        }

        function updateAddGroupingButton() {
            addGroupingButton.set('disabled', ssgClustersWithSelectedEntities.length == 0);
        }

        /**
         * Enables/Disables each SSG Cluster in a drop down list based on
         * whether it contains selected entities.
         * @param {HTMLSelectElement} dropDown
         */
        function updateGroupingSsgClusterDropDown(dropDown) {
            for (var i = 0; i < dropDown.options.length; ++i) {
                var option = dropDown.options[i];
                var ssgClusterId = option.value;
                option.disabled = ssgClusterIdsWithSelectedEntities[ssgClusterId] == undefined;
            }
        }

        function updateGroupingSsgClusterDropDowns() {
            var trs = groupingTableBody.rows;
            for (var i = 0; i < trs.length; ++i) {
                var tr = trs[i];
                var dropDown = tr._ssgClusterDropDown;
                updateGroupingSsgClusterDropDown(dropDown);
            }
        }

        function updateSaveSettingsButton() {
            saveSettingsButton.set('disabled', !validateSettings());
        }

        function updateSaveDefaultButton() {
            var selected = reportTypeDropDown.options[reportTypeDropDown.selectedIndex];
            saveDefaultButton.set('label', localizedStrings.SAVE_DEFAULT_BUTTON_LABEL.replace('REPORT_TYPE', selected.text));
            saveDefaultButton.set('disabled', !validateSettings());
        }

        function updateGenerateButton() {
            generateButton.set('disabled', !validateSettings());
        }

        function onChangeReportType() {
            updateSaveSettingsButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        function onChangeEntityType() {
            refreshSsgClusterContentSelector();

            // Clears out all entity selections because they would now be the wrong type.
            while (entitySelectionTableBody.rows.length > 0) {
                entitySelectionTableBody.deleteRow(-1);
            }
            updateSsgClustersWithSelectedEntities();
            // and all groupings
            while (groupingTableBody.rows.length > 0) {
                groupingTableBody.deleteRow(-1);
            }

            // Updates the add button.
            var entityTypeText;
            var entityType = getEntityType();
            if (entityType == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE) {
                entityTypeText = localizedStrings.PUBLISHED_SERVICE_S;
            } else if (entityType == l7.EntityTreeTable.ENTITY.OPERATION) {
                entityTypeText = localizedStrings.OPERATION_S;
            }
            addEntityButton.set('label', localizedStrings.ADD_ENTITY_BUTTON_LABEL.replace('ENTITY_TYPE', entityTypeText));

            updateAddGroupingButton();
            updateSaveSettingsButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        function onChangeSelectedEntities() {
            updateSsgClustersWithSelectedEntities();
            loadAvailableMessageContext();
            updateAddGroupingButton();
            updateGroupingSsgClusterDropDowns();
            validateGroupings();
            updateSaveSettingsButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        function onChangeRelativeTimePeriod() {
            if (validateRelativeTimePeriod()) {
                l7.Util.removeClass(relativeTimePeriodTextBox, 'invalid');
                relativeTimePeriodHint.innerHTML = '';
            } else {
                l7.Util.addClass(relativeTimePeriodTextBox, 'invalid');
                relativeTimePeriodHint.innerHTML = '(' + localizedStrings.RELATIVE_TIME_PERIOD_HINT + ')';
            }
            updateSaveSettingsButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        function onChangeAbsoluteTimePeriodFromDate() {
            // TODO set mindate of To calendar
            onChangeAbsoluteTimePeriod();
        }

        function onChangeAbsoluteTimePeriodToDate() {
            // TODO set maxdate of From calendar
            onChangeAbsoluteTimePeriod();
        }

        function onChangeAbsoluteTimePeriod() {
            if (validateAbsoluteTimePeriod()) {
                absoluteTimePeriodHint.innerHTML = '';
            } else {
                absoluteTimePeriodHint.innerHTML = '(' + localizedStrings.ABSOLUTE_TIME_PERIOD_HINT + ')';
            }
            updateSaveSettingsButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        function onChangeTimePeriodType() {
            var isRelative = relativeTimePeriodRadioButton.checked;
            relativeTimePeriodTextBox.disabled = !isRelative;
            relativeTimePeriodUnitDropDown.disabled = !isRelative;

            var isAbsolute = absoluteTimePeriodRadioButton.checked;
            absoluteTimePeriodFromDateTextBox.disabled = !isAbsolute;
            absoluteTimePeriodFromHourDropDown.disabled = !isAbsolute;
            absoluteTimePeriodToDateTextBox.disabled = !isAbsolute;
            absoluteTimePeriodToHourDropDown.disabled = !isAbsolute;

            onChangeRelativeTimePeriod();
            onChangeAbsoluteTimePeriod();
        }

        function onChangeTimeInterval() {
            if (validateTimeInterval()) {
                l7.Util.removeClass(timeIntervalTextBox, 'invalid');
                timeIntervalHint.innerHTML = '';
            } else {
               l7.Util.addClass(timeIntervalTextBox, 'invalid');
                timeIntervalHint.innerHTML = '(' + localizedStrings.TIME_INTERVAL_HINT + ')';
            }
            
            timeIntervalTextBox.disabled = !hasTimeIntervalRadioButton.checked;
            timeIntervalUnitDropDown.disabled = !hasTimeIntervalRadioButton.checked;
            updateSaveSettingsButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        function onChangeGroupings() {
            updateSaveSettingsButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        function onChangeReportName() {
            updateSaveSettingsButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        function getTimePeriodType() {
            var result;
            if (relativeTimePeriodRadioButton.checked) {
                result = TimePeriodType.RELATIVE;
            } else if (absoluteTimePeriodRadioButton.checked) {
                result = TimePeriodType.ABSOLUTE;
            }
            return result;
        }

        function setTimePeriodType(type) {
            if (type == TimePeriodType.RELATIVE) {
                relativeTimePeriodRadioButton.checked = true;
            } else if (type == TimePeriodType.ABSOLUTE) {
                absoluteTimePeriodRadioButton.checked = true;
            }
        }

        /**
         * Populates the input fields given a settings.
         * @param {object} settings     object literal for a settings; see http://sarek/mediawiki/index.php?title=Standard_Reports_Design#Generate_Report_.28browser_.26rarr.3B_server.29 for object structure
         */
        function setFieldsFromSettings(settings) {
            setReportType(settings.type);
            // TODO
        }

        /**
         * Returns a settings from the input fields.
         * @return {object} object literal for a settings; see http://sarek/mediawiki/index.php?title=Standard_Reports_Design#Generate_Report_.28browser_.26rarr.3B_server.29 for object structure
         */
        function getSettingsFromFields() {
            // TODO Encapsulate into a Settings class?
            var settings = {};
            settings.reportType = reportTypeDropDown.value;
            settings.entityType = getEntityType();
            settings.entities = [];
            for (var i = 0; i < entitySelectionTableBody.rows.length; ++i) {
                var tr = entitySelectionTableBody.rows[i];
                var entity = {};
                entity.clusterId = tr._ssgCluster.id;
                entity.publishedServiceId = tr._publishedService.id;
                entity.publishedServiceName = tr._publishedService.name;
                if (settings.entityType == 'operation') {
                    entity.operation = tr._operation;
                } else {
                    entity.operation = null;
                }
                settings.entities.push(entity);
            }
            settings.timePeriod = {};
            settings.timePeriod.timeZone = timePeriodTimeZoneDropDown.value;
            settings.timePeriod.type = getTimePeriodType();
            if (settings.timePeriod.type == TimePeriodType.RELATIVE) {
                settings.timePeriod.numberOfTimeUnits = relativeTimePeriodTextBox.value;
                settings.timePeriod.unitOfTime = relativeTimePeriodUnitDropDown.value;
            } else if (settings.timePeriod.type == TimePeriodType.ABSOLUTE) {
                var fromDate = new Date();
                fromDate.setTime(Date.parse(absoluteTimePeriodFromDate));
                var fromHour = absoluteTimePeriodFromHourDropDown.value;
                settings.timePeriod.start = l7.Util.formatDate(fromDate, 'yyyy/MM/dd') + ' ' + l7.Util.formatInteger(fromHour, 2) + ':00';
                var toDate = new Date();
                toDate.setTime(Date.parse(absoluteTimePeriodToDate));
                var toHour = absoluteTimePeriodToHourDropDown.value;
                settings.timePeriod.end = l7.Util.formatDate(toDate, 'yyyy/MM/dd') + ' ' + l7.Util.formatInteger(toHour, 2) + ':00';
            }
            if (noTimeIntervalRadioButton.checked) {
                settings.timeInterval = null;
            } else if (hasTimeIntervalRadioButton.checked) {
                settings.timeInterval = {};
                settings.timeInterval.value = timeIntervalTextBox.value;
                settings.timeInterval.unit = timeIntervalUnitDropDown.value;
            }
            settings.groupings = [];
            for (i = 0; i < groupingTableBody.rows.length; ++i) {
                tr = groupingTableBody.rows[i];
                var grouping = {};
                grouping.clusterId = tr._ssgClusterDropDown.value;
                grouping.messageContextKey = tr._messageContextDropDown.value;
                grouping.constraint = tr._constraintTextBox.value;
                settings.groupings.push(grouping);
            }
            settings.summaryChart = summaryChartCheckBox.checked;
            settings.summaryReport = noTimeIntervalRadioButton.checked;
            settings.reportName = reportNameTextBox.value;
            return settings;
        }

        function loadSavedSettingsDropDown() {
            var callback = {
                success : function(o) {
                    var result = l7.Dialog.parseJSON(
                            o.responseText,
                            localizedStrings.ERROR,
                            '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_DOWNLOAD_SAVED_SETTINGS) + '</p>',
                            localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                            localizedStrings.OK);
                    if (!l7.Util.isException(result)) {
                        savedSettings = result;
                        while (savedSettingsDropDown.length > 0) {
                            savedSettingsDropDown.remove(0);
                        }
                        for (var i = 0; i < result.length; ++i) {
                            var option = document.createElement('option');
                            option.value = savedSettings[i].id
                            option.innerHTML = savedSettings[i].name;
                            savedSettingsDropDown.appendChild(option); // Note: HTMLSelectElement.add(option, null) doesn't work in IE7.
                        }
                        loadSettingsButton.set('disabled', savedSettingsDropDown.length == 0);
                    }
                },
                failure : function(o) {
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_SAVED_SETTINGS + o.statusText, localizedStrings.OK);
                }
            };
            var url = 'dataSource/standardReport/savedSettings.json';
            YAHOO.util.Connect.asyncRequest('GET', url, callback, null);
        }

        /**
         * @param {string} type     a ReportType value
         */
        function setReportType(type) {
            for (var i = 0; i < reportTypeDropDown.options.length; ++i) {
                if (reportTypeDropDown.options[i].value == type) {
                    reportTypeDropDown.selectedIndex = i;
                }
            }
            onChangeReportType();
        }

        function getEntityType() {
            var result;
            if (publishedServiceRadioButton.checked) {
                result = l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE;
            } else if (operationRadioButton.checked) {
                result = l7.EntityTreeTable.ENTITY.OPERATION;
            } else {
                YAHOO.log('Unexpected entity type selection.', 'error', 'StandardReports.html showSsgClusterContent')
            }
            return result;
        }

        function refreshSsgClusterSelector() {
            ssgClusterSelectorWindow.loadEntityTreeTable();
        }

        function refreshSsgClusterContentSelector() {
            var ssgCluster = ssgClusterSelectorWindow.getEntityTreeTable().getHighlightedEntity();
            var entityType = getEntityType();
            ssgClusterContentSelectorWindow.loadSsgClusterContent(ssgCluster, [entityType], null);
        }

        /**
         * Callback function upon an SSG Cluster highlighted.
         * @param {object} previous     the previously highlighted SSG Cluster entity object literal; null if none
         * @param {object} ssgCluster   the newly highlighted SSG Cluster entity object literal
         * @param {string} callbackId
         */
        function onHighlightSsgCluster(previous, ssgCluster, callbackId) {
            var entityType = getEntityType();
            ssgClusterContentSelectorWindow.loadSsgClusterContent(ssgCluster, [entityType], null);
        }

        /**
         * Downloads the list of message context applicable to the SSG Clusters with selected entities.
         */
        function loadAvailableMessageContext() {
            var callback = {
                success : function(o) {
                    var result = l7.Dialog.parseJSON(
                            o.responseText,
                            localizedStrings.ERROR,
                            '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_DOWNLOAD_MESSAGE_CONTEXT_LIST) + '</p>',
                            localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                            localizedStrings.OK);
                    if (!l7.Util.isException(result)) {
                        availableMessageContext = result;
                    }
                },
                failure : function(o) {
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_MESSAGE_CONTEXT_LIST + o.statusText, localizedStrings.OK);
                }
            };
            var postData = '';
            for (var i = 0; i < ssgClustersWithSelectedEntities.length; ++i) {
                if (i != 0) postData += '&';
                postData += 'clusterGuid=' + encodeURIComponent(ssgClustersWithSelectedEntities[i].id);
            }
            var url = jsonMappingUrl;
            YAHOO.util.Connect.asyncRequest('POST', url, callback, postData);
        }

        /**
         * @param {HTMLSelectElement} dropDown      the drop down list to populate
         */
        function populateGroupingSsgClusterDropDown(dropDown) {
            // Saves selected value, if any, to be restored once repopulated.
            var prevValue = null;
            if (dropDown.options.length > 0) {
                prevValue = dropDown.value;
            }

            // Removes all.
            while (dropDown.options.length > 0) {
                dropDown.remove(0);
            }

            // Populates the drop down list with each available SSG Cluster.
            var entities = ssgClusterSelectorWindow.getEntityTreeTable().getEntities();
            if ( entities ) {
                for (var i = 0; i < entities.length; ++i) {
                    var entity = entities[i];
                    if (entity.type == l7.EntityTreeTable.ENTITY.SSG_CLUSTER) {
                        var option = document.createElement('option');
                        option.value = entity.id;
                        if ( entity.ancestors ) {
                            option.innerHTML = entity.ancestors.join(' / ') + ' / ' +  entity.name;
                        } else {
                            option.innerHTML = entity.name;
                        }
                        option.disabled = ssgClusterIdsWithSelectedEntities[option.value] == undefined;
                        dropDown.appendChild(option);
                        if (option.value == prevValue) {
                            dropDown.selectedIndex = option.index; // Restores previously selected SSG Cluster.
                        }
                        // The disabled attribute does not work properly in IE7. We have to
                        // manually set default selection to the first enabled OPTION.
                        if (prevValue == null) {
                            if (ssgClusterIdsWithSelectedEntities[dropDown.value] == undefined) {
                                dropDown.selectedIndex = option.index;
                            }
                        }
                    }
                }
            }
        }

        /**
         * @param {HTMLSelectElement} dropDown      the drop down list to populate
         * @param {string} ssgClusterId
         */
        function populateGroupingMessageContextDropDown(dropDown, ssgClusterId) {
            while (dropDown.childNodes.length > 0) {
                dropDown.removeChild(dropDown.childNodes[0]);
            }
            for (var i = 0; i < availableMessageContext.length; ++i) {
                var messageContext = availableMessageContext[i];
                if (messageContext.id == ssgClusterId) {
                    var optGroup = document.createElement('optgroup');
                    optGroup.label = localizedStrings.STANDARD_MESSAGE_CONTEXT_MAPPING;
                    dropDown.appendChild(optGroup);
                    for (var j = 0; j < messageContext.standard.length; ++j) {
                        var option = document.createElement('option');
                        option.value = messageContext.standard[j];
                        option.innerHTML = messageContext.standard[j];
                        optGroup.appendChild(option);
                    }

                    if (messageContext.custom.length > 0) {
                        optGroup = document.createElement('optgroup');
                        optGroup.label = localizedStrings.CUSTOM_MESSAGE_CONTEXT_MAPPING;
                        dropDown.appendChild(optGroup);
                        for (j = 0; j < messageContext.custom.length; ++j) {
                            option = document.createElement('option');
                            option.value = messageContext.custom[j];
                            option.innerHTML = messageContext.custom[j];
                            optGroup.appendChild(option);
                        }
                    }

                    break;
                }
            }
        }

        function onClickLoadSettings() {
            setFieldsFromSettings(savedSettings[savedSettingsDropDown.selectedIndex]);
            // TODO
            l7.Dialog.showErrorDialog(null, 'Not Implemented yet!', null);
        }

        function onClickSaveSettings() {
            // TODO
            l7.Dialog.showErrorDialog(null, 'Not Implemented yet!', null);
        }

        function onClickManageSettings() {
            // TODO
            l7.Dialog.showErrorDialog(null, 'Not Implemented yet!', null);
        }

        function onClickSaveDefault() {
            // TODO
            l7.Dialog.showErrorDialog(null, 'Not Implemented yet!', null);
        }

        function onClickAddEntity() {
            var ssgCluster = ssgClusterContentSelectorWindow.getSsgCluster();
            var entities = ssgClusterContentSelectorWindow.getEntityTreeTable().getEntitiesWithTristateCheckboxSelected();

            for (var i = 0; i < entities.length; ++i) {
                var entity = entities[i];

                // Skips this if already added.
                var alreadyAdded = false;
                var trs = entitySelectionTableBody.rows;
                for (var j = 0; j < trs.length; ++j) {
                    if (trs[j]._entity == entity) {
                        alreadyAdded = true;
                    }
                }
                if (alreadyAdded) {
                    continue;
                }

                var tr = entitySelectionTableBody.insertRow(-1);
                tr._ssgCluster = ssgCluster;    // Stash away for later retrieval.
                tr._entity = entity;
                var td;

                // Delete button column.
                var img = document.createElement('img');
                img.src = '../images/delete.png';
                img.className = 'clickable';
                YAHOO.util.Event.addListener(img, 'click', onClickDeleteEntity, tr);
                td = tr.insertCell(-1);
                td.appendChild(img);

                // SSG Cluster column.
                td = tr.insertCell(-1);
                if (ssgCluster.ancestors != undefined) {
                    td.innerHTML = ssgCluster.ancestors.join(' / ') + ' / ' + ssgCluster.name;
                } else {
                    td.innerHTML = ssgCluster.name;
                }

                // Published Service column.
                var publishedService;
                if (entity.type == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE) {
                    publishedService = entity;
                } else if (entity.type == l7.EntityTreeTable.ENTITY.OPERATION) {
                    publishedService = ssgClusterContentSelectorWindow.getEntityTreeTable().getParentEntity(entity);
                } else {
                    YAHOO.log('Invalid entity type: ' + entity.type, 'error', 'StandardReports.html onClickAddEntity')
                }
                td = tr.insertCell(-1);
                td.innerHTML = publishedService.name;
                tr._publishedService = publishedService;    // Stash away for later retrieval.

                // Operation column.
                td = tr.insertCell(-1);
                if (entity.type == l7.EntityTreeTable.ENTITY.OPERATION) {
                    td.innerHTML = entity.name;
                    tr._operation = entity.name;            // Stash away for later retrieval.
                } else {
                    td.className = 'notApplicable';
                }
            }

            onChangeSelectedEntities();
        }

        function onClickDeleteEntity(event, tr) {
            entitySelectionTableBody.removeChild(tr);
            onChangeSelectedEntities();
        }

        function onClickAddGrouping() {
            var tr = groupingTableBody.insertRow(-1);
            var td;

            // Delete button column.
            var deleteImg = document.createElement('img');
            deleteImg.src = '../images/delete.png';
            deleteImg.className = 'clickable';
            YAHOO.util.Event.addListener(deleteImg, 'click', onClickDeleteGrouping, tr);
            td = tr.insertCell(-1);
            td.appendChild(deleteImg);

            // SSG Cluster drop down list column.
            var ssgClusterDropDown = document.createElement('select');
            populateGroupingSsgClusterDropDown(ssgClusterDropDown);
            td = tr.insertCell(-1);
            td.appendChild(ssgClusterDropDown);
            // Warning icon; appears when the SSG Cluster selected in the drop down list
            // is not long part of selected entities.
            var warningImg = document.createElement('img');
            warningImg.src = '../images/warning.png';
            warningImg.className = 'middle';
            warningImg.title = localizedStrings.SSG_CLUSTER_NOT_APPLICABLE;
            warningImg.style.display = 'none';
            td.appendChild(warningImg);

            // Message context drop down list column.
            var messageContextDropDown = document.createElement('select');
            populateGroupingMessageContextDropDown(messageContextDropDown, ssgClusterDropDown.value);
            td = tr.insertCell(-1);
            td.appendChild(messageContextDropDown);
            YAHOO.util.Event.addListener(ssgClusterDropDown, 'change',
                function(event, tr) {
                    var ssgClusterDropDown = tr._ssgClusterDropDown;
                    var messageContextDropDown = tr._messageContextDropDown;
                    validateGrouping(tr);
                    populateGroupingMessageContextDropDown(messageContextDropDown, ssgClusterDropDown.value);
                },
                tr
            );

            // Constraint value column.
            var constraintTextBox = document.createElement('input');
            constraintTextBox.type = 'text';
            constraintTextBox.style.width = '95%'; // Any better solution?
            constraintTextBox.maxlength = '128';
            td = tr.insertCell(-1);
            td.appendChild(constraintTextBox);

            // Stashes the HTML element into the TR element for easy reference.
            tr._ssgClusterDropDown = ssgClusterDropDown;
            tr._messageContextDropDown = messageContextDropDown;
            tr._warningImg = warningImg;
            tr._constraintTextBox = constraintTextBox;

            onChangeGroupings();
        }

        function onClickDeleteGrouping(event, tr) {
            groupingTableBody.removeChild(tr);
            onChangeGroupings();
        }

        function onClickGenerate() {
            var callback = {
                success : function(o) {
                    l7.Dialog.hideWaitDialog();
                    var result = l7.Dialog.parseJSON(
                            o.responseText,
                            localizedStrings.ERROR,
                            '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_SUBMIT_GENERATE_REPORT) + '</p>',
                            localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                            localizedStrings.OK);
                    if (!l7.Util.isException(result)) {
                        // No return object expected.
                        l7.Dialog.showInfoDialog('Standard Report', 'Request for standard report has been submitted for generation.', localizedStrings.OK);
                    }
                },
                failure : function(o) {
                    l7.Dialog.hideWaitDialog();
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_SUBMIT_GENERATE_REPORT + o.statusText, localizedStrings.OK);
                }
            };
            var url = generateReportUrl;
            var settings = getSettingsFromFields();
            var postData = YAHOO.lang.JSON.stringify(settings);
            l7.Dialog.showWaitDialog(localizedStrings.SUBMITTING_GENERATE_REPORT + '...');
            YAHOO.util.Connect.setDefaultPostHeader(false);
            YAHOO.util.Connect.initHeader('Content-Type', 'application/json; charset=utf-8');
            YAHOO.util.Connect.asyncRequest('POST', url, callback, postData);
            YAHOO.util.Connect.setDefaultPostHeader(true);
        }

        function onClickDownloadOutput() {
            // TODO
            l7.Dialog.showErrorDialog(null, 'Not Implemented yet!', null);
        }

        function onClickDeleteOutput() {
            // TODO
            l7.Dialog.showErrorDialog(null, 'Not Implemented yet!', null);
        }

        function initButtons() {
            loadSettingsButton = new YAHOO.widget.Button('loadSettingsButton', {
                onclick : {fn : onClickLoadSettings},
                type : 'push'
            });
            saveSettingsButton = new YAHOO.widget.Button('saveSettingsButton', {
                onclick : {fn : onClickSaveSettings},
                type : 'push'
            });
            manageSettingsButton = new YAHOO.widget.Button('manageSettingsButton', {
                onclick : {fn : onClickManageSettings},
                type : 'push'
            });
            saveDefaultButton = new YAHOO.widget.Button('saveDefaultButton', {
                disabled : true,
                onclick : {fn : onClickSaveDefault},
                type : 'push'
            });
            addEntityButton = new YAHOO.widget.Button('addEntityButton', {
                onclick : {fn : onClickAddEntity},
                type : 'push'
            });
            addGroupingButton = new YAHOO.widget.Button('addGroupingButton', {
                onclick : {fn : onClickAddGrouping},
                type : 'push'
            });
            generateButton = new YAHOO.widget.Button('generateButton', {
                onclick : {fn : onClickGenerate},
                type : 'push'
            });
            downloadOutputButton = new YAHOO.widget.Button('downloadOutputButton', {
                onclick : {fn : onClickDownloadOutput},
                type : 'push'
            });
            deleteOutputButton = new YAHOO.widget.Button('deleteOutputButton', {
                onclick : {fn : onClickDeleteOutput},
                type : 'push'
            });
        }

        function initDialogs() {
            // No custom dialog yet.
        }

        function initSsgClusterSelector(iframe) {
            iframe.contentWindow.setEntityHighlightedCallback(onHighlightSsgCluster);
        }

        function initSsgClusterContentSelector(iframe) {
            // Nothing to do.
        }

        function init() {
            relativeTimePeriodRadioButton      = document.getElementById('relativeTimePeriodRadioButton');
            relativeTimePeriodTextBox          = document.getElementById('relativeTimePeriodTextBox');
            relativeTimePeriodHint             = document.getElementById('relativeTimePeriodHint');
            relativeTimePeriodUnitDropDown     = document.getElementById('relativeTimePeriodUnitDropDown');
            absoluteTimePeriodRadioButton      = document.getElementById('absoluteTimePeriodRadioButton');
            absoluteTimePeriodFromDateTextBox  = document.getElementById('absoluteTimePeriodFromDateTextBox');
            absoluteTimePeriodFromHourDropDown = document.getElementById('absoluteTimePeriodFromHourDropDown');
            absoluteTimePeriodToHourDropDown   = document.getElementById('absoluteTimePeriodToHourDropDown');
            absoluteTimePeriodToDateTextBox    = document.getElementById('absoluteTimePeriodToDateTextBox');
            absoluteTimePeriodHint             = document.getElementById('absoluteTimePeriodHint');
            timePeriodTimeZoneDropDown         = document.getElementById('timePeriodTimeZoneDropDown');

            hasTimeIntervalRadioButton = document.getElementById('hasTimeIntervalRadioButton');
            noTimeIntervalRadioButton  = document.getElementById('noTimeIntervalRadioButton');
            timeIntervalTextBox        = document.getElementById('timeIntervalTextBox');
            timeIntervalUnitDropDown   = document.getElementById('timeIntervalUnitDropDown');
            timeIntervalHint           = document.getElementById('timeIntervalHint');

            savedSettingsDropDown           = document.getElementById('savedSettingsDropDown');
            reportTypeDropDown              = document.getElementById('reportTypeDropDown');
            publishedServiceRadioButton     = document.getElementById('publishedServiceRadioButton');
            operationRadioButton            = document.getElementById('operationRadioButton');
            ssgClusterSelectorWindow        = document.getElementById('ssgClusterSelector').contentWindow;
            ssgClusterContentSelectorWindow = document.getElementById('ssgClusterServiceContentSelector').contentWindow;
            entitySelectionTableBody        = document.getElementById('entitySelectionTableBody');
            groupingHint                    = document.getElementById('groupingHint');
            groupingTableBody               = document.getElementById('groupingTableBody');
            summaryChartCheckBox            = document.getElementById('summaryChartCheckBox');
            reportNameTextBox               = document.getElementById('reportNameTextBox');

            l7.Widget.initHourlyDropDown(absoluteTimePeriodFromHourDropDown);
            l7.Widget.initHourlyDropDown(absoluteTimePeriodToHourDropDown);
            initButtons();
            initDialogs();
            // loadSavedSettingsDropDown(); TODO uncomment this when saved settings is implemented

            onChangeTimePeriodType();
            onChangeTimeInterval();
            updateAddGroupingButton();
            updateSaveDefaultButton();
            updateGenerateButton();
        }

        YAHOO.util.Event.onDOMReady(init);
    </script>
    </wicket:head>
</head>
<body class="yui-skin-sam">
<noscript><div class="javascriptWarning">This page requires JavaScript. Your browser either does not have JavaScript support or has disabled it.</div></noscript>
<table width="100%">
    <tr>
        <td>
            <div class="header">
                <table width="100%">
                    <tr class="header">
                        <td class="logoLeft"><img src="../images/logoLeft.png" alt="" /></td>
                        <td class="logo"><a href="Monitor.html"><img src="../images/l7Logo.png" alt="Layer 7 Technologies Inc." /><img src="../images/esmLogo.png" alt="" /></a></td>
                        <td class="logoRight"><img src="../images/logoRight.png" alt="" /></td>
                        <td width="100%"><img src="../images/spacer.png" alt="" /></td>
                        <td class="middle nowrap">Logged in as "admin"<br />since May 5, 2008 05:57:54 PM</td>
                        <td class="middle"><form method="get" action="Login.html"><input type="submit" value="Log Out" /></form></td>
                        <td class="middle help"><a href="Help.html" target="l7-esm-help" title="Open help page in a separate window">Help</a></td>
                    </tr>
                </table>
            </div>
            <div class="divider"><img src="../images/spacer.png" alt="" /></div>
            <div>
                <table>
                    <tr>
                        <td id="tabLTManageGateways"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTManageGateways" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTManageGateways"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTManagePolicies"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTManagePolicies" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTManagePolicies"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTReports"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTReports" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTReports"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTTools"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTTools" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTTools"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTSettings"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTSettings" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTSettings"><img src="../images/tabRT.png" alt="" /></td>
                        <td><img src="../images/tabLT.png" alt="" /></td>
                        <td class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td><img src="../images/tabRT.png" alt="" /></td>
                    </tr>
                    <tr>
                        <td id="tabLMManageGateways" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMManageGateways" class="tabCM"><a href="Monitor.html">Manage Gateways</a></td>
                        <td id="tabRMManageGateways" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMManagePolicies" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMManagePolicies" class="tabCM"><a href="PolicyMigration.html">Manage Policies</a></td>
                        <td id="tabRMManagePolicies" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMReports" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMReports" class="tabCMon">Reports</td>
                        <td id="tabRMReports" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMTools" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMTools" class="tabCM"><a href="Messages.html">Tools</a></td>
                        <td id="tabRMTools" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMSettings" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMSettings" class="tabCM"><a href="UserSettings.html">Settings</a></td>
                        <td id="tabRMSettings" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabCM" width="100%"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                    </tr>
                    <tr>
                        <td id="tabLBManageGateways"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBManageGateways" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBManageGateways"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBManagePolicies"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBManagePolicies" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBManagePolicies"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBReports"><img src="../images/tabLBon.png" alt="" /></td>
                        <td id="tabCBReports" class="tabCBon"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBReports"><img src="../images/tabRBon.png" alt="" /></td>
                        <td id="tabLBTools"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBTools" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBTools"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBSettings"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBSettings" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBSettings"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td><img src="../images/tabLBoff.png" alt="" /></td>
                        <td class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td><img src="../images/tabRBoff.png" alt="" /></td>
                    </tr>
                </table>
            </div>
            <script language="JavaScript" type="text/javascript">
                l7.TabBar.initTab('ManageGateways');
                l7.TabBar.initTab('ManagePolicies');
                l7.TabBar.initTab('Tools');
                l7.TabBar.initTab('Settings');
            </script>
            <div class="subtabBar">
                <span class="subtabOn">Standard Reports</span>
            </div>
            <div class="content">
                <wicket:extend>
                <div class="panel">
                    <div class="panelTitle tippy"><img id="newReportTippy" class="tippy" src="../images/tippyExpanded.png" alt="" onclick="l7.Tippy.toggleTippy(this, 'newReportDiv')" /><span class="clickable" onclick="l7.Tippy.toggleTippy('newReportTippy', 'newReportDiv')">New Report</span></div>
                    <div id="newReportDiv">
                        <!-- TODO remove "display: none" when saved settings is implemented  -->
                        <div class="panelToolbar" style="display: none;">
                            <table> <!-- Any other way to middle-align SELECT and BUTTON elements? -->
                                <tr>
                                    <td class="middle"><button id="loadSettingsButton" title="Load a previously saved settings">Load Settings:</button></td>
                                    <td class="middle">
                                        <select id="savedSettingsDropDown">
                                            <option></option>  <!-- Workaround for IE7 bug: Weird overlap without this. --> 
                                        </select>
                                    </td>
                                    <td class="middle"><img class="refresh clickableImg middle" src="../images/refresh.png" title="Refresh list of saved settings" alt="Refresh" onclick="loadSavedSettingsDropDown();" /></td>
                                    <td class="middle"><button id="saveSettingsButton" title="Save as a named setttings">Save Settings ...</button></td>
                                    <td class="middle"><button id="manageSettingsButton" title="Save as a named setttings">Manage Settings ...</button></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panelContent">
                        <form wicket:id="form">
                            <table class="spaced">
                                <tr>
                                    <th class="middle">Report Type:</th>
                                    <td class="middle">
                                        <table>
                                            <tr>
                                                <td class="middle">
                                                    <select id="reportTypeDropDown" onchange="onChangeReportType();">
                                                        <option value="performance">Performance Statistics</option>
                                                        <option value="usage">Usage Report</option>
                                                    </select>
                                                </td>
                                                <td class="middle"><button id="saveDefaultButton"></button></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="top">Entity Selection:</th>
                                    <td width="100%">
                                        <div class="panel noMargin">
                                            <div class="panelToolbar">
                                                Select by:
                                                <input id="publishedServiceRadioButton" type="radio" name="selectionType" value="publishedService" onclick="onChangeEntityType();" checked/>
                                                <label for="publishedServiceRadioButton">Published Service</label>
                                                <input id="operationRadioButton" type="radio" name="selectionType" value="operation" onclick="onChangeEntityType();"/>
                                                <label for="operationRadioButton">Operation</label>
                                            </div>
                                                <table class="explorer" width="100%">
                                                    <tr>
                                                        <th width="50%"><img src="../images/spacer.png" alt="" height="0" width="350" /><!-- minimum width --></th>
                                                        <th width="50%"><img src="../images/spacer.png" alt="" height="0" width="350" /><!-- minimum width --></th>
                                                    </tr>
                                                    <tr>
                                                        <th>SSG Clusters <img class="refresh clickableImg middle" src="../images/refresh.png" title="Refresh list of SSG Clusters" alt="Refresh" onclick="refreshSsgClusterSelector();"/></th>
                                                        <th><span title="Content of selected SSG Cluster">Content</span> <img class="refresh clickableImg middle" src="../images/refresh.png" title="Refresh list of content" alt="Refresh" onclick="refreshSsgClusterContentSelector();"/></th>
                                                    </tr>
                                                    <tr>
                                                        <td class="srcDest"><iframe id="ssgClusterSelector" src="SSGClusterSelector.html" frameborder="0" scrolling="yes" height="200" width="100%" onload="initSsgClusterSelector(this);"></iframe></td>
                                                        <td class="srcDest"><iframe id="ssgClusterServiceContentSelector" src="SSGClusterServiceContentSelector.html" frameborder="0" scrolling="yes" height="200" width="100%" onload="initSsgClusterContentSelector(this);"></iframe></td>
                                                    </tr>
                                                </table>
                                            <div class="panelToolbar">
                                                <button id="addEntityButton">Add Checked Published Service(s)</button>
                                            </div>
                                            <div class="panelContent smallPadding">
                                                <table class="dataTable">
                                                    <thead>
                                                        <tr>
                                                            <th><!-- deletion image button --></th>
                                                            <th>SSG Cluster</th>
                                                            <th>Published Service</th>
                                                            <th width="100%">Operation</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="entitySelectionTableBody"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="middle">Time Period:</th>
                                    <td class="middle">
                                        Time Zone: 
                                        <select id="timePeriodTimeZoneDropDown" wicket:id="timezone">
                                            <option value="Canada/Pacific" selected="selected">Canada/Pacific (GMT-08:00/-07:00)</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th></th>
                                    <td class="middle">
                                        <table> <!-- Any other way to middle-align SELECT and BUTTON elements? -->
                                            <tr>
                                                <td class="middle"><input id="relativeTimePeriodRadioButton" type="radio" name="timePeriodType" value="relative" onclick="onChangeTimePeriodType();" checked/></td>
                                                <td class="middle"><label for="relativeTimePeriodRadioButton">Last</label></td>
                                                <td class="middle"><input id="relativeTimePeriodTextBox" class="right" type="text" size="9" maxlength="9" value="1" onkeyup="onChangeRelativeTimePeriod();"/></td>
                                                <td class="middle">
                                                    <select id="relativeTimePeriodUnitDropDown" name="relativeTimePeriodUnit">
                                                        <option value="HOUR">hour</option>
                                                        <option value="DAY" selected>day</option>
                                                        <option value="WEEK">week</option>
                                                        <option value="MONTH">month</option>
                                                    </select>
                                                </td>
                                                <td class="middle"><span id="relativeTimePeriodHint" class="red"></span></td>
                                                <td class="middle"><span id="relativeTimePeriodSpan"></span></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th></th>
                                    <td>
                                        <table>
                                            <tr>
                                                <td class="middle"><input id="absoluteTimePeriodRadioButton" type="radio" name="timePeriodType" value="absolute" onclick="onChangeTimePeriodType();"/></td>
                                                <td class="middle"><label for="absoluteTimePeriodRadioButton">From</label></td>
                                                <td class="middle"><div wicket:id="fromDate"/></td>
                                                <td class="middle"><select id="absoluteTimePeriodFromHourDropDown" onchange="onChangeAbsoluteTimePeriod();"></select></td>
                                                <td class="middle">To</td>
                                                <td class="middle"><div wicket:id="toDate"/></td>
                                                <td class="middle"><select id="absoluteTimePeriodToHourDropDown" onchange="onChangeAbsoluteTimePeriod();"></select></td>
                                                <td class="middle"><span id="absoluteTimePeriodHint" class="red"></span></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="middle">Time Interval:</th>
                                    <td class="middle">
                                        <table>
                                            <tr>
                                                <td class="middle"><input id="noTimeIntervalRadioButton" type="radio" name="timeInterval" value="false" onclick="onChangeTimeInterval();" checked/></td>
                                                <td class="middle"><label for="noTimeIntervalRadioButton">None (Summary Report)</label></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th></th>
                                    <td>
                                        <table> <!-- Any other way to middle-align SELECT and BUTTON elements? -->
                                            <tr>
                                                <td class="middle"><input id="hasTimeIntervalRadioButton" type="radio" name="timeInterval" value="true" onclick="onChangeTimeInterval();"/></td>
                                                <td class="middle"><label for="hasTimeIntervalRadioButton">Interval:</label></td>
                                                <td class="middle"><input id="timeIntervalTextBox" class="right" type="text" size="9" maxlength="9" value="1" onkeyup="onChangeTimeInterval();"/></td>
                                                <td class="middle">
                                                    <select id="timeIntervalUnitDropDown" name="timeIntervalUnit">
                                                        <option value="HOUR">hour</option>
                                                        <option value="DAY">day</option>
                                                        <option value="WEEK">week</option>
                                                    </select>
                                                </td>
                                                <td class="middle"><span id="timeIntervalHint" class="red"></span></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="top">Grouping:</th>
                                    <td>
                                        <div class="panel noMargin">
                                            <div class="panelToolbar">
                                                <button id="addGroupingButton">Add Group by Message Context</button>
                                                <span id="groupingHint" class="red note"></span>
                                            </div>
                                            <div class="panelContent smallPadding">
                                                <table class="dataTable">
                                                    <thead>
                                                        <tr>
                                                            <th><!-- deletion image button --></th>
                                                            <th>SSG Cluster</th>
                                                            <th>Message Context</th>
                                                            <th width="100%">Constraint Value <span class="note">(optional, wildcard * allowed)</span></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="groupingTableBody">
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Charting:</th>
                                    <td>
                                        <input id="summaryChartCheckBox" type="checkbox" checked/>
                                        <label for="summaryChartCheckBox">Include Summary Chart</label>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Report Name:</th>
                                    <td><input id="reportNameTextBox" type="text" size="64" maxlength="128" onkeyup="onChangeReportName();"/></td>
                                </tr>
                            </table>
                            </form>                    
                            <div class="middle nowrap">
                                <button id="generateButton">Generate Report</button>
                            </div>
                        </div>
                    </div>
                </div>
                <script lanaguge="javascript" wicket:id="javascript"></script>
                <div wicket:id="generatedReports">
                <div class="panel">
                    <div class="panelTitle tippy">
                        <img id="generatedReportsTippy" class="tippy" src="../images/tippyExpanded.png" alt="" onclick="l7.Tippy.toggleTippy(this, 'generatedReportsDiv')" />
                        <span class="clickable" onclick="l7.Tippy.toggleTippy('generatedReportsTippy', 'generatedReportsDiv')">Generated Reports</span>
                        <img class="refresh clickableImg middle" src="../images/refresh.png" title="Refresh list of generated reports" alt="Refresh" onclick="" />
                    </div>
                    <div id="generatedReportsDiv">
                        <div class="panelToolbar">
                            <table class="spaced"> <!-- Any other way to middle-align SELECT and BUTTON elements? -->
                                <tr>
                                    <td class="middle">Output Format: </td>
                                    <td class="middle"><select><option>PDF</option></select></td>
                                    <td class="middle"><button id="downloadOutputButton" title="Zip and download checked reports">Zip and Download</button></td>
                                    <td class="middle"><button id="deleteOutputButton" title="Delete checked reports">Delete</button></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panelContent">
                            <!-- Table of generated reports goes here. -->
                        </div>
                    </div>
                </div>
                </div>

                <div wicket:id="jsonMappings"/>
                <div wicket:id="postReportParameters">
                    
                </div>
                </wicket:extend>

            </div>
            <div class="statusBar">
                <table>
                    <tr>
                        <td width="100%">Time Zone: Canada/Pacific (GMT-08:00/<b>-07:00</b>)</td>
                        <td><a class="nowrap" href="http://www.layer7tech.com" target="_blank">Layer 7 Technologies Inc.</a></td>
                    </tr>
                </table>
            </div>
            <div class="divider"><img src="../images/spacer.png" alt="" /></div>
        </td>
    </tr>
</table>
</body>
</html>
