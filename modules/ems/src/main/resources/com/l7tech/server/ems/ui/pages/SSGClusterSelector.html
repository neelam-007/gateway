<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- PROTOTYPE ONLY BEGIN -->
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <!-- PROTOTYPE ONLY END -->
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Gateway Cluster Selector [Enterprise Service Manager]</title>
    <link rel="stylesheet" href="../css/l7.css" media="all" type="text/css" />

    <wicket:head>
    <!-- Required YUI modules: button, connection, container, dom, event, json, logger, menu -->
    <link rel="stylesheet" type="text/css" href="../yui/assets/skins/sam/skin.css">
    <script type="text/javascript" src="../yui/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="../yui/connection/connection-min.js"></script>
    <script type="text/javascript" src="../yui/container/container-min.js"></script>
    <script type="text/javascript" src="../yui/menu/menu-min.js"></script>
    <script type="text/javascript" src="../yui/element/element-min.js"></script>
    <script type="text/javascript" src="../yui/button/button-min.js"></script>
    <script type="text/javascript" src="../yui/json/json-min.js"></script>
    <script type="text/javascript" src="../yui/logger/logger-min.js"></script>

    <link rel="stylesheet" type="text/css" href="../css/l7-yui-skin.css"> <!-- modifies YUI sam skin; must come after YUI CSS files -->
    <script type="text/javascript" src="../js/l7.js"></script>
    <script type="text/javascript" src="../js/entityTreeTable.js"></script>
    <script type="text/javascript">
        /** Localized strings for passing into l7.EntityTreeTable constructor. */
        var entityTreeTableLocalizedStrings = {
            ENTITY_DATA_ERROR : 'Data error.',
            SSG_CLUSTER_STATE_UP : 'Up',
            SSG_CLUSTER_STATE_PARTIAL : 'Partial',
            SSG_CLUSTER_STATE_DOWN : 'Down',
            SSG_NODE_STATE_ON : 'On',
            SSG_NODE_STATE_OFF : 'Off',
            SSG_NODE_STATE_DOWN : 'Down',
            SSG_NODE_STATE_OFFLINE : 'Offline',
            ACCESS_ACCOUNT_IS_SET : 'Gateway user account is mapped. Click to change gateway user account.',
            ACCESS_ACCOUNT_CAN_SET : 'No gateway user account is mapped. Click to map gateway user account.',
            ACCESS_ACCOUNT_CANNOT_CHANGE : 'Gateway user account is mapped. Trust must be established before changing gateway user account.',
            ACCESS_ACCOUNT_CANNOT_SET : 'No gateway user account is mapped. Trust must be established before mapping gateway user account.',
            ACCESS_GRANTED : 'Role with access permission assigned',
            ACCESS_NOT_GRANTED : 'Role with access permission not assigned',
            ENTERPRISE_FOLDER : 'folder',
            SSG_CLUSTER : 'Gateway Cluster'
        };

        /** Localized strings for local HTML markups, e.g., error dialogs. */
        var localizedStrings = {
            OK : 'OK',
            ERROR : 'Error',
            SESSION_TIMEOUT : 'Your session has expired.',
            CANNOT_PARSE_RESPONSE_JSON : 'Malformed response from server.',
            CANNOT_DOWNLOAD_ENTITY_DATA : 'Unable to retrieve array of enterprise entities from the server.',
            CANNOT_PARSE_ENTITY_DATA : 'Unable to parse array of enterprise entities retrieved from the server: '
        };
    </script>
    <script type="text/javascript">
        /**
         * The enterpries tree table object.
         * @type l7.EntityTreeTable
         */
        var entityTreeTable;

        /**
         * The TBODY element inside the entity tree table.
         * @type HTMLTableSectionElement
         */
        var entityTreeTableBody;

        /**
         * @type string
         */
        var callbackId;

        /**
         * Callback function upon highlighting an SSG Cluster.
         * @type function(previous, entity, callbackId)
         */
        var entityHighlightedCallback;

        /**
         * Callback function upon clicking trust dialog button.
         * @type function(event, entity, callbackId)
         */
        var onClickTrustDialogButtonCallback;

        /**
         * Callback function upon clicking access dialog button.
         * @type function(event, entity, callbackId)
         */

        var onClickAccessDialogButtonCallback;
        /**
         * Parent window should call this if it wants a callback identifier.
         * @param {string} id   an identifier to include when callback to parent's showSSGClusterContent function.
         */
        function setCallbackId(id) {
            callbackId = id;
        }

        /**
         * Parent window should call this to provide the handler for entity highlighted event.
         * @param {function} fn
         */
        function setEntityHighlightedCallback(fn) {
            entityHighlightedCallback = fn;
        }

        /**
         * Callback function upon an entity highlighted.
         * @param {object} previous     the previously highlighted entity object literal; null if none
         * @param {object} entity       the newly highlighted entity object literal
         */
        function onEntityHighlighted(previous, entity) {
            entityHighlightedCallback(previous, entity, callbackId);
        }

        function setOnClickTrustDialogButtonCallback(fn) {
            onClickTrustDialogButtonCallback = fn;
        }

        function onClickTrustDialogButton(event, entity) {
            onClickTrustDialogButtonCallback(event, entity, callbackId);
        }

        function setOnClickAccessDialogButtonCallback(fn) {
            onClickAccessDialogButtonCallback = fn;
        }

        function onClickAccessDialogButton(event, entity) {
            onClickAccessDialogButtonCallback(event, entity, callbackId);
        }

        /**
         * @return {l7.EntityTreeTable}
         */
        function getEntityTreeTable() {
            return entityTreeTable;
        }

        /**
         * (Re)loads the content of the entity tree table by fetching entity data from server.
         */
        function loadEntityTreeTable() {
            var callback = {
                success : function(o) {
                    var result = l7.Connection.parseJsonResponse(o,
                                                                 true,
                                                                 localizedStrings.CANNOT_DOWNLOAD_ENTITY_DATA,
                                                                 localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                                                                 localizedStrings.SESSION_TIMEOUT,
                                                                 localizedStrings.ERROR,
                                                                 localizedStrings.OK);
                    if (result.success) {
                        var entities = result.json;
                        entityTreeTable.load(entities);
                    } else {
                        entityTreeTable.displayDataError();
                    }
                },
                failure : function(o) {
                    entityTreeTable.displayDataError();
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_ENTITY_DATA + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
                }
            };
            entityTreeTable.clear();
            YAHOO.util.Connect.asyncRequest('GET', ssgClusterJsonUrl, callback, null);
        }

        /**
         * Initializes the enterprise tree table instance; and populates it.
         */
        function initEntityTreeTable() {
            var config = {
                localizedStrings : entityTreeTableLocalizedStrings,
                columns : [
                    l7.EntityTreeTable.COLUMN.NAME,
                    l7.EntityTreeTable.COLUMN.ONLINE_STATUS,
                    l7.EntityTreeTable.COLUMN.TRUST_STATUS,
                    l7.EntityTreeTable.COLUMN.ACCESS_STATUS
                ],
                highlightableEntities : [
                    l7.Constants.ENTITY_TYPE.SSG_CLUSTER
                ],
                onEntityHighlighted : onEntityHighlighted,
                onClickTrustDialogButton : onClickTrustDialogButton,
                onClickAccessDialogButton : onClickAccessDialogButton
            };
            entityTreeTable = new l7.EntityTreeTable(entityTreeTableBody, [], '../images', config);

            loadEntityTreeTable();
        }

        function initDialogs() {
            // TODO
        }

        function init() {
            entityTreeTableBody = document.getElementById('entityTreeTableBody');
            initEntityTreeTable();
            initDialogs();
        }
    </script>
    </wicket:head>
</head>
<body class="dataIFrame yui-skin-sam" onload="init();">
<table class="dataTable" width="100%">
    <thead>
        <tr>
            <th class="name" width="100%">Name<br /><img src="../images/spacer.png" alt="" height="0" width="140" /><!-- minimum width --></th>
            <th><img src="../images/status.png" title="Online Status" alt="" /></th>
            <th><img src="../images/trust.png" title="Trust Status" alt="" /></th>
            <th><img src="../images/accessAccount.png" title="Access Account" alt="" /></th>
        </tr>
    </thead>
    <tbody id="entityTreeTableBody">
    </tbody>
</table>
<div wicket:id="actiondiv"/>
</body>
</html>
