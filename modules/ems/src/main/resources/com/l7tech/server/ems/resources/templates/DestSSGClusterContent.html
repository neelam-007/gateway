<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- PROTOTYPE ONLY BEGIN -->
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <!-- PROTOTYPE ONLY END -->
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Destination SSG Cluster Items Selector [Enterprise Service Manager]</title>
    <link rel="stylesheet" href="../css/l7.css" media="all" type="text/css" />

    <!-- Required YUI modules: button, connection, container, dom, event, json, logger, menu -->
    <link rel="stylesheet" type="text/css" href="../yui/assets/skins/sam/skin.css">
    <script type="text/javascript" src="../yui/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="../yui/connection/connection-min.js"></script>
    <script type="text/javascript" src="../yui/container/container-min.js"></script>
    <script type="text/javascript" src="../yui/menu/menu-min.js"></script>
    <script type="text/javascript" src="../yui/element/element-beta-min.js"></script>
    <script type="text/javascript" src="../yui/button/button-min.js"></script>
    <script type="text/javascript" src="../yui/json/json-min.js"></script>
    <script type="text/javascript" src="../yui/logger/logger-min.js"></script>

    <link rel="stylesheet" type="text/css" href="../css/l7-yui-skin.css"> <!-- modifies YUI sam skin; must come after YUI CSS files -->
    <script type="text/javascript" src="../js/l7.js"></script>
    <script type="text/javascript" src="../js/enterpriseTreeTable.js"></script>
    <script type="text/javascript">
        // TODO generate these variables dynamically on the server according to user's langauge preference

        /** Localized strings for passing into l7.EnterpriseTreeTable constructor. */
        var enterpriseTreeTableLocalizedStrings = {
            SSG_CLUSTER_STATE_UP : 'Up',
            SSG_CLUSTER_STATE_PARTIAL : 'Partial',
            SSG_CLUSTER_STATE_DOWN : 'Down',
            SSG_NODE_STATE_ON : 'On',
            SSG_NODE_STATE_OFF : 'Off',
            SSG_NODE_STATE_DOWN : 'Down',
            SSG_NODE_STATE_OFFLINE : 'Offline',
            ACCESS_ACCOUNT_IS_SET : 'Access account is set. Click to change access account.',
            ACCESS_ACCOUNT_NOT_SET : 'No access account. Click to enter access account.',
            ACCESS_GRANTED : 'Access granted',
            ACCESS_NOT_GRANTED : 'Access not granted',
            DASHBOARD_CHECKBOX_TOOLTIP : 'Show/Hide dashboard for this SSG Cluster',
            MONITORED_PROPERTY_BUTTON_TOOLTIP : 'Click to configure this monitoring property',
            ENTERPRISE_FOLDER : 'folder',
            SSG_CLUSTER : 'SSG Cluster',
            SSG_NODE : 'SSG Node',
            SSG_FOLDER : 'folder',
            PUBLISHED_SERVICE : 'published service',
            POLICY_FRAGMENT : 'policy fragment',
            SSL_HOST_NAME : 'SSL host name',
            ADMINISTRATIVE_PORT_NUMBER : 'administrative port number',
            IP_ADDRESS : 'IP address',
            DATABASE_HOSTS : 'database host(s)',
            SELF_HOST_NAME : 'self host name',
            ZOOM_ICON_TOOLTIP : 'Show details'
        };

        /** Localized strings for local HTML markups, e.g., error dialogs. */
        var localizedStrings = {
            ERROR : 'Error',
            CANNOT_DOWNLOAD_ENTITY_DATA : 'Failed to get array of SSG Cluster entities from server: ',
            CANNOT_PARSE_ENTITY_DATA : 'Failed to parse array of SSG Cluster entities downloaded from server: ',
            ENTITY_DATA_ERROR : 'Data error.'
        };
    </script>
    <script type="text/javascript">
        /**
         * The enterpries tree table object.
         * @type l7.EnterpriseTreeTable
         */
        var enterpriseTreeTable;

        var callbackId;

        var currentSSGClusterId;

        var currentZoomTr;
        var currentZoomTrPreviousBackgroundColor;

        /**
         * Parent window should call this.
         * @param {string} id   an identifier to include when callback to parent's zoomEntity function.
         */
        function setCallbackId(id) {
            callbackId = id;
        }

        /**
         * Onclick event handler for the zoom icon of an entity.
         *
         * @param {MouseEvent} event    the click event
         * @param {object} entity       the SSG Cluster entity object literal
         */
        function onClickZoomIcon(event, entity) {
            if (currentZoomTr != undefined) {
                currentZoomTr.style.backgroundColor = currentZoomTrPreviousBackgroundColor;
            }
            currentZoomTr = entity._tr;
            currentZoomTrPreviousBackgroundColor = currentZoomTr.style.backgroundColor;
            currentZoomTr.style.backgroundColor = '#dbdbdb';
            parent.zoomItem(callbackId, currentSSGClusterId, entity.type, entity.id);
        }

        /**
         * Repopulates the table body with content of the given SSG Cluster.
         * To be called by parent frame.
         * @param {string} ssgClusterId     SSG Cluster ID
         */
        function loadSSGClusterContent(ssgClusterId) {

            function displayError() {
                var tbody = document.getElementById('enterpriseTreeTableBody');
                var tr = tbody.insertRow(-1);
                var td = tr.insertCell(-1);
                td.colSpan = 4;
                td.innerHTML = localizedStrings.ENTITY_DATA_ERROR;
            }

            var callback = {
                success : function(o) {
                    var entities;
                    try {
                        entities = YAHOO.lang.JSON.parse(o.responseText);
                    } catch (e) {
                        enterpriseTreeTable.clear();
                        displayError();
                        l7.Error.showDialog(localizedStrings.ERROR, '30em', localizedStrings.CANNOT_PARSE_ENTITY_DATA + e);
                        return;
                    }
                    enterpriseTreeTable.load(entities);
                    currentSSGClusterId = ssgClusterId;
                },
                failure : function(o) {
                    enterpriseTreeTable.clear();
                    displayError();
                    l7.Error.showDialog(localizedStrings.ERROR, '30em', localizedStrings.CANNOT_DOWNLOAD_ENTITY_DATA + o.statusText);
                }
            };
            var url = 'dataSource/ssgClusterContent/' + ssgClusterId + '.json';
            YAHOO.util.Connect.asyncRequest('GET', url, callback, null);
        }

        /**
         * Initializes the enterprise tree table instance; with no entity data.
         */
        function initEnterpriseTreeTable() {
            var tbody = document.getElementById('enterpriseTreeTableBody');
            var config = {
                localizedStrings : enterpriseTreeTableLocalizedStrings,
                columns : [
                    l7.EnterpriseTreeTable.COLUMN.NAME,
                    l7.EnterpriseTreeTable.COLUMN.ZOOM,
                    l7.EnterpriseTreeTable.COLUMN.VERSION,
                    l7.EnterpriseTreeTable.COLUMN.TYPE
                ],
                entitiesWithZoomIcon : [
                    l7.EnterpriseTreeTable.ENTITY.PUBLISHED_SERVICE,
                    l7.EnterpriseTreeTable.ENTITY.POLICY_FRAGMENT
                ],
                onClickZoomIcon : onClickZoomIcon,
                entitiesWithRadioButton : [
                    l7.EnterpriseTreeTable.ENTITY.SSG_FOLDER
                ],
                entitySelectable : false
            };
            enterpriseTreeTable = new l7.EnterpriseTreeTable(tbody, [] /* no entities initially */, '../images', config);
        }

        function init() {
            initEnterpriseTreeTable();
        }

        YAHOO.util.Event.onDOMReady(init);
    </script>
</head>
<body class="dataIFrame yui-skin-sam">
<table id="ssgClusterItemsSelector" class="dataTable" width="100%">
    <thead>
        <tr>
            <th class="name">Name<br /><img src="../images/spacer.png" alt="" height="0" width="140" /><!-- minimum width --></th>
            <th class="edit"><img src="../images/spacer.png" alt="" height="0" width="16" /><!-- minimum width --></th>
            <th title="Version">Ver.</th>
            <th width="100%">Type</th>
        </tr>
    </thead>
    <tbody id="enterpriseTreeTableBody">
    </tbody>
</table>
</body>
</html>