<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- PROTOTYPE ONLY BEGIN -->
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <!-- PROTOTYPE ONLY END -->
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Standard Reports [Enterprise Service Manager]</title>
    <link rel="stylesheet" type="text/css" href="/css/l7.css" />

    <wicket:head>
    <!-- Required YUI modules: button, calendar, connection, container, event, json, logger -->
    <link rel="stylesheet" type="text/css" href="/yui/assets/skins/sam/skin.css">
    <script type="text/javascript" src="/yui/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="/yui/element/element-beta-min.js"></script>
    <script type="text/javascript" src="/yui/button/button-min.js"></script>
    <script type="text/javascript" src="/yui/calendar/calendar-min.js"></script>
    <script type="text/javascript" src="/yui/connection/connection-min.js"></script>
    <script type="text/javascript" src="/yui/container/container-min.js"></script>
    <script type="text/javascript" src="/yui/json/json-min.js"></script>
    <script type="text/javascript" src="/yui/logger/logger-min.js"></script>

    <link rel="stylesheet" type="text/css" href="/css/l7-yui-skin.css" /> <!-- modifies YUI sam skin; must come after YUI CSS files -->
    <style type="text/css">
        .note {
            font-size: 90%;
            margin-left: 8px;
        }
    </style>
    <script type="text/javascript" src="/js/l7.js"></script>
    <script type="text/javascript" src="/js/entityTreeTable.js"></script>
    <script type="text/javascript">
        /** Localized strings for local HTML markups, e.g., error dialogs. */
        var localizedStrings = {
            REPORT_TYPE_PERFORMANCE : 'Performance Statistics',
            REPORT_TYPE_USAGE : 'Usage Report',
            SAVE_DEFAULT_BUTTON_LABEL : 'Save Settings as Default for &ldquo;{0}&rdquo;',
            PUBLISHED_SERVICE_S : 'Published Service(s)',
            OPERATION_S : 'Operation(s)',
            ADD_ENTITY_BUTTON_LABEL : 'Add Checked {0}',
            REMOVE : 'Remove',
            LOADING_SAVED_SETTINGS : "Loading settings &ldquo;{0}&rdquo;...",
            SETTINGS_SAVED_TITLE : "Settings Saved",
            SETTINGS_SAVED : "Settings is saved successfully.",
            OK : 'OK',
            CANCEL : 'Cancel',
            YES : 'Yes',
            NO : 'No',
            WARNING: 'Warning',
            ERROR : 'Error',
            CANNOT_PARSE_RESPONSE_JSON : 'Malformed response from server: ',
            CANNOT_SAVE_SETTINGS : 'Failed to save settings.',
            CANNOT_DELETE_SETTINGS : 'Failed to delete settings &ldquo;{0}&rdquo;.',
            CANNOT_DOWNLOAD_SAVED_SETTINGS_LIST : 'Failed to download list of saved settings.',
            CANNOT_DOWNLOAD_SAVED_SETTINGS : 'Failed to download saved settings &ldquo;{0}&rdquo;.',
            CANNOT_DOWNLOAD_MESSAGE_CONTEXT_LIST : 'Failed to download list of message context keys for the selected SSG Clusers.',
            SSG_CLUSTER_NOT_APPLICABLE : 'None of the selected entities belong to this SSG Cluster. Please delete or reselect.',
            TOO_MANY_UNIQUE_MESSAGE_CONTEXT_KEYS : 'Cannot use more than 5 unique message context keys per SSG cluster',
            INVALID_GROUPINGS_REMOVED : "Some groupings in this settings have been removed because they no longer applies: ",
            SSG_CLUSTER_NOT_EXIST : 'SSG Cluster &ldquo;{0}&rdquo; does not exist.',
            MESSAGE_CONTEXT_KEY_NOT_EXIST : 'Message context key &ldquo;{0}&rdquo; does not exist in SSG Cluster &ldquo;{1}&rdquo;.',
            STANDARD_MESSAGE_CONTEXT_MAPPING : 'Standard Mapping',
            CUSTOM_MESSAGE_CONTEXT_MAPPING : 'Custom Mapping',
            RELATIVE_TIME_PERIOD_HINT : 'Must be positive integer',
            ABSOLUTE_TIME_PERIOD_HINT : 'From time must be earlier than To time',
            TIME_INTERVAL_HINT : 'Must be positive integer',
            SUBMITTING_GENERATE_REPORT : 'Submitting standard report generation',
            CANNOT_SUBMIT_GENERATE_REPORT : 'Failed to submit standard report generation.'
        }
    </script>
    <script type="text/javascript">
        var ReportType = {
            PERFORMANCE : 'performance',
            USAGE       : 'usage'
        };

        var TimePeriodType = {
            RELATIVE : 'relative',
            ABSOLUTE : 'absolute'
        };

        var loadSettingsButton;
        var saveSettingsButton;
        var deleteSettingsButton;
        var addEntityButton;
        var addGroupingButton;
        var generateButton;
        var downloadOutputButton;
        var deleteOutputButton;

        var relativeTimePeriodRadioButton;
        var absoluteTimePeriodRadioButton;
        var hasTimeIntervalRadioButton;
        var noTimeIntervalRadioButton;
        var publishedServiceRadioButton;
        var operationRadioButton;

        var summaryChartCheckBox;

        var relativeTimePeriodTextBox;
        var relativeTimePeriodHint;
        var absoluteTimePeriodFromDateTextBox;
        var absoluteTimePeriodToDateTextBox;
        var absoluteTimePeriodHint;
        var timeIntervalTextBox;
        var timeIntervalHint;
        var groupingHint;
        var reportNameTextBox;

        var settingsListDropDown;
        var reportTypeDropDown;
        var relativeTimePeriodUnitDropDown;
        var absoluteTimePeriodFromHourDropDown;
        var absoluteTimePeriodToHourDropDown;
        var timePeriodTimeZoneDropDown;
        var timeIntervalUnitDropDown;

        var ssgClusterSelectorWindow;
        var ssgClusterContentSelectorWindow;

        var messageWhenNoEntitySelected;
        var entitySelectionTableBody;
        var messageWhenNoGrouping;
        var groupingTableBody;

        var saveSettingsDialog;
        var saveSettingsOverwriteDialog;
        var deleteSettingsDialog;

        /**
         * Array of SSG Cluster IDs that have entities selected.
         * May be empty but never null.
         * @type array
         */
        var ssgClusterIdsWithSelectedEntities = [];

        /**
         * List of message context object literals that are available in the
         * SSG Clusters with selected entities currently.
         * @type array
         */
        var availableMessageContext;

        /**
         * Serialize a date time value for sending to the server.
         * @param {Date} d      a JavaScript Date object specifying the year, month and date
         * @param {integer} h   the hour value (0-23)
         */
        function serializeDateTime(d, h) {
            var DATE_FORMAT = 'yyyy/MM/dd';
            return l7.Util.formatDate(d, DATE_FORMAT) + ' ' + l7.Util.formatInteger(h, 2) + ':00';
        }

        /**
         * Deserialize a date time string received from the server.
         * @param {string} s    date time string to parse
         * @return {Date} a JavaScript Date object; null if error parsing
         */
        function deserializeDateTime(s) {
            var RE = new RegExp('^ *([0-9]+)\/([0-9]+)\/([0-9]+) +([0-9]+):([0-9]+)');
            var tc = s.match(RE);
            if (tc == null) return null;
            var millis = Date.parse(tc[1] + '/' + tc[2] + '/' + tc[3] + ' ' + tc[4] + ':' + tc[5]);
            var result = new Date();
            result.setTime(millis);
            return result;
        }

        /**
         * Verifies if relative time period input is valid.
         * @return {boolean} true if valid
         */
        function validateRelativeTimePeriod() {
            var valid = false;
            if (relativeTimePeriodRadioButton.checked) {
                var timePeriod = relativeTimePeriodTextBox.value;
                valid = l7.Util.isIntString(timePeriod) && timePeriod >= 0;
            } else if (absoluteTimePeriodRadioButton.checked) {
                valid = true;
            }
            return valid;
        }

        /**
         * Verifies if absolute time period input is valid.
         * @return {boolean} true if valid
         */
        function validateAbsoluteTimePeriod() {
            var valid = false;
            if (relativeTimePeriodRadioButton.checked) {
                valid = true;
            } else if (absoluteTimePeriodRadioButton.checked) {
                if (absoluteTimePeriodFromDate == absoluteTimePeriodToDate) {
                    var fromHour = absoluteTimePeriodFromHourDropDown.value;
                    var toHour = absoluteTimePeriodToHourDropDown.value;
                    valid = (fromHour - toHour) < 0;
                } else {
                    valid = true;
                }
            }
            return valid;
        }

        /**
         * Verifies if time period input is valid.
         * @return {boolean} true if valid
         */
        function validateTimePeriod() {
            return timePeriodTimeZoneDropDown.value != '' && validateRelativeTimePeriod() && validateAbsoluteTimePeriod();
        }

        /**
         * Verifies if time interval input is valid.
         * @return {boolean} true if valid
         */
        function validateTimeInterval() {
            var valid = false;
            if (noTimeIntervalRadioButton.checked) {
                valid = true;
            } else if (hasTimeIntervalRadioButton.checked) {
                var timeInterval = timeIntervalTextBox.value;
                valid = l7.Util.isIntString(timeInterval) && timeInterval >= 0;
            }
            return valid;
        }

        /**
         * Verifies if a grouping is valid and raise or clear any warning UI.
         * @return {boolean} true if valid
         */
        function validateGrouping(tr) {
            // Tests if SSG Cluster is still amongst the selected entities.
            var ssgClusterId = tr._ssgClusterDropDown.value;
            var valid = l7.Util.arrayContains(ssgClusterIdsWithSelectedEntities, ssgClusterId);
            tr._ssgClusterWarningImg.title = valid ? null : localizedStrings.SSG_CLUSTER_NOT_APPLICABLE;
            tr._ssgClusterWarningImg.style.display = valid ? 'none' : '';
            return valid;
        }

        /**
         * Verifies if number of unique message context keys specified per cluster is at most 5.
         * @return {boolean} true if valid
         */
        function validateGroupingMessageContextKey() {
            var valid = true;
            var trs = groupingTableBody.rows;

            // First, sort the rows by SSG Cluster and message context key
            // using a map whose key is SSG Cluster ID and map value is a child map.
            // The child map key is message context key and map value is an array of TR elements.
            var map = {};
            for (var i = 0; i < trs.length; ++i) {
                var tr = trs[i];
                var ssgClusterId = tr._ssgClusterDropDown.value;
                var messageContextKey = tr._messageContextDropDown.value;
                if (!map[ssgClusterId]) {
                    map[ssgClusterId] = {};
                }
                if (!map[ssgClusterId][messageContextKey]) {
                    map[ssgClusterId][messageContextKey] = [];
                }
                map[ssgClusterId][messageContextKey].push(tr);
            }

            // Then count and warn.
            for (ssgClusterId in map) {
                var numUniqueKeys = 0;
                for (messageContextKey in map[ssgClusterId]) {
                    ++ numUniqueKeys;
                }
                var validMsgCtxKey = numUniqueKeys <= 5;
                for (messageContextKey in map[ssgClusterId]) {
                    var trsWithKey = map[ssgClusterId][messageContextKey];
                    for (i = 0; i < trsWithKey.length; ++i) {
                        tr = trsWithKey[i];
                        tr._msgCtxKeyWarningImg.title = validMsgCtxKey ? null : localizedStrings.TOO_MANY_UNIQUE_MESSAGE_CONTEXT_KEYS;
                        tr._msgCtxKeyWarningImg.style.display = validMsgCtxKey ? 'none' : '';
                    }
                    valid = valid && validMsgCtxKey;
                }
            }

            return valid;
        }

        /**
         * Verifies if all groupings are valid and raise or clear any warning UI.
         * @return {boolean} true if valid
         */
        function validateGroupings() {
            var valid = true;
            var trs = groupingTableBody.rows;
            for (var i = 0; i < trs.length; ++i) {
                var tr = trs[i];
                if (!validateGrouping(tr)) {    // Do not optimize using short-ciruit!
                    valid = false;
                }
            }

            valid = valid && validateGroupingMessageContextKey();

            if (reportTypeDropDown.value == ReportType.USAGE && trs.length == 0) {
                groupingHint.style.display = '';
                valid = false;
            } else {
                groupingHint.style.display = 'none';
            }

            return valid;
        }

        /**
         * Verifies if all settings input fields are valid.
         * @return {boolean} true if valid
         */
        function validateSettings() {
            var valid = validateGroupings();
            return valid &&
                   entitySelectionTableBody.rows.length > 0 &&
                   validateTimePeriod() &&
                   validateTimeInterval() &&
                   reportNameTextBox.value.search(/\S/) != -1;
        }

        /**
         * Updates ssgClusterIdsWithSelectedEntities.
         * Should be called upon change in selected entities.
         */
        function updateSsgClustersWithSelectedEntities() {
            ssgClusterIdsWithSelectedEntities.length = 0;
            for (var i = 0; i < entitySelectionTableBody.rows.length; ++i) {
                var ssgClusterId = entitySelectionTableBody.rows[i]._ssgClusterId;
                if (!l7.Util.arrayContains(ssgClusterIdsWithSelectedEntities, ssgClusterId)) {
                    ssgClusterIdsWithSelectedEntities.push(ssgClusterId);
                }
            }
        }

        function updateAddGroupingButton() {
            addGroupingButton.set('disabled', ssgClusterIdsWithSelectedEntities.length == 0);
        }

        /**
         * Enables/Disables each SSG Cluster in a drop down list based on
         * whether it contains selected entities.
         * @param {HTMLSelectElement} dropDown
         */
        function updateGroupingSsgClusterDropDown(dropDown) {
            for (var i = 0; i < dropDown.options.length; ++i) {
                var option = dropDown.options[i];
                var ssgClusterId = option.value;
                option.disabled = !l7.Util.arrayContains(ssgClusterIdsWithSelectedEntities, ssgClusterId);
            }
        }

        function updateGroupingSsgClusterDropDowns() {
            var trs = groupingTableBody.rows;
            for (var i = 0; i < trs.length; ++i) {
                var tr = trs[i];
                var dropDown = tr._ssgClusterDropDown;
                updateGroupingSsgClusterDropDown(dropDown);
            }
        }

        function updateSaveSettingsButton() {
            saveSettingsButton.set('disabled', !validateSettings());
        }

        function updateGenerateButton() {
            generateButton.set('disabled', !validateSettings());
        }

        function onChangeReportType() {
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        function onChangeEntitySelectionType() {
            refreshSsgClusterContentSelector();

            // Clears out all entity selections because they would now be the wrong type.
            while (entitySelectionTableBody.rows.length > 0) {
                entitySelectionTableBody.deleteRow(-1);
            }
            messageWhenNoEntitySelected.style.display = '';
            updateSsgClustersWithSelectedEntities();
            // and all groupings
            while (groupingTableBody.rows.length > 0) {
                groupingTableBody.deleteRow(-1);
            }

            // Updates the add button.
            var entityTypeText;
            var entityType = getEntitySelectionType();
            if (entityType == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE) {
                entityTypeText = localizedStrings.PUBLISHED_SERVICE_S;
            } else if (entityType == l7.EntityTreeTable.ENTITY.OPERATION) {
                entityTypeText = localizedStrings.OPERATION_S;
            }
            addEntityButton.set('label', l7.Util.formatMessage(localizedStrings.ADD_ENTITY_BUTTON_LABEL, entityTypeText));

            updateAddGroupingButton();
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        function onChangeSelectedEntities() {
            messageWhenNoEntitySelected.style.display = entitySelectionTableBody.rows.length == 0 ? '' : 'none';
            updateSsgClustersWithSelectedEntities();
            loadAvailableMessageContext();
            updateAddGroupingButton();
            updateGroupingSsgClusterDropDowns();
            validateGroupings();
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        function onChangeRelativeTimePeriod() {
            if (validateRelativeTimePeriod()) {
                l7.Util.removeClass(relativeTimePeriodTextBox, 'invalid');
                relativeTimePeriodHint.innerHTML = '';
            } else {
                l7.Util.addClass(relativeTimePeriodTextBox, 'invalid');
                relativeTimePeriodHint.innerHTML = '(' + localizedStrings.RELATIVE_TIME_PERIOD_HINT + ')';
            }
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        function onChangeAbsoluteTimePeriodFromDate() {
            onChangeAbsoluteTimePeriod();
        }

        function onChangeAbsoluteTimePeriodToDate() {
            onChangeAbsoluteTimePeriod();
        }

        function onChangeAbsoluteTimePeriod() {
            if (validateAbsoluteTimePeriod()) {
                absoluteTimePeriodHint.innerHTML = '';
            } else {
                absoluteTimePeriodHint.innerHTML = '(' + localizedStrings.ABSOLUTE_TIME_PERIOD_HINT + ')';
            }
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        function onChangeTimePeriodTimeZone() { // TODO This is not necessary if all items in the drop down list are valid.
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        function onChangeTimePeriodType() {
            var isRelative = relativeTimePeriodRadioButton.checked;
            relativeTimePeriodTextBox.disabled = !isRelative;
            relativeTimePeriodUnitDropDown.disabled = !isRelative;

            var isAbsolute = absoluteTimePeriodRadioButton.checked;
            document.getElementById('absoluteTimePeriodFromDateTextBox').disabled = !isAbsolute;
            absoluteTimePeriodFromHourDropDown.disabled = !isAbsolute;
            document.getElementById('absoluteTimePeriodToDateTextBox').disabled = !isAbsolute;
            absoluteTimePeriodToHourDropDown.disabled = !isAbsolute;

            onChangeRelativeTimePeriod();
            onChangeAbsoluteTimePeriod();
        }

        function onChangeTimeInterval() {
            if (validateTimeInterval()) {
                l7.Util.removeClass(timeIntervalTextBox, 'invalid');
                timeIntervalHint.innerHTML = '';
            } else {
               l7.Util.addClass(timeIntervalTextBox, 'invalid');
                timeIntervalHint.innerHTML = '(' + localizedStrings.TIME_INTERVAL_HINT + ')';
            }

            timeIntervalTextBox.disabled = !hasTimeIntervalRadioButton.checked;
            timeIntervalUnitDropDown.disabled = !hasTimeIntervalRadioButton.checked;
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        function onChangeGroupings() {
            messageWhenNoGrouping.style.display = groupingTableBody.rows.length == 0 ? '' : 'none';
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        function onChangeReportName() {
            updateSaveSettingsButton();
            updateGenerateButton();
        }

        /**
         * @param {string} type     a ReportType value
         */
        function setReportType(type) {
            l7.Widget.selectDropDownByValue(reportTypeDropDown, type);
            onChangeReportType();
        }

        /**
         * Returns the entity selection type.
         * @return {string} an l7.EntityTreeTable.ENTITY value
         */
        function getEntitySelectionType() {
            var result;
            if (publishedServiceRadioButton.checked) {
                result = l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE;
            } else if (operationRadioButton.checked) {
                result = l7.EntityTreeTable.ENTITY.OPERATION;
            } else {
                YAHOO.log('Unexpected entity type selection.', 'error', 'StandardReports.html getEntitySelectionType');
            }
            return result;
        }

        /**
         * Sets the entity selection type.
         * @param {string} type     an l7.EntityTreeTable.ENTITY value
         */
        function setEntitySelectionType(type) {
            if (type == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE) {
                publishedServiceRadioButton.checked = true;
            } else if (type == l7.EntityTreeTable.ENTITY.OPERATION) {
                operationRadioButton.checked = true;
            } else {
                YAHOO.log('Unexpected entity type: ' + type, 'error', 'StandardReports.html setEntitySelectionType');
            }

            onChangeEntitySelectionType();
        }

        /**
         * Tests if an SSG Cluster exists in the SSG Cluster selector.
         * @param {string} id
         * @return {boolean}
         */
        function isExistSSGCluster(id) {
            var entity = ssgClusterSelectorWindow.getEntityTreeTable().getEntityById(id);
            return entity && entity.type == l7.EntityTreeTable.ENTITY.SSG_CLUSTER;
        }

        /**
         * Adds an selected entity.
         * @param {string} ssgClusterId
         * @param {string} ssgClusterName
         * @param {array} ssgClusterAncestors
         * @param {string} publishedServiceId       ID of published service or published service alias
         * @param {string} publishedServiceName
         * @param {string} relatedId                ID of the original published service if the selected entity is a published service alias or an operation inside a published service alias; undefined otherwise
         * @param {string} operation                name of operation; undefined if the selected entity is not an operation
         */
        function addEntity(ssgClusterId, ssgClusterName, ssgClusterAncestors, publishedServiceId, publishedServiceName, relatedId, operation) {
            // Skips this if already added.
            var alreadyAdded = false;
            var trs = entitySelectionTableBody.rows;
            for (var j = 0; j < trs.length; ++j) {
                var tr = trs[j];
                if (tr._ssgClusterId == ssgClusterId &&
                    tr._publishedServiceId == publishedServiceId &&
                    tr._operation == operation) {
                    alreadyAdded = true;
                    break;
                }
            }
            if (alreadyAdded) {
                return;
            }

            tr = entitySelectionTableBody.insertRow(-1);
            tr._ssgClusterId = ssgClusterId;   // Stash away for later retrieval.
            var td;

            // Delete button column.
            var img = document.createElement('img');
            img.src = '../images/delete.png';
            img.className = 'clickable';
            img.title = localizedStrings.REMOVE;
            YAHOO.util.Event.addListener(img, 'click', onClickDeleteEntity, tr);
            td = tr.insertCell(-1);
            td.appendChild(img);

            // SSG Cluster column.
            td = tr.insertCell(-1);
            if (ssgClusterAncestors != undefined) {
                td.innerHTML = ssgClusterAncestors.join(' / ') + ' / ' + ssgClusterName;
            } else {
                td.innerHTML = ssgClusterName;
            }

            // Published Service column.
            td = tr.insertCell(-1);
            td.innerHTML = publishedServiceName;
            if (relatedId != undefined) { // the selected entity is either a published service alias or an operation inside a published service alias	
                td.style.fontStyle = 'italic';
            }
            tr._publishedServiceId = publishedServiceId;        // Stash away for later retrieval.
            tr._publishedServiceName = publishedServiceName;    // Stash away for later retrieval.
            tr._relatedId = relatedId;                          // Stash away for later retrieval.

            // Operation column.
            td = tr.insertCell(-1);
            if (operation) {
                td.innerHTML = operation;
                tr._operation = operation;  // Stash away for later retrieval.
            } else {
                td.className = 'notApplicable';
            }
        }

        /**
         * Adds a number of selected entities.
         * @param {array} entities      array of entity object literals
         */
        function addSelectedEntities(entities) {
            for (var i = 0; i < entities.length; ++i) {
                var entity = entities[i];
                addEntity(entity.clusterId,
                          entity.clusterName,
                          entity.clusterAncestors,
                          entity.publishedServiceId,
                          entity.publishedServiceName,
                          entity.operation);
            }

            onChangeSelectedEntities();
        }

        /**
         * @return {string} a TimePeriodType value
         */
        function getTimePeriodType() {
            var result;
            if (relativeTimePeriodRadioButton.checked) {
                result = TimePeriodType.RELATIVE;
            } else if (absoluteTimePeriodRadioButton.checked) {
                result = TimePeriodType.ABSOLUTE;
            }
            return result;
        }

        /**
         * Sets the time period selection.
         * @param {string} timeZone         a java.util.TimeZone long name time zone ID
         * @param {string} type             a TimePeriodType value
         * @param {string} relativeValue    applies if type == TimePeriodType.RELATIVE
         * @param {string} relativeUnit     applies if type == TimePeriodType.RELATIVE
         * @param {string} absoluteFrom     applies if type == TimePeriodType.ABSOLUTE
         * @param {string} absoluteTo       applies if type == TimePeriodType.ABSOLUTE
         */
        function setTimePeriod(timeZone, type, relativeValue, relativeUnit, absoluteFrom, absoluteTo) {
            l7.Widget.selectDropDownByValue(timePeriodTimeZoneDropDown, timeZone);

            if (type == TimePeriodType.RELATIVE) {
                relativeTimePeriodRadioButton.checked = true;
                relativeTimePeriodTextBox.value = relativeValue;
                l7.Widget.selectDropDownByValue(relativeTimePeriodUnitDropDown, relativeUnit);
            } else if (type == TimePeriodType.ABSOLUTE) {
                absoluteTimePeriodRadioButton.checked = true;
                var from = deserializeDateTime(absoluteFrom);
                absoluteTimePeriodFromDateTextBox.getCalendar().select(from);
                l7.Widget.selectDropDownByValue(absoluteTimePeriodFromHourDropDown, from.getHours());
                var to = deserializeDateTime(absoluteTo);
                absoluteTimePeriodToDateTextBox.getCalendar().select(to);
                l7.Widget.selectDropDownByValue(absoluteTimePeriodToHourDropDown, to.getHours());
            } else {
                YAHOO.log('Unexpected time period type: ' + type, 'error', 'StandardReports.html setTimePeriod');
            }

            onChangeTimePeriodTimeZone();
            onChangeTimePeriodType();
        }

        /**
         * Sets the time interval.
         * @param {boolean} hasTimeInterval
         * @param {string} value                applies if hasTimeInterval == true
         * @param {string} unit                 applies if hasTimeInterval == true
         */
        function setTimeInterval(hasTimeInterval, value, unit) {
            if (hasTimeInterval) {
                hasTimeIntervalRadioButton.checked = true;
                timeIntervalTextBox.value = value;
                l7.Widget.selectDropDownByValue(timeIntervalUnitDropDown, unit);
            } else {
                noTimeIntervalRadioButton.checked = true;
            }

            onChangeTimeInterval();
        }

        /**
         * Determines if a message context key exists in an SSG Cluster.
         * @param {string} ssgClusterId     SSG Cluster ID
         * @param {string} key              the message context key
         * @return {boolean}
         */
        function isExistMessageContextKey(ssgClusterId, key) {
            for (var i = 0; i < availableMessageContext.length; ++i) {
                var messageContext = availableMessageContext[i];
                if (messageContext.id == ssgClusterId) {
                    for (var j = 0; j < messageContext.standard.length; ++j) {
                        if (key == messageContext.standard[j]) {
                            return true;
                        }
                    }
                    for (j = 0; j < messageContext.custom.length; ++j) {
                        if (key == messageContext.custom[j]) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        /**
         * Adds a grouping programmatically; intended for use when loading a saved settings.
         * @param {string} ssgClusterId
         * @param {string} messageContextKey
         * @param {string} constraint
         * @return {null|string} null if successful; a localized message if error
         */
        function addGrouping(ssgClusterId, ssgClusterName, ssgClusterAncestors, messageContextKey, constraint) {
            var ssgClusterPath = ssgClusterAncestors.join(' / ') + ' / ' + ssgClusterName;
            if (!isExistSSGCluster(ssgClusterId)) {
                return l7.Util.formatMessage(localizedStrings.SSG_CLUSTER_NOT_EXIST, ssgClusterPath);
            }
            if (!isExistMessageContextKey(ssgClusterId, messageContextKey)) {
                return l7.Util.formatMessage(localizedStrings.MESSAGE_CONTEXT_KEY_NOT_EXIST, messageContextKey, ssgClusterPath);
            }
            var tr = onClickAddGrouping();
            l7.Widget.selectDropDownByValue(tr._ssgClusterDropDown, ssgClusterId);
            populateGroupingMessageContextDropDown(tr._messageContextDropDown, ssgClusterId);
            l7.Widget.selectDropDownByValue(tr._messageContextDropDown, messageContextKey);
            tr._constraintTextBox.value = constraint;
            return null;
        }

        /**
         * Adds a number of groupings.
         * @param {array} groupings
         */
        function addGroupings(groupings) {
            var errMsgs = [];
            for (var i = 0; i < groupings.length; ++i) {
                var grouping = groupings[i];
                var errMsg = addGrouping(grouping.clusterId,
                                         grouping.clusterName,
                                         grouping.clusterAncestors,
                                         grouping.messageContextKey,
                                         grouping.constraint);
                if (errMsg != null) {
                    errMsgs.push(errMsg);
                }
            }

            if (errMsgs.length > 0) {
                var bodyHtml = '<div style="max-width: 600px;">' + l7.Util.escapeAsText(localizedStrings.INVALID_GROUPINGS_REMOVED) + '<ul style="margin-left: 1.5em;">';
                for (var j = 0; j < errMsgs.length; ++j) {
                    bodyHtml += '<li style="display: list-item;">' + l7.Util.escapeAsText(errMsgs[j]) + '</li>';
                }
                bodyHtml += '</ul></div>';
                l7.Dialog.showErrorDialog(localizedStrings.WARNING, bodyHtml, localizedStrings.OK);
            }

            onChangeGroupings();
        }

        /**
         * Sets the output report name.
         * @param {string} name
         */
        function setReportName(name) {
            reportNameTextBox.value = name;
            onChangeReportName();
        }

        /**
         * Populates the input fields given a settings object.
         * @param {object} settings     object literal for a settings; see http://sarek/mediawiki/index.php?title=Standard_Reports_Design#Generate_Report_.28browser_.26rarr.3B_server.29 for object structure
         */
        function setFieldsFromSettings(settings) {
            setReportType(settings.reportType);
            setEntitySelectionType(settings.entityType);
            addSelectedEntities(settings.entities);
            setTimePeriod(settings.timePeriod.timeZone,
                          settings.timePeriod.type,
                          settings.timePeriod.numberOfTimeUnits,
                          settings.timePeriod.unitOfTime,
                          settings.timePeriod.start,
                          settings.timePeriod.end);
            setTimeInterval(settings.timeInterval,
                            settings.timeInterval ? settings.timeInterval.value : null,
                            settings.timeInterval ? settings.timeInterval.unit : null);
            addGroupings(settings.groupings);
            summaryChartCheckBox.checked = settings.summaryChart;
            setReportName(settings.reportName);
        }

        /**
         * Returns a settings object from the input fields.
         * @return {object} object literal for a settings; see http://sarek/mediawiki/index.php?title=Standard_Reports_Design#Generate_Report_.28browser_.26rarr.3B_server.29 for object structure
         */
        function getSettingsFromFields() {
            var settings = {};
            settings.reportType = reportTypeDropDown.value;
            settings.entityType = getEntitySelectionType();
            settings.entities = [];
            for (var i = 0; i < entitySelectionTableBody.rows.length; ++i) {
                var tr = entitySelectionTableBody.rows[i];
                var entity = {};
                entity.clusterId = tr._ssgClusterId;
                entity.publishedServiceId = tr._publishedServiceId;
                entity.publishedServiceName = tr._publishedServiceName;
                entity.relatedId = tr._relatedId;
                if (settings.entityType == 'operation') {
                    entity.operation = tr._operation;
                } else {
                    entity.operation = null;
                }
                settings.entities.push(entity);
            }
            settings.timePeriod = {};
            settings.timePeriod.timeZone = timePeriodTimeZoneDropDown.value;
            settings.timePeriod.type = getTimePeriodType();
            if (settings.timePeriod.type == TimePeriodType.RELATIVE) {
                settings.timePeriod.numberOfTimeUnits = relativeTimePeriodTextBox.value;
                settings.timePeriod.unitOfTime = relativeTimePeriodUnitDropDown.value;
            } else if (settings.timePeriod.type == TimePeriodType.ABSOLUTE) {
                var fromDate = new Date();
                fromDate.setTime(Date.parse(absoluteTimePeriodFromDate));
                var fromHour = absoluteTimePeriodFromHourDropDown.value;
                settings.timePeriod.start = serializeDateTime(fromDate, fromHour);
                var toDate = new Date();
                toDate.setTime(Date.parse(absoluteTimePeriodToDate));
                var toHour = absoluteTimePeriodToHourDropDown.value;
                settings.timePeriod.end = serializeDateTime(toDate, toHour);
            }
            if (noTimeIntervalRadioButton.checked) {
                settings.timeInterval = null;
            } else if (hasTimeIntervalRadioButton.checked) {
                settings.timeInterval = {};
                settings.timeInterval.value = timeIntervalTextBox.value;
                settings.timeInterval.unit = timeIntervalUnitDropDown.value;
            }
            settings.groupings = [];
            for (i = 0; i < groupingTableBody.rows.length; ++i) {
                tr = groupingTableBody.rows[i];
                var grouping = {};
                grouping.clusterId = tr._ssgClusterDropDown.value;
                grouping.messageContextKey = tr._messageContextDropDown.value;
                grouping.constraint = tr._constraintTextBox.value;
                settings.groupings.push(grouping);
            }
            settings.summaryChart = summaryChartCheckBox.checked;
            settings.summaryReport = noTimeIntervalRadioButton.checked;
            settings.reportName = reportNameTextBox.value;
            return settings;
        }

        /**
         * Populates the saved settings drop down list by downloading from server.
         * Note: This is asynchronous.
         */
        function populateSettingsListDropDown() {
            while (settingsListDropDown.length > 0) {
                settingsListDropDown.remove(0);
            }
            var callback = {
                success : function(o) {
                    var result = l7.Dialog.parseJSON(
                            o.responseText,
                            localizedStrings.ERROR,
                            '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_DOWNLOAD_SAVED_SETTINGS_LIST) + '</p>',
                            localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                            localizedStrings.OK);
                    if (!l7.Util.isException(result)) {
                        for (var i = 0; i < result.length; ++i) {
                            var option = document.createElement('option');
                            option.value = result[i].id
                            option.innerHTML = result[i].name;
                            settingsListDropDown.appendChild(option); // Note: HTMLSelectElement.add(option, null) doesn't work in IE7.
                        }
                        loadSettingsButton.set('disabled', settingsListDropDown.length == 0);
                        deleteSettingsButton.set('disabled', settingsListDropDown.length == 0);
                    }
                },
                failure : function(o) {
                    loadSettingsButton.set('disabled', settingsListDropDown.length == 0);
                    deleteSettingsButton.set('disabled', settingsListDropDown.length == 0);
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_SAVED_SETTINGS_LIST + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
                }
            };
            var getSettingsListUrl = document.forms['getSettingsListForm'].action;
            YAHOO.util.Connect.asyncRequest('GET', getSettingsListUrl, callback, null);
        }

        function refreshSsgClusterSelector() {
            ssgClusterSelectorWindow.loadEntityTreeTable();
        }

        function refreshSsgClusterContentSelector() {
            var ssgCluster = ssgClusterSelectorWindow.getEntityTreeTable().getHighlightedEntity();
            var entitySelectionType = getEntitySelectionType();
            var entitiesWithTristateCheckbox = [l7.EntityTreeTable.ENTITY.SERVICE_FOLDER, entitySelectionType];
            if (entitySelectionType == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE) {
                entitiesWithTristateCheckbox.push(l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE_ALIAS);
            } else if (entitySelectionType == l7.EntityTreeTable.ENTITY.OPERATION) {
                entitiesWithTristateCheckbox.push(l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE);
                entitiesWithTristateCheckbox.push(l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE_ALIAS);
            }
            ssgClusterContentSelectorWindow.loadSsgClusterContent(ssgCluster, entitiesWithTristateCheckbox, null);
        }

        /**
         * Callback function upon an SSG Cluster highlighted.
         * @param {object} previous     the previously highlighted SSG Cluster entity object literal; null if none
         * @param {object} ssgCluster   the newly highlighted SSG Cluster entity object literal
         * @param {string} callbackId
         */
        function onHighlightSsgCluster(previous, ssgCluster, callbackId) {
            refreshSsgClusterContentSelector();
        }

        /**
         * Downloads the list of message context applicable to the SSG Clusters with selected entities.
         * Note: This is synchronous.
         */
        function loadAvailableMessageContext() {
            var postData = '';
            for (var i = 0; i < ssgClusterIdsWithSelectedEntities.length; ++i) {
                if (i != 0) postData += '&';
                postData += 'clusterGuid=' + encodeURIComponent(ssgClusterIdsWithSelectedEntities[i]);
            }
            var xhr = l7.Connection.syncRequest('POST', jsonMappingUrl, postData, false);
            if (xhr.status == 200) {
                var result = l7.Dialog.parseJSON(
                        xhr.responseText,
                        localizedStrings.ERROR,
                        '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_DOWNLOAD_MESSAGE_CONTEXT_LIST) + '</p>',
                        localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                        localizedStrings.OK);
                if (!l7.Util.isException(result) && result instanceof Array) {
                    availableMessageContext = result;
                }
            } else {
                l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DOWNLOAD_MESSAGE_CONTEXT_LIST + '<br/><br/>' + xhr.status + ' ' + xhr.statusText, localizedStrings.OK);
            }
        }

        /**
         * Populates/Repopulates a drop down list for selecting an SSG Cluster for grouping.
         * All SSG Clusters found in the SSG Cluster Selector will be listed but only those
         * with selected entities will be enabled.
         * If populating a previously empty drop down list, the first enabled SSG Cluster
         * OPTION will be selected. Otherwise, the previous selection will be restored.
         * @param {HTMLSelectElement} dropDown      the drop down list to populate
         */
        function populateGroupingSsgClusterDropDown(dropDown) {
            // Saves selected value, if any, to be restored once repopulated.
            var prevValue = null;
            if (dropDown.options.length > 0) {
                prevValue = dropDown.value;
            }

            // Removes all.
            while (dropDown.options.length > 0) {
                dropDown.remove(0);
            }

            // Populates the drop down list with each available SSG Cluster.
            var entities = ssgClusterSelectorWindow.getEntityTreeTable().getEntities();
            if (entities) {
                for (var i = 0; i < entities.length; ++i) {
                    var entity = entities[i];
                    if (entity.type == l7.EntityTreeTable.ENTITY.SSG_CLUSTER) {
                        var option = document.createElement('option');
                        option.value = entity.id;
                        if (entity.ancestors) {
                            option.innerHTML = entity.ancestors.join(' / ') + ' / ' +  entity.name;
                        } else {
                            option.innerHTML = entity.name;
                        }
                        option.disabled = !l7.Util.arrayContains(ssgClusterIdsWithSelectedEntities, option.value);
                        dropDown.appendChild(option);
                        if (prevValue) {
                            // Restores previously selected SSG Cluster.
                            if (option.value == prevValue) {
                                dropDown.selectedIndex = option.index;
                            }
                        } else {
                            // No SSG Cluster selected previously.
                            // Because the disabled attribute does not work in IE7. We have to
                            // manually set default selection to the first enabled OPTION.
                            if ((dropDown.selectedIndex == -1 || dropDown.options[dropDown.selectedIndex].disabled)
                                && !option.disabled) {
                                dropDown.selectedIndex = option.index;
                            }
                        }
                    }
                }
            }
        }

        /**
         * Populates/Repopulates a drop down list for selecting an message context key for grouping.
         * @param {HTMLSelectElement} dropDown      the drop down list to populate
         * @param {string} ssgClusterId
         */
        function populateGroupingMessageContextDropDown(dropDown, ssgClusterId) {
            while (dropDown.childNodes.length > 0) {
                dropDown.removeChild(dropDown.childNodes[0]);
            }
            for (var i = 0; i < availableMessageContext.length; ++i) {
                var messageContext = availableMessageContext[i];
                if (messageContext.id == ssgClusterId) {
                    var optGroup = document.createElement('optgroup');
                    optGroup.label = localizedStrings.STANDARD_MESSAGE_CONTEXT_MAPPING;
                    dropDown.appendChild(optGroup);
                    for (var j = 0; j < messageContext.standard.length; ++j) {
                        var option = document.createElement('option');
                        option.value = messageContext.standard[j];
                        option.innerHTML = messageContext.standard[j];
                        optGroup.appendChild(option);
                    }

                    if (messageContext.custom.length > 0) {
                        optGroup = document.createElement('optgroup');
                        optGroup.label = localizedStrings.CUSTOM_MESSAGE_CONTEXT_MAPPING;
                        dropDown.appendChild(optGroup);
                        for (j = 0; j < messageContext.custom.length; ++j) {
                            option = document.createElement('option');
                            option.value = messageContext.custom[j];
                            option.innerHTML = messageContext.custom[j];
                            optGroup.appendChild(option);
                        }
                    }

                    break;
                }
            }
        }

        function loadOutputTableBody() {
            // TODO
        }

        /**
         * Note: This uses an asynchronous call.
         */
        function onClickLoadSettings() {
            var settingsName = settingsListDropDown.options[settingsListDropDown.selectedIndex].text;
            var settingsId = settingsListDropDown.value;
            var callback = {
                success : function(o) {
                    l7.Dialog.hideWaitDialog();
                    var result = l7.Dialog.parseJSON(
                            o.responseText,
                            localizedStrings.ERROR,
                            l7.Util.formatMessage(localizedStrings.CANNOT_DOWNLOAD_SAVED_SETTINGS, settingsName),
                            localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                            localizedStrings.OK);
                    if (!l7.Util.isException(result)) {
                        if (result.warning) {
                            var bodyHtml = '<div style="max-width: 600px;">' + result.warning;
                            if (result.warningItems && result.warningItems instanceof Array && result.warningItems.length > 0) {
                                bodyHtml += '<ul style="margin-left: 1.5em;">'
                                for (var i = 0; i < result.warningItems.length; ++i) {
                                    var warningItem = result.warningItems[i];
                                    bodyHtml += '<li style="display: list-item;">' + l7.Util.escapeAsText(warningItem) + '</li>';
                                }
                                bodyHtml += '</ul>';
                            }
                            bodyHtml += '</div>';
                            l7.Dialog.showErrorDialog(localizedStrings.WARNING, bodyHtml, localizedStrings.OK);
                        }
                        setFieldsFromSettings(result);
                        document.getElementById('saveSettingsDialog_name').value = settingsName;
                    }
                },
                failure : function(o) {
                    l7.Dialog.hideWaitDialog();
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, l7.Util.formatMessage(localizedStrings.CANNOT_DOWNLOAD_SAVED_SETTINGS, settingsName) + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
                }
            };
            var getSettingsUrl = document.forms['getSettingsForm'].action;
            var postData = 'id=' + encodeURIComponent(settingsId);
            l7.Dialog.showWaitDialog(l7.Util.formatMessage(localizedStrings.LOADING_SAVED_SETTINGS, settingsName));
            YAHOO.util.Connect.asyncRequest('POST', getSettingsUrl, callback, postData);
        }

        function onClickSaveSettings() {
            validateSaveSettingsDialog();
            saveSettingsDialog.center();
            saveSettingsDialog.show();
        }

        function onClickDeleteSettings() {
            var selected = settingsListDropDown.options[settingsListDropDown.selectedIndex];
            document.getElementById('deleteSettingsDialog_id').value = selected.value;
            document.getElementById('deleteSettingsDialog_name').innerHTML = l7.Util.escapeAsText(selected.text);
            deleteSettingsDialog.center();
            deleteSettingsDialog.show();
        }

        function onClickAddEntity() {
            var ssgCluster = ssgClusterContentSelectorWindow.getSsgCluster();
            var entities = ssgClusterContentSelectorWindow.getEntityTreeTable().getEntitiesWithTristateCheckboxSelected();
            var entitySelectionType = getEntitySelectionType();

            for (var i = 0; i < entities.length; ++i) {
                var entity = entities[i];

                if (entitySelectionType == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE) {
                    if (entity.type != l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE &&
                        entity.type != l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE_ALIAS) {
                        continue;
                    }
                } else if (entitySelectionType == l7.EntityTreeTable.ENTITY.OPERATION) {
                    if (entity.type != l7.EntityTreeTable.ENTITY.OPERATION) {
                        continue;
                    }
                } else {
                    continue;
                }

                var publishedService;
                var operation;
                if (entity.type == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE || entity.type == l7.EntityTreeTable.ENTITY.PUBLISHED_SERVICE_ALIAS) {
                    publishedService = entity;
                } else if (entity.type == l7.EntityTreeTable.ENTITY.OPERATION) {
                    publishedService = ssgClusterContentSelectorWindow.getEntityTreeTable().getParentEntity(entity);
                    operation = entity.name;
                }

                addEntity(ssgCluster.id, ssgCluster.name, ssgCluster.ancestors, publishedService.id, publishedService.name, publishedService.relatedId, operation);
            }
            onChangeSelectedEntities();
        }

        function onClickDeleteEntity(event, tr) {
            entitySelectionTableBody.removeChild(tr);
            onChangeSelectedEntities();
        }

        /**
         * @return {HTMLTableRowElement} the newly created TR element
         */
        function onClickAddGrouping() {
            var tr = groupingTableBody.insertRow(-1);
            var td;

            // Delete button column.
            var deleteImg = document.createElement('img');
            deleteImg.src = '../images/delete.png';
            deleteImg.className = 'clickable';
            deleteImg.title = localizedStrings.REMOVE;
            YAHOO.util.Event.addListener(deleteImg, 'click', onClickDeleteGrouping, tr);
            td = tr.insertCell(-1);
            td.appendChild(deleteImg);

            // SSG Cluster drop down list column.
            var ssgClusterDropDown = document.createElement('select');
            populateGroupingSsgClusterDropDown(ssgClusterDropDown);
            td = tr.insertCell(-1);
            td.appendChild(ssgClusterDropDown);
            // Warning icon; appears when the SSG Cluster selected in the drop down list
            // is no long part of selected entities.
            var ssgClusterWarningImg = document.createElement('img');
            ssgClusterWarningImg.src = '../images/warning.png';
            ssgClusterWarningImg.className = 'middle';
            ssgClusterWarningImg.style.display = 'none';
            td.appendChild(ssgClusterWarningImg);

            // Message context drop down list column.
            var messageContextDropDown = document.createElement('select');
            populateGroupingMessageContextDropDown(messageContextDropDown, ssgClusterDropDown.value);
            YAHOO.util.Event.addListener(messageContextDropDown, 'change',
                function(event) {
                    updateSaveSettingsButton();
                    updateGenerateButton();
                }
            );
            td = tr.insertCell(-1);
            td.appendChild(messageContextDropDown);
            YAHOO.util.Event.addListener(ssgClusterDropDown, 'change',
                function(event, tr) {
                    var ssgClusterDropDown = tr._ssgClusterDropDown;
                    var messageContextDropDown = tr._messageContextDropDown;
                    populateGroupingMessageContextDropDown(messageContextDropDown, ssgClusterDropDown.value);
                    updateSaveSettingsButton();
                    updateGenerateButton();
                },
                tr
            );
            // Warning icon; appears when the number of unique keys specified per SSG Cluster exceeds 5.
            var msgCtxKeyWarningImg = document.createElement('img');
            msgCtxKeyWarningImg.src = '../images/warning.png';
            msgCtxKeyWarningImg.className = 'middle';
            msgCtxKeyWarningImg.style.display = 'none';
            td.appendChild(msgCtxKeyWarningImg);

            // Constraint value column.
            var constraintTextBox = document.createElement('input');
            constraintTextBox.type = 'text';
            constraintTextBox.style.width = '95%'; // Any better solution?
            constraintTextBox.maxLength = '255';
            td = tr.insertCell(-1);
            td.appendChild(constraintTextBox);

            // Stashes the HTML element into the TR element for easy reference.
            tr._ssgClusterDropDown = ssgClusterDropDown;
            tr._ssgClusterWarningImg = ssgClusterWarningImg;
            tr._messageContextDropDown = messageContextDropDown;
            tr._msgCtxKeyWarningImg = msgCtxKeyWarningImg;
            tr._constraintTextBox = constraintTextBox;

            onChangeGroupings();

            return tr;
        }

        function onClickDeleteGrouping(event, tr) {
            groupingTableBody.removeChild(tr);
            onChangeGroupings();
        }

        function onClickGenerate() {
            var callback = {
                success : function(o) {
                    l7.Dialog.hideWaitDialog();
                    var result = l7.Dialog.parseJSON(
                            o.responseText,
                            localizedStrings.ERROR,
                            '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_SUBMIT_GENERATE_REPORT) + '</p>',
                            localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                            localizedStrings.OK);
                    if (!l7.Util.isException(result)) {
                        // No return object expected.
                        l7.Dialog.showInfoDialog('Standard Report', 'Request for standard report has been submitted for generation.', localizedStrings.OK);
                    }
                },
                failure : function(o) {
                    l7.Dialog.hideWaitDialog();
                    l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_SUBMIT_GENERATE_REPORT + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
                }
            };
            var settings = getSettingsFromFields();
            var postData = YAHOO.lang.JSON.stringify(settings);
            l7.Dialog.showWaitDialog(localizedStrings.SUBMITTING_GENERATE_REPORT + '...');
            YAHOO.util.Connect.setDefaultPostHeader(false);
            YAHOO.util.Connect.initHeader('Content-Type', 'application/json; charset=utf-8');
            YAHOO.util.Connect.asyncRequest('POST', generateReportUrl, callback, postData);
            YAHOO.util.Connect.setDefaultPostHeader(true);
        }

        function onClickDownloadOutput() {
            // TODO
            l7.Dialog.showErrorDialog(null, 'Not Implemented yet!', null);
        }

        function onClickDeleteOutput() {
            // TODO
            l7.Dialog.showErrorDialog(null, 'Not Implemented yet!', null);
        }

        /**
         * Verifies if all inputs in the save settings dialog are valid.
         * @return {boolean} true if valid
         */
        function validateSaveSettingsDialog() {
            var name = document.getElementById('saveSettingsDialog_name').value;
            var valid = name.length > 0;
            var okButton = saveSettingsDialog.getButtons()[0];
            okButton.set('disabled', !valid);
            return valid;
        }

        /**
         * Saves the current settings.
         *
         * If "overwrite" is false, the request is sent to a server address which should
         * respond, if duplicate settings name exists, with a JSON object whose property
         * "reconfirm" set to true; otherwise responds with a JSON "null".
         *
         * If "overwrite" is true, the request is sent to another server address which
         * should overwrite any duplicate settings and responds with a JSON "null".
         *
         * Note: This uses a synchronous call.
         *
         * @param {string} name         settings name to save as
         * @param {boolean} overwrite   true to overwrite existing settings with same name without confirmation dialog
         */
        function saveSettings(name, overwrite) {
            var settings = getSettingsFromFields();
            settings.name = name;   // Add settings name to request payload object.
            var postData = YAHOO.lang.JSON.stringify(settings);
            // PROTOTYPE ONLY BEGIN
            var saveSettingsUrl = 'action/standardReport/saveSettings';
            if (name.indexOf('duplicate') != -1) {
                // Provides a way to test settings name already exists.
                saveSettingsUrl = 'action/standardReport/saveSettings_DUPLICATE.json';
            } else if (name.indexOf('exception') != -1) {
                // Provides a way to test exception response.
                saveSettingsUrl = 'action/standardReport/saveSettings_EXCEPTION.json';
            } else if (name.indexOf('404') != -1) {
                // Provides a way to test 404 response.
                saveSettingsUrl = '_no_such_address_';
            }
            var saveSettingsOverwriteUrl = 'action/standardReport/saveSettingsOverwrite';
            // PROTOTYPE ONLY END
            var url = overwrite ? saveSettingsOverwriteUrl : saveSettingsUrl;
            var xhr = l7.Connection.syncRequest('POST', url, postData, true);
            if (xhr.status == 200) {
                var result = l7.Dialog.parseJSON(
                        xhr.responseText,
                        localizedStrings.ERROR,
                        '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_SAVE_SETTINGS) + '</p>',
                        localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                        localizedStrings.OK);
                if (!l7.Util.isException(result)) {
                    if (result == null) {
                        // No return object expected.
                        l7.Dialog.showInfoDialog(localizedStrings.SETTINGS_SAVED_TITLE, localizedStrings.SETTINGS_SAVED, localizedStrings.OK);
                        populateSettingsListDropDown();    // Refreshes to show added settings.
                    } else if (result.reconfirm != undefined && result.reconfirm == true) {
                        document.getElementById('saveSettingsOverwriteForm_name').value = name;
                        document.getElementById('saveSettingsOverwriteDialog_name').innerHTML = l7.Util.escapeAsText(name);
                        saveSettingsOverwriteDialog.center();
                        saveSettingsOverwriteDialog.show();
                    }
                }
            } else {
                l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_SAVE_SETTINGS + '<br/><br/>' + xhr.status + ' ' + xhr.statusText, localizedStrings.OK);
            }
        }

        function initButtons() {
            loadSettingsButton = new YAHOO.widget.Button('loadSettingsButton', {
                onclick : {fn : onClickLoadSettings},
                type : 'push'
            });
            saveSettingsButton = new YAHOO.widget.Button('saveSettingsButton', {
                onclick : {fn : onClickSaveSettings},
                type : 'push'
            });
            deleteSettingsButton = new YAHOO.widget.Button('deleteSettingsButton', {
                onclick : {fn : onClickDeleteSettings},
                type : 'push'
            });
            addEntityButton = new YAHOO.widget.Button('addEntityButton', {
                onclick : {fn : onClickAddEntity},
                type : 'push'
            });
            addGroupingButton = new YAHOO.widget.Button('addGroupingButton', {
                onclick : {fn : onClickAddGrouping},
                type : 'push'
            });
            generateButton = new YAHOO.widget.Button('generateButton', {
                onclick : {fn : onClickGenerate},
                type : 'push'
            });
            downloadOutputButton = new YAHOO.widget.Button('downloadOutputButton', {
                onclick : {fn : onClickDownloadOutput},
                type : 'push'
            });
            deleteOutputButton = new YAHOO.widget.Button('deleteOutputButton', {
                onclick : {fn : onClickDeleteOutput},
                type : 'push'
            });
        }

        function initSaveSettingsDialog() {
            saveSettingsDialog = new YAHOO.widget.Dialog('saveSettingsDialog', {
                buttons     : [
                    {
                        text      : localizedStrings.OK,
                        handler   : function() {
                            this.hide();
                            var settingsName = document.getElementById('saveSettingsDialog_name').value;
                            saveSettings(settingsName, false);
                        },
                        isDefault : true
                    },
                    {
                        text      : localizedStrings.CANCEL,
                        handler   : function() {
                            this.hide();
                        }
                    }
                ],
                close       : true,
                draggable   : true,
                icon        : YAHOO.widget.SimpleDialog.ICON_BLOCK,
                modal       : true,
                postmethod  : 'manual', // Because payload is JSON data format, not FORM data.
                visible     : false
            });
            saveSettingsDialog.manualSubmitEvent.subscribe(function() {
                if (validateSaveSettingsDialog()) {
                    var settingsName = document.getElementById('saveSettingsDialog_name').value;
                    saveSettings(settingsName, false);
                } // else treat as cancel
            }); // To handle ENTER key press.
            saveSettingsDialog.render();
        }

        function initSaveSettingsOverwriteDialog() {
            saveSettingsOverwriteDialog = new YAHOO.widget.Dialog('saveSettingsOverwriteDialog', {
                buttons     : [
                    {
                        text      : localizedStrings.YES,
                        handler   : function() {
                            saveSettings(document.getElementById('saveSettingsOverwriteForm_name').value, true);
                            this.hide();
                        },
                        isDefault : true
                    },
                    {
                        text      : localizedStrings.NO,
                        handler   : function() {
                            this.hide();
                        }
                    }
                ],
                close       : true,
                draggable   : true,
                icon        : YAHOO.widget.SimpleDialog.ICON_BLOCK,
                modal       : true,
                visible     : false
            });
            saveSettingsOverwriteDialog.render();
        }

        function initDeleteSettingsDialog() {
            deleteSettingsDialog = new YAHOO.widget.Dialog('deleteSettingsDialog', {
                buttons     : [
                    {
                        text      : localizedStrings.OK,
                        handler   : function() {
                            this.submit();
                        },
                        isDefault : true
                    },
                    {
                        text      : localizedStrings.CANCEL,
                        handler   : function() {
                            this.hide();
                        }
                    }
                ],
                close       : true,
                draggable   : true,
                icon        : YAHOO.widget.SimpleDialog.ICON_BLOCK,
                modal       : true,
                postmethod  : 'async',
                visible     : false
            });
            deleteSettingsDialog.render();
            deleteSettingsDialog.callback.success = function(o) {
                var result = l7.Dialog.parseJSON(
                        o.responseText,
                        localizedStrings.ERROR,
                        '<p>' + l7.Util.escapeAsText(localizedStrings.CANNOT_DELETE_SETTINGS) + '</p>',
                        localizedStrings.CANNOT_PARSE_RESPONSE_JSON,
                        localizedStrings.OK);
                if (!l7.Util.isException(result)) {
                    // No return object expected.
                    populateSettingsListDropDown();    // Refreshes to show deleted settings.
                }
            }
            deleteSettingsDialog.callback.failure = function(o) {
                l7.Dialog.showErrorDialog(localizedStrings.ERROR, localizedStrings.CANNOT_DELETE_SETTINGS + '<br/><br/>' + o.status + ' ' + o.statusText, localizedStrings.OK);
            }
        }

        function initDialogs() {
            initSaveSettingsDialog();
            initSaveSettingsOverwriteDialog();
            initDeleteSettingsDialog();
        }

        function initSsgClusterSelector(iframe) {
            iframe.contentWindow.setEntityHighlightedCallback(onHighlightSsgCluster);
        }

        function initSsgClusterContentSelector(iframe) {
            // Nothing to do.
        }

        function init() {
            relativeTimePeriodRadioButton      = document.getElementById('relativeTimePeriodRadioButton');
            relativeTimePeriodTextBox          = document.getElementById('relativeTimePeriodTextBox');
            relativeTimePeriodHint             = document.getElementById('relativeTimePeriodHint');
            relativeTimePeriodUnitDropDown     = document.getElementById('relativeTimePeriodUnitDropDown');
            absoluteTimePeriodRadioButton      = document.getElementById('absoluteTimePeriodRadioButton');
            absoluteTimePeriodFromDateTextBox  = document.getElementById('absoluteTimePeriodFromDateTextBox');
            absoluteTimePeriodFromHourDropDown = document.getElementById('absoluteTimePeriodFromHourDropDown');
            absoluteTimePeriodToHourDropDown   = document.getElementById('absoluteTimePeriodToHourDropDown');
            absoluteTimePeriodToDateTextBox    = document.getElementById('absoluteTimePeriodToDateTextBox');
            absoluteTimePeriodHint             = document.getElementById('absoluteTimePeriodHint');
            timePeriodTimeZoneDropDown         = document.getElementById('timePeriodTimeZoneDropDown');

            hasTimeIntervalRadioButton = document.getElementById('hasTimeIntervalRadioButton');
            noTimeIntervalRadioButton  = document.getElementById('noTimeIntervalRadioButton');
            timeIntervalTextBox        = document.getElementById('timeIntervalTextBox');
            timeIntervalUnitDropDown   = document.getElementById('timeIntervalUnitDropDown');
            timeIntervalHint           = document.getElementById('timeIntervalHint');

            settingsListDropDown            = document.getElementById('settingsListDropDown');
            reportTypeDropDown              = document.getElementById('reportTypeDropDown');
            publishedServiceRadioButton     = document.getElementById('publishedServiceRadioButton');
            operationRadioButton            = document.getElementById('operationRadioButton');
            ssgClusterSelectorWindow        = document.getElementById('ssgClusterSelector').contentWindow;
            ssgClusterContentSelectorWindow = document.getElementById('ssgClusterServiceContentSelector').contentWindow;
            messageWhenNoEntitySelected     = document.getElementById('messageWhenNoEntitySelected');
            entitySelectionTableBody        = document.getElementById('entitySelectionTableBody');
            groupingHint                    = document.getElementById('groupingHint');
            messageWhenNoGrouping           = document.getElementById('messageWhenNoGrouping');
            groupingTableBody               = document.getElementById('groupingTableBody');
            summaryChartCheckBox            = document.getElementById('summaryChartCheckBox');
            reportNameTextBox               = document.getElementById('reportNameTextBox');

            l7.Widget.initHourlyDropDown(absoluteTimePeriodFromHourDropDown);
            l7.Widget.initHourlyDropDown(absoluteTimePeriodToHourDropDown);
            initButtons();
            initDialogs();
            populateSettingsListDropDown();

            onChangeTimePeriodType();
            onChangeTimeInterval();
            updateAddGroupingButton();
            updateGenerateButton();
        }

        YAHOO.util.Event.onDOMReady(init);
    </script>
    </wicket:head>
</head>
<body class="yui-skin-sam">
<noscript><div class="javascriptWarning">This page requires JavaScript. Your browser either does not have JavaScript support or has disabled it.</div></noscript>
<table width="100%">
    <tr>
        <td>
            <div class="header">
                <table width="100%">
                    <tr class="header">
                        <td class="logoLeft"><img src="../images/logoLeft.png" alt="" /></td>
                        <td class="logo"><a href="Monitor.html"><img src="../images/l7Logo.png" alt="Layer 7 Technologies Inc." /><img src="../images/esmLogo.png" alt="" /></a></td>
                        <td class="logoRight"><img src="../images/logoRight.png" alt="" /></td>
                        <td width="100%"><img src="../images/spacer.png" alt="" /></td>
                        <td class="middle nowrap">Logged in as "admin"<br />since May 5, 2008 05:57:54 PM</td>
                        <td class="middle"><form method="get" action="Login.html"><input type="submit" value="Log Out" /></form></td>
                        <td class="middle help"><a href="Help.html" target="l7-esm-help" title="Open help page in a separate window">Help</a></td>
                    </tr>
                </table>
            </div>
            <div class="divider"><img src="../images/spacer.png" alt="" /></div>
            <div>
                <table>
                    <tr>
                        <td id="tabLTManageGateways"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTManageGateways" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTManageGateways"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTManagePolicies"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTManagePolicies" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTManagePolicies"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTReports"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTReports" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTReports"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTTools"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTTools" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTTools"><img src="../images/tabRT.png" alt="" /></td>
                        <td id="tabLTSettings"><img src="../images/tabLT.png" alt="" /></td>
                        <td id="tabCTSettings" class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRTSettings"><img src="../images/tabRT.png" alt="" /></td>
                        <td><img src="../images/tabLT.png" alt="" /></td>
                        <td class="tabCT"><img src="../images/spacer.png" alt="" /></td>
                        <td><img src="../images/tabRT.png" alt="" /></td>
                    </tr>
                    <tr>
                        <td id="tabLMManageGateways" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMManageGateways" class="tabCM"><a href="Monitor.html">Manage Gateways</a></td>
                        <td id="tabRMManageGateways" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMManagePolicies" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMManagePolicies" class="tabCM"><a href="PolicyMigration.html">Manage Policies</a></td>
                        <td id="tabRMManagePolicies" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMReports" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMReports" class="tabCMon">Reports</td>
                        <td id="tabRMReports" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMTools" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMTools" class="tabCM"><a href="Messages.html">Tools</a></td>
                        <td id="tabRMTools" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabLMSettings" class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabCMSettings" class="tabCM"><a href="UserSettings.html">Settings</a></td>
                        <td id="tabRMSettings" class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabLM"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabCM" width="100%"><img src="../images/spacer.png" alt="" /></td>
                        <td class="tabRM"><img src="../images/spacer.png" alt="" /></td>
                    </tr>
                    <tr>
                        <td id="tabLBManageGateways"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBManageGateways" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBManageGateways"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBManagePolicies"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBManagePolicies" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBManagePolicies"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBReports"><img src="../images/tabLBon.png" alt="" /></td>
                        <td id="tabCBReports" class="tabCBon"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBReports"><img src="../images/tabRBon.png" alt="" /></td>
                        <td id="tabLBTools"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBTools" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBTools"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td id="tabLBSettings"><img src="../images/tabLBoff.png" alt="" /></td>
                        <td id="tabCBSettings" class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td id="tabRBSettings"><img src="../images/tabRBoff.png" alt="" /></td>
                        <td><img src="../images/tabLBoff.png" alt="" /></td>
                        <td class="tabCBoff"><img src="../images/spacer.png" alt="" /></td>
                        <td><img src="../images/tabRBoff.png" alt="" /></td>
                    </tr>
                </table>
            </div>
            <script language="JavaScript" type="text/javascript">
                l7.TabBar.initTab('ManageGateways');
                l7.TabBar.initTab('ManagePolicies');
                l7.TabBar.initTab('Tools');
                l7.TabBar.initTab('Settings');
            </script>
            <div class="subtabBar">
                <span class="subtabOn">Standard Reports</span>
            </div>
            <div class="content">
                <wicket:extend>
                <div class="panel">
                    <div class="panelTitle tippy"><img id="newReportTippy" class="tippy" src="../images/tippyExpanded.png" alt="" onclick="l7.Tippy.toggleTippy(this, 'newReportDiv')" /><span class="clickable" onclick="l7.Tippy.toggleTippy('newReportTippy', 'newReportDiv')">Generate New Report</span></div>
                    <div id="newReportDiv">
                        <div class="panelToolbar">
                            <table> <!-- Any other way to middle-align SELECT and BUTTON elements? -->
                                <tr>
                                    <td class="middle"><button id="loadSettingsButton" title="Load selected settings">Load Settings:</button></td>
                                    <td class="middle">
                                        <select id="settingsListDropDown">
                                            <option></option> <!-- Workaround for IE7 bug: Weird overlap without this. -->
                                        </select>
                                    </td>
                                    <td class="middle"><img class="refresh clickableImg middle" src="../images/refresh.png" title="Refresh list of saved settings" alt="Refresh" onclick="populateSettingsListDropDown();" /></td>
                                    <td class="middle"><button id="deleteSettingsButton" title="Delete selected setttings">Delete</button></td>
                                    <td class="middle"><button id="saveSettingsButton" title="Save as a named setttings">Save Settings As ...</button></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panelContent">
                        <form wicket:id="form">
                            <table class="spaced">
                                <tr>
                                    <th class="middle">Report Type:</th>
                                    <td class="middle">
                                        <select id="reportTypeDropDown" onchange="onChangeReportType();">
                                            <option value="performance">Performance Statistics</option>
                                            <option value="usage">Usage Report</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="top">Entity Selection:</th>
                                    <td width="100%">
                                        <div class="panel noMargin">
                                            <div class="panelToolbar">
                                                Select by:
                                                <input id="publishedServiceRadioButton" type="radio" name="selectionType" value="publishedService" onclick="onChangeEntitySelectionType();" checked/>
                                                <label for="publishedServiceRadioButton">Published Service</label>
                                                <input id="operationRadioButton" type="radio" name="selectionType" value="operation" onclick="onChangeEntitySelectionType();"/>
                                                <label for="operationRadioButton">Operation</label>
                                            </div>
                                                <table class="explorer" width="100%">
                                                    <tr>
                                                        <th width="50%"><img src="../images/spacer.png" alt="" height="0" width="350" /><!-- minimum width --></th>
                                                        <th width="50%"><img src="../images/spacer.png" alt="" height="0" width="350" /><!-- minimum width --></th>
                                                    </tr>
                                                    <tr>
                                                        <th>SSG Clusters <img class="refresh clickableImg middle" src="../images/refresh.png" title="Refresh list of SSG Clusters" alt="Refresh" onclick="refreshSsgClusterSelector();"/></th>
                                                        <th><span title="Content of selected SSG Cluster">Content</span> <img class="refresh clickableImg middle" src="../images/refresh.png" title="Refresh list of content" alt="Refresh" onclick="refreshSsgClusterContentSelector();"/></th>
                                                    </tr>
                                                    <tr>
                                                        <td class="srcDest"><iframe id="ssgClusterSelector" src="SSGClusterSelector.html" frameborder="0" scrolling="yes" height="200" width="100%" onload="initSsgClusterSelector(this);"></iframe></td>
                                                        <td class="srcDest"><iframe id="ssgClusterServiceContentSelector" src="SSGClusterServiceContentSelector.html" frameborder="0" scrolling="yes" height="200" width="100%" onload="initSsgClusterContentSelector(this);"></iframe></td>
                                                    </tr>
                                                </table>
                                            <div class="panelToolbar">
                                                <button id="addEntityButton">Add Checked Published Service(s)</button>
                                            </div>
                                            <div class="panelContent smallPadding">
                                                <table class="dataTable">
                                                    <thead>
                                                        <tr>
                                                            <th><!-- deletion image button --></th>
                                                            <th>SSG Cluster</th>
                                                            <th>Published Service</th>
                                                            <th width="100%">Operation</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="messageWhenNoEntitySelected">
                                                        <tr>
                                                            <td colspan="4"><img src="../images/warning.png" alt="" /> <span class="middle">Please add at least one entity.</span></td>
                                                        </tr>
                                                    </tbody>
                                                    <tbody id="entitySelectionTableBody"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="middle">Time Period:</th>
                                    <td class="middle">
                                        Time Zone: 
                                        <select id="timePeriodTimeZoneDropDown" wicket:id="timezone" onchange="onChangeTimePeriodTimeZone();">
                                            <option value="Canada/Pacific" selected="selected">Canada/Pacific (GMT-08:00/-07:00)</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th></th>
                                    <td class="middle">
                                        <table> <!-- Any other way to middle-align SELECT and BUTTON elements? -->
                                            <tr>
                                                <td class="middle"><input id="relativeTimePeriodRadioButton" type="radio" name="timePeriodType" value="relative" onclick="onChangeTimePeriodType();" checked/></td>
                                                <td class="middle"><label for="relativeTimePeriodRadioButton">Last</label></td>
                                                <td class="middle"><input id="relativeTimePeriodTextBox" class="right" type="text" size="9" maxlength="9" value="1" onkeyup="onChangeRelativeTimePeriod();"/></td>
                                                <td class="middle">
                                                    <select id="relativeTimePeriodUnitDropDown" name="relativeTimePeriodUnit">
                                                        <option value="HOUR">hours</option>
                                                        <option value="DAY" selected>days</option>
                                                        <option value="WEEK">weeks</option>
                                                        <option value="MONTH">months</option>
                                                    </select>
                                                </td>
                                                <td class="middle"><span id="relativeTimePeriodHint" class="red"></span></td>
                                                <td class="middle"><span id="relativeTimePeriodSpan"></span></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th></th>
                                    <td>
                                        <table>
                                            <tr>
                                                <td class="middle"><input id="absoluteTimePeriodRadioButton" type="radio" name="timePeriodType" value="absolute" onclick="onChangeTimePeriodType();"/></td>
                                                <td class="middle"><label for="absoluteTimePeriodRadioButton">From</label></td>
                                                <td class="middle"><div wicket:id="fromDate"/></td>
                                                <td class="middle"><select id="absoluteTimePeriodFromHourDropDown" onchange="onChangeAbsoluteTimePeriod();"></select></td>
                                                <td class="middle">To</td>
                                                <td class="middle"><div wicket:id="toDate"/></td>
                                                <td class="middle"><select id="absoluteTimePeriodToHourDropDown" onchange="onChangeAbsoluteTimePeriod();"></select></td>
                                                <td class="middle"><span id="absoluteTimePeriodHint" class="red"></span></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="middle">Time Interval:</th>
                                    <td class="middle">
                                        <table>
                                            <tr>
                                                <td class="middle"><input id="noTimeIntervalRadioButton" type="radio" name="timeInterval" value="false" onclick="onChangeTimeInterval();" checked/></td>
                                                <td class="middle"><label for="noTimeIntervalRadioButton">None (Summary Report)</label></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th></th>
                                    <td>
                                        <table> <!-- Any other way to middle-align SELECT and BUTTON elements? -->
                                            <tr>
                                                <td class="middle"><input id="hasTimeIntervalRadioButton" type="radio" name="timeInterval" value="true" onclick="onChangeTimeInterval();"/></td>
                                                <td class="middle"><label for="hasTimeIntervalRadioButton">Interval:</label></td>
                                                <td class="middle"><input id="timeIntervalTextBox" class="right" type="text" size="9" maxlength="9" value="1" onkeyup="onChangeTimeInterval();"/></td>
                                                <td class="middle">
                                                    <select id="timeIntervalUnitDropDown" name="timeIntervalUnit">
                                                        <option value="HOUR">hours</option>
                                                        <option value="DAY">days</option>
                                                        <option value="WEEK">weeks</option>
                                                        <option value="MONTH">months</option>
                                                    </select>
                                                </td>
                                                <td class="middle"><span id="timeIntervalHint" class="red"></span></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="top">Grouping:</th>
                                    <td>
                                        <div class="panel noMargin">
                                            <div class="panelToolbar">
                                                <table>
                                                    <tr>
                                                        <td><button id="addGroupingButton">Add Grouping by Message Context Key</button></td>
                                                        <td class="top" width="100%">
                                                            <span class="note">Use grouping only if service policy contains Message Context Assertion(s).</span>
                                                            <br/>
                                                            <span id="groupingHint" class="red note">There must be at least one grouping for Usage Report.</span>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <div class="panelContent smallPadding">
                                                <table class="dataTable">
                                                    <thead>
                                                        <tr>
                                                            <th><!-- deletion image button --></th>
                                                            <th>SSG Cluster</th>
                                                            <th>Message Context Key</th>
                                                            <th width="100%">Key Value Filter <span class="note">(optional, wildcard * allowed)</span></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="messageWhenNoGrouping">
                                                        <tr>
                                                            <td colspan="4">None specified.</td>
                                                        </tr>
                                                    </tbody>
                                                    <tbody id="groupingTableBody"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Charting:</th>
                                    <td>
                                        <input id="summaryChartCheckBox" type="checkbox" checked/>
                                        <label for="summaryChartCheckBox">Include Summary Chart</label>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Report Name:</th>
                                    <td><input id="reportNameTextBox" type="text" maxlength="128" style="width: 97%;" onkeyup="onChangeReportName();"/></td>
                                </tr>
                            </table>
                            </form>                    
                            <div class="middle nowrap">
                                <button id="generateButton">Generate Report</button>
                            </div>
                        </div>
                    </div>
                </div>
                <script lanaguge="javascript" wicket:id="fromDateJavascript"></script>
                <script lanaguge="javascript" wicket:id="toDateJavascript"></script>
                <div wicket:id="generatedReports" style="min-height: 200px;">
                <div class="panel">
                    <div class="panelTitle tippy">
                        <img id="generatedReportsTippy" class="tippy" src="../images/tippyExpanded.png" alt="" onclick="l7.Tippy.toggleTippy(this, 'generatedReportsDiv')" />
                        <span class="clickable" onclick="l7.Tippy.toggleTippy('generatedReportsTippy', 'generatedReportsDiv')">Generated Reports</span>
                        <img class="refresh clickableImg middle" src="../images/refresh.png" title="Refresh list of generated reports" alt="Refresh" onclick="" />
                    </div>
                    <div id="generatedReportsDiv">
                        <div class="panelToolbar">
                            <table class="spaced"> <!-- Any other way to middle-align SELECT and BUTTON elements? -->
                                <tr>
                                    <td class="middle">Output Format: </td>
                                    <td class="middle"><select><option>PDF</option></select></td>
                                    <td class="middle"><button id="downloadOutputButton" title="Zip and download checked reports">Zip and Download</button></td>
                                    <td class="middle"><button id="deleteOutputButton" title="Delete checked reports">Delete</button></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panelContent">
                            <!-- Table of generated reports goes here. -->
                        </div>
                    </div>
                </div>
                </div>

                <div wicket:id="jsonMappings"/>
                <div wicket:id="postReportParameters">
                    
                </div>

                <div style="display: none;">
                    <form name="getSettingsListForm" action="TODO_ToBeGeneratedByWicket" method="POST">
                    </form>
                </div>

                <div style="display: none;">
                    <form name="getSettingsForm" action="TODO_ToBeGeneratedByWicket" method="POST">
                        <input id="getSettingsForm_id" type="hidden"/>
                    </form>
                </div>

                <div id="saveSettingsDialog">
                    <div class="hd">Save Settings As</div>
                    <div class="bd">
                        <form> <!-- No action because this is used merely to focus input and handle ENTER key press. -->
                            <table class="spaced">
                                <tr>
                                    <th>Settings Name:</th>
                                    <td><input type="text" id="saveSettingsDialog_name" name="name" size="40" maxlength="128" onkeyup="validateSaveSettingsDialog();" /></td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>

                <div id="saveSettingsOverwriteDialog">
                    <div class="hd">Duplicate Settings Name</div>
                    <div class="bd">
                        <form> <!-- No action because this is used merely to focus input and handle ENTER key press. -->
                            <input id="saveSettingsOverwriteForm_name" type="hidden"/>
                            A settings with the name &ldquo;<span id="saveSettingsOverwriteDialog_name"></span>&rdquo;
                            already exists.
                            <br/>
                            <br/>
                            Overwrite?
                        </form>
                    </div>
                </div>

                <div id="deleteSettingsDialog">
                    <div class="hd">Delete Settings</div>
                    <div class="bd">
                        <form action="action/standardReport/deleteSettings" method="POST">
                            <input id="deleteSettingsDialog_id" type="hidden" name="id" />
                            Delete the setting &ldquo;<span id="deleteSettingsDialog_name"></span>&rdquo;?
                        </form>
                    </div>
                </div>
                </wicket:extend>

            </div>
            <div class="statusBar">
                <table>
                    <tr>
                        <td width="100%">Time Zone: Canada/Pacific (GMT-08:00/<b>-07:00</b>)</td>
                        <td><a class="nowrap" href="http://www.layer7tech.com" target="_blank">Layer 7 Technologies Inc.</a></td>
                    </tr>
                </table>
            </div>
            <div class="divider"><img src="../images/spacer.png" alt="" /></div>
        </td>
    </tr>
</table>
</body>
</html>
