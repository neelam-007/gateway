<?xml version="1.0" encoding="UTF-8"?>
<!-- Ant build file for all modules. -->
<project name="updateinstaller" default="package.sign">

    <property name="src.root" value="."/>
    <property name="build.dir" value="${src.root}/build"/>
    <property name="checksum.dir" value="${src.root}/build/checksum"/>
    <property name="bin.dir" value="${src.root}/bin"/>
    <property name="data.dir" value="${src.root}/data"/>
    <property name="bin.stage.dir" value="${src.root}/bin/stages/stage0"/>
    <property name="bin.check.dir" value="${src.root}/bin/stages/check"/>
    <property name="readme.file" value="${src.root}/README.TXT"/>
    <property name="description.file" value="${src.root}/description.txt"/>
    <property name="updatefilelist.file" value="${src.root}/updatefilelist"/>
    <property name="jar.name" value="${src.root}/UpdateInstaller.jar"/>
    <property name="manifest.name" value="${src.root}/UpdateInstaller.mf"/>

    <target name="package.sign" depends="package">
        <echo message="Signing the Package Installer Jar"/>
    </target>

    <target name="checkPrepare">
        <condition property="installer.prepared">
            <and>
                <available file="${bin.dir}"/>
                <available file="${data.dir}"/>
                <available file="${build.dir}"/>
            </and>
        </condition>
    </target>

    <target name="package" depends="checkPrepare">
        <fail unless="installer.prepared">The update project needs to be prepared first. Please run prepare task</fail>
        <echo message="building the source and jar"/>
        <javac srcdir="${src.root}" destdir="${build.dir}" />
        
        <!--<checksum file="${updatefilelist.file}"/>-->
        <jar basedir="${build.dir}" destfile="${jar.name}" manifest="${manifest.name}"/>
    </target>

    <target name="prepare" depends="checkPrepare" unless="installer.prepared">
        <echo message="Creating the update project structure."/>
        <mkdir dir="${bin.check.dir}" />
        <mkdir dir="${bin.stage.dir}" />
        <mkdir dir="${data.dir}"/>
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${checksum.dir}"/>
        <echo file="${readme.file}" message="Place excutables that perform the installation tasks in bin/stages/stageX where X indicates the order in which stages are to be performed"/>
        <echo file="${description.file}" message="Enter a description of the update here"/>
        <echo message="*** Preparation complete. PLEASE READ THE README.TXT FILE ***"/>
    </target>

    <target name="clean">
        <delete dir="${build.dir}"/>
    </target>

</project>